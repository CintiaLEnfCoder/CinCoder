var bg;(()=>{"use strict";var t,e,i,s,n,a,r,o,c={28132:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.r(e),i.d(e,{Displacement:()=>a.KL,Gif:()=>a.nt,GifBuffer:()=>a.ZM,Layer:()=>a.mh,Mp4:()=>a.HE,PXD:()=>a.BS,Stroke:()=>a.mP,ZipReader:()=>a.Mr,ZipWriter:()=>a._Q,__wbg_buffer_3f3d764d4747d564:()=>a.jp,__wbg_height_c0440005f53e9792:()=>a.Wy,__wbg_new_4c0b35176d4e6c47:()=>a.BY,__wbg_newwithbyteoffsetandlength_b79525f5b383cdb2:()=>a.gI,__wbg_width_9a7937fdc4208452:()=>a.nx,__wbg_x_7af334499c70ecf9:()=>a.ut,__wbg_y_7b2e0b17f2702db7:()=>a.qY,__wbindgen_memory:()=>a.oH,__wbindgen_object_drop_ref:()=>a.ug,__wbindgen_string_new:()=>a.h4,__wbindgen_throw:()=>a.Or,distanceTransform:()=>a.TK,distanceTransformInv:()=>a.Mt});var n=i(72982),a=i(82646),r=t([n,a]);[n,a]=r.then?(await r)():r,s()}catch(o){s(o)}}))},82646:(t,e,i)=>{i.a(t,(async(s,n)=>{try{i.d(e,{BS:()=>F,BY:()=>X,HE:()=>z,KL:()=>A,Mr:()=>O,Mt:()=>L,Or:()=>Y,TK:()=>T,Wy:()=>G,ZM:()=>I,_Q:()=>B,gI:()=>V,h4:()=>U,jp:()=>W,mP:()=>N,mh:()=>R,nt:()=>D,nx:()=>H,oH:()=>j,qY:()=>q,ug:()=>K,ut:()=>$});var a=i(36817),r=i(72982);t=i.hmd(t);var o=s([r]);r=(o.then?(await o)():o)[0];let c=new("undefined"==typeof TextDecoder?(0,t.require)("util").TextDecoder:TextDecoder)("utf-8",{ignoreBOM:!0,fatal:!0});c.decode();let h=new Uint8Array;function l(){return 0===h.byteLength&&(h=new Uint8Array(r.memory.buffer)),h}function d(t,e){return c.decode(l().subarray(t,t+e))}const u=new Array(32).fill(void 0);u.push(void 0,null,!0,!1);let m=u.length;function p(t){m===u.length&&u.push(u.length+1);const e=m;return m=u[e],u[e]=t,e}function g(t){return u[t]}function v(t){t<36||(u[t]=m,m=t)}function f(t){const e=g(t);return v(t),e}let y=new Int32Array;function w(){return 0===y.byteLength&&(y=new Int32Array(r.memory.buffer)),y}let x=new Uint8ClampedArray;function b(t,e){return(0===x.byteLength&&(x=new Uint8ClampedArray(r.memory.buffer)),x).subarray(t/1,t/1+e)}let k=0;function S(t,e){const i=e(1*t.length);return l().set(t,i/1),k=t.length,i}let Z=new("undefined"==typeof TextEncoder?(0,t.require)("util").TextEncoder:TextEncoder)("utf-8");const P="function"==typeof Z.encodeInto?function(t,e){return Z.encodeInto(t,e)}:function(t,e){const i=Z.encode(t);return e.set(i),{read:t.length,written:i.length}};function E(t,e,i){if(void 0===i){const i=Z.encode(t),s=e(i.length);return l().subarray(s,s+i.length).set(i),k=i.length,s}let s=t.length,n=e(s);const a=l();let r=0;for(;r<s;r++){const e=t.charCodeAt(r);if(e>127)break;a[n+r]=e}if(r!==s){0!==r&&(t=t.slice(r)),n=i(n,s,s=r+3*t.length);const e=l().subarray(n+r,n+s);r+=P(t,e).written}return k=r,n}function C(t,e){return l().subarray(t/1,t/1+e)}let M=new Float32Array;function _(t,e){return(0===M.byteLength&&(M=new Float32Array(r.memory.buffer)),M).subarray(t/4,t/4+e)}function T(t,e,i){try{const o=r.__wbindgen_add_to_stack_pointer(-16),c=S(i,r.__wbindgen_malloc),h=k;r.distanceTransform(o,t,e,c,h);var s=w()[o/4+0],n=w()[o/4+1],a=_(s,n).slice();return r.__wbindgen_free(s,4*n),a}finally{r.__wbindgen_add_to_stack_pointer(16)}}function L(t,e,i){try{const o=r.__wbindgen_add_to_stack_pointer(-16),c=S(i,r.__wbindgen_malloc),h=k;r.distanceTransformInv(o,t,e,c,h);var s=w()[o/4+0],n=w()[o/4+1],a=_(s,n).slice();return r.__wbindgen_free(s,4*n),a}finally{r.__wbindgen_add_to_stack_pointer(16)}}class A{static __wrap(t){const e=Object.create(A.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_displacement_free(t)}constructor(t,e,i,s,n,a){const o=S(t,r.__wbindgen_malloc),c=k,h=r.displacement_new(o,c,e,i,s,n,a);return A.__wrap(h)}beginStroke(){const t=r.displacement_beginStroke(this.ptr);return N.__wrap(t)}setStampSize(t){r.displacement_setStampSize(this.ptr,t)}setDensity(t){r.displacement_setDensity(this.ptr,t)}setStrength(t){r.displacement_setStrength(this.ptr,t)}retarget(t,e,i){const s=S(t,r.__wbindgen_malloc),n=k;r.displacement_retarget(this.ptr,s,n,e,i)}setMode(t){const e=E(t,r.__wbindgen_malloc,r.__wbindgen_realloc),i=k;r.displacement_setMode(this.ptr,e,i)}applyFast(t){return f(r.displacement_applyFast(this.ptr,p(t)))}applyQuality(t){return f(r.displacement_applyQuality(this.ptr,p(t)))}}class D{static __wrap(t){const e=Object.create(D.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_gif_free(t)}constructor(t,e,i){try{const a=r.__wbindgen_add_to_stack_pointer(-16);r.gif_new(a,t,e,i);var s=w()[a/4+0],n=w()[a/4+1];if(w()[a/4+2])throw f(n);return D.__wrap(s)}finally{r.__wbindgen_add_to_stack_pointer(16)}}addFrame(t,e,i){try{const n=r.__wbindgen_add_to_stack_pointer(-16),a=S(t,r.__wbindgen_malloc),o=k;r.gif_addFrame(n,this.ptr,a,o,e,i);var s=w()[n/4+0];if(w()[n/4+1])throw f(s)}finally{r.__wbindgen_add_to_stack_pointer(16)}}takeResult(){try{const s=this.__destroy_into_raw(),n=r.__wbindgen_add_to_stack_pointer(-16);r.gif_takeResult(n,s);var t=w()[n/4+0],e=w()[n/4+1],i=b(t,e).slice();return r.__wbindgen_free(t,1*e),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class I{__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_gifbuffer_free(t)}}class R{static __wrap(t){const e=Object.create(R.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_layer_free(t)}get kind(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_kind(i,this.ptr);var t=w()[i/4+0],e=w()[i/4+1];return d(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}get x(){return r.layer_x(this.ptr)}get y(){return r.layer_y(this.ptr)}get name(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_name(i,this.ptr);var t=w()[i/4+0],e=w()[i/4+1];return d(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}get width(){return r.layer_width(this.ptr)}get height(){return r.layer_height(this.ptr)}get alpha(){return r.layer_alpha(this.ptr)}get blendMode(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_blendMode(i,this.ptr);var t=w()[i/4+0],e=w()[i/4+1];return d(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}get visible(){return 0!==r.layer_visible(this.ptr)}get locked(){return 0!==r.layer_locked(this.ptr)}get rotation(){return r.layer_rotation(this.ptr)}takeCanvas(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_takeCanvas(s,this.ptr);var t=w()[s/4+0],e=w()[s/4+1],i=b(t,e).slice();return r.__wbindgen_free(t,1*e),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}takeMask(){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.layer_takeMask(s,this.ptr);var t=w()[s/4+0],e=w()[s/4+1],i=b(t,e).slice();return r.__wbindgen_free(t,1*e),i}finally{r.__wbindgen_add_to_stack_pointer(16)}}get meta(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.layer_meta(i,this.ptr);var t=w()[i/4+0],e=w()[i/4+1];return d(t,e)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(t,e)}}}class z{static __wrap(t){const e=Object.create(z.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_mp4_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16);r.mp4_new(s,t);var e=w()[s/4+0],i=w()[s/4+1];if(w()[s/4+2])throw f(i);return z.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}addVideoTrack(t,e,i){try{const a=r.__wbindgen_add_to_stack_pointer(-16),o=S(i,r.__wbindgen_malloc),c=k;r.mp4_addVideoTrack(a,this.ptr,t,e,o,c);var s=w()[a/4+0],n=w()[a/4+1];if(w()[a/4+2])throw f(n);return s>>>0}finally{r.__wbindgen_add_to_stack_pointer(16)}}addFrame(t,e,i,s,n,a){try{const c=r.__wbindgen_add_to_stack_pointer(-16),h=S(a,r.__wbindgen_malloc),l=k;r.mp4_addFrame(c,this.ptr,t,e,i,s,n,h,l);var o=w()[c/4+0];if(w()[c/4+1])throw f(o)}finally{r.__wbindgen_add_to_stack_pointer(16)}}fetchFile(){try{const n=this.__destroy_into_raw(),a=r.__wbindgen_add_to_stack_pointer(-16);r.mp4_fetchFile(a,n);var t=w()[a/4+0],e=w()[a/4+1],i=w()[a/4+2];if(w()[a/4+3])throw f(i);var s=C(t,e).slice();return r.__wbindgen_free(t,1*e),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class F{static __wrap(t){const e=Object.create(F.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_pxd_free(t)}get width(){return r.__wbg_get_pxd_width(this.ptr)}set width(t){r.__wbg_set_pxd_width(this.ptr,t)}get height(){return r.__wbg_get_pxd_height(this.ptr)}set height(t){r.__wbg_set_pxd_height(this.ptr,t)}get layers(){return r.__wbg_get_pxd_layers(this.ptr)}set layers(t){r.__wbg_set_pxd_layers(this.ptr,t)}static decode(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16),n=S(t,r.__wbindgen_malloc),a=k;r.pxd_decode(s,n,a);var e=w()[s/4+0],i=w()[s/4+1];if(w()[s/4+2])throw f(i);return F.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}takeNextLayer(){try{const i=r.__wbindgen_add_to_stack_pointer(-16);r.pxd_takeNextLayer(i,this.ptr);var t=w()[i/4+0],e=w()[i/4+1];if(w()[i/4+2])throw f(e);return R.__wrap(t)}finally{r.__wbindgen_add_to_stack_pointer(16)}}}class N{static __wrap(t){const e=Object.create(N.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_stroke_free(t)}push(t,e,i){return f(r.stroke_push(this.ptr,t,e,i))}}class O{static __wrap(t){const e=Object.create(O.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_zipreader_free(t)}constructor(t){try{const s=r.__wbindgen_add_to_stack_pointer(-16),n=S(t,r.__wbindgen_malloc),a=k;r.zipreader_new(s,n,a);var e=w()[s/4+0],i=w()[s/4+1];if(w()[s/4+2])throw f(i);return O.__wrap(e)}finally{r.__wbindgen_add_to_stack_pointer(16)}}readFile(t){try{const a=r.__wbindgen_add_to_stack_pointer(-16),o=E(t,r.__wbindgen_malloc,r.__wbindgen_realloc),c=k;r.zipreader_readFile(a,this.ptr,o,c);var e=w()[a/4+0],i=w()[a/4+1],s=w()[a/4+2];if(w()[a/4+3])throw f(s);var n=C(e,i).slice();return r.__wbindgen_free(e,1*i),n}finally{r.__wbindgen_add_to_stack_pointer(16)}}readString(t){try{const c=r.__wbindgen_add_to_stack_pointer(-16),h=E(t,r.__wbindgen_malloc,r.__wbindgen_realloc),l=k;r.zipreader_readString(c,this.ptr,h,l);var e=w()[c/4+0],i=w()[c/4+1],s=w()[c/4+2],n=w()[c/4+3],a=e,o=i;if(n)throw a=0,o=0,f(s);return d(a,o)}finally{r.__wbindgen_add_to_stack_pointer(16),r.__wbindgen_free(a,o)}}}class B{static __wrap(t){const e=Object.create(B.prototype);return e.ptr=t,e}__destroy_into_raw(){const t=this.ptr;return this.ptr=0,t}free(){const t=this.__destroy_into_raw();r.__wbg_zipwriter_free(t)}constructor(){const t=r.zipwriter_new();return B.__wrap(t)}writeFile(t,e,i){try{const n=r.__wbindgen_add_to_stack_pointer(-16),a=E(t,r.__wbindgen_malloc,r.__wbindgen_realloc),o=k,c=S(e,r.__wbindgen_malloc),h=k;r.zipwriter_writeFile(n,this.ptr,a,o,c,h,i);var s=w()[n/4+0];if(w()[n/4+1])throw f(s)}finally{r.__wbindgen_add_to_stack_pointer(16)}}writeString(t,e,i){try{const n=r.__wbindgen_add_to_stack_pointer(-16),a=E(t,r.__wbindgen_malloc,r.__wbindgen_realloc),o=k,c=E(e,r.__wbindgen_malloc,r.__wbindgen_realloc),h=k;r.zipwriter_writeFile(n,this.ptr,a,o,c,h,i);var s=w()[n/4+0];if(w()[n/4+1])throw f(s)}finally{r.__wbindgen_add_to_stack_pointer(16)}}finish(){try{const n=this.__destroy_into_raw(),a=r.__wbindgen_add_to_stack_pointer(-16);r.zipwriter_finish(a,n);var t=w()[a/4+0],e=w()[a/4+1],i=w()[a/4+2];if(w()[a/4+3])throw f(i);var s=C(t,e).slice();return r.__wbindgen_free(t,1*e),s}finally{r.__wbindgen_add_to_stack_pointer(16)}}}function U(t,e){return p(d(t,e))}function $(t){return g(t).x}function q(t){return g(t).y}function H(t){return g(t).width}function G(t){return g(t).height}function j(){return p(r.memory)}function W(t){return p(g(t).buffer)}function V(t,e,i){return p(new Uint8ClampedArray(g(t),e>>>0,i>>>0))}function K(t){f(t)}function X(t,e,i,s){return p(new a.Z(t,e,i,s))}function Y(t,e){throw new Error(d(t,e))}n()}catch(c){n(c)}}))},81188:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.r(e);var n=i(74820),a=i(17030),r=t([a]);if(a=(r.then?(await r)():r)[0],"cGl4bHIuY29t"!==btoa(document.location.hostname.split(".").slice(-2).join(".")))throw new Error;n.ZP.product="bg";new a.Z;s()}catch(o){s(o)}}))},17030:(t,e,i)=>{i.a(t,(async(t,s)=>{try{i.d(e,{Z:()=>Z});var n=i(47985),a=i(96548),r=i(93947),o=i(33655),c=i(36817),h=i(71030),l=i(4256),d=i(56222),u=i(75934),m=i(95574),p=i(28132),g=i(31456),v=i(21951),f=i(4375),y=i(74820),w=i(33506),x=i(47630),b=i(57246),k=t([p]);p=(k.then?(await k)():k)[0];class S{constructor(t,e,i,s,n){this.id=t,this.name=e,this.original=i,this.preview=s,this.source=n}}class Z extends n.Z{constructor(){if(super(),this.fill="none",this.crop="none",this.selectFill=t=>{(0,h.Z)("fill",t),(0,r.ZP)("fill-"+this.fill).classList.remove("marked"),(0,r.ZP)("list").classList.remove(this.fill),this.fill=t,(0,r.ZP)("fill-"+this.fill).classList.add("marked"),(0,r.ZP)("list").classList.add(this.fill)},this.selectCrop=t=>{(0,h.Z)("crop",t),(0,r.ZP)("crop-"+this.crop).classList.remove("marked"),this.crop=t,(0,r.ZP)("crop-"+this.crop).classList.add("marked"),this.changeCrop()},this.openImage=async()=>{(0,h.Z)("open-browse"),await(0,u.Q0)(!0).then((async t=>{0!==t.length&&await this.append(t)}))},this.removeImage=t=>{(0,h.Z)("remove","image");const e=this.images.findIndex((e=>e.id===t));-1!==e&&this.images.splice(e,1),(0,r.ZP)(t).remove()},this.removeAll=()=>{(0,h.Z)("remove","all");for(let t of this.images)(0,r.ZP)(t.id).remove();this.images=[]},this.append=async(t,e)=>{(0,r.ZP)("hero").style.display="none",(0,r.ZP)("list").style.display="flex";const i=new Array;for(let s=0;s<t.length;s++){const n=o.M8();i.push({id:n,file:t[s],source:e}),(0,r.ZP)("list-open").before((0,r.T)("div",{id:n,className:"box queue"},(0,r.T)("div",{className:"loading small"})))}i.forEach((async t=>{var e;const i=t.id,s=t.file.name;(0,h.Z)("open-file",null!==(e=t.file.type)&&void 0!==e?e:"");try{const e=await(0,m.s4)(t.file);window.requestAnimationFrame((()=>{const n=c.Z.bestFit(e.width,e.height,500,250),a=c.Z.bestFit(e.width,e.height,4096,4096),h=o.eY(e,a.width,a.height),l=o.eY(h,n.width,n.height);l.id="preview-"+i;const d=new S(i,s,h,l,t.source);this.images.push(d),(0,r.ZP)(i).innerHTML="",(0,r.ZP)(i).classList.remove("queue");let u=(0,r.T)("img",{src:"/img/icon/close.svg",className:"close ic"});u.addEventListener("click",(()=>this.removeImage(i))),(0,r.ZP)(i).prepend(l,u),this.removeBackground(i)}))}catch(n){document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("fileNoOpen")})),(0,r.ZP)(i).remove()}}))},this.removeBackground=async t=>{const e=this.images.findIndex((e=>e.id===t)),i=this.images[e],s=(0,r.T)("div",{className:"overlay"},(0,r.T)("div",{className:"dot-floating"}));(0,r.ZP)(t).append(s);try{const t=await(0,d.J)(i.original);i.mask=o.vL(i.original.width,i.original.height);const e=this.shader.apply(o.qT(t,1080));i.mask.getContext("2d").drawImage(e,0,0,i.mask.width,i.mask.height)}catch(h){return void console.log(h)}i.baked=o.vL(i.original.width,i.original.height);const n=i.baked.getContext("2d");n.save(),n.globalCompositeOperation="copy",n.drawImage(i.original,0,0),n.globalCompositeOperation="destination-in",n.drawImage(i.mask,0,0),n.restore(),i.bounds=o.l(i.baked),this.updatePreview(i),s.remove();let c=(0,r.T)("div",{className:"options"},(0,r.T)("div",{onclick:()=>this.save(i)},(0,r.T)("img",{src:"/img/icon/download.svg"}),(0,a.Z)("save")),(0,r.T)("div",{className:"fine-tune premium",onclick:()=>this.fineTune(i)},(0,r.T)("img",{src:"/img/tool/thick/cutout.svg"}),(0,a.Z)("fineTune")));(0,r.ZP)(t).append(c)},this.changeCrop=()=>{for(let t of this.images)this.updatePreview(t)},this.updatePreview=t=>{const e=t.preview.getContext("2d");e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high";const i="bounds"===this.crop?c.Z.bestFit(t.bounds.width,t.bounds.height,500,250):c.Z.bestFit(t.baked.width,t.baked.height,500,250);t.preview.width=i.width,t.preview.height=i.height,e.clearRect(0,0,t.preview.width,t.preview.height),"bounds"===this.crop?e.drawImage(t.baked,t.bounds.x,t.bounds.y,t.bounds.width,t.bounds.height,0,0,t.preview.width,t.preview.height):e.drawImage(t.baked,0,0,t.preview.width,t.preview.height)},this.getSelected=()=>{const t=this.images.findIndex((t=>t.id===this.selected));return this.images[t]},this.getOutput=t=>{const e="bounds"===this.crop?o.vL(t.bounds.width,t.bounds.height):o.vL(t.baked.width,t.baked.height),i=e.getContext("2d");return"none"!==this.fill&&(i.fillStyle="black"===this.fill?"#000000":"#ffffff",i.fillRect(0,0,e.width,e.height)),"bounds"===this.crop?i.drawImage(t.baked,t.bounds.x,t.bounds.y,t.bounds.width,t.bounds.height,0,0,e.width,e.height):i.drawImage(t.baked,0,0,e.width,e.height),e},this.fineTune=t=>{(0,h.Z)("finetune"),"premium"===(null===w.a||void 0===w.a?void 0:w.a.subscriptionAccess)?new g.Z(t.original,t.mask,(e=>{t.mask=e,t.baked=o.vL(t.original.width,t.original.height);const i=t.baked.getContext("2d");i.save(),i.globalCompositeOperation="copy",i.drawImage(t.original,0,0),i.globalCompositeOperation="destination-in",i.drawImage(t.mask,0,0),i.restore(),t.bounds=o.l(t.baked),this.updatePreview(t)})):new v.Z("CUTOUT")},this.save=async t=>{if(!(null===w.a||void 0===w.a?void 0:w.a.subscription)&&(0,y.X6)())return void new b.Z;const e=this.getOutput(t);let i=t.name.lastIndexOf("."),s=-1!==i?t.name.substring(0,i):t.name;e.toBlob((async t=>{const e=new File([t],s+".png",{type:"image/png"});(0,x.vV)(e,s,"png"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("fileSaved")}))}),"image/png","100"),(0,y.ru)(),(0,h.Z)("save-file","png")},this.saveAll=async()=>{if(!(null===w.a||void 0===w.a?void 0:w.a.subscription)&&(0,y.X6)())return void new b.Z;const t=(0,r.T)("div",{id:"modal-remove-background",className:"modal"});document.body.appendChild(t);const e=new Array;for(let a=0;a<this.images.length;a++){document.dispatchEvent(new CustomEvent("loading",{detail:"Export "+(a+1)+" of "+this.images.length}));const t=this.getOutput(this.images[a]),i=await new Promise((e=>t.toBlob(e,"image/png",100)));e.push(new File([i],this.images[a].name.replace(/\.[^/.]+$/,"")+".png"))}document.dispatchEvent(new CustomEvent("loading",{detail:"Create zip"}));let i=new p.ZipWriter;for(let a=0;a<e.length;a++){const t=e[a];let s=await t.arrayBuffer(),n=new Uint8Array(s);i.writeFile(t.name,n,!1)}const s=i.finish(),n=new File([new Blob([s.buffer])],"background-remover.zip",{type:"application/zip"});(0,x.vV)(n,"background-remover","zip"),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("notification",{detail:(0,a.Z)("fileSaved")})),t.remove(),(0,y.ru)(),(0,h.Z)("save-file","zip")},this.images=new Array,this.shader=new l.Z,this.shader.addShader("alpha-shift-mask",!0),(0,r.ZP)("drop-open").addEventListener("click",this.openImage),(0,r.ZP)("list-open").addEventListener("click",this.openImage),(0,r.ZP)("open-photo").addEventListener("click",this.openImage),(0,r.ZP)("fill-none").addEventListener("click",(()=>this.selectFill("none"))),(0,r.ZP)("fill-white").addEventListener("click",(()=>this.selectFill("white"))),(0,r.ZP)("fill-black").addEventListener("click",(()=>this.selectFill("black"))),(0,r.ZP)("crop-none").addEventListener("click",(()=>this.selectCrop("none"))),(0,r.ZP)("crop-bounds").addEventListener("click",(()=>this.selectCrop("bounds"))),(0,r.ZP)("save-all").addEventListener("click",(()=>this.saveAll())),(0,r.ZP)("close-all").addEventListener("click",(()=>this.removeAll())),y.ZP.file){const t="/proxy/?url=";new f.Z({title:y.ZP.name,referrer:y.ZP.referrer}).load(t+encodeURIComponent(y.ZP.file)).then((async t=>{await this.append([t],"api")}))}}}s()}catch(S){s(S)}}))},47985:(t,e,i)=>{i.d(e,{Z:()=>p});var s=i(96548),n=i(93947),a=i(71030),r=i(43673),o=i(27969),c=i(74820),h=i(57909),l=i(33506),d=i(21951);class u extends h.Z{constructor(t,e=0){var i,r;if(super(),this.selectedIndex=e,this.dialog.classList.add("news-dialog"),this.dialog.style.maxWidth="unset",t.length>1){const r=t.map(((i,s)=>(0,n.T)("a",{id:`news-menu-item-${s}`,className:s===e?"item selected":"item",href:"javascript:;",onclick:()=>{var e;(0,n.ZP)(`news-menu-item-${this.selectedIndex}`).classList.remove("selected"),(0,n.ZP)(`news-menu-item-${s}`).classList.add("selected"),(0,n.ZP)("news-current").replaceWith(m(t[s])),this.selectedIndex=s,null===(e=(0,n.ZP)("new-checkout-cta"))||void 0===e||e.addEventListener("click",(()=>{new d.Z("news"),this.cleanUp()})),(0,a.Z)("news-select")}},(0,n.T)("div",{className:"block"}),(0,n.T)("div",i.title))));this.setContent((0,n.T)("div",{className:"news-split"},(0,n.T)("div",{className:"news-menu flair"},(0,n.T)("div",{className:"headline"},(0,s.Z)("whatsNew")),...r),m(t[e]))),null===(i=(0,n.ZP)("new-checkout-cta"))||void 0===i||i.addEventListener("click",(()=>{new d.Z("news"),this.cleanUp()}))}else this.setContent(m(t[0])),null===(r=(0,n.ZP)("new-checkout-cta"))||void 0===r||r.addEventListener("click",(()=>{new d.Z("news"),this.cleanUp()}));(0,c.Lt)("lastNewsCheck",(new Date).toISOString())}}function m(t,e){const i=new Date(t.publishDate);let s;if(t.video){const i=()=>{const e=Math.max(360,r.getBoundingClientRect().height),i=`https://www.youtube.com/embed/${t.video}?autoplay=1&modestbranding=1`;s.style.height=e+"px",r.style.filter="blur(6px)",(0,a.Z)("news-play"),s.append((0,n.T)("div",{className:"player-container"},(0,n.T)("iframe",{width:"640",height:"360",src:i,className:"player",allow:"autoplay"})))};let r=(0,n.T)("img",{className:"news-cover",src:t.cover,onload:e}),o=(0,n.T)("div",{className:"play-button",onclick:i},(0,n.T)("img",{src:"/img/icon/play-circle.svg"}));s=(0,n.T)("div",{className:"cover-stack"},r,o)}else s=(0,n.T)("img",{className:"news-cover",src:t.cover,onload:e});return(0,n.T)("div",{id:"news-current"},s,(0,n.T)("div",{className:"news-content"},(0,n.T)("div",{className:"news-title"},(0,n.T)("span",{className:"news-headline"},t.title),(0,n.T)("span",i.toLocaleDateString())),(0,n.T)("div",{className:"news-text"},t.text),t.checkoutCta&&"free"===(null===l.a||void 0===l.a?void 0:l.a.subscriptionAccess)?(0,n.T)("a",{className:"button med positive",style:"margin-left:auto",id:"new-checkout-cta",dataset:t.ctaDataset||{}},l.a?"GET A SUBSCRIPTION":"SIGN UP NOW!"):t.urlWeb?(0,n.T)("a",{className:"button med positive",style:"margin-left:auto",href:t.urlWeb,target:"_blank",onmousedown:()=>{(0,a.Z)("news-url-web")}},t.cta):""))}class p{constructor(){var t,e,i;this.pollNews=async()=>{const t=new Date(c.ZP.lastNewsCheck);this.news=await fetch(`https://pixlr.com/api/news/poll/?target=web&from=${t.toISOString()}&limit=5`).then((t=>t.json()));const e=await this.news;!1!==e.status?(e.data.unread>0&&!e.data.pop&&(0,n.ZP)("news-button").classList.add("notification"),e.data.pop&&new u(e.data.news.docs)):console.error(e.message)},this.newsClick=async()=>{(0,a.Z)("news-click");const t=await this.news;!1!==t.status&&t.data.news.docs.length?((0,n.ZP)("news-button").classList.remove("notification"),new u(t.data.news.docs)):document.dispatchEvent(new CustomEvent("notification",{detail:"No news :/"}))},this.optimizeForPWA=()=>{if((0,n.ZP)("app-selector")){const t=(0,n.ZP)("app-selector").getElementsByTagName("a");for(let e=0;e<t.length;e++)t[e].setAttribute("target","_blank")}(0,n.ZP)("logo-plate")&&(0,n.ZP)("logo-plate").remove(),document.title="Remove bg"},this.showMobilePop=t=>{const e="ios"===t?"https://apps.apple.com/app/apple-store/id1592957878?pt=122065465&ct=rbg-www&mt=8":"https://play.google.com/store/apps/details?id=com.pixlr.removebg&utm_source=product-www&utm_campaign=rbg-www&utm_medium=www",i="ios"===t?"/images/mobile/app-store-white.svg":"/images/mobile/google-play-dark.svg",a=(0,n.T)("a",{id:"app-alert",href:e,target:"_new"},(0,n.T)("img",{id:"app-icon",src:"/img/misc/bg-icon.svg"}),(0,n.T)("div",{},(0,n.T)("h3",{},(0,s.Z)("getApp")),(0,n.T)("p",{},(0,s.Z)("getAppDesc")),(0,n.T)("img",{id:"store-icon",src:i})),(0,n.T)("img",{className:"close",src:"/img/icon/close.svg",onclick:t=>(t.stopPropagation(),t.preventDefault(),a.remove(),!1)}));document.body.append(a)},this.center=t=>new r.Z(Math.round(document.body.clientWidth/2-t.clientWidth/2),Math.round(document.body.clientHeight/2-t.clientHeight/2)),this.notification=t=>{const e=(0,n.ZP)("notification");e&&(this.notiId&&(clearTimeout(this.notiId),e.innerHTML="",e.style.display="none"),requestAnimationFrame((()=>{e.style.display="block",e.innerHTML='<div class="message">'+t.detail+"</div>";const i=this.center(e);e.style.top=i.y+"px",e.style.left=i.x+"px"})),this.notiId=setTimeout((function(){e.innerHTML="",e.style.top="-999px",e.style.left="-999px",e.style.display="none"}),800))},this.loading=t=>{const e=(0,n.ZP)("notification");if(!e)return;if("stop"===t.detail)return void(this.keepLoading?this.keepLoading=!1:(e.innerHTML="",e.style.display="none"));this.notiId&&(clearTimeout(this.notiId),e.innerHTML="",e.style.display="none"),this.notiId=setTimeout((()=>{this.keepLoading?this.keepLoading=!1:(e.innerHTML="",e.style.top="-999px",e.style.left="-999px",e.style.display="none")}),400),e.style.display="block",e.innerHTML=`\n            <div class="spinner">\n                ${"start"===t.detail?"Loading":t.detail}<span>.</span><span>.</span><span>.</span>\n            </div>\n        `;const i=this.center(e);e.style.top=i.y+"px",e.style.left=i.x+"px",this.keepLoading=!0},this.navigate=t=>{"editor"===t?((0,n.ZP)("home").style.display="none",(0,n.ZP)("workspace").style.display="block",history.pushState(null,null,"#editor"),this.lastHash="#editor",document.dispatchEvent(new CustomEvent("resize")),(0,n.ZP)("editor-list").append(...Array.from((0,n.ZP)("source-list").childNodes))):(this.lastHash=void 0,(0,n.ZP)("home").style.display="block",(0,n.ZP)("workspace").style.display="none",history.replaceState(null,null," "),(0,n.ZP)("source-list").append(...Array.from((0,n.ZP)("editor-list").childNodes)))},this.isModal=()=>document.getElementsByClassName("modal").length>0,history.replaceState(null,null," "),document.documentElement.classList.add(c.ZP.workspace,c.ZP.accent),null===(t=(0,n.ZP)("login"))||void 0===t||t.addEventListener("click",(()=>new o.ZP)),null===(e=(0,n.ZP)("news-button"))||void 0===e||e.addEventListener("click",this.newsClick),null===(i=(0,n.ZP)("try-premium"))||void 0===i||i.addEventListener("click",(()=>new d.Z("HOME"))),(window.matchMedia("(display-mode: standalone)").matches||document.referrer.includes("android-app://"))&&(document.documentElement.classList.add("standalone"),this.optimizeForPWA()),/iPad|iPhone|iPod/.test(navigator.userAgent)&&this.showMobilePop("ios"),/android/i.test(navigator.userAgent)&&this.showMobilePop("android"),document.addEventListener("loading",(t=>this.loading(t)),!0),document.addEventListener("notification",(t=>this.notification(t)),!0),this.pollNews()}}},71030:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(74820),n=i(33506);const a=(t,e)=>{var i,a,r;"undefined"==typeof gtag||(null!==(a=null===(i=window.dataLayer)||void 0===i?void 0:i.length)&&void 0!==a?a:0)>1e3||gtag("event",t,{product:s.ZP.product,user_type:null!==(r=null===n.a||void 0===n.a?void 0:n.a.type)&&void 0!==r?r:"guest",label:e})}},92396:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(83990),n=i(87318);class a{constructor(t=!1,e,i,s,n){this.block=t,this.enter=e,this.scene=i,this.exit=s,this.stagger=n}}a.fromInjection=(t,e)=>{let i=e?a.clone(e):new a;if(i.block=!1,!t)return i;if(t.enter&&(i.enter&&(t.enter.delay=i.enter.delay,t.enter.speed=i.enter.speed),i.enter=t.enter,i.enter.duration=i.enter.duration?i.enter.duration:a.getMotionsDuration(i.enter.motions)),t.scene&&(i.scene&&(t.scene.delay=i.scene.delay,t.scene.speed=i.scene.speed,t.scene.repeat=i.scene.repeat,t.scene.gap=i.scene.gap),i.scene=t.scene,i.scene.motions)){let t=a.getMotionsDuration(i.scene.motions);i.scene.duration=t+i.scene.repeat*(t+i.scene.gap)}return t.exit&&(i.exit&&(t.exit.delay=i.exit.delay,t.exit.speed=i.exit.speed),i.exit=t.exit,i.exit.duration=a.getMotionsDuration(i.exit.motions)),t.stagger&&(i.stagger=t.stagger),i},a.getSegment=(t,e)=>{if(e)switch(t){case"enter":return e.enter;case"scene":return e.scene;case"exit":return e.exit}},a.setSegmentSpeed=(t,e)=>{if(!t)return;t.speed=e;let i=a.getMotionsDuration(t.motions,t.speed);t.duration=i+t.repeat*(i+t.gap)},a.setSegmentRepeat=(t,e)=>{if(!t)return;let i=a.getMotionsDuration(t.motions,t.speed);t.repeat=e,t.duration=i+e*(i+t.gap)},a.setSegmentGap=(t,e)=>{if(!t)return;let i=a.getMotionsDuration(t.motions,t.speed);t.gap=e,t.duration=i+t.repeat*(i+t.gap)},a.getAnimationSegment=(t,e)=>{if(!e)return;const i=new a(e.block);return"enter"===t&&(i.enter=new s.Z(e.enter.name,[...e.enter.motions],e.enter.option,e.enter.duration,e.enter.delay,e.enter.speed,e.enter.repeat,e.enter.gap)),"scene"===t&&(i.scene=new s.Z(e.scene.name,[...e.scene.motions],e.scene.option,e.scene.duration,e.scene.delay,e.scene.speed,e.scene.repeat,e.scene.gap)),"exit"===t&&(i.exit=new s.Z(e.exit.name,[...e.exit.motions],e.exit.option,e.exit.duration,e.exit.delay,e.exit.speed,e.exit.repeat,e.exit.gap)),i},a.getMotionsDuration=(t,e=1)=>{if(!t||0===t.length)return 0;let i=0;for(const s of t)i=Math.max(i,Math.round((s.delay+s.duration)*e));return i},a.clone=t=>{if(!t)return;const e=new a(t.block);return t.enter&&(e.enter=new s.Z(t.enter.name,[...t.enter.motions],t.enter.option,t.enter.duration,t.enter.delay,t.enter.speed,t.enter.repeat,t.enter.gap)),t.scene&&(e.scene=new s.Z(t.scene.name,[...t.scene.motions],t.scene.option,t.scene.duration,t.scene.delay,t.scene.speed,t.scene.repeat,t.scene.gap)),t.exit&&(e.exit=new s.Z(t.exit.name,[...t.exit.motions],t.exit.option,t.exit.duration,t.exit.delay,t.exit.speed,t.exit.repeat,t.exit.gap)),t.stagger&&(e.stagger=new n.Z(t.stagger.duration,t.stagger.metod)),e}},47339:(t,e,i)=>{i.d(e,{Z:()=>d});var s=i(99872),n=i(43673),a=i(98776),r=i(4256),o=i(89422),c=i(78685),h=i(87318),l=i(92396);class d{constructor(t,e){this.scantime=0,this.scantype="none",this.getDuration=()=>{let t=0;return this.transitions.forEach((e=>{t=Math.max(t,e.getDuration())})),t},this.prepare=t=>{for(const e of this.transitions)e.motion.fill&&(e.begin(this.getProperty(e.motion.method,t)),this.setProperty(e.motion.method,e.motion.manner,t,e.step(0)))},this.step=(t,e)=>{for(const i of this.transitions)i.shouldRun(t)&&(i.playing||i.begin(this.getProperty(i.motion.method,e)),this.setProperty(i.motion.method,i.motion.manner,e,i.step(t)))},this.setProperty=(t,e,i,s)=>{switch(t){case"opacity":this.layer.transform.opacity=s;break;case"rotate":this.layer.transform.rotation=360*s,this.layer.transform.rAnchor=this.anchorToPoint(e);break;case"scale":this.layer.transform.scale.x=s,this.layer.transform.scale.y=s,this.layer.transform.sAnchor=this.anchorToPoint(e);break;case"scale-width":this.layer.transform.scale.x=s,this.layer.transform.sAnchor=this.anchorToPoint(e);break;case"scale-height":this.layer.transform.scale.y=s,this.layer.transform.sAnchor=this.anchorToPoint(e);break;case"self-x":this.layer.transform.offset.x=s*this.layer.getRect().width;break;case"self-y":this.layer.transform.offset.y=s*this.layer.getRect().height;break;case"offset-x":this.layer.transform.offset.x=s*i.width;break;case"offset-y":this.layer.transform.offset.y=s*i.height;break;case"viewport-x":this.layer.transform.offset.x=s*i.width-this.layer.getRect().center().x;break;case"viewport-y":this.layer.transform.offset.y=s*i.height-this.layer.getRect().center().y;break;case"viewport-box-x":const n=this.transformedRectWidth();this.layer.transform.offset.x=this.layer.getRect().center().x-(.5*n+s*(i.width-n));break;case"viewport-box-y":const a=this.transformedRectHeight();this.layer.transform.offset.y=this.layer.getRect().center().y-(.5*a+s*(i.height-a));break;default:this.setShader(t,s,e)}},this.transformedRectWidth=()=>this.layer.getRect().width*this.layer.transform.scale.x,this.transformedRectHeight=()=>this.layer.getRect().height*this.layer.transform.scale.y,this.anchorToPoint=t=>{switch(t){case"topleft":return new n.Z(0,0);case"top":return new n.Z(.5,0);case"topright":return new n.Z(1,0);case"left":return new n.Z(0,.5);case"center":return new n.Z(.5,.5);case"right":return new n.Z(1,.5);case"bottomleft":return new n.Z(0,1);case"bottom":return new n.Z(.5,1);case"bottomright":return new n.Z(1,1)}return new n.Z(.5,.5)},this.setShader=(t,e,i)=>{switch(this.shaders||(this.shaders=new r.Z),t){case"wipe":this.shaders.addShader("wipe",{direction:i,amount:e});break;case"swipe":this.shaders.addShader("swipe",{direction:i,amount:e,color:this.getLayerAccent()});break;case"slot":this.shaders.addShader("slot",{direction:i,amount:e});break;case"blinds":this.shaders.addShader("blinds",{direction:i,amount:e});break;case"melt":this.shaders.addShader("melt",{direction:i,amount:e});break;case"warp":this.shaders.addShader("warp",{direction:i,amount:e});break;case"curtain":this.shaders.addShader("curtain",{direction:i,amount:e});break;case"split":this.shaders.addShader("split",{direction:i,sections:2,amount:e});break;case"line":this.shaders.addShader("split",{direction:i,sections:8,amount:e});break;case"marquee":this.shaders.addShader("marquee",{direction:i,amount:e});break;default:this.shaders.addShader(t,e)}this.layer.transient=this.shaders.apply(this.layer.baked?this.layer.baked:this.layer.canvas)},this.getLayerAccent=()=>this.layer instanceof c.Z&&"color"===this.layer.fill.getType()?this.layer.fill.value:new a.Z(255,255,255),this.getProperty=(t,e)=>{switch(t){case"opacity":return this.layer.transform.opacity;case"rotate":return this.layer.transform.rotation/360;case"scale":case"scale-width":return this.layer.transform.scale.x;case"scale-height":return this.layer.transform.scale.y;case"self-x":return this.layer.transform.offset.x/this.layer.getRect().width;case"self-y":return this.layer.transform.offset.y/this.layer.getRect().height;case"offset-x":return this.layer.transform.offset.x/e.width;case"offset-y":return this.layer.transform.offset.y/e.height;case"viewport-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/e.width;case"viewport-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/e.height;case"viewport-box-x":return(this.layer.getRect().center().x+this.layer.transform.offset.x)/(e.width-this.transformedRectWidth());case"viewport-box-y":return(this.layer.getRect().center().y+this.layer.transform.offset.y)/(e.height-this.transformedRectHeight())}return 0},this.finish=()=>{this.layer.transient=void 0,this.layer.transform=void 0},this.layer=t,this.transitions=e,this.layer.transform={sAnchor:new n.Z(.5,.5),rAnchor:new n.Z(.5,.5),scale:new n.Z(1,1),offset:new n.Z(0,0),rotation:0,opacity:1}}}d.bakeAnimators=t=>{const e=new Array;for(const i of t.layers)if(i.rect)if(!i.animation&&t.animation){const s=d.createPageTransitions(i,t,t.animation);s.length>0&&e.push(new d(i,s))}else if(i.animation&&!i.animation.block){const t=d.createLayerTransitions(i.animation);e.push(new d(i,t))}return e},d.createPageTransitions=(t,e,i)=>{const n=e.layerNr(t.id),a=e.layers.length,r=new s.Z(e.width,e.height),c=d.filterMotions(i.enter,t,n,a,r),l=d.filterMotions(i.scene,t,n,a,r),u=d.filterMotions(i.exit,t,n,a,r);if(!c&&!l&&!u&&0===c.length&&0===l.length&&0===u.length)return;const m=0===n&&t.settings.locked?0:h.Z.getOffset(t,e,i.stagger),p=i.enter?i.enter.duration+i.enter.delay:0,g=i.scene?i.scene.duration+i.scene.delay:0,v=new Array;if(c)for(const s of c)v.push(new o.Z(s,i.enter.speed,i.enter.delay+m));if(l)for(const s of l)v.push(new o.Z(s,i.scene.speed,i.scene.delay+m+p));if(u)for(const s of u)v.push(new o.Z(s,i.exit.speed,i.enter.delay+m+p+g));return v},d.createLayerTransitions=(t,e=!1)=>{const i=!!t.enter,s=!!t.scene,n=new Array;let a=i?t.enter.duration:0,r=s?t.scene.duration:0;if(!e&&i&&(a+=t.enter.delay),(e&&i&&s||!e&&s)&&(r+=t.scene.delay),t.enter){const i=e?0:t.enter.delay;for(const e of t.enter.motions)n.push(new o.Z(e,t.enter.speed,i))}if(t.scene){const s=e&&!i?0:t.scene.delay;for(const e of t.scene.motions)n.push(new o.Z(e,t.scene.speed,s+a));if(t.scene.repeat>0){let e=l.Z.getMotionsDuration(t.scene.motions,t.scene.speed),i=e+t.scene.gap;for(let r=0;r<t.scene.repeat;r++){for(const e of t.scene.motions)n.push(new o.Z(e,t.scene.speed,i+s+a));i+=e+t.scene.gap}}}if(t.exit){const c=!e||i||s?t.exit.delay:0;for(const e of t.exit.motions)n.push(new o.Z(e,t.exit.speed,c+a+r))}return n},d.createSegmentTransitions=t=>{const e=new Array;if(t)for(const i of t.motions)e.push(new o.Z(i,t.speed));return e},d.filterMotions=(t,e,i,s,n)=>{if(!t||!t.motions||0===t.motions.length)return;let a;for(const r of t.motions)if(d.filterMotion(e,i,s,n,r)){a=r.filter;break}return t.motions.filter((t=>t.filter===a))},d.filterMotion=(t,e,i,s,n)=>{if("background"===n.filter)return 0===e&&t.settings.locked;if(0===e&&t.settings.locked)return!1;if("foreground"===n.filter)return e===i-1;if("all"===n.filter||n.filter===t.type)return!0;if("large"===n.filter)return t.getRect().width>.75*s.width||t.getRect().height>.75*s.height;if("medium"===n.filter)return t.getRect().width>.25*s.width&&t.getRect().width<.75*s.width&&t.getRect().height>.25*s.height&&t.getRect().height<.75*s.height;if("small"===n.filter)return t.getRect().width<.25*s.width||t.getRect().height<.25*s.height;switch(n.filter){case"odd":return e%2==1;case"even":return e%2==0;case"1-three":return e%3==0;case"2-three":return e%3==1;case"3-three":return e%3==2;case"1-four":return e%4==0;case"2-four":return e%4==1;case"3-four":return e%4==2;case"4-four":return e%4==3}}},71750:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t){switch(this.type=t,this.type){case s.EASE_LINEAR:this.calculate=s.linear;break;case s.EASE_TWENTY_LADDER:this.calculate=s.ladderTwenty;break;case s.EASE_TEN_LADDER:this.calculate=s.ladderTen;break;case s.EASE_FIVE_LADDER:this.calculate=s.ladderFive;break;case s.EASE_THREE_LADDER:this.calculate=s.ladderThree;break;case s.EASE_IN_SINE:this.calculate=s.inSine;break;case s.EASE_OUT_SINE:this.calculate=s.outSine;break;case s.EASE_IN_OUT_SINE:this.calculate=s.inOutSine;break;case s.EASE_IN_CUBIC:this.calculate=s.inCubic;break;case s.EASE_OUT_CUBIC:this.calculate=s.outCubic;break;case s.EASE_IN_OUT_CUBIC:this.calculate=s.inOutCubic;break;case s.EASE_IN_QUINT:this.calculate=s.inQuint;break;case s.EASE_OUT_QUINT:this.calculate=s.outQuint;break;case s.EASE_IN_OUT_QUINT:this.calculate=s.inOutQuint;break;case s.EASE_IN_CIRC:this.calculate=s.inCirc;break;case s.EASE_OUT_CIRC:this.calculate=s.outCirc;break;case s.EASE_IN_OUT_CIRC:this.calculate=s.inOutCirc;break;case s.EASE_IN_QUAD:this.calculate=s.inQuad;break;case s.EASE_OUT_QUAD:this.calculate=s.outQuad;break;case s.EASE_IN_OUT_QUAD:this.calculate=s.inOutQuad;break;case s.EASE_IN_QUART:this.calculate=s.inQuart;break;case s.EASE_OUT_QUART:this.calculate=s.outQuart;break;case s.EASE_IN_OUT_QUART:this.calculate=s.inOutQuart;break;case s.EASE_IN_EXPO:this.calculate=s.inExpo;break;case s.EASE_OUT_EXPO:this.calculate=s.outExpo;break;case s.EASE_IN_OUT_EXPO:this.calculate=s.inOutExpo;break;case s.EASE_IN_BACK:this.calculate=s.inBack;break;case s.EASE_OUT_BACK:this.calculate=s.outBack;break;case s.EASE_IN_OUT_BACK:this.calculate=s.inOutBack;break;case s.EASE_IN_BOUNCE:this.calculate=s.inBounce;break;case s.EASE_OUT_BOUNCE:this.calculate=s.outBounce;break;case s.EASE_IN_OUT_BOUNCE:this.calculate=s.inOutBounce;break;case s.EASE_IN_ELASTIC:this.calculate=s.inElastic;break;case s.EASE_OUT_ELASTIC:this.calculate=s.outElastic;break;case s.EASE_IN_OUT_ELASTIC:this.calculate=s.inOutElastic}}static inOutQuint(t){return t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2}static outCirc(t){return Math.sqrt(1-Math.pow(t-1,2))}static inOutCirc(t){return t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2}}s.EASE_LINEAR="linear",s.EASE_TWENTY_LADDER="twenty-ladder",s.EASE_TEN_LADDER="ten-ladder",s.EASE_FIVE_LADDER="five-ladder",s.EASE_THREE_LADDER="three-ladder",s.EASE_IN_SINE="in-sine",s.EASE_OUT_SINE="out-sine",s.EASE_IN_OUT_SINE="in-out-sine",s.EASE_IN_CUBIC="in-cubic",s.EASE_OUT_CUBIC="out-cubic",s.EASE_IN_OUT_CUBIC="in-out-cubic",s.EASE_IN_QUINT="in-quint",s.EASE_OUT_QUINT="out-quint",s.EASE_IN_OUT_QUINT="in-out-quint",s.EASE_IN_CIRC="in-circ",s.EASE_OUT_CIRC="out-circ",s.EASE_IN_OUT_CIRC="in-out-circ",s.EASE_IN_QUAD="in-quad",s.EASE_OUT_QUAD="out-quad",s.EASE_IN_OUT_QUAD="in-out-quad",s.EASE_IN_QUART="in-quart",s.EASE_OUT_QUART="out-quart",s.EASE_IN_OUT_QUART="in-out-quart",s.EASE_IN_EXPO="in-expo",s.EASE_OUT_EXPO="out-expo",s.EASE_IN_OUT_EXPO="in-out-expo",s.EASE_IN_BACK="in-back",s.EASE_OUT_BACK="out-back",s.EASE_IN_OUT_BACK="in-out-back",s.EASE_IN_BOUNCE="in-bounce",s.EASE_OUT_BOUNCE="out-bounce",s.EASE_IN_OUT_BOUNCE="in-out-bounce",s.EASE_IN_ELASTIC="in-elastic",s.EASE_OUT_ELASTIC="out-elastic",s.EASE_IN_OUT_ELASTIC="in-out-elastic",s.linear=t=>t,s.ladderTwenty=t=>s.ladder(t,20),s.ladderTen=t=>s.ladder(t,10),s.ladderFive=t=>s.ladder(t,5),s.ladderThree=t=>s.ladder(t,3),s.ladder=(t,e)=>Math.ceil(t*e)*(1/e),s.inSine=t=>1-Math.cos(t*Math.PI/2),s.outSine=t=>Math.sin(t*Math.PI/2),s.inOutSine=t=>-(Math.cos(Math.PI*t)-1)/2,s.inCubic=t=>t*t*t,s.outCubic=t=>1-Math.pow(1-t,3),s.inOutCubic=t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,s.inQuint=t=>t*t*t*t*t,s.outQuint=t=>1-Math.pow(1-t,5),s.inCirc=t=>1-Math.sqrt(1-Math.pow(t,2)),s.inQuad=t=>t*t,s.outQuad=t=>1-(1-t)*(1-t),s.inOutQuad=t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,s.inQuart=t=>t*t*t*t,s.outQuart=t=>1-Math.pow(1-t,4),s.inOutQuart=t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,s.inExpo=t=>0===t?0:Math.pow(2,10*t-10),s.outExpo=t=>1===t?1:1-Math.pow(2,-10*t),s.inOutExpo=t=>0===t?0:1===t?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,s.inBack=t=>{const e=1.70158;return 2.70158*t*t*t-e*t*t},s.outBack=t=>{const e=1.70158;return 1+2.70158*Math.pow(t-1,3)+e*Math.pow(t-1,2)},s.inOutBack=t=>{const e=2.5949095;return t<.5?Math.pow(2*t,2)*(7.189819*t-e)/2:(Math.pow(2*t-2,2)*((e+1)*(2*t-2)+e)+2)/2},s.inBounce=t=>1-s.outBounce(1-t),s.outBounce=t=>{const e=7.5625,i=2.75;return t<1/i?e*t*t:t<2/i?e*(t-=1.5/i)*t+.75:t<2.5/i?e*(t-=2.25/i)*t+.9375:e*(t-=2.625/i)*t+.984375},s.inOutBounce=t=>t<.5?(1-s.outBounce(1-2*t))/2:(1+s.outBounce(2*t-1))/2,s.inElastic=t=>{const e=2*Math.PI/3;return 0===t?0:1===t?1:-Math.pow(2,10*t-10)*Math.sin((10*t-10.75)*e)},s.outElastic=t=>{const e=2*Math.PI/3;return 0===t?0:1===t?1:Math.pow(2,-10*t)*Math.sin((10*t-.75)*e)+1},s.inOutElastic=t=>{const e=2*Math.PI/4.5;return 0===t?0:1===t?1:t<.5?-Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*e)/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*e)/2+1}},83990:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e,i,n=0,a=0,r=s.SPEED_NORMAL,o=0,c=0){this.name=t,this.motions=e,this.option=i,this.duration=n,this.delay=a,this.speed=r,this.repeat=o,this.gap=c}}s.SPEED_SLOW=2,s.SPEED_NORMAL=1,s.SPEED_FAST=.5},87318:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(33655),n=i(43673);class a{constructor(t,e="top"){this.duration=t,this.metod=e}}a.getOffset=(t,e,i)=>{let a=0;if(void 0===i||0===i.duration||!t.rect)return a;switch(i.metod){case"top":a=t.getRect().y/e.height;break;case"bottom":a=1-t.getRect().y/e.height;break;case"left":a=t.getRect().x/e.width;break;case"right":a=1-t.getRect().x/e.width;break;case"back":a=e.layerNr(t.id)/e.layers.length;break;case"front":a=1-e.layerNr(t.id)/e.layers.length;break;case"center":a=new n.Z(e.width/2,e.height/2).distanceTo(t.getRect().center())/Math.sqrt(e.width*e.width+e.height*e.height)/2;break;case"bounds":a=1-new n.Z(e.width/2,e.height/2).distanceTo(t.getRect().center())/Math.sqrt(e.width*e.width+e.height*e.height)/2}return Math.round((0,s.uZ)(a*i.duration,0,i.duration))}},93409:(t,e,i)=>{i(33655),i(47339)},89422:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(71750);class n{constructor(t,e,i=0){this.shouldRun=t=>{const e=t<this.idelay,i=t>this.idelay+this.iduration;return i&&!this.end?(this.end=!0,!0):!e&&!i},this.getDuration=()=>this.idelay+this.iduration,this.fill=t=>{this.initial=void 0===this.motion.value.set?t:this.motion.value.set;const e=void 0===this.motion.value.from?this.initial:this.motion.value.from,i=void 0===this.motion.value.to?this.initial:this.motion.value.to;return 2===this.motion.direction||4===this.motion.direction?i-(i-e):e+(i-e)},this.begin=t=>{this.end=!1,this.playing=!0,this.initial=void 0===this.motion.value.set?t:this.motion.value.set,this.ibefore=void 0===this.motion.value.from?this.initial:this.motion.value.from,this.iafter=void 0===this.motion.value.to?this.initial:this.motion.value.to},this.step=t=>{if(0===t||t-this.idelay<1||0===this.ipass||0===this.motion.iterations)return this.ibefore;let e=Math.ceil((t-this.idelay)/this.ipass),i=(t-this.idelay)%this.ipass,s=0===i?1:i/this.ipass;(this.end||e>this.motion.iterations)&&(e=this.motion.iterations,s=1);const n=(this.iafter-this.ibefore)*this.ease.calculate(s);return this.flip(e)?this.iafter-n:this.ibefore+n},this.flip=t=>2===this.motion.direction||3===this.motion.direction&&t%2==0||4===this.motion.direction&&t%2==1,this.motion=t,this.ease=new s.Z(t.easing),this.idelay=Math.round(this.motion.delay*e+i),this.iduration=Math.round(this.motion.duration*e),this.ipass=0===this.iduration||0===this.motion.iterations?0:this.iduration/this.motion.iterations}}},4231:(t,e,i)=>{i.d(e,{$f:()=>n,Ef:()=>l,Gr:()=>r,_Y:()=>c,c0:()=>o,o5:()=>a,ox:()=>h});var s=i(93947);async function n(t,e="GET",i={},n=!1){try{const a={"Content-Type":"application/json"};n&&(a.Authorization=`Bearer ${(0,s.pR)("__pat","")}`);const r={method:e,headers:a};"GET"!==e&&(r.body=JSON.stringify(i));const o=await fetch(t,r);return await o.json()}catch(a){return console.error(a),{status:!1,message:"Internal Server Error"}}}const a=()=>n("/checkout/plans"),r=t=>n("/checkout/upgrade/details","POST",{plan:t}),o=(t={})=>n("/checkout/paymentmethods","POST",t),c=(t,e)=>n(`/paypal/polling?id=${t}&type=${e}`,"POST"),h=()=>n("/api/country/"),l=async()=>{try{const t=await fetch("/api/geoip/"),e=await t.json();return e.registeredCountry.isoCode}catch(t){return"US"}}},27969:(t,e,i)=>{i.d(e,{ZP:()=>h,od:()=>c});var s=i(96548),n=i(71030),a=i(4231),r=i(93947),o=i(61293);const c={AF:"Afghanistan",AX:"Åland Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo, Republic of the (Brazzaville)",CD:"Congo, the Democratic Republic of the (Kinshasa)",CK:"Cook Islands",CR:"Costa Rica",CI:"Côte d'Ivoire, Republic of",HR:"Croatia",CU:"Cuba",CW:"Curaçao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Islas Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern and Antarctic Lands",GA:"Gabon",GM:"Gambia, The",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Laos",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestine, State of",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"Réunion",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint Barthélemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"};class h{constructor(t="chooser",e={method:"popup"}){this.setContent=async(t,e)=>{var i;let s="";switch(t){case"chooser":s=this.Form.chooser();break;case"login":s=this.Form.login();break;case"register":s=await this.Form.register();break;case"forgotPassword":s=this.Form.forgotPassword();break;case"setPassword":this.loadCaptcha(),s=this.Form.resetPassword(!0);break;case"resetPassword":this.loadCaptcha(),s=this.Form.resetPassword();break;case"verification":s=this.Form.verification(null!==(i=e.verify)&&void 0!==i?i:"verification");break;case"changePassword":s=this.Form.changePassword();break;case"changeEmail":s=this.Form.changeEmail();break;case"changeUsername":s=this.Form.changeUsername((0,r.ZP)("change-name").dataset.name);break;case"deleteAccount":const t=(0,r.ZP)("delete-account").dataset.name||"User";s=this.Form.deleteAccount(t);break;case"deleteAccountConfirmation":s=this.Form.deleteAccountConfirmation(e.reason);break;case"additionalVerification":this.passwordVerification="pending",s=this.Form.additionalVerification()}this.content.innerHTML=s,this.setFooter(t)},this.setFooter=t=>{switch(this.footer.style.display="block",t){case"login":this.footer.innerHTML=`${(0,s.Z)("common-notMember")} &nbsp; <a class="anchor" id="load-chooser">${(0,s.Z)("common-signUpNow")}</a>`,(0,r.ZP)("load-chooser").onclick=()=>this.loadForm("chooser");break;case"register":this.footer.innerHTML=`${(0,s.Z)("common-alreadyMember")} &nbsp; <a class="anchor" id="load-login">${(0,s.Z)("common-loginHere")}</a>`,(0,r.ZP)("load-login").onclick=()=>this.loadForm("login");break;case"forgotPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,s.Z)("common-back")}</a>`,(0,r.ZP)("entry-back").onclick=()=>this.loadForm("login");break;case"resetPassword":this.footer.innerHTML=`<a class="anchor back" id="entry-back">&#10094; &nbsp; ${(0,s.Z)("common-back")}</a>`,(0,r.ZP)("entry-back").onclick=()=>this.loadForm("forgotPassword");break;default:return this.footer.innerHTML="",void(this.footer.style.display="none")}},this.keyDown=t=>{"Escape"!==t.key&&"Esc"!==t.key||this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.classList.remove("ani"),this.holder.classList.remove("dim"),setTimeout((()=>{this.dialog.remove(),this.dialog=null,this.holder.remove(),this.holder=null}),200)},this.loadForm=async(t,e={})=>{var i,s,n,a,o,c,h,l,d,u,m;if(this.form=t,await this.setContent(t,e),"setPassword"!==t&&"resetPassword"!==t||this.renderCaptcha(),"chooser"===t)document.querySelectorAll(".social-button").forEach((t=>{t.addEventListener("click",(()=>{this.loadSocialLogin(t.dataset.social)}))})),null===(i=(0,r.ZP)("choose-email"))||void 0===i||i.addEventListener("click",(()=>{this.loadForm("register"),this.options.email&&setTimeout((()=>{(0,r.ZP)("entry-email").value=this.options.email}),500)}));if(null===(s=(0,r.ZP)("entry-form"))||void 0===s||s.addEventListener("submit",(t=>{this.submitForm((0,r.ZP)("entry-form").dataset.entry,t)})),"register"!==this.form&&"resetPassword"!==this.form||(null===(n=(0,r.ZP)("entry-password"))||void 0===n||n.addEventListener("focus",(()=>{this.passwordMeter("show",(0,r.ZP)("entry-password"))})),null===(a=(0,r.ZP)("entry-password"))||void 0===a||a.addEventListener("input",(()=>{this.updatePasswordMeter((0,r.ZP)("entry-password"))}))),"setPassword"===this.form&&(e.email=(0,r.ZP)("set-password").dataset.email),"resetPassword"!==this.form&&"setPassword"!==this.form||((0,r.ZP)("entry-email").value=e.email),(0,r.ZP)("entry-to-email")){const t=(0,r.ZP)("entry-to-email").dataset.text.replace("[EMAIL]",e.email);(0,r.ZP)("entry-to-email").innerHTML=t}(0,r.ZP)("verification-email")&&((0,r.ZP)("verification-email").value=e.email),(0,r.ZP)("entry-resend")&&(clearTimeout(this.resendCodeTimeouts),this.resendCodeTimeouts=setTimeout((()=>{(0,r.ZP)("entry-resend").classList.remove("hide")}),3e4),null===(o=(0,r.ZP)("entry-resend"))||void 0===o||o.addEventListener("click",(()=>this.resendCode(e.email)))),null===(c=(0,r.ZP)("entry-email"))||void 0===c||c.addEventListener("keyup",(()=>{this.validateInputTimer("email")})),null===(h=(0,r.ZP)("entry-email"))||void 0===h||h.addEventListener("blur",(()=>{(0,r.b0)((0,r.ZP)("entry-email"),"","email")})),null===(l=(0,r.ZP)("entry-cancel"))||void 0===l||l.addEventListener("click",(()=>this.cleanUp())),null===(d=(0,r.ZP)("load-forgotPassword"))||void 0===d||d.addEventListener("click",(()=>this.loadForm("forgotPassword"))),null===(u=(0,r.ZP)("toggle-password"))||void 0===u||u.addEventListener("click",(()=>this.togglePassword())),null===(m=(0,r.ZP)("toggle-password-2"))||void 0===m||m.addEventListener("click",(()=>this.togglePassword("toggle-password-2","entry-password-new")))},this.loadSocialLogin=async t=>{if((0,n.Z)("login",t),"apple"===t){const t=await new Promise(((t,e)=>{let i=document.createElement("script");i.type="text/javascript",i.crossOrigin="anonymous",i.src="https://appleid.cdn-apple.com/appleauth/static/jsapi/appleid/1/en_US/appleid.auth.js",document.body.appendChild(i),i.onload=function(){t(AppleID?AppleID.auth:null)},i.onerror=function(){e("Failed to load apple auth script")}}));t&&(t.init({clientId:"com.pixlr.web",scope:"name email",redirectURI:new URL(location.href).origin+"/auth/apple/callback",state:location.href,nonce:"",usePopup:!1}),t.signIn())}else{const e=window.location.origin;window.location.href=`${e}/auth/${t}?callbackUrl=${window.location.href}`}},this.togglePassword=(t="toggle-password",e="entry-password")=>{const i=(0,r.ZP)(t),s=(0,r.ZP)(e);"text"===s.type?(s.type="password",i.src="/img/icon/eye-hide.svg"):(s.type="text",i.src="/img/icon/eye-show.svg")},this.passwordMeter=(t="show",e)=>{if("show"==t&&e){const t=(0,r.ZP)(e.id),i=(0,r.ZP)(e.id).nextElementSibling;t.classList.remove("invalid"),i.style.display="none"}(0,r.ZP)("password-meter").style.display="show"==t?"flex":"none"},this.updatePasswordMeter=t=>{let e=(0,r.ZP)("password-meter"),i=(0,r.ZP)("password-meter").classList.value.replace(" ",","),s=0;switch(t.value.match(/[a-z]/)&&s++,t.value.match(/[A-Z]/)&&s++,t.value.match(/\d/)&&s++,t.value.match(/[!@#$%&*?'"~_./+\-|()^`:;<>,]/)&&s++,t.value.length<8&&0!==s&&(s=0),s){case 0:e.classList.replace(i,"none");break;case 1:e.classList.replace(i,"weak");break;case 2:e.classList.replace(i,"soso");break;case 3:e.classList.replace(i,"good");break;case 4:e.classList.replace(i,"great")}},this.validateInputTimer=t=>{this.validationTimer[t]&&clearTimeout(this.validationTimer[t]),this.validationTimer[t]=setTimeout((()=>(0,r.b0)((0,r.ZP)(`entry-${t}`),"",t)),1e3)},this.loadCaptcha=()=>{let t=document.createElement("script");t.id="recaptcha-js-api",t.defer=!0,t.src="https://www.google.com/recaptcha/api.js",document.getElementsByTagName("head")[0].appendChild(t)},this.renderCaptcha=()=>{this.captcha=void 0;const t=window.location.href.includes("localhost")?"6LeBQzcaAAAAAPwVny3IG23_fY_FasFVKXvQG9qB":"6LcqBEsaAAAAAF-JcOUzRtVKASZt5b-EMITWxEJf";setTimeout((()=>{try{this.captcha=grecaptcha.render((0,r.ZP)("recaptcha"),{sitekey:t})}catch(e){console.error("Failed to load Captcha, please check your network connection!")}}),2500)},this.getFormInput=()=>{const t={},e=(0,r.ZP)("entry-form");return e.querySelectorAll("input").forEach((e=>{"checkbox"==e.type?t[e.name]=e.checked:t[e.name]=e.value})),e.querySelectorAll("select").forEach((e=>{t[e.name]=e.value})),t},this.submitForm=async(t,e)=>{switch(e.preventDefault(),t){case"login":this.loginHandler();break;case"register":this.registerHandler();break;case"verification":this.verificationHandler();break;case"forgotPassword":this.forgotPasswordHandler();break;case"setPassword":this.passwordResetHandler(!0);break;case"resetPassword":this.passwordResetHandler();break;case"changeEmail":this.changeEmailHandler();break;case"changeEmailVerification":this.changeEmailVerificationHandler();break;case"changePassword":this.changePasswordHandler();break;case"changeUsername":this.changeUsernameHandler();break;case"deleteAccount":this.deleteAccountHandler();break;case"deleteAccountConfirmation":this.deleteAccountConfirmationHandler()}},this.loginHandler=async()=>{const t=this.getFormInput();t.email=t.email.trim();const e=(0,r.b0)((0,r.ZP)("entry-email"),t.email,"email"),i=(0,r.b0)((0,r.ZP)("entry-password"),t.password,"password");if(!e||!i)return;(0,r.ZP)("entry-submit").innerHTML='\n            <img src="/images/myaccount/loading.gif" alt="loading" style="margin-top:12px;">\n        ';const o=await(0,a.$f)("/auth/login","POST",t);if(o.status)if((0,n.Z)("login","password"),(0,r.ZP)("entry-submit").innerHTML=(0,s.Z)("common-login"),this.callbackUrl){const t=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=t}else window.location.reload();else o.verify?(this.loadForm("verification",{email:t.email}),(0,r.FN)("danger",o.message,5)):((0,r.ZP)("entry-submit").innerText="Login",(0,r.FN)("danger",o.message,5))},this.registerHandler=async()=>{this.registerData=this.getFormInput();const t=(0,r.b0)((0,r.ZP)("entry-email"),this.registerData.email,"email"),e=(0,r.b0)((0,r.ZP)("entry-password"),this.registerData.password,"password");if(!t||!e)return;const i=this.getFormInput();Object.assign(i,this.registerData);const s=await(0,a.$f)("/auth/register","POST",i);if(!s.status)return(0,r.FN)("danger",s.message,5),void this.loadForm("register");this.loadForm("verification",{email:i.email})},this.verificationHandler=async()=>{const t=this.getFormInput(),e=await(0,a.$f)("/auth/verify","POST",t);if(!e.status)return(0,r.FN)("danger",e.message,5);(0,r.FN)("success",e.message,5),this.cleanUp(),setTimeout((()=>{if(this.callbackUrl){const t=decodeURIComponent(this.callbackUrl).split("#")[0];window.location.href=t}else window.location.reload()}),1e3)},this.forgotPasswordHandler=async()=>{const t=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-email"),t.email,"email"))return;t.resend=!1;const e=await(0,a.$f)("/auth/request/code/","POST",t);if(!e.status)return(0,r.FN)("danger",e.message,5);(0,r.FN)("success",e.message,5,t.email),this.loadForm("resetPassword",{email:t.email})},this.passwordResetHandler=async(t=!1)=>{let e;try{if(e=grecaptcha.getResponse(this.captcha),grecaptcha.reset(this.captcha),!e)return(0,r.FN)("danger","Please complete the CAPTCHA!",3)}catch(h){console.error("Failed to get Captcha Token!")}const i=this.getFormInput();i.token=e;const s=(0,r.b0)((0,r.ZP)("entry-email"),i.email,"email"),n=(0,r.b0)((0,r.ZP)("entry-password"),i.password,"password"),o=(0,r.b0)((0,r.ZP)("entry-code"),i.code,"code");if(!s||!n||!o)return;const c=await(0,a.$f)("/auth/reset","POST",i);if(!c.status)return(0,r.FN)("danger",c.message,5);(0,r.FN)("success",c.message,5),this.cleanUp(),setTimeout((()=>{t?window.location.href="/logout":window.location.reload()}),1e3)},this.resendCode=async t=>{(0,r.ZP)("entry-resend").classList.add("hide"),this.resendCodeTimeouts=setTimeout((()=>{(0,r.ZP)("entry-resend").classList.remove("hide")}),3e4);const e=await(0,a.$f)("/auth/request/code/","POST",{email:t,resend:!0});if(!e.status)return(0,r.FN)("danger",e.message,5);(0,r.FN)("success",e.message,5,t)},this.changeEmailHandler=async()=>{const t=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-email"),t.email,"email"))return;const e=await(0,a.$f)("/auth/changeemail/request","POST",{newEmail:t.email});if(!e.status)return(0,r.FN)("danger",e.message);this.loadForm("verification",{email:t.email,verify:"changeEmailVerification"}),(0,r.FN)("success",e.message,5,t.email)},this.changeEmailVerificationHandler=async()=>{const t=this.getFormInput();t.newEmail=t.email;if(!(0,r.b0)((0,r.ZP)("entry-code"),t.code,"code"))return;const e=await(0,a.$f)("/auth/changeemail/verify","POST",t);if(!e.status)return(0,r.FN)("danger",e.message,5);(0,r.FN)("success",e.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),1e3)},this.changePasswordHandler=async()=>{const t=this.getFormInput(),e=(0,r.b0)((0,r.ZP)("entry-password"),t.password,"password"),i=(0,r.b0)((0,r.ZP)("entry-password-new"),t["new-password"],"password");if(!e||!i)return;const s=await(0,a.$f)("/auth/changepassword","PUT",{oldPassword:t.password,newPassword:t["new-password"]});if(!s.status)return(0,r.FN)("danger",s.message,5);(0,r.FN)("success",s.message,5),setTimeout((()=>{window.location.replace(`/logout?callbackUrl=${window.location.href}`)}),2e3)},this.changeUsernameHandler=async()=>{const t=this.getFormInput(),e=await(0,a.$f)("/myaccount/api/profile","PUT",t,!0);if(!e.status)return(0,r.FN)("danger",e.message);(0,r.FN)("success",e.message),setTimeout((()=>window.location.reload()),500)},this.deleteAccountHandler=async()=>{const t=this.getFormInput();"leavingReasonDefault"!==t.reason&&this.loadForm("deleteAccountConfirmation",{reason:t.reason})},this.deleteAccountConfirmationHandler=async()=>{const t=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-password"),t.password,"password"))return;const e=await(0,a.$f)("/api/myaccount/profile","DELETE",t,!0);if(!e.status)return(0,r.FN)("danger",e.message);window.location.href="/logout/"},this.getAdditionalVerificationstatus=()=>(0,r.ZP)("entry-modal"),this.additionalVerificationHandler=async()=>{const t=this.getFormInput();if(!(0,r.b0)((0,r.ZP)("entry-password"),t.password,"password"))return!1;const e=await(0,a.$f)("/api/myaccount/verification","POST",t,!0);return e.status?(this.cleanUp(),!0):((0,r.FN)("danger",e.message),!1)},this.Form=new o.Z,this.form=t,this.options=e,this.registerData={},this.validationTimer={},this.captcha={},e.callback&&(this.callbackUrl=e.callback),"popup"===this.options.method?(this.holder=(0,r.T)("div",{id:"entry-modal",className:"modal"}),document.body.appendChild(this.holder),this.dialog=(0,r.T)("div",{className:"entry pop"}),this.holder.appendChild(this.dialog),this.content=(0,r.T)("div",{className:"entry-content"}),this.footer=(0,r.T)("div",{id:"entry-footer"}),this.dialog.append((0,r.T)("img",{id:"popup-close",className:"close",src:"/img/icon/close-black.svg",onclick:()=>this.cleanUp()}),this.content,this.footer),document.addEventListener("keydown",this.keyDown,!1),setTimeout((()=>this.dialog.classList.add("ani")),5),setTimeout((()=>this.holder.classList.add("dim")),5)):(this.dialog=this.options.holder,this.dialog.classList.add("entry"),this.content=(0,r.T)("div",{className:"entry-content"}),this.footer=(0,r.T)("div",{id:"entry-footer"}),this.dialog.append(this.content,this.footer)),this.loadForm(t)}}},61293:(t,e,i)=>{i.d(e,{Z:()=>r});var s=i(96548),n=i(27969),a=i(4231);class r{constructor(){this.chooser=()=>`\n            <h1>${(0,s.Z)("common-signUpLogIn")}</h1>\n            <p>\n            ${(0,s.Z)("common-agreeTo")} <a href="/terms-of-use/" target='_new'>${(0,s.Z)("common-termsOfUse")}</a> ${(0,s.Z)("common-and")} <a href="/privacy-policy/" target='_new'> ${(0,s.Z)("common-privacyPolicy")}</a>.\n            </p>\n            <div class="chooser">\n                <div class="social-button" data-social="google">\n                    <img src="/images/icon/google.svg" alt="google">\n                    ${(0,s.Z)("common-continueWith")} Google\n                </div>\n                <div class="social-button" data-social="facebook">\n                    <img src="/images/icon/facebook.svg" alt="facebook">\n                    ${(0,s.Z)("common-continueWith")} Facebook\n                </div>\n                <div class="social-button" data-social="apple">\n                    <img src="/images/icon/apple_gray.svg" alt="apple">\n                    ${(0,s.Z)("common-continueWith")} Apple\n                </div>\n                <a class="anchor top-20" style="display:block;text-align:center;font-size:15px;" id="choose-email">\n                    ${(0,s.Z)("common-orUseEmail")}\n                </a>\n            </div>\n        `,this.login=()=>`\n            <h1>${(0,s.Z)("common-login")}</h1>\n\n            <form id="entry-form" data-entry="login">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password" placeholder="Enter password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="entry-submit">${(0,s.Z)("common-login")}</button>\n                <div class="input-group inline space-between">\n                    <div class="inline">\n                        <input type="checkbox" id="entry-rememberMe" name="rememberMe"/>\n                        <label for="entry-rememberMe" class="custom-checkbox">${(0,s.Z)("common-rememberMe")}</label>\n                    </div>\n                    <div>\n                        <a class="anchor" id="load-forgotPassword">${(0,s.Z)("common-forgotPass")}</a>\n                    </div>\n                </div>\n            </form>\n        `,this.register=async()=>{let t="",e=!1;const i=await(0,a.Ef)();for(let s in n.od)e||"US"!==s&&i!=s?t+=`<option value="${s}">${n.od[s]}</option>`:(t+=`<option value="${s}" selected>${n.od[s]}</option>`,e=!0);return`\n            <h1>${(0,s.Z)("common-signUp")}</h1>\n\n            <form id="entry-form" data-entry="register">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password" placeholder="Enter password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="country">${(0,s.Z)("common-country")}</label>\n                    <select name="country">\n                        ${t}\n                    </select>\n                </div>\n\n                <div class="input-group">\n                    <div class="checkbox-group inline">\n                        <input type="checkbox" id="entry-newsletter" name="newsletter" checked/>\n                        <label for="entry-newsletter" class="custom-checkbox">${(0,s.Z)("subscribeToNewsletter")}</label>\n                    </div>\n                </div>\n\n                <button type="submit" class="button big positive full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-signUp")}</button>\n            </form>\n        `},this.forgotPassword=()=>`\n            <h1>${(0,s.Z)("common-forgotPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="forgotPassword">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" placeholder="Email address"/>\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-40" id="load-verification">${(0,s.Z)("common-reqCode")}</button>\n            </form>\n        `,this.resetPassword=(t=!1)=>{const e=t?"setPassword":"resetPassword";return`\n            <h1>${t?(0,s.Z)("common-setPassword"):(0,s.Z)("common-resetPass")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="${e}">\n                <div class="input-group">\n                    <label for="entry-email">${(0,s.Z)("common-email")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email" readonly/>\n                    <p class="error-msg">${(0,s.Z)("common-enterValidEmail")}</p>\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-newPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <div class="input-group">\n                    <label for="entry-code">${(0,s.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidCode")}</p>                    \n                </div>\n                \n                ${t?`<p class="top-10 text-center"><a class="anchor" id="entry-resend">${(0,s.Z)("common-SendResetCode")}</a></p>`:""}\n\n                <div id="recaptcha" style="padding-top: 5px"></div>\n                <button class="button big positive full" type="submit">${(0,s.Z)("common-updatePass")}</button>\n                ${t?"":`<p class="top-10 hide text-center" id="entry-resend">${(0,s.Z)("common-didNotReceiveCode")} <a class="anchor">${(0,s.Z)("common-resend")}</a></p>`}\n            </form>\n        `},this.verification=t=>`\n            <h1>${(0,s.Z)("common-verifyAcc")}</h1>\n            <p id="entry-to-email" data-text="${(0,s.Z)("common-sentCodeDesc")}">${(0,s.Z)("common-sentCodeDesc")}</p>\n\n            <form id="entry-form" data-entry="${t}">\n                <input id="verification-email" type="hidden" name="email" readonly/>\n                <div class="input-group">\n                    <label for="code">${(0,s.Z)("common-code")}</label>\n                    <input type="number" name="code" id="entry-code" onkeypress="if(this.value.length===6)return false;">\n                    <p class="error-msg">${(0,s.Z)("common-enterValidCode")}</p>\n                </div>\n\n                <button type="submit" class="button big positive full top-20">${(0,s.Z)("common-verify")}</button>\n                <p class="top-20 hide text-center" id="entry-resend">${(0,s.Z)("common-didNotReceiveCode")} &nbsp; <a class="anchor">${(0,s.Z)("common-resend")}</a></p>\n            </form>\n        `,this.changePassword=()=>`\n            <h1>${(0,s.Z)("common-changePassword")}</h1>\n            <form id="entry-form" class="top-30" data-entry="changePassword">\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-oldPass")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-newPass")}</label>\n                    <input type="password" name="new-password" id="entry-password-new">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password-2" class="input-icon" src="/img/icon/eye-hide.svg">\n                    <span id="password-meter" class="none">\n                        <span></span><span></span><span></span><span></span>\n                    </span>\n                </div>\n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-changePassword")}</button>\n            </form>\n        `,this.changeEmail=()=>`\n            <h1>${(0,s.Z)("common-changeEmail")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeEmail">\n                <div class="input-group">\n                    <label class="text-capitalize" for="email">${(0,s.Z)("common-newEmail")}</label>\n                    <input type="email" maxlength="70" name="email" id="entry-email">\n                    <p class="error-msg">${(0,s.Z)("common-EnterValidEmail")}</p>\n                </div>\n            \n                <button type="submit" class="button full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-newEmail")}</button>\n            </form>\n        `,this.changeUsername=(t="")=>`\n            <h1>${(0,s.Z)("changeUsername")}</h1>\n\n            <form id="entry-form" class="top-30" data-entry="changeUsername">\n                <div class="input-group">\n                    <label for="entry-username">${(0,s.Z)("newUsername")}</label>\n                    <input type="text" name="name" id="entry-username" value="${t}">\n                </div>\n\n                <button type="submit" class="button full top-20">${(0,s.Z)("update")}</button>\n            </form>\n        `,this.deleteAccount=t=>`\n            <h1>${(0,s.Z)("common-deleteMyAccount")}</h1>\n            <p class="top-20">Hey ${t},</p>\n            <p class="no-margin">${(0,s.Z)("common-sadToSeeYouGoWhyLeaving")}</p>\n\n            <form id="entry-form" data-entry="deleteAccount">\n                <div class="input-group">\n                    <label class="top-20 text-uppercase">${(0,s.Z)("common-leavingBecause")}</label>\n                    <select name="reason">\n                        <option value="leavingReasonDefault" disabled selected>${(0,s.Z)("common-leavingReasonDefault")}</option>\n                        <option value="leavingReasons1">${(0,s.Z)("common-leavingReasons1")}</option>\n                        <option value="leavingReasons2">${(0,s.Z)("common-leavingReasons2")}</option>\n                        <option value="leavingReasons3">${(0,s.Z)("common-leavingReasons3")}</option>\n                        <option value="leavingReasons4">${(0,s.Z)("common-leavingReasons4")}</option>\n                        <option value="leavingReasons5">${(0,s.Z)("common-leavingReasons5")}</option>\n                    <select>\n                </div>\n\n                <button type="submit" class="button red full top-20" style="margin-bottom: 20px">${(0,s.Z)("common-deleteMyAccount")}</button>\n            </form>\n        `,this.deleteAccountConfirmation=(t="leavingReasonDefault")=>`\n            <h4 class="top-35 text-default">${(0,s.Z)("areYouSureYouWantToDelete")} </h4>\n            <p class="top-35">${(0,s.Z)("youCanStillChangeYourMind")} </p>\n\n            <form id="entry-form" data-entry="deleteAccountConfirmation">\n                <input type="hidden" name="reason" value="${t}">\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center flex-wrap" style="margin-top: 30px">\n                <button class="button full positive" id="entry-cancel">${(0,s.Z)("cancel")}</button>\n                    <button type="submit" class="button full transparent">${(0,s.Z)("deleteMyAccount")}</button>\n                </div>\n            </form>\n        `,this.additionalVerification=()=>`\n            <h3 class="heavy">${(0,s.Z)("enterYourPasswordToContinue")}</h3>\n\n            <form id="entry-form" data-entry="additionalVerification">\n                <div class="input-group">\n                    <label for="entry-password">${(0,s.Z)("common-password")}</label>\n                    <input type="password" name="password" id="entry-password">\n                    <p class="error-msg"></p>\n                    <img id="toggle-password" class="input-icon" src="/img/icon/eye-hide.svg">\n                </div>\n\n                <div class="input-group checkbox-group inline justify-center" style="margin-top: 30px">\n                    <button type="submit" class="button full top-20">Continue</button>\n                </div>\n            </form>\n        `}}},97666:(t,e,i)=>{i.d(e,{By:()=>a,Cj:()=>o,L8:()=>r});var s=i(96548),n=i(93947);function a(t,e=100,i="",a="",r=""){return(0,n.T)("div",{className:`form-group w-${e}`},(0,n.T)("div",{className:"adyen-checkout-title"},(0,n.T)("span",{className:"adyen-checkout__label__text"},`${(0,s.Z)(t)} ${(0,s.Z)(a)}`),r),(0,n.T)("input",{type:"text",id:t.replace("checkout-",""),maxLength:56,required:!0,value:i}))}function r(t){return(0,n.T)("div",{className:"tooltip"},(0,n.T)("span",{className:"tooltiptext"},(0,n.T)("img",{src:"/img/icon/information.svg",alt:"i"})),(0,n.T)("div",{className:"right"},t,(0,n.T)("i")))}function o(t,e=100){return(0,n.T)("div",{className:`form-group w-${e}`},(0,n.T)("span",{className:"adyen-checkout__label__text"},(0,s.Z)(t)),(0,n.T)("select",{id:"country",name:"country",className:"country-select"}))}},16577:(t,e,i)=>{i.d(e,{Z:()=>m});var s=i(96548),n=i(4231),a=i(93947),r=i(97666),o=i(57909),c=i(21951),h=i(70840),l=i(99344),d=i(33506),u=i(57246);class m extends o.Z{constructor(t,e){var o,m,p,g,v,f;if(super(!0),this.checkoutType="subscription",this.checkoutMode="checkout",this.checkoutUrl="/checkout/payments",this.selectedPaymentMethod="credit",this.productName="Pixlr Premium",this.totalPrice=59,this.renewalPrice=59,this.seatPrice=3.99,this.currency="USD",this.currencySymbol="$",this.checkoutPlan="premium-yearly",this.checkoutDiscountPercentage="",this.savedCardId="",this.billingAddress={},this.billingAddressRequired=["firstName","lastName","vatNumber","address","city","zipCode","state"],this.encryptedCardData={isValid:!1,paymentMethod:{}},this.freeTrial=!1,this.balanceCredit=0,this.tax={status:!1},this.additionalSeats={status:!1},this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.paypalCheckoutSubscriptionsUrl="/paypal/subscriptions",this.paypalCheckoutTemplateUrl="/paypal/templates",this.monthName=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.loadEventListener=()=>{var t,e,i,s,n,r;"seats"!==this.checkoutType&&"Pixlr Team"!==this.productName||document.getElementsByClassName("radio-options")[1]&&(document.getElementsByClassName("radio-options")[1].style.display="none"),null===(t=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.addEventListener("click",this.makePayment),(0,a.ZP)("add-billing-info").addEventListener("click",this.showAndGetBilling),(0,a.ZP)("back-billing-icon").addEventListener("click",this.creditCardForm),null===(e=(0,a.ZP)("paypal-radio-option"))||void 0===e||e.addEventListener("click",this.checkoutMethod),(0,a.ZP)("adyen-radio-option").addEventListener("click",this.checkoutMethod),(0,a.ZP)("back-premium-icon").classList.remove("hide"),(0,a.ZP)("back-premium-icon").addEventListener("click",this.backPreviousPopup),null===(i=(0,a.ZP)("collapse-seat"))||void 0===i||i.addEventListener("click",this.collapseSeat),null===(s=(0,a.ZP)("country"))||void 0===s||s.addEventListener("change",this.updateCountry),null===(n=document.getElementsByClassName("seat-option-custom")[0])||void 0===n||n.addEventListener("input",(()=>{this.selectSeats(document.getElementsByClassName("seat-option-custom")[0],!0)})),null===(r=document.getElementsByClassName("seat-option-custom")[0])||void 0===r||r.addEventListener("click",(function(){const t=this.children[0];t.value||(t.value="1")})),document.querySelectorAll(".seat-option").forEach((t=>{t.addEventListener("click",(()=>{this.selectSeats(t,"seats"===this.checkoutType)}))})),this.creditCardForm(),this.populateCountry()},this.populateCountry=async()=>{const{data:t}=await n.ox();this.countryList=t;const e=(0,a.ZP)("country");for(const i in this.countryList.country){const t=(0,a.T)("option",{value:this.countryList.country[i]},this.countryList.country[i]);(null===d.a||void 0===d.a?void 0:d.a.country)===i&&(t.selected=!0),e.append(t)}this.updateCountry()},this.creditCardForm=async()=>{var t;const[e]=await Promise.all([i.e(6600).then(i.bind(i,4884)).then((t=>t.default)),i.e(6600).then(i.bind(i,80697))]);(0,a.ZP)("billing-page").classList.add("hide"),(0,a.ZP)("payment-method").classList.remove("hide"),(0,a.ZP)("card-page").classList.remove("hide"),(0,a.ZP)("back-premium-icon").classList.remove("hide"),null===(t=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.classList.remove("hide"),"subscription"===this.checkoutType?this.freeTrial?(0,a.ZP)("subscription-pay-btn").innerText=(0,s.Z)("start30DaysTrial"):(0,a.ZP)("subscription-pay-btn").innerText=(0,s.Z)("payAmountNow",`${this.currency} ${this.totalPrice.toFixed(2)}`):"template"===this.checkoutType?(0,a.ZP)("template-pay-btn").innerHTML=(0,s.Z)("payNow"):"seats"===this.checkoutType&&((0,a.ZP)("seats-pay-btn").innerText=(0,s.Z)("payAmountNow",`${this.currency} ${this.totalPrice.toFixed(2)}`)),this.isReadyToPay();const{paymentMethods:r,paymentCards:o,adyenClientKey:c,proRatedSeats:h}=await n.c0({splan:this.checkoutPlan});(null==r?void 0:r.storedPaymentMethods)&&o&&this.populateSavedCard(r.storedPaymentMethods,o),h&&((0,a.ZP)("prorated-seat").style.display="block",this.seatPrice=0,this.updatePrice());return new e({locale:"en_US",environment:"pixlr.com"===window.location.hostname?"live":"test",clientKey:c,paymentMethodsResponse:r,onChange:this.handleOnChange}).create("card",{hasHolderName:!0,holderNameRequired:!0}).mount("#component-container"),!0},this.paypalForm=()=>{var t;(0,a.ZP)("card-page").classList.add("hide"),(0,a.ZP)(`${this.checkoutType}-pay-btn`).innerHTML=(0,s.Z)("continueOnPaypal"),null===(t=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.removeAttribute("disabled")},this.checkoutMethod=()=>{for(var t=document.getElementsByName("payment"),e=0;e<t.length;e++)1==t[e].checked&&this.paymentSection(t[e].value)},this.paymentSection=async t=>{if("paypal"===t)this.paypalForm(),this.selectedPaymentMethod="paypal";else this.creditCardForm(),this.selectedPaymentMethod="credit";this.toggleCheckoutPlan()},this.showAndGetBilling=()=>{(0,a.ZP)("card-page").classList.add("hide"),(0,a.ZP)("payment-method").classList.add("hide"),(0,a.ZP)("billing-page").classList.remove("hide"),(0,a.ZP)("back-premium-icon").classList.add("hide");const t=(0,a.ZP)("billing-address").getElementsByTagName("input");for(let e=0;e<t.length;e++){const i=t[e];i.addEventListener("keyup",(()=>{this.billingAddress[i.id]=i.value,this.isReadyToPay()}))}},this.updateCountry=()=>{const t=Object.keys(this.countryList.country).find((t=>this.countryList.country[t]===(0,a.ZP)("country").value));this.countryList.tax[t]?(this.tax.status=!0,this.tax.percentage=this.countryList.tax[t]):this.tax.status=!1,this.countryList.countryEU.some((e=>e===t))?this.currency="EUR":this.currency="USD",this.currencySymbol="USD"===this.currency?"$":"€",document.querySelectorAll(".currency").forEach((t=>t.innerHTML=this.currency)),document.querySelectorAll(".currency-symbol").forEach((t=>t.innerHTML=this.currencySymbol)),(0,a.ZP)("tax-included")&&((0,a.ZP)("tax-included").style.display=this.tax.status?"block":"none"),this.updatePrice()},this.populateSavedCard=(t=[],e)=>{if(!t.length)return;const i=(0,a.ZP)("saved-cards");i.innerHTML="",t.forEach(((t,s)=>{if(!e.includes(t.id))return;const n=(0,a.T)("div",{id:t.id,className:"saved-card-item"},(0,a.T)("img",{src:`https://checkoutshopper-live.adyen.com/checkoutshopper/images/logos/${t.brand}.svg`,alt:`${t.brand} icon`}),(0,a.T)("div",(0,a.T)("span",{style:"font-size: 12px;"},`**** **** **** ${t.lastFour}`),(0,a.T)("span",{className:"heavy",style:"font-size: 10px; color: #A2A2A4;"},`EXP DATE ${t.expiryMonth}/${t.expiryYear.substring(4,2)}`)));n.addEventListener("click",(()=>{this.selectSavedCard(t)})),e[0]===t.id?i.prepend(n):i.append(n)}))},this.resultModal=t=>{(0,a.ZP)("overview").style.display="none",(0,a.ZP)("checkout").style.display="none";const e=t.status;return(e||"success"===e)&&Object.assign(d.a,t.data.settings),(0,a.ZP)("result-modal")&&(0,a.ZP)("result-modal").remove(),t.loading?`\n            <div id="result-modal" class="loader">\n                <img src="/images/myaccount/black-loading.gif" alt="loading" style="width: 150px">\n                <h2>${(0,s.Z)("pleaseCompleteYourPaymentAtPaypal")}!</h2>\n                <p class="top-20">${(0,s.Z)("pleaseDoNotRefreshOrCloseThisPageWhilePaymentIsProcessing")}.</p>\n                <p>${"web"===this.options.platform?(0,s.Z)("youWillAutomaticallyBeRedirectedToMyAccount"):(0,s.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>\n            </div>\n            `:e||"success"===e?((0,a.ZP)("try-premium")&&((0,a.ZP)("try-premium").style.display="none"),`\n            <div id="result-modal">\n                <img src="/images/icon/green-tick.png" alt="green tick icon" style="width: 50px; height: 50px">\n                <h2 class="top-20 heavy">${(0,s.Z)("thankYouForYourPurchase")}!</h2>\n                ${"template"===this.checkoutType?`<p class="pad-10">${(0,s.Z)("theTemplateIsLoading")}`:""}\n\n                <p>${"web"===this.options.platform?(0,s.Z)("youWillAutomaticallyBeRedirectedToMyAccount"):(0,s.Z)("youWillAutomaticallyBeRedirectedToTheEditor")}</p>\n            </div>`):`\n            <div id="result-modal">\n                <img src="/images/icon/red-cross.png" alt="fail" style="width: 50px; height: 50px">\n                <h1 class="heavy top-20">${(0,s.Z)("paymentFailed")}</h1>\n                <p class="pad-10">${(0,s.Z)("paymentUnsuccessful")}.</p>\n            </div>`},this.handleOnChange=t=>{const{data:{paymentMethod:e},isValid:i}=t;this.encryptedCardData.isValid=i,this.encryptedCardData.paymentMethod=e,this.encryptedCardData.cardHolderName=document.getElementsByClassName("adyen-checkout__input--text")[0].value,this.isReadyToPay()},this.getCheckoutData=()=>{const t={billingAddress:this.billingAddress,currency:this.currency,promo:this.promoCode,seatsToAdd:this.additionalSeats.status?this.additionalSeats.count:0,freeTrialSource:"editor",checkoutMethod:this.checkoutMode};if("credit"===this.selectedPaymentMethod)t.paymentMethod=this.encryptedCardData.paymentMethod;else if("saved-card"===this.selectedPaymentMethod&&this.savedCardId)t.paymentCard=this.savedCardId;else if("paypal"!==this.selectedPaymentMethod)throw new Error("Failed to get checkout information!");return"subscription"===this.checkoutType?(t.splan=this.checkoutPlan,this.freeTrial&&(t.freeTrial="true")):"template"===this.checkoutType&&(t.templateId=this.templateId),t},this.selectSavedCard=t=>{const e=(0,a.ZP)(t.id);e.className.includes("selected")?(e.classList.remove("selected"),(0,a.ZP)("component-container").classList.remove("blocked"),this.savedCardId="",this.selectedPaymentMethod="credit"):(document.querySelectorAll(".saved-card-item").forEach((t=>t.classList.remove("selected"))),e.classList.add("selected"),(0,a.ZP)("component-container").classList.add("blocked"),this.savedCardId=t.id,this.selectedPaymentMethod="saved-card"),this.isReadyToPay()},this.makePayment=async()=>{var t;if(!this.isReadyToPay())return;if(null===(t=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.setAttribute("disabled","true"),"paypal"===this.selectedPaymentMethod)return this.paypalCheckout();let e;this.billingAddress.country=(0,a.ZP)("country").value,"subscription"===this.checkoutType?e=this.checkoutUrl:"template"===this.checkoutType?e=this.checkoutUrl+"/template/":"seats"===this.checkoutType&&(e=this.checkoutUrl+"/seats/");const i=this.getCheckoutData();i.captchaToken="!!";const s=this.getUTMParam();try{const t=await fetch(e+"?platform=editor"+s,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(i)}),n=await t.json();"subscription"===this.checkoutType&&n.status&&this.trackShareASale(n.data),this.setContent(this.resultModal(n)),n.status&&("web"===this.options.platform?"seats"===this.checkoutType?setTimeout((()=>window.location.href="/myaccount/?tab=team"),1500):setTimeout((()=>window.location.href="/myaccount/?tab=subscription"),1500):setTimeout((()=>{var t;null===(t=null==this?void 0:this.stage)||void 0===t||t.unblock(),null==this||this.cleanUp()}),2500))}catch({message:n}){this.setContent(this.resultModal({status:!1}))}},this.paypalCheckout=async()=>{const t="subscription"===this.checkoutType?this.paypalCheckoutSubscriptionsUrl:this.paypalCheckoutTemplateUrl,e=this.getCheckoutData();try{const i=await fetch(t+"?platform=editor",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(e)}),s=await i.json();if(s.status){const t=this.createPopupWin(s.redirectUrl,"Paypal Checkout",800,650);this.setContent(this.resultModal({loading:!0}));const e=await(0,l.n)((async()=>{try{const t=await n._Y(s.id,this.checkoutType);return Promise.resolve(t)}catch(t){return Promise.reject(t)}}),500,15e3);"success"===e.status&&((0,a.ZP)("try-premium")&&((0,a.ZP)("try-premium").style.display="none"),t.close(),this.setContent(this.resultModal(e)),setTimeout((()=>{null==this||this.cleanUp(),this.stage&&this.stage.unblock(),"web"===this.options.platform&&(window.location.href="/myaccount/?tab=subscription")}),2500))}else this.setContent(this.resultModal({status:!1}))}catch(i){console.error(i),this.setContent(this.resultModal({status:!1}))}},this.promoCodeOnInput=()=>{const t=(0,a.ZP)("promocode-input");t.value=t.value.toUpperCase()},this.applyPromoCode=async()=>{if("Remove"===(0,a.ZP)("promocode-submit").innerText)return this.removePromoCode(),!1;const t=(0,a.ZP)("promocode-input");this.options.code&&((0,a.ZP)("promocode-add").style.display="none",(0,a.ZP)("promocode-toggle").style.display="block",t.value=this.options.code);let e=this.options.code&&""!==this.options.code?this.options.code:t.value.toUpperCase().trim();try{const i=await fetch(`/api/promo/status/?code=${e}&product=${this.productName}&splan=${this.checkoutPlan}`),n=await i.json();if(!n.status)throw new Error("Invalid promocode!");const{percentage:r,amount:o,productName:c,productCode:h}=n.promo;return(0,a.ZP)("promo-remarks").innerText=r?(0,s.Z)("discountPercentageOffFirstPayingMonth").replace("{discountAmount}",`${r}%`):(0,s.Z)("discountAmountOnlyFirstPayingMonth").replace("{discountAmount}",o),this.promoCode=Object.assign(Object.assign({},this.promoCode),{percentage:r,amount:o,productName:c,productCode:h}),this.promoCode.code=e,this.togglePromoApplied(),this.updatePrice(),t.readOnly=!0,(0,a.ZP)("promocode-submit").innerText=(0,s.Z)("remove"),!0}catch({response:i,message:n}){return e="",t.value="",(0,a.ZP)("promocode-error").style.display="block",setTimeout((()=>{(0,a.ZP)("promocode-error").style.display="none"}),1500),!1}},this.removePromoCode=()=>{this.promoCode={promoApplied:!1,code:"",discountedAmount:0},this.updatePrice(this.renewalPrice);const t=(0,a.ZP)("promocode-input");t.value="",t.readOnly=!1,(0,a.ZP)("promo-tac").style.display="block",(0,a.ZP)("promo-section").style.display="flex",(0,a.ZP)("promocode-submit").innerText="Apply"},this.togglePromoApplied=()=>{this.promoCode.promoApplied=!this.promoCode.promoApplied},this.updatePrice=t=>{if(t&&(this.renewalPrice=t,this.totalPrice=t),this.promoCode.promoApplied){this.promoCode.productName.includes(this.productName)&&this.promoCode.productCode.includes(this.checkoutPlan)?(this.promoCode.percentage&&(this.promoCode.discountedAmount=this.renewalPrice*(this.promoCode.percentage/100)),this.promoCode.amount&&(this.promoCode.discountedAmount=this.promoCode.amount)):this.removePromoCode()}if(this.additionalSeats.status&&this.additionalSeats.count?this.additionalSeats.amount=this.additionalSeats.count*this.seatPrice:this.additionalSeats.amount=0,this.tax.status?this.tax.amount=(this.renewalPrice-this.promoCode.discountedAmount-this.balanceCredit+this.additionalSeats.amount)*(this.tax.percentage/100):this.tax.amount=0,this.totalPrice=this.renewalPrice-this.promoCode.discountedAmount-this.balanceCredit+this.additionalSeats.amount+this.tax.amount,this.freeTrial){const t=new Date;t.setMonth(t.getMonth()+1);const e=`${t.getDate()} ${this.monthName[t.getMonth()]} ${t.getFullYear()}`,i=document.getElementById("freetrial-note");null!=i&&(i.innerHTML=`${(0,s.Z)("cancelAnytimeOrAutoRenewalForAmount",e,this.currencySymbol+this.totalPrice.toFixed(2))}`,i.style.display="block")}(0,a.ZP)("plan-price")&&((0,a.ZP)("plan-price").innerText="seats"===this.checkoutType?this.seatPrice.toFixed(2):this.renewalPrice.toFixed(2)),(0,a.ZP)("total-price")&&((0,a.ZP)("total-price").innerText=`${this.freeTrial?"0.00":this.totalPrice.toFixed(2)}`),"subscription"!==this.checkoutType&&"seats"!==this.checkoutType||(this.freeTrial?(0,a.ZP)("subscription-pay-btn").innerText=`${(0,s.Z)("start30DaysTrial")}`:(0,a.ZP)(`${this.checkoutType}-pay-btn`).innerText=`PAY ${this.currency}${this.totalPrice.toFixed(2)} NOW`),this.shouldShowPriceSummary()},this.toggleCheckoutPlan=t=>{if("upgrade"===this.checkoutMode)return;"stack"===this.checkoutMode?(0,a.ZP)("checkout-plan").checked=!0:t&&((0,a.ZP)("checkout-plan").checked=t);const e=(0,a.ZP)("checkout-plan").checked,i=(0,a.ZP)("checkout-toggler");if(this.freeTrial=this.isEligibleForTrialCheckout(),e){switch(this.productName){case"Pixlr Plus":this.checkoutPlan="plus-yearly";break;case"Pixlr Premium":this.checkoutPlan="premium-yearly";break;case"Pixlr Team":this.checkoutPlan="team-yearly"}i.getElementsByClassName("switch-plan")[0].classList.remove("isMonthly"),i.getElementsByClassName("switch-plan")[0].classList.add("isYearly"),i.getElementsByClassName("switch-plan-monthly")[0].classList.remove("active"),i.getElementsByClassName("switch-plan-yearly")[0].classList.add("active"),(0,a.ZP)("plan-duration").innerText="year",(0,a.ZP)("promo-remarks").style.display="none","Pixlr Team"===this.productName&&(this.seatPrice=47.88),this.updatePrice(this.getRenewalPrice(this.checkoutPlan))}else{switch(this.productName){case"Pixlr Plus":this.checkoutPlan="plus-monthly";break;case"Pixlr Premium":this.checkoutPlan="premium-monthly";break;case"Pixlr Team":this.checkoutPlan="team-monthly"}i.getElementsByClassName("switch-plan")[0].classList.remove("isYearly"),i.getElementsByClassName("switch-plan")[0].classList.add("isMonthly"),i.getElementsByClassName("switch-plan-yearly")[0].classList.remove("active"),i.getElementsByClassName("switch-plan-monthly")[0].classList.add("active"),"Pixlr Team"===this.productName&&(this.seatPrice=3.99),(0,a.ZP)("plan-duration").innerText="month",(0,a.ZP)("promo-remarks").style.display="block",this.updatePrice(this.getRenewalPrice(this.checkoutPlan))}(0,a.ZP)("freetrial-note").style.display=this.freeTrial?"block":"none",(0,a.ZP)("renewal-price").innerHTML=`${this.getRenewalPrice(this.checkoutPlan).toFixed(2)}`},this.isEligibleForTrialCheckout=()=>{var t;let e=!1;null===(t=(0,a.ZP)("checkout-plan"))||void 0===t||t.checked;return e=!(!(null===d.a||void 0===d.a?void 0:d.a.eligibleForTrail)||"Pixlr Premium"!==this.productName),e},this.isReadyToPay=()=>{var t,e;const{isValid:i,paymentMethod:s}=this.encryptedCardData,n=Object.values(this.billingAddress).filter((t=>""!==t)).length;try{if("paypal"===this.selectedPaymentMethod)return!0;if("credit"===this.selectedPaymentMethod){if(!i)throw!1;if(0===this.encryptedCardData.cardHolderName.length)throw!1}return 0!==n&&this.billingAddressRequired.forEach((t=>{if(!this.billingAddress[t])throw!1})),null===(t=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===t||t.removeAttribute("disabled"),!0}catch({message:r}){return null===(e=(0,a.ZP)(`${this.checkoutType}-pay-btn`))||void 0===e||e.setAttribute("disabled","true"),!1}},this.createPopupWin=(t,e,i,s)=>{const n=(screen.width-i)/2,a=(screen.height-s)/4;return window.open(t,e,`resizable=yes,width=${i},height=${s},top=${a},left=${n}`)},this.collapseSeat=()=>{(0,a.ZP)("collapse-seat").classList.toggle("active");document.getElementsByClassName("seat-select")[0].classList.toggle("hide")},this.cleanUp=()=>{(0,a.ZP)("workspace")&&(0,a.ZP)("workspace").classList.remove("blur"),(0,a.ZP)("home")&&(0,a.ZP)("home").classList.remove("blur"),document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.backPreviousPopup=()=>{switch(this.cleanUp(),this.options.bounceSource){case"premiumbounce":new c.Z(this.options.bounceType);break;case"premiumtemplatebounce":new h.Z(this.stage);break;case"paywall":new u.Z}},this.shouldShowPriceSummary=()=>{"upgrade"===this.checkoutMode&&this.upgradeDetails.status&&this.balanceCredit>0?((0,a.ZP)("balance-credit-summary").style.display="block",(0,a.ZP)("balance-credit-details").innerHTML=`- ${this.currency} ${this.balanceCredit.toFixed(2)}`):((0,a.ZP)("balance-credit-summary").style.display="none",(0,a.ZP)("balance-credit-details").innerHTML=""),this.promoCode.promoApplied?((0,a.ZP)("promo-summary").style.display="block",(0,a.ZP)("promo-details").innerHTML=`- ${this.currency} ${this.promoCode.discountedAmount.toFixed(2)}`):((0,a.ZP)("promo-summary").style.display="none",(0,a.ZP)("promo-details").innerHTML=""),this.additionalSeats.status&&this.additionalSeats.amount>0?((0,a.ZP)("additional-seats-summary").style.display="block",(0,a.ZP)("additional-seats-count").innerHTML=this.additionalSeats.count.toString(),(0,a.ZP)("additional-seats-details").innerHTML=`${this.currency} ${this.additionalSeats.amount.toFixed(2)}`):(0,a.ZP)("additional-seats-summary").style.display="none",this.tax.status?((0,a.ZP)("tax-summary").style.display="block",(0,a.ZP)("tax-details").innerHTML=`${this.currency} ${this.tax.amount.toFixed(2)}`):((0,a.ZP)("tax-summary").style.display="none",(0,a.ZP)("tax-details").innerHTML="")},this.getUTMParam=()=>{const t={};let e="";return this.options.utm_source&&(t.utm_source=this.options.utm_source),this.options.utm_medium&&(t.utm_medium=this.options.utm_medium),this.options.utm_campaign&&(t.utm_campaign=this.options.utm_campaign),e+=Object.keys(t).map((e=>e+"="+t[e])).join("&"),e?`&${e}`:e},this.getRenewalPrice=t=>{const e=this.subscriptionPlans.filter((e=>e.code===t))[0];if(e.pricing[this.currency].amount)return e.pricing[this.currency].amount;if("premium-monthly"===t)return 7.99;if("premium-yearly"===t)return 59;if("team-monthly"===t)return 12.99;if("team-yearly"===t)return 119;if("plus-monthly"===t)return 1.99;if("plus-yearly"===t)return 8.99;throw new Error("Failed to get pricing details")},this.selectSeats=(t,e=!1)=>{const i=t;if(document.querySelectorAll(".seat-option").forEach((t=>{t!==i&&t.classList.remove("active")})),"subscription"===this.checkoutType&&i.classList.toggle("active"),"seats"===this.checkoutType&&(i.classList.contains("active")||i.classList.toggle("active")),i.classList.contains("active"))if(i.classList.contains("seat-option-custom")){const t=i.getElementsByTagName("input")[0];""==t.value?(this.additionalSeats.status=!1,this.additionalSeats.count=0):(this.additionalSeats.status=!0,this.additionalSeats.count=Number(t.value))}else"0"==i.dataset.value?(this.additionalSeats.status=!1,this.additionalSeats.count=0):(this.additionalSeats.count=Number(i.dataset.value),this.additionalSeats.status=!0);else this.additionalSeats.status=!1,this.additionalSeats.count=0;this.updatePrice()},this.trackShareASale=t=>{const{merchantReference:e,paidAmount:i,currency:s,sscid:n,newCustomer:a=0}=t;if(n){const t=document.createElement("img");t.id="_SHRSL_img_1",t.src=`https://www.shareasale.com/sale.cfm?tracking=${e}&amount=${i}&merchantID=94987&transtype=sale&sscidmode=6&sscid=${n}&currency=${s}&newcustomer=${a}`,t.style.width="1",t.style.height="1";const r=document.createElement("script");r.src="https://www.dwin1.com/19038.js",r.type="text/javascript",r.defer=!0,this.dialog.appendChild(t),this.dialog.appendChild(r)}},i.e(1477).then(i.bind(i,64593)),this.content.id="checkout-modal",this.dialog.style.maxWidth="900px",this.checkoutType=t,this.options=e,this.options.platform||(this.options.platform="suite"),this.options.stage&&(this.stage=this.options.stage),this.setContent('\n            <div id="checkout-loading">\n                Please wait while checkout is loading\n            </div>\n        '),"template"===this.checkoutType){if(!this.options.stage)throw new Error("Failed to load stage");this.templateId=null!==(p=null===(m=null===(o=this.stage.fresco)||void 0===o?void 0:o.templateMeta)||void 0===m?void 0:m.templateId)&&void 0!==p?p:"-",this.renewalPrice=1,this.totalPrice=1}"seats"===this.checkoutType&&(this.seatPrice=(null===(g=null===d.a||void 0===d.a?void 0:d.a.subscriptionCode)||void 0===g?void 0:g.includes("monthly"))?3.99:47.88,this.renewalPrice=0,this.totalPrice=this.seatPrice),"subscription"===this.checkoutType&&(this.options.plan&&(this.checkoutPlan=this.options.plan),this.options.checkoutMode&&(this.checkoutMode=this.options.checkoutMode),this.checkoutPlan.includes("premium")&&(this.productName="Pixlr Premium",this.checkoutDiscountPercentage="-38%"),this.checkoutPlan.includes("plus")&&(this.productName="Pixlr Plus",this.checkoutDiscountPercentage="-62%"),this.checkoutPlan.includes("team")&&(this.productName="Pixlr Team",this.seatPrice="team-monthly"===this.checkoutPlan?3.99:47.88,this.checkoutDiscountPercentage="-31%"),this.freeTrial=!("Pixlr Premium"!==this.productName||!(null===d.a||void 0===d.a?void 0:d.a.eligibleForTrail)),Promise.all([n.o5(),n.Gr(this.checkoutPlan)]).then((([t,e])=>{var i,s,n,r,o;if(this.upgradeDetails=e,!t.status)throw new Error("Failed to get plan details");"upgrade"===this.checkoutMode&&(this.freeTrial=!1,e.status&&(this.balanceCredit=e.data.balanceCredit)),this.subscriptionPlans=t.data,this.renewalPrice=this.totalPrice=this.getRenewalPrice(this.checkoutPlan),null===(i=(0,a.ZP)("checkout-loading"))||void 0===i||i.remove(),this.setContent(`\n                    <div id="checkout" class="">\n                        <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                        ${y}\n                        ${w}\n                        ${x}\n                    </div>\n                    <div id="overview" class="left-panel"></div>\n                `),(0,a.ZP)("overview").innerHTML=S(this.productName,this.checkoutPlan,this.totalPrice),null===(s=(0,a.ZP)("checkout-plan"))||void 0===s||s.addEventListener("change",(()=>this.toggleCheckoutPlan())),"upgrade"!==this.checkoutMode||e.status?("upgrade"===this.checkoutMode||"Pixlr Plus"===this.productName?(0,a.ZP)("promocode-add").style.display="none":(null===(n=(0,a.ZP)("promocode-submit"))||void 0===n||n.addEventListener("click",this.applyPromoCode),null===(r=(0,a.ZP)("promocode-input"))||void 0===r||r.addEventListener("input",this.promoCodeOnInput),null===(o=(0,a.ZP)("promocode-add"))||void 0===o||o.addEventListener("click",(()=>{(0,a.ZP)("promocode-toggle").style.display="block",(0,a.ZP)("promocode-add").style.display="none"}))),this.checkoutPlan.includes("yearly")&&this.toggleCheckoutPlan(!0),this.options.code&&this.applyPromoCode(),this.loadEventListener()):this.setContent(this.resultModal({status:!1}))})));const y=`\n            <div id="payment-method" class="hide top-20">\n                <h2 class="heavy">${(0,s.Z)("paymentMethod")}</h2>\n                \n            <div id="saved-cards"></div>\n        \n                <div class="payment-options top-20">\n                    <div class="radio-options">\n                        <input type="radio" name="payment" value="adyen" id="adyen-radio-option" data-checked="true" checked/>\n                        <label for="adyen-radio-option">${(0,s.Z)("useCreditCard")}</label>\n                    </div>\n                    <div class="radio-options ${"checkout"===this.checkoutMode?"":"hidden"}">\n                        <input type="radio" name="payment" value="paypal" id="paypal-radio-option" data-checked="false"/>\n                        <label for="paypal-radio-option"> ${(0,s.Z)("payWith")} <img class="paypal-icon" src="/img/icon/paypal.png"/></label>\n                    </div>\n                </div>\n            </div>\n        `,w=`\n            <div id="card-page" class="hide">\n                <div class="w-100">\n                    <div id="component-container" style="padding: 15px 0 10px"></div>\n                    <div id="add-billing-container">\n                        <a id="add-billing-info" class="heavy anchor"><img src="/img/icon/plus-circle-light-blue.svg">${(0,s.Z)("AddOptionalBillingInformation")}</a>\n                    </div>\n                </div>\n            </div>\n        `,x=`\n            <div id="billing-page" class="hide top-20">\n                <img id="back-billing-icon" src="/img/icon/arrow-left-black.svg">\n                <div class="billing-form w-100">\n                    <h3 class="heavy">${(0,s.Z)("billingDetailsSmallCap")}</h3>\n                    <form id="billing-address" style="padding: 15px 0 10px">`+(0,a.T)("div",{className:"flex"},r.By("checkout-firstName",50),r.By("checkout-lastName",50)).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-company-name",100,"","checkout-optional")).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-vatNumber",100,"","",r.L8("For value-added  tax purposes"))).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-companyRegistrationNumber",100,"","checkout-optional")).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-department",100,"","checkout-optional")).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-address",100)).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-city",50),r.By("checkout-zipCode",50)).outerHTML+(0,a.T)("div",{className:"flex"},r.By("checkout-state",50),r.Cj("checkout-country",50)).outerHTML+"</form>\n                </div>\n\t\t\t</div>\n        ",b=`\n            <a id="promocode-add">${(0,s.Z)("iHaveAPromoCode")}!</a>\n            <div id="promocode-toggle" class="w-100 top-15" style="display:none">\n                <p class="heavy" style="font-size: 12px">${(0,s.Z)("promoCode")} </p>\n                <div id="promo-section">\n                    <input type="text" id="promocode-input" placeholder="${(0,s.Z)("promoCode")} *">\n                    <span id="promocode-submit" class="apply">${(0,s.Z)("apply")}</span>\n                </div>\n                <p id="promocode-error">${(0,s.Z)("invalidPromoCode")}</p>\n                <p id="promo-tac">* ${(0,s.Z)("codeIsvalidForOneTimeOnlyDiscountNotAppliedToNextCharges")}</p>\n            </div>\n        `,k=()=>`\n                <div id="breakdown-summary" class="top-20">\n                    ${"subscription"===this.checkoutType&&this.productName?`\n                        <div>\n                            <p>\n                                ${this.productName.replace("Pixlr","")+" "+(0,s.Z)("subscription")}\n                                <span style="float: right;" id="renewal-price">${this.renewalPrice.toFixed(2)}</span>\n                                <span style="float: right; margin-right: 5px;" class="currency">${this.currency}</span>\n                            </p>\n                            <span>${"Pixlr Team"===this.productName?(0,s.Z)("x5SeatIncluded"):""}</span>\n                        </div>\n                        `:""}                    \n                    <div id="promo-summary" style="display: none;">\n                        <p>\n                            ${(0,s.Z)("promoCode")}: \n                            <span id="promo-details" style="float:right;"></span>\n                        </p>\n                        <span id="promo-remarks"></span>\n                    </div>\n                    <div id="balance-credit-summary" style="display: none;">\n                        <p>\n                            Balance Credit:\n                            <span id="balance-credit-details" style="float:right;"></span>\n                        </p>\n                    </div>\n                    <div id="additional-seats-summary" style="display: none;">\n                        <p>\n                            ${(0,s.Z)("additionalSeats")}\n                            <span id="additional-seats-details" style="float:right;"></span>\n                        </p>\n                        <span>x<span id="additional-seats-count"></span> ${(0,s.Z)("seats")}</span>\n                    </div>\n                    <div id="tax-summary" style="display: none;">\n                        <p>\n                            GST: 8%\n                            <span id="tax-details" style="float:right;"></span>\n                        </p>\n                    </div>\n                </div>\n            `,S=(t,e,i)=>`\n                <div class="card">\n\n                    <p class="small heavy">\n                        ${t}\n                        <a class="semi-bold anchor" style="float:right;font-size:10px;line-height:18px;" href="/pricing/" target="_blank">${(0,s.Z)("subscriptionBenefits")}</a>\n                    </p>\n\n                    ${"checkout"===this.checkoutMode?`\n                        <div class="row pad-10">\n                            <div id="checkout-toggler">\n                                <input type="checkbox" class="toggle-check" id="checkout-plan" />\n                                <label for="checkout-plan">\n                                    <div class="switch-plan ${e.includes("monthly")?"isMonthly":"isYearly"}">\n                                        <div class="switch-plan-monthly ${e.includes("monthly")?"active":""}">${(0,s.Z)("monthly")}</div>\n                                        <div class="switch-plan-yearly ${e.includes("yearly")?"active":""}">${(0,s.Z)("yearly")} <span class="yearly-badge" style="${this.checkoutDiscountPercentage?"":"display:none"}">${this.checkoutDiscountPercentage}</span></div>\n                                    </div>\n                                </label>\n                            </div>\n                        </div>\n                    `:""}\n\n                    <p style="font-size:14px">\n                        <span class="currency" style="font-size:14px">${this.currency} </span> \n                        <span id="plan-price" style="font-size:14px">${i}</span>/<span id="plan-duration" style="font-size:14px">month</span> • ${(0,s.Z)("checkout-autorenewalBasis")}\n                    </p>\n                    <p style="font-size:12px; line-height:14px; margin:15px 0">${(0,s.Z)("youCanCancelAuto")}</p>\n\n                    <div style="border-top: 1px solid #D3D4D4; width: 100%; margin:10px 0"></div>\n\n                    ${"Pixlr Team"===t?`\n                    <div style="width: 100%">\n                        <p class="heavy" style="padding-bottom: 10px; font-size: 12px; display: flex; align-items: center">\n                            <img src="/images/icon/team-blue.svg" style="width: 20px; height: 20px; margin-right: 5px"> \n                            ${(0,s.Z)("needMoreSeats")}\n                            <img id="collapse-seat" class="pointer" src="/images/icon/small-arrow-down.svg" style="margin-left: 8px; width: 12px">\n                        </p>\n                        <div class="seat-select hide">\n                            <span class="seat-option" data-value="5">5 ${(0,s.Z)("seats")}</span>\n                            <span class="seat-option" data-value="10">10 ${(0,s.Z)("seats")}</span>\n                            <span class="seat-option" data-value="20">20 ${(0,s.Z)("seats")}</span>\n                            <span class="seat-option seat-option-custom"><input type="number" placeholder="Custom" min="1" max="100" oninput="this.value = !!this.value && Math.abs(this.value) >= 1 ? Math.abs(this.value) : null"></span>\n                        </div>\n                    </div>\n                    `:""}\n\n                    ${b}\n                    ${k()}\n\n                    <div style="padding-bottom: 18px; border-bottom: 1px dashed #D3D4D4; width: 100%"></div>\n                    <div class="row space-between" style="padding: 18px 0; width: 100%; align-items: center">\n                        <div>\n                            <h3 class="heavy" style="text-transform: none; opacity: 1;color: #333">\n                                ${(0,s.Z)("checkout-totalDue")}:\n                            </h3>\n                            <span id="tax-included" style="display: none;font-size: 14px; color: #A3A3A3">(incl. GST)</span>\n                        </div>\n                        <h3 style="font-size: 18px;opacity: 1;color: #333">\n                            <span class="currency heavy" style="font-size: 18px">${this.currency}</span>\n                            <span class="heavy" id="total-price" style="font-size: 18px">${i}</span>\n                        </h3>\n                    </div>\n                    <button id="subscription-pay-btn" class="button big positive w-100">${(0,s.Z)("payAmountNow").replace("{number}",`${this.currency} ${i.toFixed(2)}`)}</button>\n                    <span id="freetrial-note" class="pad-10"></span>\n                    \n                </div>\n            `,Z=`\n            <div id="premium-options" class="card">\n                <p style="font-weight: bold;">Pixlr Template</p>\n                <p><span class="currency">${this.currency}</span> ${this.currencySymbol}1.00/template</p>\n\n                <div class="column space-between pad-15 template-info">\n                    <div id="template-canvas" style="padding:9px;"></div>\n                    <div class="desc">${(0,s.Z)("dontJustPayForOne")} <span id="premium-check">here</span></div>\n                </div>\n                ${k()}\n                <div class="row space-between pad-0" style="margin-bottom: 15px">\n                    <h3 style="text-transform: none; font-size:18px" class="heavy">${(0,s.Z)("checkout-totalDue")}:</h3>\n                    <h3 style="font-size:18px">\n                        <span class="currency heavy">${this.currency}</span>\n                        <span class="heavy" id="total-price">${this.totalPrice.toFixed(2)}</span>\n                    </h3>\n                </div>\n                <button id="template-pay-btn" class="button big positive w-100 pad-15">${(0,s.Z)("payNow")}</button>\n            </div>\n        `,P=`\n            <div id="premium-options" class="card">\n\n                <div style="margin:-15px -15px 0 -15px;padding:15px;">\n                    <h3 class="heavy" style="margin-top: 25px">${(0,s.Z)("additionalSeats")}</h3>\n\n                    <p class="heavy" style="font-size:14px">\n                        <span class="currency heavy" style="font-size:14px">${this.currency} </span> \n                        ${this.currencySymbol}\n                        <span id="plan-price" class="heavy" style="font-size:14px">${this.seatPrice}</span>/<span id="plan-duration" class="heavy" style="font-size:14px">${(0,s.Z)("seats")}</span>\n                    </p>\n\n                    <p id="prorated-seat" style="font-size: 11px; line-height: 16px; display: none;">\n                        Enjoy added seats for free until your next renewal. Cost for any additonal seats will be prorated to your subscription renewal.\n                    </p>\n                </div>\n\n                <div style="border-top: 1px solid #D3D4D4; width: 100%"></div>\n\n                <div>\n                    <p class="heavy" style="padding-bottom: 10px; font-size: 12px; display: flex; align-items: center">\n                        <img src="/images/icon/team-blue.svg" style="width: 20px; height: 20px; margin-right: 5px"> \n                        ${(0,s.Z)("needMoreSeats")}\n                        <img id="collapse-seat" src="/images/icon/small-arrow-down.svg" style="margin-left: 5px">\n                    </p>\n                    <div class="seat-select">\n                        <span class="seat-option active" data-value="5">5 ${(0,s.Z)("seats")}</span>\n                        <span class="seat-option" data-value="10">10 ${(0,s.Z)("seats")}</span>\n                        <span class="seat-option" data-value="20">20 ${(0,s.Z)("seats")}</span>\n                        <span class="seat-option seat-option-custom"><input type="number" placeholder="Custom" min="1" max="100" oninput="this.value = !!this.value && Math.abs(this.value) >= 1 ? Math.abs(this.value) : null"></span>\n                    </div>\n                </div>\n\n                ${k()}\n\n                <div style="padding-bottom: 18px; border-bottom: 1px dashed #D3D4D4; width: 100%"></div>\n                <div class="row space-between" style="padding: 18px 0; width: 100%">\n                    <h3 class="heavy" style="text-transform: none;opacity: 1;color: #333">${(0,s.Z)("checkout-totalDue")}:</h3>\n                    <h3 style="font-size: 18px;opacity: 1;color: #333">\n                        <span class="currency heavy">${this.currency}</span>\n                        <span class="heavy" id="total-price">${this.totalPrice}</span>\n                    </h3>\n                </div>\n                <button id="seats-pay-btn" class="button big positive w-100 pad-15">${(0,s.Z)("payAmountNow",`${this.currency} ${this.totalPrice.toFixed(2)}`)}</button>\n                <span id="freetrial-note" class="pad-10"></span>\n                    \n            </div>\n        `;"template"===this.checkoutType&&(null===(v=(0,a.ZP)("checkout-loading"))||void 0===v||v.remove(),this.setContent(`\n                <div id="checkout" class="">\n                    <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                    ${y}\n                    ${w}\n                    ${x}\n                </div>\n                <div id="overview" class="left-panel"></div>\n            `),(0,a.ZP)("overview").innerHTML=Z,(0,a.ZP)("template-canvas").appendChild(this.stage.getOutputCanvas(.08)),(0,a.ZP)("premium-check").addEventListener("click",(()=>{this.cleanUp(),new h.Z(this.stage)})),this.loadEventListener()),"seats"===this.checkoutType&&(null===(f=(0,a.ZP)("checkout-loading"))||void 0===f||f.remove(),this.setContent(`\n                <div id="checkout" class="">\n                    <img id="back-premium-icon" class="hide" src="/img/icon/arrow-left-black.svg">\n                    ${y}\n                    ${w}\n                    ${x}\n                </div>\n                <div id="overview" class="left-panel"></div>\n            `),(0,a.ZP)("overview").innerHTML=P,this.updatePrice(),this.selectSeats(document.getElementsByClassName("seat-option")[0]),this.loadEventListener())}}},92409:(t,e,i)=>{i.d(e,{Ev:()=>a,V:()=>r});var s=i(93947),n=i(74820);async function a(){if(!("getDigitalGoodsService"in window))return!1;try{return!!(await window.getDigitalGoodsService("https://play.google.com/billing"))}catch(t){return console.log(t),!1}}async function r(t,e){const i=(0,s.pR)("__pat",""),a="premium_monthly",r="product_1",c="com.pixlr."+n.ZP.product;if("getDigitalGoodsService"in window)try{const s=await window.getDigitalGoodsService("https://play.google.com/billing");if(s){if(!("PaymentRequest"in window))return console.log("something went wrong"),!1;{const n=new PaymentRequest([{supportedMethods:"https://play.google.com/billing",data:{sku:t?r:a}}]);try{const h=await n.show();if(await h.complete(),t){let t=await async function(t,e,i,s,n){try{const a=await fetch("/api/purchase/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+t},body:JSON.stringify({productId:e,packageName:s,purchaseToken:i,itemId:n})});return null!=(await a.json()).status}catch(a){return console.log(a),!1}}(i,r,h.details.token,c,e);return t?"acknowledge"in s?(console.log("v1"),await s.acknowledge(h.details.token,"repeatable"),!0):(await s.consume(h.details.token),console.log("v2"),!0):(console.log("status false"),!1)}return!!(await o(i,a,h.details.token,c))&&("acknowledge"in s&&await s.acknowledge(h.details.token,"onetime"),!0)}catch(h){return console.log("catch false"),console.log(h),!1}}}}catch(h){return console.log(h),!1}}async function o(t,e,i,s,n=!1){try{const a=await fetch("/api/subscription/validate/google",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:"Bearer "+t},body:JSON.stringify({productId:e,packageName:s,purchaseToken:i,freeTrial:n})});return null!=(await a.json()).status}catch(a){return console.log(a),!1}}},99344:(t,e,i)=>{async function s(t,e=5e3,i=3e4){const s=(new Date).getTime()+i,n=(i,a)=>{Promise.resolve(t()).then((t=>{console.log(t);const r=(new Date).getTime();"success"===t.status?i(t):r<s||"pending"===t.status?setTimeout(n,e,i,a):a(new Error("AsyncPoller: reached timeout"))})).catch((t=>{a(t)}))};return new Promise(n)}i.d(e,{n:()=>s})},23770:(t,e,i)=>{i.d(e,{X3:()=>n});var s=i(33655);async function n(){try{return await o.open()}catch(t){return Promise.resolve(new l)}}class a{constructor(t){this.next=()=>this.queue.pop(),this.queue=[new s.L5];let e=this.queue[0];t.onsuccess=()=>{const i=t.result;i?(e.resolve({done:!1,value:i.value}),e=new s.L5,this.queue.unshift(e),i.continue()):e.resolve({done:!0,value:void 0})},t.onerror=()=>{e.reject(t.error)}}[Symbol.asyncIterator](){return this}}class r{constructor(t){this.inner=t}static bound(t,e,i=!1,s=!1){return new r(IDBKeyRange.bound(t,e,i,s))}static lowerBound(t,e){return new r(IDBKeyRange.lowerBound(t,e))}static upperBound(t,e){return new r(IDBKeyRange.upperBound(t,e))}static only(t){return new r(IDBKeyRange.only(t))}static unwrap(t){return t instanceof r?t.inner:t}}class o{constructor(t){this.underlying=t}static availiable(){return!navigator.userAgent.includes("Edge")&&!!window.indexedDB}transaction(t,...e){const i=this.underlying.transaction(e,t);return e.map((t=>new c(i.objectStore(t))))}}o.open=async()=>o.availiable()?new Promise(((t,e)=>{const i=window.indexedDB.open("pixlr",2);i.onupgradeneeded=t=>{const e=i.result;0===t.oldVersion?(e.createObjectStore("blobs"),e.createObjectStore("fonts"),e.createObjectStore("document-meta",{keyPath:"id"}),e.createObjectStore("document-selection"),e.createObjectStore("document-thumbnail"),e.createObjectStore("layer-meta",{keyPath:"id"}).createIndex("document","document"),e.createObjectStore("layer-mask"),e.createObjectStore("layer-bitmap")):e.deleteObjectStore("history")},i.onerror=t=>e(i.error),i.onsuccess=()=>t(new o(i.result))})):Promise.reject(new Error("Browser does not support indexedDB"));class c{constructor(t){this.underlying=t}get(t){return new Promise(((e,i)=>{const s=this.underlying.get(t);s.onsuccess=()=>e(s.result),s.onerror=()=>i(s.error)}))}getAll(t,e){return new Promise(((i,s)=>{const n=this.underlying.getAll(r.unwrap(t),e);n.onsuccess=()=>i(n.result),n.onerror=()=>s(n.error)}))}iterate(t,e){const i=this.underlying.openCursor(r.unwrap(t),e);return new a(i)}index(t){const e=this.underlying.index(t);return new h(e)}cursor(t,e,i){return new Promise(((s,n)=>{const a=this.underlying.openCursor(r.unwrap(e),i);a.onsuccess=()=>{const e=a.result;if(e){const i=t(e.value,e);"number"==typeof i?e.advance(i):!1!==i?e.continue():s()}else s()},a.onerror=()=>n(a.error)}))}put(t,e){return new Promise(((i,s)=>{const n=this.underlying.put(t,e);n.onsuccess=()=>{i()},n.onerror=()=>{s(n.error)}}))}add(t,e){return new Promise(((i,s)=>{const n=this.underlying.add(t,e);n.onsuccess=()=>{i()},n.onerror=()=>{s(n.error)}}))}clear(){return new Promise(((t,e)=>{let i=this.underlying.clear();i.onsuccess=()=>t(),i.onerror=()=>e(i.error)}))}count(t){return new Promise(((e,i)=>{let s;s=void 0===t?this.underlying.count():this.underlying.count(r.unwrap(t)),s.onsuccess=()=>e(s.result),s.onerror=()=>i(s.error)}))}delete(t){return new Promise(((e,i)=>{const s=this.underlying.delete(r.unwrap(t));s.onsuccess=()=>e(),s.onerror=()=>i(s.error)}))}}class h{constructor(t){this.underlying=t,this.name=t.name,this.keyPath=t.keyPath,this.multiEntry=t.multiEntry,this.unique=t.unique}get(t){return new Promise(((e,i)=>{const s=this.underlying.get(t);s.onsuccess=()=>e(s.result),s.onerror=()=>i(s.error)}))}getAll(t,e){return new Promise(((i,s)=>{const n=this.underlying.getAll(r.unwrap(t),e);n.onsuccess=()=>i(n.result),n.onerror=()=>s(n.error)}))}count(t){return new Promise(((e,i)=>{let s;s=void 0===t?this.underlying.count():this.underlying.count(r.unwrap(t)),s.onsuccess=()=>e(s.result),s.onerror=()=>i(s.error)}))}cursor(t,e,i){return new Promise(((s,n)=>{const a=this.underlying.openCursor(r.unwrap(e),i);a.onsuccess=()=>{const e=a.result;e?(t(e.value,e),e.continue()):s()},a.onerror=()=>n(a.error)}))}iterate(t,e){const i=this.underlying.openCursor(r.unwrap(t),e);return new a(i)}getAllKeys(t,e){return new Promise(((i,s)=>{const n=this.underlying.getAllKeys(r.unwrap(t),e);n.onsuccess=()=>i(n.result),n.onerror=()=>s(n.error)}))}}class l{transaction(t,...e){return e.map((t=>new d(t)))}}class d{constructor(t){this.name=t}index(t){return this}put(t,e){}add(t,e){}clear(){}delete(t){}async get(t){}async getAll(t,e){return[]}async count(t){return 0}async cursor(t,e,i){}iterate(t,e){return{next:()=>Promise.resolve({done:!0,value:void 0}),[Symbol.asyncIterator](){return this}}}}},93947:(t,e,i)=>{i.d(e,{FN:()=>h,Rg:()=>c,T:()=>r,ZP:()=>a,b0:()=>l,pR:()=>o});var s=i(96548),n=i(43673);function a(t){return document.getElementById(t)}function r(t,...e){const i=document.createElement(t);if(0===e.length)return i;const s=e[0],n=!("string"==typeof s||s instanceof HTMLElement),a=n?e.slice(1):e;if(n&&s){if(s.style){const t=s.style;delete s.style,"string"==typeof t?i.setAttribute("style",t):Object.assign(i.style,t)}if(s.dataset){const t=s.dataset;delete s.dataset,"object"==typeof t&&Object.entries(t).map((([t,e])=>i.setAttribute(`data-${t}`,e)))}Object.assign(i,s)}return i.append(...a.filter((t=>null!=t))),i}function o(t,e){const i=document.cookie.split(";").map((t=>t.trim().split("="))).find((([e,i])=>e===t));return i?i[1]:e}function c(t,e,i,s){t.style.touchAction="none";const a=t=>{t.stopPropagation(),t.preventDefault(),i&&i(new n.Z(t.clientX,t.clientY))},r=e=>{e.stopPropagation(),e.preventDefault(),s&&s(new n.Z(e.clientX,e.clientY)),t.removeEventListener("pointermove",a,!0),t.removeEventListener("pointerup",r,!0),t.releasePointerCapture(e.pointerId)};t.addEventListener("pointerdown",(i=>{i.preventDefault(),i.button>0||(t.addEventListener("pointermove",a,!0),t.addEventListener("pointerup",r,!0),t.setPointerCapture(i.pointerId),e&&e(new n.Z(i.clientX,i.clientY)))}),!0)}const h=(t="success",e="common-ServerError",i=3,n)=>{let o=e?(0,s.Z)(e):"danger"==t?(0,s.Z)("common-ServerError"):(0,s.Z)("common-success");n&&(o=o.replace("{email}",n)),document.body.append(r("div",{id:"toast-box",className:`toast ${t}`},r("span",r("img",{src:`/images/icon/${t}_alert.svg`})),r("span",{className:"toast-text"},o),r("span",{className:`toast-close ${t}`,style:"line-height: 0;",onclick:()=>{var t;return null===(t=a("toast-box"))||void 0===t?void 0:t.remove()}},r("img",{style:"width: 14px;",src:"/images/icon/close.png"})))),setTimeout((()=>{var t;return null===(t=a("toast-box"))||void 0===t?void 0:t.remove()}),1e3*i)};function l(t,e,i,n=!1){let a=!1;if(e||(e=t.value),"email"===i)(e=e.trim()).match(/^[^\s@]+@[^\s@]+\.[^\s@]+$/)||n&&""===e?(t.classList.remove("invalid"),t.nextElementSibling.style.display="none"):(a=!0,t.classList.add("invalid"),t.nextElementSibling.style.display="block");else if("password"===i){const i=t.nextElementSibling;e.length<8||e.length>50?(a=!0,t.classList.add("invalid"),i.style.display="block",e.length<8?i.innerHTML=(0,s.Z)("common-MinPassword"):e.length>50&&(i.innerHTML=(0,s.Z)("common-MaxPassword"))):(t.classList.remove("invalid"),i.style.display="none")}else if("code"===i){const i=t.nextElementSibling;6!==e.length?(t.classList.add("invalid"),i.style.display="block",a=!0):(t.classList.remove("invalid"),i.style.display="none"),setTimeout((()=>{t.classList.remove("invalid"),i.style.display="none"}),3e3)}return!a}},47163:(t,e,i)=>{i.d(e,{Z:()=>c});var s=i(33655),n=i(23770),a=i(95574),r=i(77758);class o{constructor(t,e,i=!1,s="woff",n,a){this.name=t,this.short=e,this.premium=i,this.local=!!n,this.thumb=a,this.font=n,this.type=s}static async save(t){const e=await(0,n.X3)(),[i]=e.transaction("readwrite","fonts");await i.put(t,t.name)}static async delete(t){const e=await(0,n.X3)(),[i]=e.transaction("readwrite","fonts");await i.delete(t.name)}}class c{static async loadFontFromTemplate(t,e,i){var s,n;let a=null===(s=i.split(".")[0])||void 0===s?void 0:s.toLowerCase(),r=null===(n=i.split(".")[1])||void 0===n?void 0:n.toLowerCase();return await c.createLocalFontDesc(t,e,a,r)}static async loadFontFromUpload(t){var e,i;let s=null===(e=t.name.split(".")[0])||void 0===e?void 0:e.toLowerCase().substring(0,50).replace(" ","-"),n=null===(i=t.name.split(".")[1])||void 0===i?void 0:i.toLowerCase(),a=s.substring(0,20).replace("-","").toLowerCase();if(s=(null==s?void 0:s.charAt(0).toUpperCase())+(null==s?void 0:s.slice(1)),c.fontList.find((t=>t.name===s)))return void document.dispatchEvent(new CustomEvent("notification",{detail:"Font already exists!"}));let r=n;switch(n){case"otf":r="opentype";break;case"ttf":r="truetype"}const o=new Blob([t],{type:"font/"+r});let h=await c.createLocalFontDesc(o,s,a,n);return h&&document.dispatchEvent(new CustomEvent("notification",{detail:"Font was added!"})),h}static async createLocalFontDesc(t,e,i,n){const a=new o(e,i,!1,n,t);try{await c.addToDOM(a)}catch(m){return console.log(m),void document.dispatchEvent(new CustomEvent("notification",{detail:"Failed to load font!"}))}let h=new r.Z(e,56);h.height>72&&h.setSize(Math.floor(72/h.height*56));const l=s.vL(400,80),d=l.getContext("2d");d.font=h.getCssFont(),d.fillStyle="#ffffff",d.textBaseline="top",d.fillText(e,0,Math.round((80-h.height)/2)-h.ascent);var u;return a.thumb=await(u=l,new Promise(((t,e)=>{u.toBlob((e=>{t(e)}),"image/png")}))),await o.save(a),c.fontList.unshift(a),a}static async removeLocalFontDesc(t){let e=c.getFontDesc(t);e&&(await o.delete(e),c.fontList=c.fontList.filter((t=>t!==e)))}static async addToDOM(t){if(!t)return;const e=t.local?new FontFace(t.name,await(0,a.h0)(t.font)):new FontFace(t.name,`url(/font/${t.short}.woff) format('woff')`);if(document.fonts.has(e))return Promise.resolve(e);let i=await e.load();return document.fonts.add(i),i}static getFontDesc(t){return c.fontList.find((e=>e.name===t))}static async getFontFile(t){let e=this.getFontDesc(t);if(!e)return;if(e.local)return new File([e.font],e.name);let i=await fetch("/font/"+e.short+".woff").then((t=>t.blob()));return i?new File([i],e.short+".woff",{type:"font/woff"}):void 0}static async loadSaved(){const t=await(0,n.X3)(),[e]=t.transaction("readonly","fonts");return e.iterate()}}c.fontList=[new o("Arial","arial"),new o("Courier New","courier"),new o("Georgia","georgia"),new o("Trebuchet MS","trebuchet"),new o("Verdana","verdana"),new o("Aberus","aberus"),new o("Ablation","ablation",!0),new o("Adeft","adeft"),new o("Adelya","adelya",!0),new o("Adios Amigos","adios"),new o("Adolfine","adolfine"),new o("Agnostic","agnostic",!0),new o("Aiden","aiden"),new o("Amaranth","amaranth"),new o("Amateur Typewriter","amateur",!0),new o("Alder","alder",!0),new o("Almondia","almondia"),new o("Aloma Island","alomaisland",!0),new o("Alvida","alvida"),new o("Amoreiza","amoreiza"),new o("AmoretteLight","amorette"),new o("Angeleno Brush Script","angeleno",!0),new o("Antreas","antreas"),new o("Arm Race","arm"),new o("Artick","artick"),new o("Asap","asap"),new o("Atomsfer","atomosfer"),new o("Atthens","atthens"),new o("Avocado Sans","avocado",!0),new o("Baangkarr Press","baangkarr",!0),new o("Badstar","badstar",!0),new o("Bahram","bahram"),new o("Baileyns","baileyns"),new o("Barooduck","barooduck",!0),new o("Bearley","bearley"),new o("Beat","beat",!0),new o("BebasNeue","bebasneue"),new o("Bellquinas","bellquinas"),new o("Bengrraas","bengrraas"),new o("Beornheard","beornheard"),new o("Berretti","berretti"),new o("Biker New","biker",!0),new o("Blossom Berry Script","blossomberry",!0),new o("Boullervard","boullervard"),new o("Bondie","bondie",!0),new o("Bondrians","bondrians",!0),new o("Braga Deco","braga"),new o("Brave Hearted","brave"),new o("Bright Orchid","brightorchid",!0),new o("Brioche","brioche",!0),new o("Brocklyn","brocklyn"),new o("Bronzier","bronzier",!0),new o("Brooklyn","brooklyn",!0),new o("Brodetto","brodetto"),new o("Bronela","bronela",!0),new o("The Brownies","brownies"),new o("Bubbble Gum","bubbblegum",!0),new o("Brushcheetah","brushcheetah"),new o("Butternut Script","butternut",!0),new o("Caang","caang"),new o("Cakehtreuks","cakehtreuks"),new o("Cannoli Poke","cannoli",!0),new o("Camille","camille"),new o("Calamandria","calamandria"),new o("Caldwell","caldwell",!0),new o("Carafun","carafun"),new o("Carnavonts","carnavonts"),new o("Carvino","carvino"),new o("Cervantes","cervantes"),new o("Chaiaathah","chaiaathah",!0),new o("Chalkyal","chalkyal"),new o("Chiqarine","chiqarine"),new o("Chukies","chukies"),new o("Cincoyo","cincoyo"),new o("Clockwise","clockwise",!0),new o("Coast Redwood","coast"),new o("Colombo","colombo",!0),new o("College","college",!0),new o("Companion","companion"),new o("Corlombus","corlombus"),new o("Conseration","conseration",!0),new o("CuprumFFU","cuprum"),new o("Cupello sons","cupello",!0),new o("Costa Mala","costamala",!0),new o("Cozy","cozy",!0),new o("CreamyMoony","creamy"),new o("Cross Road","crossroad",!0),new o("Cross Road Slab","crossroadslab",!0),new o("Daddy Day","daddy"),new o("Dankduck","dankduck"),new o("Darbots","darbots",!0),new o("Davish","davish",!0),new o("Davish Rounded","davishround",!0),new o("Dear Journal","dearjournal",!0),new o("Delicious","delicious",!0),new o("Desmodus","desmodus"),new o("Desmosedici","desmosedici"),new o("Dhangdose","dhangdose"),new o("Dingle","dingle",!0),new o("Djangart Rough","djangart"),new o("Dolington","dolington",!0),new o("Doppelganger","doppelganger",!0),new o("Dorr","dorr",!0),new o("Dustin","dustin",!0),new o("Earth And Sky","earth"),new o("Easterica","easterica"),new o("Eastone","eastone"),new o("Eastwood","eastwood",!0),new o("Echizen","echizen"),new o("El-Karnito","elkarnito"),new o("Elliot","elliot"),new o("Elysian","elysian",!0),new o("Emery","emery"),new o("Empire View","empire"),new o("Eugiene","eugiene"),new o("Espano","espano",!0),new o("Erleane","erleane"),new o("Everleigh","everleigh",!0),new o("Exquisite","exquisite",!0),new o("Espano","espano",!0),new o("Farewell Angelina","angelina",!0),new o("Father and Son","father"),new o("Fatherly","fatherly"),new o("Fenord","fenord",!0),new o("Finland","finland",!0),new o("Flamingo","flamingo"),new o("FoxyMist","foxy"),new o("Forever Freedom","forever",!0),new o("Game On","game"),new o("Gamour","gamour",!0),new o("Gallerina","gallerina",!0),new o("Geronide","geronide",!0),new o("Geronide Stamp","geronidestamp",!0),new o("Gingle Snowland","ginglesnowland",!0),new o("Gingerbreads","gingerbreads"),new o("Gladiolusy","gladiolusy",!0),new o("Glamper","glamper",!0),new o("Goldie Dreambox","goldiedreambox",!0),new o("Gordon","gordon",!0),new o("Gorgeous","gorgeous",!0),new o("Gingerly","gingerly",!0),new o("Goorraatt","goorraatt"),new o("Grayson","grayson",!0),new o("Great Again","great"),new o("Grovana","grovana",!0),new o("Gustavo","gustavo"),new o("Haahloddoh","haahloddoh"),new o("Hadrea","hadrea"),new o("Hairmusk","hairmusk"),new o("Hakushou","hakushou"),new o("Harietta","harietta",!0),new o("Hattori Hanzo","hattori"),new o("Haystacks","haystacks",!0),new o("Heater","heater"),new o("Hedonist","hedonist",!0),new o("Hello Alpha","helloa"),new o("Hello Daddy","hellod",!0),new o("Hello People","hello"),new o("Hello Spring","hellospring",!0),new o("Hellowins","hellowins"),new o("Heypatricks","heypatricks"),new o("Highway","highway",!0),new o("Hippo Letto","hippo"),new o("Historia","historia",!0),new o("Hollawind","hollawind"),new o("Hodor","hodor",!0),new o("Honey","honey"),new o("Honeyspice","honeyspice",!0),new o("Huckleberries","huckleberries"),new o("Hymned Sans","hymnedsans",!0),new o("Hymned Script","hymnedscript",!0),new o("IacottNeue","iacottneue",!0),new o("Icebold","icebold",!0),new o("Inder","inder"),new o("Indigo","indigo",!0),new o("Irish gold","irishgold"),new o("Irishgreen","irishgreen"),new o("Its mine","itsmine"),new o("Jacinda","jacinda",!0),new o("Jared","jared"),new o("Jarots","jarots"),new o("Jomantara","jomantara"),new o("Josefin","josefin"),new o("Juneville","juneville"),new o("Jura","jura"),new o("Kajika","kajika"),new o("Kakamora","kakamora"),new o("Katey Blue","kateyblue",!0),new o("Keripik","keripik"),new o("Ketapang","ketapang"),new o("Kindel","kindel",!0),new o("Kingbirds","kingbirds",!0),new o("Laahleggek","laahleggek"),new o("Laborations","laborations"),new o("La Fiesta","lafiesta"),new o("Landon","landon"),new o("Landre","landre",!0),new o("Langley","langley"),new o("La Vonn","vonn"),new o("Laudya Bloods","laudya"),new o("Leaderson","leaderson"),new o("Leath","leath"),new o("Legendum","legendum"),new o("Leobronx","leobronx"),new o("Little Edelweiss","little"),new o("Little Girl","littlegirl"),new o("Lotus Eater","lotuseater",!0),new o("Lobster","lobster"),new o("Lovalicious","lovalicious",!0),new o("Loverstruck","loverstruck"),new o("MaaLLaangBronks","maallaangbronks"),new o("Madison","madison"),new o("Magic Winter","magicwinter"),new o("Magic Trick","magic"),new o("Mai Leho Bahhrala","maileho"),new o("Maldisa","maldisa"),new o("Malinsha","malinsha",!0),new o("Maple Leaves","mapleleaves",!0),new o("Maxton","maxton"),new o("Market","market"),new o("Marones","marones",!0),new o("Me and my dog","meandmydog",!0),new o("Meidy","meidy"),new o("Menighampiil","menighampiil"),new o("Mewton","mewton"),new o("Merry Merry","merrymerry",!0),new o("Molot","molot"),new o("Momday","momday"),new o("Moms Note","moms"),new o("Monday Lovers","monday"),new o("Monetta","monetta"),new o("Mongli","mongli"),new o("Montour","montour"),new o("Morissette Script","morissette"),new o("Mountain","mountain"),new o("Mooka","mooka",!0),new o("More Magic","moremagic",!0),new o("Morgana Sonz","morgana",!0),new o("Nature Force","natureforce",!0),new o("Ms Orange Sky","ms"),new o("Najova","najova"),new o("Natarajasana","natarajasana"),new o("Naville","naville"),new o("Neorah","neorah"),new o("New Autumn","new"),new o("No Siesta","nosiesta"),new o("Night Jump","nightjump"),new o("Notes","notes",!0),new o("NoFire","nofire"),new o("North Avellion","northavellion",!0),new o("Northern","northern"),new o("North High Shadow","northhighsdw",!0),new o("North High","northhigh",!0),new o("Novante","novante",!0),new o("Nunu","nunu"),new o("Offlander","offlander",!0),new o("Oliemolly","oliemolly",!0),new o("Oracles","oracles"),new o("Ostern","ostern"),new o("Otakaku","otakaku"),new o("Out Hill","out"),new o("Overdose","overdose"),new o("Paabaalioot","paabaalioot"),new o("Painted Gallery","paintedgallery",!0),new o("Pandoura","pandoura"),new o("PapaRocknRoll","papa"),new o("Paradise","paradise"),new o("Patlabour","patlabour",!0),new o("Peach Market","peachmarket",!0),new o("Peanut","peanut"),new o("Peony Rose","peonyrose",!0),new o("Perfect Thoughts","perfectthoughts",!0),new o("Pina Colada","pinacolada",!0),new o("Piqolo","piqolo"),new o("Pixelo","pixelo"),new o("Plunge","plunge"),new o("Pop Fist","pop"),new o("Ponch","ponch",!0),new o("Popera","popera"),new o("Powder","powder",!0),new o("Practish","practish"),new o("Print Clearly","print"),new o("Pulsate","pulsate",!0),new o("Qlassik","qlassik"),new o("quatro","quatro",!0),new o("Quattrocento","quattrocento"),new o("Queenata","queenata"),new o("Quella Script","quella"),new o("Questro","questro"),new o("Quickie Sweet","quickie"),new o("Quill & Ink","quillink"),new o("Quish","quish"),new o("Ranania","ranania"),new o("Rankings Caps","rankingscaps",!0),new o("Raroedette","raroedette"),new o("Rawwwing","rawwwing"),new o("Raquella","raquella"),new o("Reepouh","reepouh"),new o("Regan Slab","regan"),new o("Reewoooh","reewoooh",!0),new o("Reilly","reilly"),new o("Remembrance","remembrance",!0),new o("Retrocycles","retrocycles"),new o("Retros","retros"),new o("Revans","revans",!0),new o("Reynolds Square","reynoldssquare",!0),new o("Rhapsody","rhapsody"),new o("Riverside","riverside"),new o("Republiko","republiko",!0),new o("Rocky","rocky"),new o("Roars","roars"),new o("Rockford","rockford",!0),new o("Rockrace","rockrace",!0),new o("Romaniesta","romaniesta"),new o("Romelio","romelio"),new o("Roossooh","roossooh"),new o("Ropa","ropa"),new o("Rolves","rolves",!0),new o("Roque","roque"),new o("Rosario","rosario"),new o("Roundaries","roundaries"),new o("Rowan","rowan",!0),new o("Salmonberry","salmonberry",!0),new o("San Barley","san"),new o("Saqanone","saqanone"),new o("Sants","sants"),new o("Sanur beach","sanur"),new o("Scriptonesia","scriptonesia",!0),new o("Secretary Typewriter","secretary",!0),new o("Sedalia","sedalia",!0),new o("Search","search",!0),new o("Searchlight","searchlight",!0),new o("See De Mayo","see"),new o("Serenity","serenity"),new o("The Servant","servant"),new o("Sheraton","sheraton",!0),new o("Shoelaces","shoelaces",!0),new o("Silvertone","silvertone",!0),new o("Smoother","smoother",!0),new o("Spring Break","springbreak",!0),new o("Spotlights Thin","spotlightsthin",!0),new o("Spotlights Chunky","spotlightschunky",!0),new o("Squiborn","squiborn",!0),new o("Staatliches","staatliches"),new o("Stardust Moonlight","stardust"),new o("The Stoothgart","stoothgart"),new o("Summer Coconut","summer"),new o("Summer Joy","summerjoy"),new o("Summer Nude","summernude",!0),new o("Summer Peach","summerpeach"),new o("Summer Solstice","summersolstice",!0),new o("Summery","summery"),new o("Sun Again","sunagain"),new o("Sun Pepper","sun"),new o("Sun Streets","sunstreets"),new o("Sunny Bay","sunnybay",!0),new o("Sunshine Boy","sunshine"),new o("Super Slayers","super"),new o("Surface","surface"),new o("Sweeneey","sweeneey"),new o("Teaspoon","teaspoon"),new o("Tabu","tabu"),new o("Teodore","teodore",!0),new o("TeXGyreHeros","texgyreheros"),new o("The Brocker","brocker"),new o("The California","thecalifornia"),new o("The Harison","harison"),new o("The Love For Money","theloveformoney",!0),new o("The Mastiff","mastiff"),new o("The Patriot","patriot"),new o("The Pinta","pinta"),new o("The Roxv","roxv"),new o("The Rogue","rogue"),new o("The Stegris","thestegris",!0),new o("The Queen","queen"),new o("Thirtylane","thirtylane",!0),new o("Titian","titian"),new o("Todes","todes",!0),new o("Tropical Coast","tropicalcoast"),new o("Torberta","torberta"),new o("Twigs","twigs"),new o("Twirly Ballerina","twirly",!0),new o("Unreal","unreal"),new o("Vaganza","vaganza"),new o("Valeria","valeria",!0),new o("Valery","valery"),new o("Vignette","vignette"),new o("Von Everect","von"),new o("The Voyager","voyager",!0),new o("Wandering Flowers","wandering",!0),new o("Wargate","wargate",!0),new o("Western Shooter","westernshooter",!0),new o("West Java","westjava",!0),new o("Winter Sunrise","wintersunrise",!0),new o("White Wonder","whitewonder",!0),new o("Yanone Kaffeesatz","kaffeesatz"),new o("Wonderul Wilderness","wonderulwilderness",!0),new o("Yoseline","yoseline"),new o("Zombie Dust","zombie")],c.loadFont=t=>{let e=c.fontList.find((e=>e.name===t));if(e)return c.addToDOM(e)}},95574:(t,e,i)=>{async function s(t,e){return new Promise(((i,s)=>{var n=new XMLHttpRequest,a=!1;n.responseType="arraybuffer",n.withCredentials=!1,n.open("GET",t,!0),n.onprogress=function(t){t.lengthComputable?e&&e(t.loaded/t.total*100):a||(a=!0,e&&e(-1))},n.onloadend=function(){n.status.toString().match(/^2/)?(a||e&&e(100),i(new Blob([this.response],{type:n.getResponseHeader("Content-Type")}))):s(n)},n.send()}))}function n(t){return new Promise(((e,i)=>{let s=new Image;s.onload=()=>e(s),s.onerror=t=>i(t),s.src=t}))}function a(t){return new Promise(((e,i)=>{const s=new FileReader;s.onerror=()=>i(s.error),s.onloadend=()=>e(s.result),s.readAsArrayBuffer(t)}))}function r(t){return new Promise((async(e,i)=>{const s=URL.createObjectURL(t);let n=new Image;n.crossOrigin="Anonymous",n.onload=()=>{URL.revokeObjectURL(s),n.width+n.height==0?i("Could not open file!"):e(n)},n.onerror=function(){URL.revokeObjectURL(s),i("Could not open file!")},n.name=t instanceof File?t.name:"",n.src=s}))}i.d(e,{OA:()=>n,c6:()=>s,h0:()=>a,s4:()=>r})},75934:(t,e,i)=>{i.d(e,{Q0:()=>_,ZB:()=>L});var s=i(93947),n=i(33655),a=(i(4375),i(95574)),r=i(9591),o=i(36817),c=i(82542),h=i(98776),l=i(43673),d=i(56584),u=i(39868),m=i(71030),p=i(74820),g=i(44170),v=i(78685),f=i(87108),y=i(51294),w=i(82282),x=i(84253),b=i(77359),k=i(77758),S=i(44686),Z=i(68934),P=i(9067),E=i(47163),C=(i(45453),i(33506)),M=i(58027);function _(t,e=!1){return new Promise(((i,n)=>{(0,s.ZP)("browse")&&(0,s.ZP)("browse").remove();let a=document.createElement("input");a.id="browse",a.type="file",a.multiple=t,a.className="offscreen",e&&(a.accept="image/*",a.capture="camera"),a.addEventListener("change",(()=>{a.files.length>0&&i(a.files),(0,s.ZP)("workspace").removeChild(a)}),!1),(0,s.ZP)("workspace").appendChild(a),a.click()}))}async function T(t){await async function(t,e,i=3e4){let a=!1;for(let s=0;s<document.head.childNodes.length;s++){const e=document.head.childNodes[s];if(e.nodeType===Node.ELEMENT_NODE&&e.getAttribute("src")===t){a=!0;break}}a||document.head.appendChild((0,s.T)("script",{src:t}));let r=0;for(;!e();){if(r>=i)throw new Error(`Timeout triggered when loading script ${t}`);const e=500;r+=e,await n.Dc(e)}}("/js/psd.js",(()=>window.require&&window.require("psd")));const e=window.require("psd"),i=await new Response(t).arrayBuffer(),a=new e(new Uint8Array(i));return a.parse(),a}async function L(t,e,s=!0,r="add"){var h,l;if(e){const f=null!==(h=e.type)&&void 0!==h?h:"";(0,m.Z)("open-file",f);try{switch(f){case"image/psd":case"application/psd":case"application/photoshop":case"application/x-photoshop":case"image/vnd.adobe.photoshop":(0,m.Z)("open-file","image/psd"),await I(t,e,r);break;case"image/tiff":await async function(t,e,s){const n=await async function(t){const e=(await i.e(2556).then(i.t.bind(i,74166,23))).default,s=await(0,a.h0)(t);return e.initialize({TOTAL_MEMORY:2*s.byteLength}),new e({buffer:s})}(e);let r=e.name.replace(/^.*[\\\/]/,"");t.addImage(n.toCanvas(),r,"add")}(t,e);break;default:const h=null===(l=e.name)||void 0===l?void 0:l.toLowerCase();if(h){if(h.endsWith(".psd"))return(0,m.Z)("open-file","image/psd"),void(await I(t,e,r));if(h.endsWith(".pxd"))return(0,m.Z)("open-file","image/pxd"),void(await async function(t,e,s){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const{PXD:r}=await i.e(5215).then(i.bind(i,28132)),c=await(0,a.h0)(e),h=r.decode(new Uint8Array(c)),l=new M.Z(n.M8(),e.name,h.width,h.height,void 0,void 0,void 0,s);try{t.supressRender=!0,t.addTab(l,"document");for(let e=0;e<h.layers;e++){const e=h.takeNextLayer(),i=e.width,s=e.height;switch(e.kind){case"bitmap":case"shape":{if(0===i||0===s){const i=new w.Z(n.M8(),e.name,void 0,void 0,!1);i.settings.opacity=e.alpha,i.settings.blendmode=e.blendMode,i.settings.visible=e.visible,i.settings.locked=e.locked,t.fresco.layers.push(i),e.free();continue}const a=n.vL(i,s),r=a.getContext("2d"),c=e.takeCanvas();r.putImageData(new ImageData(c,i,s),0,0);const h=new w.Z(n.M8(),e.name,a,new o.Z(e.x,e.y,i,s,e.rotation),e.locked);h.settings.opacity=e.alpha,h.settings.blendmode=e.blendMode,h.settings.visible=e.visible;const l=e.takeMask();if(l.length>0){const t=n.vL(i,s);t.getContext("2d").putImageData(new ImageData(l,i,s),0,0),h.mask=t,h.render()}t.fresco.layers.push(h);break}case"text":{const a=JSON.parse(e.meta),r=new k.Z(a.textSettings.font,a.textSettings.size);Object.assign(r,a.textSettings);const c=new v.Z(n.M8(),a.text,new o.Z(e.x,e.y,i,s,e.rotation),r);c.settings.opacity=e.alpha,c.settings.blendmode=e.blendMode,c.settings.visible=e.visible,await E.Z.loadFont(r.font),r.measureText(),await c.prepare(),t.fresco.layers.push(c)}}e.free()}}finally{h.free(),t.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}return await t.syncDocument(t.fresco),t.selectLayer(t.fresco.layers[0]),t.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render")),Promise.reject()}(t,e,r));if(h.endsWith(".pxz"))return(0,m.Z)("open-file","image/pxz"),void(await A(t,e,void 0,r));if(h.endsWith(".svg")&&"frame"!==r)return(0,m.Z)("open-file","image/svg+xml"),void(await async function(t,e,i=!0,s="add"){let n=await e.text();t.addSVGShape(n,e.name,s)}(t,e,s,r));if(h.endsWith(".otf")||h.endsWith(".ttf")||h.endsWith(".woff")||h.endsWith(".woff2"))return(0,m.Z)("open-file","font/"+e.name.split(".")[1]),void(await E.Z.loadFontFromUpload(e))}await async function(t,e,i=!0,s){const r=await(0,a.s4)(e);let h,l,m="e"===p.ZP.product&&i||"e"!==p.ZP.product?"create":"layer";if(("x"===p.ZP.product||"drop"===s)&&(m=i&&t.fresco?await(new u.Z).init():t.fresco?"layer":"create","close"===m))return;if(p.ZP.askToPreResize&&"m"!==p.ZP.product&&"create"===m&&(r.width>2500||r.height>2500)){if([h,l]=await new d.Z(r,await c.Z.rotation(e)).init(),void 0===h)return}else h=o.Z.bestFit(r.width,r.height,"premium"===(null===C.a||void 0===C.a?void 0:C.a.subscriptionAccess)?8196:4096,"premium"===(null===C.a||void 0===C.a?void 0:C.a.subscriptionAccess)?8196:4096).size(),l=0;let g=n.qT(r,h.width>h.height?h.width:h.height,l),v=e.name?e.name:r.src.replace(/^.*[\\\/]/,"");"create"===m&&t.addTab(new M.Z(n.M8(),v,g.width,g.height,void 0,void 0,void 0,s),"image");t.addImage(g,v,s)}(t,e,s,r)}}catch(g){throw document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),g}}else document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}async function A(t,e,s,a){const{ZipReader:r}=await i.e(5215).then(i.bind(i,28132));let o;try{t.supressRender=!0;let i=await e.arrayBuffer();o=new r(new Uint8Array(i));let h=o.readString("manifest.json"),d=JSON.parse(h);const u=new M.Z(n.M8(),d.name,d.width,d.height,d.background,d.animation,s,a);t.addTab(u,"template"),document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{let e=o.readFile("thumbnail.webp"),i=await n.Td(new Blob([e.buffer]));t.renderPreview(i)}catch(c){console.log(c)}let m=await D(d,new l.Z,o);t.fresco.layers.push(...m),await t.syncDocument(t.fresco)}catch(h){return console.log(h),void alert("Error while loading PXZ file :(")}finally{null==o||o.free(),t.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}t.selectLayer(t.fresco.layers[0]),t.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}async function D(t,e=new l.Z,i,s){var c;let d=new Array;if(t.stack)for(let l=0;l<t.stack.length;l++){let u=t.stack[l];switch(u.type){case g.Z.TYPE_IMAGE:case g.Z.TYPE_ELEMENT:{let t,r=u.rect?new o.Z(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r):void 0;if(void 0!==u.content)if(i){let e=i.readFile(u.content);e&&(t=await n.Td(new Blob([e.buffer])))}else{let e=await(0,a.c6)(s+u.content);e&&(t=await n.Td(e))}let c=new w.Z(n.M8(),u.name,t,r,u.locked);if(void 0!==u.opacity&&(c.settings.opacity=u.opacity),void 0!==u.blendmode&&(c.settings.blendmode=u.blendmode),void 0!==u.locked&&(c.settings.locked=u.locked),void 0!==u.visible&&(c.settings.visible=u.visible),void 0!==u.animation&&(c.animation=u.animation),void 0!==u.macro&&(c.macro=u.macro),void 0!==u.mask&&i){let t=i.readFile(u.mask);t&&(c.mask=await n.Td(new Blob([t.buffer]))),c.render()}d.push(c);break}case g.Z.TYPE_TEXT:{if(!u.format)continue;let t=new k.Z(null===(c=u.format.font)||void 0===c?void 0:c.name,u.format.size);void 0!==u.format.align&&(t.align=u.format.align),void 0!==u.format.bold&&(t.bold=u.format.bold),void 0!==u.format.italic&&(t.italic=u.format.italic),void 0!==u.format.underline&&(t.underline=u.format.underline),void 0!==u.format.uppercase&&(t.uppercase=u.format.uppercase),void 0!==u.format.linespace&&(t.lineSpace=u.format.linespace),void 0!==u.format.letterspace&&(t.letterSpace=u.format.letterspace);let l=new v.Z(n.M8(),u.content,new o.Z(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r),t);if(void 0!==u.opacity&&(l.settings.opacity=u.opacity),void 0!==u.blendmode&&(l.settings.blendmode=u.blendmode),void 0!==u.locked&&(l.settings.locked=u.locked),void 0!==u.visible&&(l.settings.visible=u.visible),void 0!==u.animation&&(l.animation=u.animation),void 0!==u.macro&&(l.macro=u.macro),t.font){let e=E.Z.getFontDesc(t.font);if(!e&&u.format.font.content){let t;t=i?new Blob([i.readFile(u.format.font.content)]):await(0,a.c6)(s+u.format.font.content),t&&(e=await E.Z.loadFontFromTemplate(t,u.format.font.name,u.format.font.content))}else e&&await E.Z.addToDOM(e);t.measureText()}if(u.style&&(u.style.curve&&(l.textSettings.curve=!0,void 0!==u.style.curve.type&&(l.textSettings.curveType=u.style.curve.type),void 0!==u.style.curve.amount&&(l.textSettings.curveAmount=u.style.curve.amount),void 0!==u.style.curve.spread&&(l.textSettings.curveSpread=u.style.curve.spread),void 0!==u.style.curve.flip&&(l.textSettings.curveFlip=u.style.curve.flip)),u.style.warp&&(l.textSettings.warp=!0,void 0!==u.style.warp.type&&(l.textSettings.warpType=u.style.warp.type),void 0!==u.style.warp.mode&&(l.textSettings.warpMode=u.style.warp.mode),void 0!==u.style.warp.edgesize&&(l.textSettings.warpEdgeSize=u.style.warp.edgesize),void 0!==u.style.warp.centersize&&(l.textSettings.warpCenterSize=u.style.warp.centersize),void 0!==u.style.warp.verticaloffset&&(l.textSettings.warpVerticalOffset=u.style.warp.verticaloffset),void 0!==u.style.warp.horizontaloffset&&(l.textSettings.warpHorizontalOffset=u.style.warp.horizontaloffset)),u.style.background&&(l.textSettings.background=!0,void 0!==u.style.background.color&&(l.textSettings.backgroundColor=u.style.background.color),void 0!==u.style.background.type&&(l.textSettings.backgroundType=u.style.background.type),void 0!==u.style.background.punch&&(l.textSettings.backgroundPunch=u.style.background.punch),void 0!==u.style.background.offset&&(l.textSettings.backgroundOffset=u.style.background.offset)),u.style.outline&&(l.textSettings.outline=!0,void 0!==u.style.outline.size&&(l.textSettings.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(l.textSettings.outlineColor=u.style.outline.color),void 0!==u.style.outline.punch&&(l.textSettings.outlinePunch=u.style.outline.punch),void 0!==u.style.outline.distance&&(l.textSettings.outlineDistance=u.style.outline.distance),void 0!==u.style.outline.direction&&(l.textSettings.outlineDirection=u.style.outline.direction)),u.style.shadow&&(l.textSettings.shadow=!0,void 0!==u.style.shadow.blur&&(l.textSettings.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(l.textSettings.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(l.textSettings.shadowAlpha=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(l.textSettings.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(l.textSettings.shadowDirection=u.style.shadow.direction))),void 0!==u.format.fill){let t;switch(u.format.fill.type){case"color":t=new r.Z(h.Z.fromHEX(u.format.fill.value));break;case"gradient":t=new r.Z(b.ZP.fromIGradient(u.format.fill.value));break;case"pattern":let e=u.format.fill.value;if(i)e.svg=i.readString(e.svg);else{let t=await(0,a.c6)(s+e.svg);t&&(e.svg=await t.text())}t=new r.Z(await P.Z.fromIPattern(e))}l.textSettings.fillType=t.getType(),l.textSettings.fillValue=t.getStringValue(),l.fill=t}await l.prepare(),l.settings.name=u.name,d.push(l);break}case g.Z.TYPE_SHAPE:{let t=new S.Z;if(t.variant=u.format?u.format.variant:"svg","svg"===t.variant){let e;if(u.content)if(i)e=i.readString(u.content);else{let t=await(0,a.c6)(s+u.content);t&&(e=await t.text())}if(!e)continue;t.content=e}"path"===t.variant&&(t.content=u.content),u.style&&(u.style.outline&&(void 0!==u.style.outline.size&&(t.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(t.outlineColor=u.style.outline.color)),u.style.shadow&&(t.shadow=!0,void 0!==u.style.shadow.blur&&(t.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(t.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(t.shadowOpacity=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(t.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(t.shadowDirection=u.style.shadow.direction)));let c=new f.Z(n.M8(),u.name,new o.Z(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r),t);if(void 0!==u.opacity&&(c.settings.opacity=u.opacity),void 0!==u.blendmode&&(c.settings.blendmode=u.blendmode),void 0!==u.locked&&(c.settings.locked=u.locked),void 0!==u.visible&&(c.settings.visible=u.visible),void 0!==u.animation&&(c.animation=u.animation),void 0!==u.macro&&(c.macro=u.macro),void 0!==u.format){if(void 0!==u.format.fill){let t;switch(u.format.fill.type){case"color":t=new r.Z(h.Z.fromHEX(u.format.fill.value));break;case"gradient":t=new r.Z(b.ZP.fromIGradient(u.format.fill.value));break;case"pattern":let e=u.format.fill.value;if(i)e.svg=i.readString(e.svg);else{let t=await(0,a.c6)(s+e.svg);t&&(e.svg=await t.text())}t=new r.Z(await P.Z.fromIPattern(e))}c.shapeSettings.fillType=t.getType(),c.shapeSettings.fillValue=t.getStringValue(),c.fill=t}u.format.radii&&(c.shapeSettings.radii=u.format.radii)}await c.prepare(),d.push(c);break}case g.Z.TYPE_FRAME:{let t=new y.Z(n.M8(),u.name,new o.Z(u.rect.x+e.x,u.rect.y+e.y,u.rect.w,u.rect.h,u.rect.r));if(void 0!==u.opacity&&(t.settings.opacity=u.opacity),void 0!==u.blendmode&&(t.settings.blendmode=u.blendmode),void 0!==u.locked&&(t.settings.locked=u.locked),void 0!==u.visible&&(t.settings.visible=u.visible),void 0!==u.animation&&(t.animation=u.animation),void 0!==u.macro&&(t.macro=u.macro),u.frame&&(void 0!==u.frame.trim&&(t.trim=new o.Z(u.frame.trim.x,u.frame.trim.y,u.frame.trim.w,u.frame.trim.h)),void 0!==u.frame.clip&&(t.frameSettings.clip=u.frame.clip)),u.content)if(i){let e=i.readFile(u.content);e&&(t.canvas=await n.Td(new Blob([e.buffer])))}else{let e=await(0,a.c6)(s+u.content);e&&(t.canvas=await n.Td(e))}u.style&&(u.style.outline&&(t.frameSettings.outline=!0,void 0!==u.style.outline.size&&(t.frameSettings.outlineSize=u.style.outline.size),void 0!==u.style.outline.color&&(t.frameSettings.outlineColor=u.style.outline.color)),u.style.shadow&&(t.frameSettings.shadow=!0,void 0!==u.style.shadow.blur&&(t.frameSettings.shadowBlur=u.style.shadow.blur),void 0!==u.style.shadow.color&&(t.frameSettings.shadowColor=u.style.shadow.color),void 0!==u.style.shadow.opacity&&(t.frameSettings.shadowOpacity=u.style.shadow.opacity),void 0!==u.style.shadow.distance&&(t.frameSettings.shadowDistance=u.style.shadow.distance),void 0!==u.style.shadow.direction&&(t.frameSettings.shadowDirection=u.style.shadow.direction))),t.prepare(),d.push(t);break}case g.Z.TYPE_GROUP:{let t=new x.Z(n.M8(),u.name,new Z.Z);void 0!==u.meta&&(void 0!==u.meta.color&&(t.groupSettings.color=u.meta.color),void 0!==u.meta.collapsed&&(t.groupSettings.collapsed=u.meta.collapsed),void 0!==u.meta.members&&(t.groupSettings.numberOfMembers=u.meta.members)),void 0!==u.opacity&&(t.settings.opacity=u.opacity),void 0!==u.locked&&(t.settings.locked=u.locked),void 0!==u.visible&&(t.settings.visible=u.visible),void 0!==u.animation&&(t.animation=u.animation),void 0!==u.macro&&(t.macro=u.macro);break}}}return d}async function I(t,e,i){document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));const s=await T(e),a=s.tree(),r=new M.Z(n.M8(),e.name,s.header.cols,s.header.rows,void 0,void 0,void 0,i);try{t.supressRender=!0,t.addTab(r,"document");let e=a.descendants();for(let i=e.length-1;i>=0;i--){const s=e[i];if(!s.isGroup())try{const a=new o.Z(s.layer.left,s.layer.top,s.layer.width,s.layer.height),r=s.get("typeTool");let c;if(r){const t=r.export();let e=t.font.sizes?t.font.sizes[0]:12;const i=t.font.name.trim(),s=new k.Z(i.substr(0,i.length-1),e);c=new v.Z(n.M8(),t.value.trim(),a.clone(),s),c.textSettings.fillType="color",c.textSettings.fillValue=new h.Z(t.font.colors[0][0],t.font.colors[0][1],t.font.colors[0][2],t.font.colors[0][3]).toHEX(),c.prepare()}else{const t=await new Promise(((t,e)=>{const i=s.toPng();i.onload=()=>t(i),i.onerror=t=>e(t)}));let r=n.qT(t,4096);c=new w.Z(n.M8(),s.layer.name,r,a,i==e.length-1)}const l={norm:"source-over",dark:"darken",lite:"lighten",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity",mul:"multiply",scrn:"screen",diss:"source-over",over:"overlay",hLit:"hard-light",sLit:"soft-light",diff:"difference",smud:"exclusion",div:"color-doge",idiv:"color-burn",lbrn:"source-over",lddg:"source-over",vLit:"source-over",lLit:"source-over",pLit:"source-over",hMix:"source-over",pass:"source-over",dkCl:"source-over",lgCl:"source-over",fsub:"source-over",fdiv:"source-over"};c.settings.blendmode=l[s.layer.blendMode.blendKey]||"source-over",c.settings.visible=s.layer.visible,c.settings.opacity=s.layer.opacity/255,t.fresco.layers.push(c)}catch(c){console.log("pxd layer read",c)}}t.selectLayer(t.fresco.layers[0]),await t.syncDocument(t.fresco)}catch(c){throw t.close(r.id),c}finally{t.supressRender=!1,document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}t.setZoom("fit"),document.dispatchEvent(new CustomEvent("layer-list-render"))}},47630:(t,e,i)=>{i.d(e,{vV:()=>n});var s=i(93947);i(33655),i(77359),i(71030),i(98776),i(44170),i(9067),i(93409),i(77664),i(47163);function n(t,e,i){let n=(0,s.T)("a",{id:"download-link"});window.document.body.append(n),n.download=e+"."+i,n.href=URL.createObjectURL(t),void 0===n.download?window.location=n.href:n.click(),n.remove()}},13049:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e,i){this.framebuffer=t,this.renderbuffer=e,this.texture=i}destroy(t){t.deleteFramebuffer(this.framebuffer),t.deleteRenderbuffer(this.renderbuffer),t.deleteTexture(this.texture)}}},32673:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(82381);class n{constructor(t,e,i){this.uniform={},this.attribute={},this.texture=new Map,this.program=t.createProgram(),t.attachShader(this.program,this.compile(t,e,t.VERTEX_SHADER)),t.attachShader(this.program,this.compile(t,i,t.FRAGMENT_SHADER)),t.linkProgram(this.program),t.useProgram(this.program),t.getProgramParameter(this.program,t.LINK_STATUS)||console.log(t.getProgramInfoLog(this.program));const n=this.collect(e,"attribute");for(const[s,h]of n)this.attribute[s]=t.getAttribLocation(this.program,s);let a=[];const r=this.collect(e,"uniform");for(const[s,h]of r)this.uniform[s]=t.getUniformLocation(this.program,s);const o=this.collect(i,"uniform");for(const[s,h]of o)this.uniform[s]=t.getUniformLocation(this.program,s),"sampler2D"===h&&a.push(s);for(var c in a){let e=a[c],i=t.getUniformLocation(this.program,e);"texture"===e?(t.uniform1i(i,0),this.texture.set(0,new s.Z(e))):(t.uniform1i(i,1),this.texture.set(1,new s.Z(e)))}}collect(t,e){const i=[],s=new RegExp("\\b"+e+" (\\w+) (\\w+)","ig");return t.replace(s,(function(t,e,s){return i.push([s,e]),t})),i}compile(t,e,i){var s=t.createShader(i);return t.shaderSource(s,e),t.compileShader(s),t.getShaderParameter(s,t.COMPILE_STATUS)?s:(console.log(t.getShaderInfoLog(s)),console.log(e),null)}getTextureById(t){let e=null;return this.texture.forEach((function(i){i.id!==t||(e=i)})),e||(console.error("Having no texture that is named `%s`.",t),null)}destroy(t){t.deleteProgram(this.program),this.texture.forEach((function(e){e.destroy(t)})),this.texture.clear()}}},4256:(t,e,i)=>{i.d(e,{Z:()=>p});var s=i(43673),n=i(98776),a=i(82381),r=i(32673),o=i(71030),c=i(94084),h=i(13049),l=i(9389),d=i(92672),u=i(71662),m=i(60134);class p{constructor(t){this.drawShader=0,this.sourceTexture=null,this.lastInChain=!1,this.currentFramebufferIndex=0,this.tempFramebuffers={},this.width=-1,this.height=-1,this.vertexBuffer=null,this.lastTextureSlot=-1,this.debug=!1,this.addPreset=(t,e=1)=>{const i=d.Z.named(t);i&&(1!==e?i.forEach((t=>{switch(t.name){case"curves":{const i=t.value,s=m.z.createCurveSet(i);s.percent=e,this.addShader(t.name,s);break}case"levels":{const i=t.value,s=new u.Z(Math.round(i.minin*e),Math.round(255-(255-i.maxin)*e));this.addShader(t.name,s);break}case"toning":{const i=t.value,s=new l.Z(i.highlight,i.midtone,i.shadow,i.amount*e);this.addShader(t.name,s);break}case"fill":{const i=t.value,s=new c.Z(i.color,i.blend,i.amount*e);this.addShader(t.name,s);break}default:this.addShader(t.name,t.value*e)}})):i.forEach((t=>this.addShader(t.name,t.value))))},this.cleanUp=()=>{this.sourceTexture=null,this.canvas=null,this.ctx=null},this.VERTEX_IDENTITY="\n        precision highp float;\n        attribute vec2 apos;\n        attribute vec2 auv;\n        varying vec2 uv;\n        uniform vec4 transform;\n\n        void main(void) {\n            uv = auv;\n            gl_Position = vec4(apos.x * transform.x + transform.z, apos.y * transform.y + transform.w, 0.0, 1.0);\n        }",this.FRAGMENT_IDENTITY="\n        precision highp float;\n        varying vec2 uv;\n        uniform sampler2D texture;\n\n        void main(void) {\n            gl_FragColor = texture2D(texture, uv);\n        }",this.GAUSSKERN_MAX=15,this.chain=t||[],this.compiledProgram=new Map,this.canvas=document.createElement("canvas"),this.canvas.id="shaders-temp",this.initContext(),this.canvas.addEventListener("webglcontextlost",this.handleContextLost.bind(this),!1)}initContext(){this.ctx=this.canvas.getContext("webgl",{alpha:!0,premultipliedAlpha:!1,depth:!1,stencil:!1,antialias:!1}),this.ctx||(console.log("Could not get shaders webgl canvas context!"),(0,o.Z)("weg-gl-error"))}handleContextLost(){null==this.canvas&&(this.canvas=document.createElement("canvas")),this.initContext()}getError(){this.debug&&this.ctx.getError()}addShader(t,e,i=!1){if("fill"==t&&0==e.amount||"toning"==t&&0==e.amount||"levels"==t&&e.isFlat()||null==e||0===e)this.removeShader(t,i);else{for(var s=0;s<this.chain.length;s++)if(this.chain[s].type===t&&this.chain[s].sidekick===i)return void(this.chain[s].value=e);this.chain.push(new g(t,e,i))}}getShaderValue(t){for(var e=0;e<this.chain.length;e++)if(this.chain[e].type==t)return this.chain[e].value}removeShaderSidekick(){let t=new Array;for(var e=0;e<this.chain.length;e++)this.chain[e].sidekick||t.push(this.chain[e]);this.chain=t}removeShader(t,e=!1){for(var i=0;i<this.chain.length;i++)if(this.chain[i].type===t&&this.chain[i].sidekick===e)return void this.chain.splice(i,1)}runShader(t,e){switch(t){case"vibrance":return this.vibrance(e);case"brightness":return this.brightness(e);case"temperature":return this.temperature(e);case"balance":return this.balance(e);case"tint":return this.tint(e);case"colorize":return this.colorize(e);case"grain":return this.grain(e);case"noise":return this.noise(e);case"vignette":return this.vignette(e);case"sharpen":return this.sharpen(e);case"blur":return this.blur(e);case"zoom":return this.zoom(e);case"bokeh":return this.bokeh(e);case"gaussian":return this.gaussian(e);case"motion":return this.motion(e);case"radial":return this.radial(e);case"smooth":return this.smooth(e);case"denoise":return this.denoise(e);case"contrast":return this.contrast(e);case"monochrome":return this.monochrome(e);case"desaturate":return this.desaturate();case"invert":return this.invert();case"exposure":return this.exposure(e);case"highlights":return this.highlights(e);case"shadows":return this.shadows(e);case"dehaze":return this.dehaze(e);case"curves":return this.curves(e);case"toning":return this.toning(e);case"lookup":return this.lookup(e);case"fill":return this.fill(e);case"bwpoint":return this.bwpoint(e);case"levels":return this.levels(e);case"multilevels":return this.multilevels(e);case"threshold":return this.threshold(e);case"bloom":return this.bloom(e);case"glamour":return this.glamour(e);case"mimichdr":return this.mimicHDR(e);case"posterize":return this.posterize(e);case"fringe":return this.fringe(e);case"pixelate":return this.pixelate(e);case"clarity":return this.clarity(e);case"mosaic":return this.mosaic(e);case"polarcoordinates":return this.polarcoordinates(e);case"kaleidoscope":return this.kaleidoscope(e);case"reflect":return this.reflect(e);case"wave":return this.wave(e);case"fisheye":return this.fisheye(e);case"scanlines":return this.scanlines(e);case"dealiasing":return this.dealiasing();case"alpha-reset":return this.alphaReset();case"alpha-invert":return this.alphaInvert();case"alpha-mask":return this.alphaMask();case"alpha-shift-mask":return this.alphaShiftMask();case"outer-glow":return this.outerGlow(e);case"inner-glow":return this.innerGlow(e);case"sobel":return this.sobel();case"solarize":return this.solarize();case"halftone":return this.halftone(e);case"stroke":return this.stroke(e);case"bevel":return this.bevel(e);case"border":return this.border(e);case"rgb-split":return this.rgbSplit(e);case"slice":return this.slice(e);case"bleed":return this.bleed(e);case"interference":return this.interference(e);case"hue":return this.hue(e);case"hue-red":return this.hue(e,317,46);case"hue-yellow":return this.hue(e,17,106);case"hue-green":return this.hue(e,77,166);case"hue-cyan":return this.hue(e,137,226);case"hue-blue":return this.hue(e,197,286);case"hue-magenta":return this.hue(e,257,346);case"saturation":return this.saturation(e);case"saturation-red":return this.saturation(e,317,46);case"saturation-yellow":return this.saturation(e,17,106);case"saturation-green":return this.saturation(e,77,166);case"saturation-cyan":return this.saturation(e,137,226);case"saturation-blue":return this.saturation(e,197,286);case"saturation-magenta":return this.saturation(e,257,346);case"lightness":return this.lightness(e);case"lightness-red":return this.lightness(e,317,46);case"lightness-yellow":return this.lightness(e,17,106);case"lightness-green":return this.lightness(e,77,166);case"lightness-cyan":return this.lightness(e,137,226);case"lightness-blue":return this.lightness(e,197,286);case"lightness-magenta":return this.lightness(e,257,346);case"melt":return this.melt(e);case"gooey":return this.gooey(e);case"block":return this.block(e);case"curtain":return this.curtain(e);case"blinds":return this.blinds(e);case"wipe":return this.wipe(e);case"slot":return this.slot(e);case"split":return this.split(e);case"circular":return this.circular(e);case"ripple":return this.ripple(e);case"warp":return this.warp(e);case"swipe":return this.swipe(e);case"marquee":return this.marquee(e);default:return console.error("We don't have this type shader, "+t)}}reset(){this.chain=[],this.compiledProgram.forEach((function(t){t.destroy(this.ctx)}),this),this.compiledProgram.clear(),this.sourceTexture&&(this.activeSourceTexture=void 0,this.sourceTexture.destroy(this.ctx),this.sourceTexture=null);for(let t in this.tempFramebuffers){this.tempFramebuffers[t].destroy(this.ctx)}this.tempFramebuffers={}}apply(t,e=!1){if(0==this.chain.length)return t;this.resize(t.width,t.height),this.drawShader=0,this.sourceTexture&&this.width==t.width&&this.height==t.height||(this.sourceTexture&&(this.sourceTexture.destroy(this.ctx),this.sourceTexture=null),this.sourceTexture=new a.Z("texture"),this.sourceTexture.createTexture(this.ctx,t.width,t.height)),(t!==this.activeSourceTexture||e)&&(this.sourceTexture.uploadData(this.ctx,t),this.activeSourceTexture=t);for(var i=0;i<this.chain.length;i++)this.lastInChain=i==this.chain.length-1,this.runShader(this.chain[i].type,this.chain[i].value);return this.currentFramebufferIndex=0,this.canvas}resize(t,e){if(t!=this.width||e!=this.height){if(this.canvas.width=this.width=t,this.canvas.height=this.height=e,!this.vertexBuffer){var i=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,-1,1,0,1,1,-1,1,0,1,1,1,1]);this.vertexBuffer=this.ctx.createBuffer(),this.ctx.bindBuffer(this.ctx.ARRAY_BUFFER,this.vertexBuffer),this.ctx.bufferData(this.ctx.ARRAY_BUFFER,i,this.ctx.STATIC_DRAW)}this.ctx.viewport(0,0,this.width,this.height);for(let t in this.tempFramebuffers){this.tempFramebuffers[t].destroy(this.ctx)}this.tempFramebuffers={}}}getTempFramebuffer(t){return this.tempFramebuffers[t]=this.tempFramebuffers[t]||this.createFramebufferTexture(this.width,this.height),this.tempFramebuffers[t]}createFramebufferTexture(t,e){let i=this.ctx.createFramebuffer();this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,i);let s=this.ctx.createRenderbuffer();this.ctx.bindRenderbuffer(this.ctx.RENDERBUFFER,s),this.ctx.renderbufferStorage(this.ctx.RENDERBUFFER,this.ctx.DEPTH_COMPONENT16,t,e);let n=this.ctx.createTexture();return this.ctx.bindTexture(this.ctx.TEXTURE_2D,n),this.ctx.texImage2D(this.ctx.TEXTURE_2D,0,this.ctx.RGBA,t,e,0,this.ctx.RGBA,this.ctx.UNSIGNED_BYTE,null),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MAG_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_MIN_FILTER,this.ctx.NEAREST),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_S,this.ctx.CLAMP_TO_EDGE),this.ctx.texParameteri(this.ctx.TEXTURE_2D,this.ctx.TEXTURE_WRAP_T,this.ctx.CLAMP_TO_EDGE),this.ctx.framebufferTexture2D(this.ctx.FRAMEBUFFER,this.ctx.COLOR_ATTACHMENT0,this.ctx.TEXTURE_2D,n,0),this.ctx.framebufferRenderbuffer(this.ctx.FRAMEBUFFER,this.ctx.DEPTH_ATTACHMENT,this.ctx.RENDERBUFFER,s),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null),this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null),new h.Z(i,s,n)}draw(t,e=!1){if((this.chain.length<=1||this.lastInChain)&&!e)this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,null);else{let t=this.getTempFramebuffer(this.currentFramebufferIndex);this.ctx.bindFramebuffer(this.ctx.FRAMEBUFFER,t.framebuffer)}this.ctx.uniform4f(t.uniform.transform,1,1,0,0),this.ctx.clear(this.ctx.COLOR_BUFFER_BIT),this.ctx.clearColor(0,0,0,0),this.setTexture(t.texture),this.ctx.drawArrays(this.ctx.TRIANGLES,0,6),this.drawShader++,this.currentFramebufferIndex^=1,this.getError()}setTexture(t){let e=-1;t.forEach((function(t,i){if(this.ctx.activeTexture(this.ctx.TEXTURE0+i),0===i&&0===this.drawShader)this.ctx.bindTexture(this.ctx.TEXTURE_2D,this.sourceTexture.texture);else if(0===i){let t=1^this.currentFramebufferIndex,e=this.getTempFramebuffer(t);this.ctx.bindTexture(this.ctx.TEXTURE_2D,e.texture)}else this.ctx.bindTexture(this.ctx.TEXTURE_2D,t.texture);e=Math.max(e,i)}),this);for(let i=e+1;i<=this.lastTextureSlot;++i)this.ctx.activeTexture(this.ctx.TEXTURE0+i),this.ctx.bindTexture(this.ctx.TEXTURE_2D,null);this.lastTextureSlot=e}compileShader(t,e=this.VERTEX_IDENTITY){let i=new r.Z(this.ctx,e,t);var s=Float32Array.BYTES_PER_ELEMENT;return this.ctx.enableVertexAttribArray(i.attribute.apos),this.ctx.vertexAttribPointer(i.attribute.apos,2,this.ctx.FLOAT,!1,4*s,0*s),this.ctx.enableVertexAttribArray(i.attribute.auv),this.ctx.vertexAttribPointer(i.attribute.auv,2,this.ctx.FLOAT,!1,4*s,2*s),i}bevel(t){let e=this.compiledProgram.get("bevel");if(!e){let t="\n                precision highp float;\n\n                varying vec2 uv;\n                \n                uniform float zeroPoint;\n                uniform vec3 lightNormal;\n                uniform float dz;\n                uniform float size;\n\n                uniform vec4 lowColor;\n                uniform vec4 highColor;\n                \n                uniform sampler2D dist;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main() {                    \n                    vec2 flipuv = vec2(uv.x, 1.0 - uv.y);\n                                         \n                    /* PER PIXEL OPS */\n                    float tl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x, -px.y)).a);\n                    float tm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0, -px.y)).a);\n                    float tr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x, -px.y)).a);\n                \n                    float ml = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,     0)).a);\n                    float mr = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,     0)).a);\n                \n                    float bl = clamp(0.0, size, texture2D(dist, flipuv + vec2(-px.x,  px.y)).a);\n                    float bm = clamp(0.0, size, texture2D(dist, flipuv + vec2(    0,  px.y)).a);\n                    float br = clamp(0.0, size, texture2D(dist, flipuv + vec2( px.x,  px.y)).a);\n                \n                    float dx = (tr + 2.0 * mr + br) - (tl + 2.0 * ml + bl);\n                    float dy = (bl + 2.0 * bm + br) - (tl + 2.0 * tm + tr);\n                \n                    vec3 surfaceNormal = vec3(dx, dy, dz);\n                    float norm = sqrt(dx*dx + dy*dy + dz*dz);\n                \n                    // Calculate incident light amount, range [-1, 0]\n                    float incidentLight = ((dot(surfaceNormal, lightNormal) / norm) - zeroPoint) - (1.0 - zeroPoint);\n                    \n                    vec4 slopes = mix(lowColor, highColor, 1.0 - abs(incidentLight));\n                    \n                    // Texture\n                    vec4 color = texture2D(texture, uv);\n\n                    // Bevel color, only use the the color where we need it\n                    float alpha = smoothstep(1e-5, dz + 8.0, distance(vec3(0.0,0.0,dz), surfaceNormal));\n                    vec4 bevelColor = vec4(slopes.rgb, slopes.a * alpha);\n\n                    gl_FragColor = straightBlend(\n                        bevelColor,\n                        color\n                    );\n                }";e=this.compileShader(t),this.compiledProgram.set("bevel",e)}this.ctx.useProgram(e.program);e.getTextureById("dist").setTexture(t.distanceMap);const i=Math.sin(t.lightElevation);this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.zeroPoint,i),this.ctx.uniform3f(e.uniform.lightNormal,Math.cos(t.lightElevation)*-Math.cos(t.lightAngle),Math.cos(t.lightElevation)*-Math.sin(t.lightAngle),i),this.ctx.uniform4f(e.uniform.lowColor,t.lowLightColor.r/255,t.lowLightColor.g/255,t.lowLightColor.b/255,t.lowOpacity),this.ctx.uniform4f(e.uniform.highColor,t.highLightColor.r/255,t.highLightColor.g/255,t.highLightColor.b/255,t.highOpacity),this.ctx.uniform1f(e.uniform.dz,1/t.depth),this.ctx.uniform1f(e.uniform.size,t.size),this.draw(e)}stroke(t){const e="stroke"+(t.cutout?"-cutout":"");let i=this.compiledProgram.get(e);if(!i){let s=`\n                precision highp float;\n\n                #define CUTOUT ${t.cutout?1:0}\n\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size - 3.0, size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    #if CUTOUT == 1\n                        vec4 tran = vec4(0);\n                        gl_FragColor = mix(gColor, tran, texColor.a);\n                    #else\n                        gl_FragColor = straightBlend(texColor, gColor);                    \n                    #endif\n                }\n            `;i=this.compileShader(s),this.compiledProgram.set(e,i)}this.ctx.useProgram(i.program),this.ctx.uniform4f(i.uniform.glowColor,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity);i.getTextureById("distanceMap").setTexture(t.distanceMap),this.ctx.uniform1f(i.uniform.size,t.size),this.draw(i)}innerGlow(t){let e=this.compiledProgram.get("innerglow");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float balance = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 texColor = texture2D(texture, uv);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        texColor.a\n                    );\n                       \n                    gl_FragColor = mix(texColor, gColor, balance * glowColor.a);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("innerglow",e)}this.ctx.useProgram(e.program),this.ctx.uniform4f(e.uniform.glowColor,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity);e.getTextureById("distanceMap").setTexture(t.distanceMap),this.ctx.uniform1f(e.uniform.size,t.size),this.ctx.uniform1f(e.uniform.feather,t.feather),this.draw(e)}outerGlow(t){let e=this.compiledProgram.get("outerglow");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform sampler2D distanceMap;\n                            \n                uniform vec4 glowColor;\n                uniform float size;\n                uniform float feather;\n\n                vec4 straightBlend(vec4 src, vec4 dst) {\n                    float alpha = src.a + dst.a * (1.0 - src.a);\n\n                    return vec4(\n                        ((src.rgb * src.a) + (dst.rgb * dst.a) * (1.0 - src.a)) / alpha,\n                        alpha\n                    );\n                }\n                \n                void main(void) {           \n                    vec2 flipped = vec2(uv.x, 1.0 - uv.y);\n\n                    float distance = texture2D(distanceMap, flipped).a;\n                    float gAlpha = 1.0-smoothstep(size * (1.0-feather), size, distance);\n\n                    vec4 gColor = vec4(\n                        glowColor.rgb, \n                        gAlpha * glowColor.a\n                    );\n\n                    vec4 texColor = texture2D(texture, uv);\n                    \n                    gl_FragColor = straightBlend(texColor, gColor);                    \n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("outerglow",e)}this.ctx.useProgram(e.program),this.ctx.uniform4f(e.uniform.glowColor,t.color.r/255,t.color.g/255,t.color.b/255,t.opacity);e.getTextureById("distanceMap").setTexture(t.distanceMap),this.ctx.uniform1f(e.uniform.size,t.size),this.ctx.uniform1f(e.uniform.feather,t.feather),this.draw(e)}sobel(){let t=this.compiledProgram.get("sobel");if(!t){let e="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                uniform float m[3];\n                #define M_PI 3.1415926535897932384626433832795\n                #define GET_PIXEL(x,y) (texture2D(texture, uv + px*vec2(x,y)))\n\n                void main() {\n\n                    float dx = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(-1,  0)*m[1] +\n                                GET_PIXEL(-1, +1)*m[2]) -\n                            length(GET_PIXEL(+1, -1)*m[0] +\n                                GET_PIXEL(+1,  0)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float dy = (length(GET_PIXEL(-1, -1)*m[0] +\n                                GET_PIXEL(0, -1)*m[1] +\n                                GET_PIXEL(+1, -1)*m[2]) -\n                            length(GET_PIXEL(-1, +1)*m[0] +\n                                GET_PIXEL(0, +1)*m[1] +\n                                GET_PIXEL(+1, +1)*m[2]));\n\n                    float theta = (atan(dy, dx) + M_PI) / (2.0*M_PI);\n\n                    gl_FragColor = vec4(length(vec2(dx, dy)), theta, 0.0, 1.0);\n                }";t=this.compileShader(e),this.compiledProgram.set("sobel",t)}if(this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.ctx.uniform1fv(t.uniform.m,[1,2,1]),this.draw(t,!0),t=this.compiledProgram.get("sobelNMS"),!t){let e="\n                precision mediump float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n\n                #define M_PI 3.1415926535897932384626433832795\n\n                void main() {\n                    vec4 cc = texture2D(texture, uv);  \n                    float theta = degrees(cc.y*M_PI*2.0); \n                    int ax = 0, ay = 0; \n                    if ((theta >= 337.5) || (theta < 22.5)) { ax = 1; ay = 0; } \n                    else if ((theta >= 22.5) && (theta < 67.5)) { ax = 1; ay = 1; } \n                    else if ((theta >= 67.5) && (theta < 112.5)) { ax = 0; ay = 1; } \n                    else if ((theta >= 112.5) && (theta < 157.5)) { ax =-1; ay = 1; } \n                    else if ((theta >= 157.5) && (theta < 202.5)) { ax =-1; ay = 0; } \n                    else if ((theta >=202.5) && (theta < 247.5)) { ax =-1; ay =-1; } \n                    else if ((theta >=247.5) && (theta < 292.5)) { ax = 0; ay =-1; } \n                    else if ((theta >= 292.5) && (theta < 337.5)) { ax = 1; ay =-1; }\n                \n                    vec4 ca = texture2D(texture, uv + px*vec2(ax, ay));\n                    vec4 cb = texture2D(texture, uv + px*vec2(-ax, -ay));\n                    gl_FragColor = vec4((((cc.x <= ca.x) || (cc.x < cb.x)) ? vec3(0) : vec3(cc.x)), 1.0);\n                }";t=this.compileShader(e),this.compiledProgram.set("sobelNMS",t)}this.ctx.useProgram(t.program),this.ctx.uniform2f(t.uniform.px,1/this.width,1/this.height),this.draw(t)}vibrance(t){let e=this.compiledProgram.get("vibrance");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv.xy);\n                    vec3 color = col.rgb;\n                \n                    float luminance = color.r*0.299 + color.g*0.587 + color.b*0.114;\n                    float mn = min(min(color.r, color.g), color.b);\n                    float mx = max(max(color.r, color.g), color.b);\n                    float sat = (1.0-(mx - mn)) * (1.0-mx) * luminance * 5.0;\n                    vec3 lightness = vec3((mn + mx)/2.0);\n                \n                    // vibrance\n                    color = mix(color, mix(color, lightness, -amount), sat);\n                \n                    // negative vibrance\n                    gl_FragColor = vec4(mix(color, lightness, (1.0-lightness)*(1.0-amount)/2.0*abs(amount)), col.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("vibrance",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}brightness(t){let e;if(t>0){if(e=this.compiledProgram.get("brightness-up"),!e){let t="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    #define PI 3.1415926535897932384626433832795\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n\n                        color.r = color.r + amount * sin(color.r * PI);\n                        color.g = color.g + amount * sin(color.g * PI);\n                        color.b = color.b + amount * sin(color.b * PI);\n\n                        gl_FragColor = color;\n                    }";e=this.compileShader(t),this.compiledProgram.set("brightness-up",e)}}else if(e=this.compiledProgram.get("brightness-down"),!e){let t="\n                    precision highp float;\n                    varying vec2 uv;\n                    uniform sampler2D texture;\n                    uniform float amount;\n\n                    void main() {\n                        vec4 color = texture2D(texture, uv);\n     \n                        color.r = (1.0 + amount) * color.r;\n                        color.g = (1.0 + amount) * color.g;\n                        color.b = (1.0 + amount) * color.b;\n\n                        gl_FragColor = color;\n                    }";e=this.compileShader(t),this.compiledProgram.set("brightness-down",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t>0?.35*t:.75*t),this.draw(e)}bwpoint(t){let e=this.compiledProgram.get("bwpoint");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float white;\n                uniform float black;\n\n                void main() {\n\n                    float bval = black / 255.0;\n                    float wval = (255.0 / (white - black));\n                \n                    vec3 color = texture2D(texture, uv).rgb;\n                    color = color * wval - (bval *  wval);\n\n                    gl_FragColor = vec4(color, texture2D(texture, uv).a);\n                }";e=this.compileShader(t),this.compiledProgram.set("bwpoint",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.black,t.black),this.ctx.uniform1f(e.uniform.white,t.white),this.draw(e)}dealiasing(){let t=this.compiledProgram.get("dealiasing");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = (color.a < 0.25) ? 0.0 : 1.0;\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("dealiasing",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaInvert(){let t=this.compiledProgram.get("alpha-invert");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.a = 1.0 - color.a;\n                    gl_FragColor = color;\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-invert",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaMask(){let t=this.compiledProgram.get("alpha-mask");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).a);\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-mask",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaShiftMask(){let t=this.compiledProgram.get("alpha-shift-mask");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    gl_FragColor = vec4(0,0,0, texture2D(texture, uv).r);\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-shift-mask",t)}this.ctx.useProgram(t.program),this.draw(t)}alphaReset(){let t=this.compiledProgram.get("alpha-reset");if(!t){let e="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    gl_FragColor = vec4(color.rgb, 1.0);\n                }";t=this.compileShader(e),this.compiledProgram.set("alpha-reset",t)}this.ctx.useProgram(t.program),this.draw(t)}border(t){let e=this.compiledProgram.get("border");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float size;\n                uniform vec4 color;\n                uniform vec2 screen;\n                uniform vec2 px;\n\n                void main() {\n                    vec4 pixel = texture2D(texture, uv);\n\n                    if(uv.y <= size*px.y || uv.y >= (screen.y-size)*px.y ||\n                       uv.x <= size*px.x || uv.x >= (screen.x-size)*px.x) {\n                        gl_FragColor = color;\n                    } else {\n                        gl_FragColor = pixel;\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("border",e)}let i=Math.round((this.width+this.height)/2*t.size);this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,i),this.ctx.uniform2f(e.uniform.screen,this.width,this.height),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform4f(e.uniform.color,t.color.r/255,t.color.g/255,t.color.b/255,1),this.draw(e)}balance(t){let e=this.compiledProgram.get("balance");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform float sr;\n                uniform float sg;\n                uniform float sb;\n                uniform float mr;\n                uniform float mg;\n                uniform float mb;\n                uniform float hr;\n                uniform float hg;\n                uniform float hb;\n                uniform float preserve;\n\n                #define PI 3.1415926535897932384626433832795\n\n                float Lum(vec4 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    \n                    float olum = Lum(color);\n\n                    //highlight\n                    color.r = clamp(color.r + (hr * (exp(color.r) - 1.0)), 0.0, 1.0);\n                    color.g = clamp(color.g + (hg * (exp(color.g) - 1.0)), 0.0, 1.0);\n                    color.b = clamp(color.b + (hb * (exp(color.b) - 1.0)), 0.0, 1.0);\n\n                    //midtone\n                    color.r = clamp(color.r + (mr * 0.25) * sin(color.r * PI), 0.0, 1.0);\n                    color.g = clamp(color.g + (mg * 0.25) * sin(color.g * PI), 0.0, 1.0);\n                    color.b = clamp(color.b + (mb * 0.25) * sin(color.b * PI), 0.0, 1.0);\n\n                    //shadow\n                    color.r = clamp((1.0 - sr * 0.5) * color.r + (1.0 - (1.0 - sr * 0.5)), 0.0, 1.0);\n                    color.g = clamp((1.0 - sg * 0.5) * color.g + (1.0 - (1.0 - sg * 0.5)), 0.0, 1.0);\n                    color.b = clamp((1.0 - sb * 0.5) * color.b + (1.0 - (1.0 - sb * 0.5)), 0.0, 1.0);\n                    \n                    if(preserve == 1.0) {\n                        float nlum = Lum(color);\n                        color.rgb = color.rgb * (olum/nlum);\n                    }\n\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("balance",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.sr,t.shadowRed),this.ctx.uniform1f(e.uniform.sg,t.shadowGreen),this.ctx.uniform1f(e.uniform.sb,t.shadowBlue),this.ctx.uniform1f(e.uniform.mr,t.midtoneRed),this.ctx.uniform1f(e.uniform.mg,t.midtoneGreen),this.ctx.uniform1f(e.uniform.mb,t.midtoneBlue),this.ctx.uniform1f(e.uniform.hr,t.highlightRed),this.ctx.uniform1f(e.uniform.hg,t.highlightGreen),this.ctx.uniform1f(e.uniform.hb,t.highlightBlue),this.ctx.uniform1f(e.uniform.preserve,Number(t.preserve)),this.draw(e)}temperature(t){let e=this.compiledProgram.get("temperature");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.r = clamp(color.r + amount, 0.0, 1.0);\n                    color.b = clamp(color.b - amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("temperature",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t/6),this.draw(e)}tint(t){let e=this.compiledProgram.get("tint");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    color.g = clamp(color.g + amount, 0.0, 1.0);\n                    gl_FragColor = color;\n                }";e=this.compileShader(t),this.compiledProgram.set("tint",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t/6),this.draw(e)}threshold(t){let e=this.compiledProgram.get("threshold");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float value = (color.r + color.g + color.b) / 3.0 < amount ? 0.0 : 1.0;\n                    gl_FragColor = vec4(value, value, value, color.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("threshold",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}noise(t){let e=this.compiledProgram.get("noise");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float random(vec2 p) {\n                    vec2 r = vec2(23.14069263277926,2.665144142690225);\n                    return fract(cos(mod(12345678.,256. * dot(p,r))));\n                }\n\n                void main() {\n                    vec4 color = texture2D(texture, uv);\n                    float noise = (random(uv) -0.5)*amount;\n\n                    gl_FragColor = vec4(color.r+noise, color.g+noise, color.b+noise, color.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("noise",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}halftone(t){let e=this.compiledProgram.get("halftone");if(!e){this.ctx.getExtension("OES_standard_derivatives");let t="\n                #ifdef GL_OES_standard_derivatives\n                #extension GL_OES_standard_derivatives : enable\n                #endif\n\n                precision highp float;                \n\n                uniform sampler2D texture;\n                uniform vec2 size;\n                uniform float frequency;\n  \n                varying vec2 uv; // Texcoords\n\n                float aastep(float threshold, float value) {\n                #ifdef GL_OES_standard_derivatives\n                    float afwidth = 0.7 * length(vec2(dFdx(value), dFdy(value)));\n                #else\n                    float afwidth = frequency * (1.0/size.x);\n                #endif\n                    return smoothstep(threshold-afwidth, threshold+afwidth, value);\n                }\n\n                // Explicit bilinear texture lookup to circumvent bad hardware precision.\n                // The extra arguments specify the dimension of the texture. (GLSL 1.30\n                // introduced textureSize() to get that information from the sampler.)\n                // 'dims' is the width and height of the texture, 'one' is 1.0/dims.\n                // (Precomputing 'one' saves two divisions for each lookup.)\n                vec4 texture2D_bilinear(sampler2D tex, vec2 st, vec2 dims, vec2 one) {\n                    vec2 uv = st * dims;\n                    vec2 uv00 = floor(uv - vec2(0.5)); // Lower left corner of lower left texel\n                    vec2 uvlerp = uv - uv00 - vec2(0.5); // Texel-local lerp blends [0,1]\n                    vec2 st00 = (uv00 + vec2(0.5)) * one;\n                    vec4 texel00 = texture2D(tex, st00);\n                    vec4 texel10 = texture2D(tex, st00 + vec2(one.x, 0.0));\n                    vec4 texel01 = texture2D(tex, st00 + vec2(0.0, one.y));\n                    vec4 texel11 = texture2D(tex, st00 + one);\n                    vec4 texel0 = mix(texel00, texel01, uvlerp.y); \n                    vec4 texel1 = mix(texel10, texel11, uvlerp.y); \n                    return mix(texel0, texel1, uvlerp.x);\n                }\n\n                vec2 mod289(vec2 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 mod289(vec3 x) { return x - floor(x * (1.0 / 289.0)) * 289.0; }\n                vec3 permute(vec3 x) { return mod289((( x * 34.0) + 1.0) * x); }\n                \n                float snoise(vec2 v) {\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                        -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                    // First corner\n                    vec2 i = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v - i + dot(i, C.xx);\n                    // Other corners\n                    vec2 i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                    // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                                            + i.x + vec3(0.0, i1.x, 1.0 ));\n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy),\n                                            dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m; m = m*m;\n                    // Gradients\n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 a0 = x - floor(x + 0.5);\n                    // Normalise gradients implicitly by scaling m\n                    m *= 1.792843 - 0.853735 * ( a0*a0 + h*h );\n                    // Compute final noise value at P\n                    vec3 g;\n                    g.x = a0.x * x0.x + h.x * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n                \n                void main() {\n                    // Correct UVs for aspect ratio so we get round balls not squished\n                    vec2 auv = uv;\n                    auv.x *= size.x / size.y;\n\n                    vec3 color = texture2D_bilinear(texture, uv, size, 1.0 / size).rgb;\n\n                    float n = 0.1*snoise(auv*200.0); // Fractal noise\n                    n += 0.05*snoise(auv*400.0);\n                    n += 0.025*snoise(auv*800.0);\n\n                    vec3 white = vec3(n*0.2 + 0.97);\n                    vec3 black = vec3(n + 0.1);\n\n                    // Perform a rough RGB-to-CMYK conversion\n                    vec4 cmyk;\n                    cmyk.xyz = 1.0 - color;\n                    cmyk.w = min(cmyk.x, min(cmyk.y, cmyk.z)); // Create K\n                    cmyk.xyz -= cmyk.w; // Subtract K equivalent from CMY\n                \n                    // Distance to nearest point in a grid of\n                    // (frequency x frequency) points over the unit square\n                    vec2 Kst = frequency*mat2(0.707, -0.707, 0.707, 0.707)*auv;\n                    vec2 Kuv = 2.0*fract(Kst)-1.0;\n                    float k = aastep(0.0, sqrt(cmyk.w)-length(Kuv)+n);\n                    vec2 Cst = frequency*mat2(0.966, -0.259, 0.259, 0.966)*auv;\n                    vec2 Cuv = 2.0*fract(Cst)-1.0;\n                    float c = aastep(0.0, sqrt(cmyk.x)-length(Cuv)+n);\n                    vec2 Mst = frequency*mat2(0.966, 0.259, -0.259, 0.966)*auv;\n                    vec2 Muv = 2.0*fract(Mst)-1.0;\n                    float m = aastep(0.0, sqrt(cmyk.y)-length(Muv)+n);\n                    vec2 Yst = frequency*auv; // 0 deg\n                    vec2 Yuv = 2.0*fract(Yst)-1.0;\n                    float y = aastep(0.0, sqrt(cmyk.z)-length(Yuv)+n);\n                \n                    vec3 rgbscreen = 1.0 - 0.9*vec3(c,m,y) + n;\n                    rgbscreen = mix(rgbscreen, black, 0.85*k + 0.3*n);\n                \n                    #ifdef GL_OES_standard_derivatives\n                        float afwidth = 2.0 * frequency * max(length(dFdx(uv)), length(dFdy(uv)));\n                    #else\n                        float afwidth = frequency * (1.0/size.x);\n                    #endif\n                    \n                    float blend = smoothstep(0.7, 1.4, afwidth); \n                    gl_FragColor = vec4(mix(rgbscreen, color, blend), 1.0);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("halftone",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.size,this.width,this.height),this.ctx.uniform1f(e.uniform.frequency,Math.round(100*t)),this.draw(e)}vignette(t){let e=this.compiledProgram.get(t<0?"vignette-white":"vignette-black");if(!e){let i=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","float grd = smoothstep(0.8, size * 0.799, dist * (amount*0.6 + size*2.0));","color.rgb += vec3(1.0, 1.0, 1.0) * (1.0 - grd);","gl_FragColor = color;","}"].join("\n"),s=["precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","uniform float size;","void main() {","vec4 color = texture2D(texture, uv);","float dist = distance(uv, vec2(0.5, 0.5));","color.rgb *= smoothstep(0.8, size * 0.799, dist * (amount*0.75 + size*2.0));","gl_FragColor = color;","}"].join("\n");e=this.compileShader(t<0?i:s),this.compiledProgram.set(t<0?"vignette-white":"vignette-black",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,.25),this.ctx.uniform1f(e.uniform.amount,t<0?-1*t:t),this.draw(e)}grain(t){let e=this.compiledProgram.get("grain");if(!e){let t=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","uniform float width;","uniform float height;","uniform float grainamount;","uniform float timer;","const float permTexUnit = 1.0/256.0;","const float permTexUnitHalf = 0.5/256.0;","float grainsize = 1.8;","float lumamount = 1.0;","vec4 rnm(in vec2 tc)","{","float noise =  sin(dot(tc + vec2(timer,timer),vec2(12.9898,78.233))) * 43758.5453;","float noiseR =  fract(noise)*2.0-1.0;","float noiseG =  fract(noise*1.2154)*2.0-1.0; ","float noiseB =  fract(noise*1.3453)*2.0-1.0;","float noiseA =  fract(noise*1.3647)*2.0-1.0;","return vec4(noiseR,noiseG,noiseB,noiseA);","}","float fade(in float t) {","return t*t*t*(t*(t*6.0-15.0)+10.0);","}","float pnoise3D(in vec3 p)","{","vec3 pi = permTexUnit*floor(p)+permTexUnitHalf;","vec3 pf = fract(p);","float perm00 = rnm(pi.xy).a ;","vec3  grad000 = rnm(vec2(perm00, pi.z)).rgb * 4.0 - 1.0;","float n000 = dot(grad000, pf);","vec3  grad001 = rnm(vec2(perm00, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n001 = dot(grad001, pf - vec3(0.0, 0.0, 1.0));","float perm01 = rnm(pi.xy + vec2(0.0, permTexUnit)).a ;","vec3  grad010 = rnm(vec2(perm01, pi.z)).rgb * 4.0 - 1.0;","float n010 = dot(grad010, pf - vec3(0.0, 1.0, 0.0));","vec3  grad011 = rnm(vec2(perm01, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n011 = dot(grad011, pf - vec3(0.0, 1.0, 1.0));","float perm10 = rnm(pi.xy + vec2(permTexUnit, 0.0)).a ;","vec3  grad100 = rnm(vec2(perm10, pi.z)).rgb * 4.0 - 1.0;","float n100 = dot(grad100, pf - vec3(1.0, 0.0, 0.0));","vec3  grad101 = rnm(vec2(perm10, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n101 = dot(grad101, pf - vec3(1.0, 0.0, 1.0));","float perm11 = rnm(pi.xy + vec2(permTexUnit, permTexUnit)).a ;","vec3  grad110 = rnm(vec2(perm11, pi.z)).rgb * 4.0 - 1.0;","float n110 = dot(grad110, pf - vec3(1.0, 1.0, 0.0));","vec3  grad111 = rnm(vec2(perm11, pi.z + permTexUnit)).rgb * 4.0 - 1.0;","float n111 = dot(grad111, pf - vec3(1.0, 1.0, 1.0));","vec4 n_x = mix(vec4(n000, n001, n010, n011), vec4(n100, n101, n110, n111), fade(pf.x));","vec2 n_xy = mix(n_x.xy, n_x.zw, fade(pf.y));","float n_xyz = mix(n_xy.x, n_xy.y, fade(pf.z));","return n_xyz;","}","vec2 coordRot(in vec2 tc, in float angle)","{","float aspect = width/height;","float rotX = ((tc.x*2.0-1.0)*aspect*cos(angle)) - ((tc.y*2.0-1.0)*sin(angle));","float rotY = ((tc.y*2.0-1.0)*cos(angle)) + ((tc.x*2.0-1.0)*aspect*sin(angle));","rotX = ((rotX/aspect)*0.5+0.5);","rotY = rotY*0.5+0.5;","return vec2(rotX,rotY);","}","void main() ","{","vec3 rotOffset = vec3(1.425,3.892,5.835);","vec2 rotCoordsR = coordRot(uv, timer + rotOffset.x);","vec3 noise = vec3(pnoise3D(vec3(rotCoordsR*vec2(width/grainsize,height/grainsize),0.0)));","vec4 tex = texture2D(texture, uv);","vec3 col = tex.rgb;","vec3 lumcoeff = vec3(0.299,0.587,0.114);","float luminance = mix(0.0,dot(col, lumcoeff),lumamount);","float lum = smoothstep(0.2,0.0,luminance);","lum += luminance;","noise = mix(noise,vec3(0.0),pow(lum,4.0));","col = col+noise*grainamount;","gl_FragColor =  vec4(col, tex.w);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("grain",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.width,this.width),this.ctx.uniform1f(e.uniform.height,this.height),this.ctx.uniform1f(e.uniform.grainamount,t/10),this.draw(e)}sharpen(t){let e=this.compiledProgram.get("sharpen");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px); // top left\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y)); // top center\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y)); // top right\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) ); // mid left\n                    vec4 c22 = texture2D(texture, uv); // mid center\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) ); // mid right\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) ); // bottom left\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) ); // bottom center\n                    vec4 c33 = texture2D(texture, uv + px ); // bottom right\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";e=this.compileShader(t),this.compiledProgram.set("sharpen",e)}let i=new Float32Array([-1,-1,-1,-1,9,-1,-1,-1,-1]);this.ctx.useProgram(e.program),this.ctx.uniform1fv(e.uniform.m,i),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.amount,t/2),this.draw(e)}blur(t,e=!1){let i=this.compiledProgram.get("blur");if(!i){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 size;\n                float random(vec3 scale, float seed) {\n                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    for (float t = -30.0; t <= 30.0; t++) {\n                        float percent = (t + offset - 0.5) / 30.0;\n                        float weight = 1.0 - abs(percent);\n                        vec4 sample = texture2D(texture, uv + size * percent);\n                        sample.rgb *= sample.a;\n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";i=this.compileShader(t),this.compiledProgram.set("blur",i)}let s=40*t/this.canvas.width,n=40*t/this.canvas.height;this.ctx.useProgram(i.program),this.ctx.uniform2f(i.uniform.size,0,n),this.draw(i,!0),this.ctx.uniform2f(i.uniform.size,s,0),this.draw(i,e)}zoom(t){let e=this.compiledProgram.get("zoom");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n\n                uniform vec2 center;\n                uniform float amount;\n                uniform vec2 px;\n                \n                float random(vec3 scale, float seed) {\n                    /* use the fragment position for a different seed per-pixel */                    return fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n                }\n                void main() {\n                    vec4 color = vec4(0.0);\n                    float total = 0.0;\n                    vec2 toCenter = (center - uv) * px;\n                    \n                    /* randomize the lookup values to hide the fixed number of samples */\n                    float offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n                    \n                    for (float t = 0.0; t <= 40.0; t++) {\n                        float percent = (t + offset) / 40.0;\n                        float weight = 4.0 * (percent - percent * percent);\n                        vec4 sample = texture2D(texture, uv + toCenter * percent * amount / px);\n                        \n                        /* switch to pre-multiplied alpha to correctly blur transparent images */\n                        sample.rgb *= sample.a;\n                        \n                        color += sample * weight;\n                        total += weight;\n                    }\n                    gl_FragColor = color / total;\n                    gl_FragColor.rgb /= gl_FragColor.a + 0.00001;\n                }";e=this.compileShader(t),this.compiledProgram.set("zoom",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}makeKernel(t){const e=this.GAUSSKERN_MAX+Number(!(1&this.GAUSSKERN_MAX)),i=Math.sqrt(2*Math.PI)*t,s=2*t*t;var n,a,r=~~(e/2),o=new Float32Array(e);for(a=0,n=-r;a<e;n++,a++)o[a]=Math.exp(-n*n/s)/i;return o}scaleKernel(t){const e=t.reduce(((t,e)=>t+e))||1;return t.map((t=>t/e))}gaussian(t){const e=this.makeKernel(10*t),i=e.length+Number(!(1&e.length));let s=this.compiledProgram.get(`guass-${i}`);if(!s){let t=`\n                precision mediump float;\n                #define KERNEL_SIZE ${i}\n                #define KERNEL_HALF KERNEL_SIZE / 2\n                // our texture\n                varying vec2 uv;\n                uniform vec2 px;\n                uniform sampler2D texture;\n                uniform float kernel[KERNEL_SIZE];\n                void main() {\n                    vec4 result = vec4(0.0);\n                    for (int i = 0; i < KERNEL_SIZE; i++) {\n                        result += texture2D(texture, uv + px*vec2(i - KERNEL_HALF))*kernel[i];\n                    }\n                    gl_FragColor = result;\n                }\n            `;s=this.compileShader(t),this.compiledProgram.set(`guass-${i}`,s)}this.ctx.useProgram(s.program),this.ctx.uniform2f(s.uniform.px,0,1/this.height),this.ctx.uniform1fv(s.uniform.kernel,this.scaleKernel(e)),this.draw(s,!0),this.ctx.uniform2f(s.uniform.px,1/this.width,0),this.draw(s)}radial(t){let e=this.compiledProgram.get("radial");if(!e){let t="\n                precision highp float;\n                const float PI = 3.1415926535897932384626433832795;\n                const float samples = 100.;\n\n                uniform sampler2D texture;\n\n                varying vec2 uv;\n                uniform vec2 center;\n                uniform vec2 resolution;\n\n                uniform float amount;\n                uniform int direction;\n                uniform int symmetry;\n               \n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 rotateUV(vec2 uv, mat2 transform, vec2 centerc) {\n                    uv -= centerc;\n                    uv = transform * uv;\n                    uv += centerc;\n                    return uv;\n                }\n             \n                void main(void) {\n                    float ar = resolution.x / resolution.y;\n                    vec2 uvc = uv;\n                    vec2 centerc = center;\n\n                    if (symmetry == 1)\n                    {\n                        if (resolution.x > resolution.y) {\n                            centerc.y /= ar;\n                            uvc.y /= ar;\n                        }\n                        else {\n                            centerc.x *= ar;\n                            uvc.x *= ar;\n                        }\n                    }\n\n                    vec2 coordcw = uvc;\n                    vec2 coordccw = uvc;\n                    vec4 FragColor = vec4(0.0, 0.0, 0.0, 0.0);\n                    vec2 toCenter = uvc - centerc;\n                    float endsamples = 0.;\n\n                    float a = amount / samples;\n\n                    mat2 matcw = rotate2d(-a * PI / 180.);\n                    mat2 matccw = rotate2d(a * PI / 180.);\n\n                    for (float i = 0.; i < samples; i+=1.) {\n                        if (direction == 1 || direction == 2) {\n                            coordccw = rotateUV(coordccw, matccw, centerc);\n                            FragColor += texture2D(texture, coordccw);\n                            endsamples += 1.;\n                        }\n\n                        if (direction == 0 || direction == 2) {\n                            coordcw = rotateUV(coordcw, matcw, centerc);\n                            FragColor += texture2D(texture, coordcw);\n                            endsamples += 1.;\n                        }\n                    }\n                    FragColor /= endsamples;\n                    gl_FragColor = FragColor;\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("radial",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,180*t.amount),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform1i(e.uniform.direction,t.direction),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.ctx.uniform1i(e.uniform.symmetry,t.symmetry?1:0),this.draw(e)}motion(t){let e=this.compiledProgram.get("motion");if(!e){let t="\n                precision mediump float;\n                uniform float KERNEL_SIZE;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float angle;\n\n                bool outOfRange(vec2 uv) {\n                    return uv.x < 0. || uv. y < 0. || uv.x > 1. || uv.y > 1.;\n                }\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n                void main() {\n                    vec4 result = vec4(0.0);\n                    vec2 resol = vec2 (1./resolution.x, 0.);//1./resolution.y);\n                    resol = rotate2d(angle) * resol;\n                    float divcnt = 1.;\n                    for (float i=1.; i <= 100.; i+=1.) {\n                        vec2 before = uv - resol * i;\n                        if (!outOfRange(before)) {\n                            result += texture2D(texture, before);\n                            divcnt += 1.;\n                        }\n                        vec2 after = uv + resol * i;\n                        if (!outOfRange(after)) {\n                            result += texture2D(texture, after);\n                            divcnt += 1.;\n                        }\n                        if (i >= KERNEL_SIZE) break;\n                    }\n                    result += texture2D(texture, uv);\n                    result /= divcnt;\n                    gl_FragColor = result;\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("motion",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.KERNEL_SIZE,100*t.amount),this.ctx.uniform1f(e.uniform.angle,t.angle),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}clarity(t){let e=this.compiledProgram.get("clarity");if(!e){const t="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                           \n                float Lum(vec3 c){\n                    return 0.299*c.r + 0.587*c.g + 0.114*c.b;\n                }\n                float BlendOverlayf(float base, float blend){\n                    return (base < 0.5 ? (2.0 * base * blend) : (1.0 - 2.0 * (1.0 - base) * (1.0 - blend)));\n                }\n                vec3 BlendOverlay(vec3 base, vec3 blend){\n                    return vec3(BlendOverlayf(base.r, blend.r), BlendOverlayf(base.g, blend.g), BlendOverlayf(base.b, blend.b));\n                }\n                float BlendVividLightf(float base, float blend){\n                    float BlendColorBurnf = (((2.0 * blend) == 0.0) ? (2.0 * blend) : max((1.0 - ((1.0 - base) / (2.0 * blend))), 0.0));\n                    float BlendColorDodgef =  (((2.0 * (blend - 0.5)) == 1.0) ? (2.0 * (blend - 0.5)) : min(base / (1.0 - (2.0 * (blend - 0.5))), 1.0));\n                    return ((blend < 0.5) ? BlendColorBurnf : BlendColorDodgef);\n                }\n                vec3 BlendVividLight(vec3 base, vec3 blend){\n                    return vec3(BlendVividLightf(base.r, blend.r), BlendVividLightf(base.g, blend.g), BlendVividLightf(base.b, blend.b));\n                }\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n    \n                void main() {\n\n                    vec4 base4 = texture2D(texture, uv.xy);\n                    \n                    vec3 blurMap = blurMap();\n                    vec3 base = base4.rgb;\n                    \n                    float intensity = (amount < 0.0) ? (amount / 2.0) : amount;\n                    float lum = Lum(base);\n                  \n                    vec3 col = vec3(lum);\n                    vec3 mask = vec3(1.0 - pow(lum, 1.8));\n                    // invert blurred texture\n                    vec3 layer = vec3(1.0 - Lum(blurMap));\n                    vec3 detail = clamp(BlendVividLight(col, layer), 0.0, 1.0);\n                    // we get negative detail by inverting the detail layer\n                    vec3 inverse = mix(1.0 - detail, detail, (intensity+1.0)/2.0);\n                  \n                    gl_FragColor = vec4(BlendOverlay(base, mix(vec3(0.5), inverse, mask)), base4.a);       \n                }";e=this.compileShader(t),this.compiledProgram.set("clarity",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.amount,2*t),this.draw(e)}smooth(t){let e=this.compiledProgram.get("smooth");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 px;\n                uniform float m[9];\n                uniform float amount;\n\n                void main(void) {\n                    vec4 c11 = texture2D(texture, uv - px);\n                    vec4 c12 = texture2D(texture, vec2(uv.x, uv.y - px.y));\n                    vec4 c13 = texture2D(texture, vec2(uv.x + px.x, uv.y - px.y));\n\n                    vec4 c21 = texture2D(texture, vec2(uv.x - px.x, uv.y) );\n                    vec4 c22 = texture2D(texture, uv);\n                    vec4 c23 = texture2D(texture, vec2(uv.x + px.x, uv.y) );\n\n                    vec4 c31 = texture2D(texture, vec2(uv.x - px.x, uv.y + px.y) );\n                    vec4 c32 = texture2D(texture, vec2(uv.x, uv.y + px.y) );\n                    vec4 c33 = texture2D(texture, uv + px );\n\n                    vec4 color = \n                        c11 * m[0] + c12 * m[1] + c13 * m[2] +\n                        c21 * m[3] + c22 * m[4] + c23 * m[5] +\n                        c31 * m[6] + c32 * m[7] + c33 * m[8];\n\n                    gl_FragColor = color * amount + (c22 * (1.0 - amount));\n                }";e=this.compileShader(t),this.compiledProgram.set("smooth",e)}let i=new Float32Array([1/16,2/16,1/16,2/16,.25,2/16,1/16,2/16,1/16]);this.ctx.useProgram(e.program),this.ctx.uniform1fv(e.uniform.m,i),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}denoise(t){const e=Math.round(30*t[0]);let i=this.compiledProgram.get("denoise"+e);if(!i){let t="\n                precision mediump float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                \n                uniform float sigma;\n                uniform float threshold;\n                uniform vec2 resolution;\n\n                #define INV_SQRT_OF_2PI 0.39894228040143267793994605993439  // 1.0/SQRT_OF_2PI\n                #define INV_PI 0.31830988618379067153776752674503\n                #define RADIUS %radius%.0\n              \n                void main(void) {\n\n                       float invSigmaQx2 = .5 / (sigma * sigma);      // 1.0 / (sigma^2 * 2.0)\n                       float invSigmaQx2PI = INV_PI * invSigmaQx2;    // 1.0 / (sqrt(PI) * sigma)\n                       \n                       float invThresholdSqx2 = .5 / (threshold * threshold);     // 1.0 / (sigma^2 * 2.0)\n                       float invThresholdSqrt2PI = INV_SQRT_OF_2PI / threshold;   // 1.0 / (sqrt(2*PI) * sigma)\n                       \n                       vec4 center = texture2D(texture,uv); \n                       \n                       float zBuff = 0.0;\n                       vec4 aBuff = vec4(0.0);\n                       \n                       for(float x=-RADIUS; x <= RADIUS; x++) {\n                           float pt = sqrt(RADIUS*RADIUS-x*x);  // pt = yRadius: have circular trend\n                           for(float y=-RADIUS; y <= RADIUS; y++) {\n   \n                               if(y >= pt || y <= pt) {\n   \n                                   vec2 d = vec2(x,y)/resolution;\n                       \n                                   float blurFactor = exp( -dot(d , d) * invSigmaQx2 ) * invSigmaQx2;\n                                   \n                                   vec4 pxx =  texture2D(texture,uv+d);\n                       \n                                   vec4 dC = pxx-center;\n                                   float deltaFactor = exp( -dot(dC, dC) * invThresholdSqx2) * invThresholdSqrt2PI * blurFactor;\n                                                       \n                                   zBuff += deltaFactor;\n                                   aBuff += deltaFactor*pxx;\n                               }\n                           }\n                       }\n                       gl_FragColor = aBuff/zBuff;\n                } ";i=this.compileShader(t.replace(/%radius%/g,e.toString())),this.compiledProgram.set("denoise"+e,i)}this.ctx.useProgram(i.program),this.ctx.uniform1f(i.uniform.sigma,e/3),this.ctx.uniform1f(i.uniform.threshold,t[1]),this.ctx.uniform2f(i.uniform.resolution,this.width,this.height),this.draw(i)}colorMatrix(t){let e=new Float32Array(t);e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255;let i=this.compiledProgram.get("colormatrix");if(!i){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float m[20];\n\n                void main(void) {\n                    vec4 c = texture2D(texture, uv);\n                    gl_FragColor.r = m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4];\n                    gl_FragColor.g = m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9];\n                    gl_FragColor.b = m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14];\n                    gl_FragColor.a = m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19];\n                } ";i=this.compileShader(t),this.compiledProgram.set("colormatrix",i)}this.ctx.useProgram(i.program),this.ctx.uniform1fv(i.uniform.m,e),this.draw(i)}colorMatrixRange(t,e,i){let s=new Float32Array(t);s[4]/=255,s[9]/=255,s[14]/=255,s[19]/=255;let n=this.compiledProgram.get("colormatrix-range");if(!n){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float m[20];\n                uniform float from;\n                uniform float to;\n\n                vec3 rgb2hsv(vec3 c) {\n                    vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n                \n                    float d = q.x - min(q.w, q.y);\n                    float e = 1.0e-10;\n                    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n                }\n\n                void main(void) {\n                    vec4 c = texture2D(texture, uv);\n                    vec3 hsv = rgb2hsv(c.rgb);\n\n                    gl_FragColor = c;\n\n                    if((hsv.x >= from && hsv.x <= to) || (to < from && (hsv.x >= from || hsv.x <= to))) {\n\n                        float blend = 1.0;\n                        float grad = 29.0/360.0;\n\n                        float distFrom = distance(hsv.x, from);\n                        float distTo = distance(hsv.x, to);\n\n                        if(distFrom <= grad) blend = distFrom / grad;\n                        if(distTo <= grad) blend = distTo / grad;\n\n                        vec4 b = vec4(\n                            m[0] * c.r + m[1] * c.g + m[2] * c.b + m[3] * c.a + m[4],\n                            m[5] * c.r + m[6] * c.g + m[7] * c.b + m[8] * c.a + m[9],\n                            m[10] * c.r + m[11] * c.g + m[12] * c.b + m[13] * c.a + m[14],\n                            m[15] * c.r + m[16] * c.g + m[17] * c.b + m[18] * c.a + m[19]);\n                        \n                        gl_FragColor = mix(c, b, blend);\n                    }\n                } ";n=this.compileShader(t),this.compiledProgram.set("colormatrix-range",n)}this.ctx.useProgram(n.program),this.ctx.uniform1fv(n.uniform.m,s),this.ctx.uniform1f(n.uniform.from,e/360),this.ctx.uniform1f(n.uniform.to,i/360),this.draw(n)}desaturate(){this.saturation(-1)}invert(){this.colorMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0])}contrast(t){let e=t+1,i=-128*(e-1);this.colorMatrix([e,0,0,0,i,0,e,0,0,i,0,0,e,0,i,0,0,0,1,0])}hue(t,e,i){let s=this.compiledProgram.get("hue"+(e?"-range":""));if(!s){let t="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n            uniform float rotation;\n            uniform float from;\n            uniform float to;\n            \n            vec3 rgb2hsv(vec3 c) {\n                vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\n                vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n                vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n            \n                float d = q.x - min(q.w, q.y);\n                float e = 1.0e-10;\n                return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n            }\n            vec3 hsv2rgb(vec3 c) {\n                vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\n                vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n                return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n            }";t+=e?"\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    vec3 hsv = rgb2hsv(base.rgb);\n\n                    gl_FragColor = base;\n\n                    if((hsv.x >= from && hsv.x <= to) || (to < from && (hsv.x >= from || hsv.x <= to))) {\n\n                        float blend = 1.0;\n                        float grad = 29.0/360.0;\n\n                        float distFrom = distance(hsv.x, from);\n                        float distTo = distance(hsv.x, to);\n\n                        if(distFrom <= grad) blend = distFrom / grad;\n                        if(distTo <= grad) blend = distTo / grad;\n                        \n                        hsv.x += rotation * blend;\n                        \n                        gl_FragColor.rgb = hsv2rgb(hsv);\n                    }\n                }":"\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    vec3 hsv = rgb2hsv(base.rgb);\n\n                    hsv.x += rotation;\n\n                    gl_FragColor = vec4(hsv2rgb(hsv), base.a);\n                }",s=this.compileShader(t),this.compiledProgram.set("hue"+(e?"-range":""),s)}this.ctx.useProgram(s.program),this.ctx.uniform1f(s.uniform.rotation,t/360),e&&(this.ctx.uniform1f(s.uniform.from,e/360),this.ctx.uniform1f(s.uniform.to,i/360)),this.draw(s)}saturation(t,e,i){let s=2*t/3+1,n=-.5*(s-1);e?this.colorMatrixRange([s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0],e,i):this.colorMatrix([s,n,n,0,0,n,s,n,0,0,n,n,s,0,0,0,0,0,1,0])}lightness(t,e,i){t*=255,e?this.colorMatrixRange([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0],e,i):this.colorMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0])}colorize(t){this.fill(new c.Z(n.Z.fromHSB(t,1,1),"color",1))}exposure(t){let e=this.compiledProgram.get("exposure");if(!e){let t=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float ramp(in float t){","t *= 2.0;","if (t >= 1.0) {","t -= 1.0;","t = log(0.5) / log(0.5*(1.0-t) + 0.9332*t);","}","return clamp(t, 0.001, 10.0);","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","vec3 base = col.rgb * matRGBtoROMM;","float a = abs(amount) * col.a + epsilon;","float v = pow(2.0, a*2.0+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (amount > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = pow(res, vec3(ramp(1.0 - (0.0 * col.a + 1.0) / 2.0)));","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("exposure",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}highlights(t){let e=this.compiledProgram.get("highlights");if(!e){let t=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(amount, 0.0, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("highlights",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}shadows(t){let e=this.compiledProgram.get("shadows");if(!e){let t=["#define GLSLIFY 1","precision highp float;","varying vec2 uv;","uniform sampler2D texture;","uniform float amount;","const float epsilon = 0.000001;","const float mx = 1.0 - epsilon;","const float PI = 3.1415926535897932384626433832795;","const mat3 matRGBtoROMM = mat3(0.5293459296226501, 0.3300727903842926, 0.14058130979537964, 0.09837432950735092, 0.8734610080718994, 0.028164653107523918, 0.01688321679830551, 0.11767247319221497, 0.8654443025588989);","const mat3 matROMMtoRGB = mat3(2.0340757369995117, -0.727334201335907, -0.3067416846752167, -0.22881317138671875, 1.2317301034927368, -0.0029169507324695587, -0.008569774217903614, -0.1532866358757019, 1.1618564128875732);","float luma_romm(in vec3 color){","return dot(color, vec3(0.242655, 0.755158, 0.002187));","}","float luma(in vec3 color){","return dot(color, vec3(0.298839, 0.586811, 0.11435));","}","vec3 rgb2hsv(in vec3 c) {","vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);","vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));","vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));","float d = q.x - min(q.w, q.y);","float e = 1.0e-10;","return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);","}","vec3 hsv2rgb(in vec3 c) {","vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);","vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);","return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);","}","vec3 setHue(in vec3 res, in vec3 base) {","vec3 hsv = rgb2hsv(base);","vec3 res_hsv = rgb2hsv(res);","return hsv2rgb(vec3(hsv.x, res_hsv.y, res_hsv.z));","}","float gaussian(in float x) {","return 1.0 - exp(-PI*2.0*x*x);","}","void main() {","lowp vec4 col = texture2D(texture, uv.xy);","lowp vec3 map = col.rgb;","vec3 base = col.rgb * matRGBtoROMM;","float base_lum = luma(col.rgb);","float map_lum = luma_romm(map * matRGBtoROMM);","float exposure = mix(0.0, amount, 1.0 - map_lum) * col.a;","float a = abs(exposure) * col.a + epsilon;","float v = pow(2.0, a+1.0)-2.0;","float m = mx - exp(-v);","vec3 res = (exposure > 0.0) ? (1.0 - exp(-v*base)) / m : log(1.0-base*m) / -v;","res = mix(base, res, min(a*100.0, 1.0));","res = setHue(res, base);","res = res * matROMMtoRGB;","gl_FragColor = vec4(res, col.a);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("shadows",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}dehaze(t){let e=this.compiledProgram.get("dehaze");if(!e){let t="\n\n                #define GLSLIFY 1;\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform float amount;  // -1.0 ~ 1.0\n\n                uniform vec2 size;\n\n                float hazeMap(vec4 base) {\n                    vec3 color = vec3(1.0, 1.0, 1.0);\n                    vec2 step = vec2(1.0 / size.xy);\n                    const int patchRadius = 1; // the half size for shift in 3 x 3 patch.\n                    for (int i = -patchRadius; i <= patchRadius; ++i) {\n                       for (int j = -patchRadius; j <= patchRadius; ++j) {\n                           vec2 uv = clamp(uv + (vec2(i, j) * step), 0.0, 1.0);\n                           color = min(color, base.rgb);\n                        }\n                    }\n                    return min(color.r, min(color.g, color.b));\n                }\n\n                void main() {\n                    \n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    lowp float haze = hazeMap(base);\n\n                    float transmission = 1.0 - 0.95 * haze;\n                    const float A = 0.95; //0.95 intensity. We can consider to collect 0.1% brightest pixel from the dark channel image.\n                    const float t0 = 0.1; //0.1 in the paper, we can increase it for solving the color bleeding.\n                    float t = mix(1.0, max(t0, transmission), amount);\n                    vec3 J = (base.rgb - A) / t + A;\n                    gl_FragColor = vec4(J, base.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("dehaze",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.size,this.width,this.height),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}solarize(){this.paletteMap||(this.paletteMap=new ImageData(256,1));for(let t=0;t<256;++t){let e=255*(t/255>.5?2*(t/255-.5):2*(.5-t/255));e=e>255?255:e<0?0:e,this.paletteMap.data[4*t]=this.paletteMap.data[4*t+1]=this.paletteMap.data[4*t+2]=e}this.mapping(this.paletteMap)}monochrome(t){let e=this.compiledProgram.get("monochrome");if(!e){let t="\n            precision highp float;\n            varying vec2 uv;\n            \n            uniform sampler2D texture;\n\n            uniform float r;\n            uniform float g;\n            uniform float b;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(r, g, b));\n            }\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n\n                gl_FragColor = vec4(avg, avg, avg, base.a);\n            }";e=this.compileShader(t),this.compiledProgram.set("monochrome",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.r,t.r),this.ctx.uniform1f(e.uniform.g,t.g),this.ctx.uniform1f(e.uniform.b,t.b),this.draw(e)}curves(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),void 0!==t.preset&&(t=m.z.createCurveSet(t)),m.Z.fillPaletteMap(t,this.paletteMap),this.mapping(this.paletteMap)}levels(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),u.Z.fillPaletteMap(t,this.paletteMap),this.mapping(this.paletteMap)}multilevels(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),u.Z.fillRGBPaletteMap(t[0].isFlat()?void 0:t[0],t[1].isFlat()?void 0:t[1],t[2].isFlat()?void 0:t[2],this.paletteMap),this.mapping(this.paletteMap)}mapping(t){let e=this.compiledProgram.get("mapping");if(!e){let t="\n                #define GLSLIFY 1\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float r = texture2D(paletteMap, vec2(base.r, 0)).r;\n                    float g = texture2D(paletteMap, vec2(base.g, 0)).g;\n                    float b = texture2D(paletteMap, vec2(base.b, 0)).b;\n                    gl_FragColor = vec4(r, g, b, base.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("mapping",e)}this.ctx.useProgram(e.program);let i=e.getTextureById("paletteMap");i.createTexture(this.ctx,t.width,t.height),i.uploadData(this.ctx,t),this.draw(e)}lookup(t){let e=this.compiledProgram.get("lookup");if(!e){let t="\n            precision highp float;\n            varying vec2 uv;\n\n            uniform sampler2D texture;\n            uniform sampler2D paletteMap;\n            \n            float luma(vec3 color) {\n                return dot(color, vec3(0.299, 0.587, 0.114));\n            }\n\n            void main() {\n                lowp vec4 base = texture2D(texture, uv.xy);\n                float avg = luma(base.rgb);\n                float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                gl_FragColor = vec4(r, g, b, base.a);\n            }";e=this.compileShader(t),this.compiledProgram.set("lookup",e)}this.ctx.useProgram(e.program);let i=e.getTextureById("paletteMap");i.createTexture(this.ctx,t.width,t.height),i.uploadData(this.ctx,t),this.draw(e)}toning(t){this.paletteMap||(this.paletteMap=new ImageData(256,1)),l.Z.fillPaletteMap(t,this.paletteMap);let e=this.compiledProgram.get("toning");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n\n                uniform sampler2D texture;\n                uniform sampler2D paletteMap;\n\n                uniform float amount;\n                \n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    lowp vec4 base = texture2D(texture, uv.xy);\n                    float avg = luma(base.rgb);\n                    float r = texture2D(paletteMap, vec2(avg, 0)).r;\n                    float g = texture2D(paletteMap, vec2(avg, 0)).g;\n                    float b = texture2D(paletteMap, vec2(avg, 0)).b;\n                    gl_FragColor = mix(base, vec4(r, g, b, base.a), amount);\n                }";e=this.compileShader(t),this.compiledProgram.set("toning",e)}this.ctx.useProgram(e.program);let i=e.getTextureById("paletteMap");i.createTexture(this.ctx,this.paletteMap.width,this.paletteMap.height),i.uploadData(this.ctx,this.paletteMap),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}fill(t){let e=this.compiledProgram.get("fill-"+t.blend);if(!e){let i="";switch(t.blend){case"color":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendColor(vec3 base, vec3 blend) {\n                            vec3 color = vec3(blend.rgb);\n                            base.r = base.r * 0.30 + base.g * 0.59 + base.b * 0.11;\n                            \n                            vec3 power = (color.r+color.g+color.b) * 0.3333 - color;\n                            base.rgb = pow(base.rrr, 1.0 + power);\n\n                            return base;\n                        }\n                        vec3 blendColor(vec3 base, vec3 blend, float opacity) {\n                            return (blendColor(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColor(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"soft-light":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendSoftLight(float base, float blend) {\n                            return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend) {\n                            return vec3(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b));\n                        }\n                        vec3 blendSoftLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendSoftLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendSoftLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"hard-light":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend) {\n                            return blendOverlay(blend,base);\n                        }\n                        vec3 blendHardLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendHardLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendHardLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"vivid-light":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        float blendVividLight(float base, float blend) {\n                            return (blend<0.5)?blendColorBurn(base,(2.0*blend)):blendColorDodge(base,(2.0*(blend-0.5)));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend) {\n                            return vec3(blendVividLight(base.r,blend.r),blendVividLight(base.g,blend.g),blendVividLight(base.b,blend.b));\n                        }\n                        vec3 blendVividLight(vec3 base, vec3 blend, float opacity) {\n                            return (blendVividLight(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendVividLight(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"overlay":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n\n                        float blendOverlay(float base, float blend) {\n                            return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend) {\n                            return vec3(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b));\n                        }\n                        vec3 blendOverlay(vec3 base, vec3 blend, float opacity) {\n                            return (blendOverlay(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendOverlay(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"multiply":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        vec3 blendMultiply(vec3 base, vec3 blend) {\n                            return base*blend;\n                        }\n                        vec3 blendMultiply(vec3 base, vec3 blend, float opacity) {\n                            return (blendMultiply(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendMultiply(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-dodge":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorDodge(float base, float blend) {\n                            return (blend==1.0)?blend:min(base/(1.0-blend),1.0);\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend) {\n                            return vec3(blendColorDodge(base.r,blend.r),blendColorDodge(base.g,blend.g),blendColorDodge(base.b,blend.b));\n                        }\n                        vec3 blendColorDodge(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorDodge(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorDodge(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"color-burn":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendColorBurn(float base, float blend) {\n                            return (blend==0.0)?blend:max((1.0-((1.0-base)/blend)),0.0);\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend) {\n                            return vec3(blendColorBurn(base.r,blend.r),blendColorBurn(base.g,blend.g),blendColorBurn(base.b,blend.b));\n                        }\n                        vec3 blendColorBurn(vec3 base, vec3 blend, float opacity) {\n                            return (blendColorBurn(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendColorBurn(base.rgb, color.rgb, amount), base.a);\n                        }";break;case"screen":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        float blendScreen(float base, float blend) {\n                            return 1.0-((1.0-base)*(1.0-blend));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend) {\n                            return vec3(blendScreen(base.r,blend.r),blendScreen(base.g,blend.g),blendScreen(base.b,blend.b));\n                        }\n                        vec3 blendScreen(vec3 base, vec3 blend, float opacity) {\n                            return (blendScreen(base, blend) * opacity + base * (1.0 - opacity));\n                        }\n\n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = vec4(blendScreen(base.rgb, color.rgb, amount), base.a);\n                        }";break;default:i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform vec4 color;\n                        \n                        void main() {\n                            vec4 base = texture2D(texture, uv.xy);\n                            gl_FragColor = mix(base, color, amount);\n                        }"}e=this.compileShader(i),this.compiledProgram.set("fill-"+t.blend,e)}this.ctx.useProgram(e.program),this.ctx.uniform4f(e.uniform.color,t.color.r/255,t.color.g/255,t.color.b/255,1),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}glamour(t){let e=this.compiledProgram.get("glamour");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n\n                float normpdf(in float x, in float sigma) {\n                    return 0.39894*exp(-0.5*x*x/(sigma*sigma))/sigma;\n                }\n\n                vec3 blurMap() {\n                    //declare stuff\n                    const int mSize = 11;\n                    const int kSize = (mSize-1)/2;\n                    float kernel[mSize];\n                    vec3 final_colour = vec3(0.0);\n                    \n                    //create the 1-D kernel\n                    float sigma = 7.0;\n                    float Z = 0.0;\n                    for (int j = 0; j <= kSize; ++j){\n                        kernel[kSize+j] = kernel[kSize-j] = normpdf(float(j), sigma);\n                    }\n                    \n                    //get the normalization factor (as the gaussian has been clamped)\n                    for (int j = 0; j < mSize; ++j){\n                        Z += kernel[j];\n                    }\n                    \n                    //read out the texels\n                    for (int i=-kSize; i <= kSize; ++i){\n                        for (int j=-kSize; j <= kSize; ++j){\n                            final_colour += kernel[kSize+j] * kernel[kSize+i] * texture2D(texture, (uv.xy + vec2(float(i),float(j))*px)).rgb;\n                        }\n                    }\n                    return vec3(final_colour/(Z*Z));\n                }\n\n                float luma(vec3 color) {\n                    return dot(color, vec3(0.299, 0.587, 0.114));\n                }\n\n                void main() {\n                    \n                    vec4 base = texture2D(texture, uv);\n                    vec3 color = blurMap();\n                    \n                    color = vec3(luma(color));\n\n                    color = vec3(\n                        (base.r <= 0.5) ? (2.0 * base.r * color.r) : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - color.r)),\n                        (base.g <= 0.5) ? (2.0 * base.g * color.g) : (1.0 - 2.0 * (1.0 - base.g) * (1.0 - color.g)),\n                        (base.b <= 0.5) ? (2.0 * base.b * color.b) : (1.0 - 2.0 * (1.0 - base.b) * (1.0 - color.b))\n                    );\n                \n                    gl_FragColor = mix(base, vec4(color, base.a), amount);\n                }";e=this.compileShader(t),this.compiledProgram.set("glamour",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}kaleidoscope(t){let e=this.compiledProgram.get("kaleidoscope");if(!e){let t="\n                precision mediump float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 resolution;\n\n                uniform float u_stretch;\n                uniform float u_position;\n                uniform float u_amount;\n\n                int modwhole(float a, float b) {\n                    float m = mod(a, b);\n\n                    return int (m+.5);\n                }\n\n                void main(void) {\n                    int numOfAxis = int(u_amount);\n                    float angleFrac = (2. * PI) / float ( 2 * numOfAxis);\n\n                    vec2 uvc = uv;\n                    uvc -= .5;\n\n                    // Convert to Polar\n                    float phi = abs(atan(uvc.x, uvc.y));\n                    float r = length(uvc);\n\n                    int count = int(phi / angleFrac);\n\n                    phi = mod(phi, angleFrac);\n                    if (modwhole (float(count), 2.) == 1) {\n                        phi = angleFrac - phi;\n                    }\n\n                    // from polar coordiantes\n                    float x = r * cos(phi);\n                    float y = r * sin(phi);\n\n                    float stretch = 1. + (1. - u_stretch);\n                    float position = u_position * PI * .5;\n\n                    uvc = vec2(x, y) * stretch + sin(position);\n\n                    if (uvc.x < 0.) uvc.x += 1.;\n                    if (uvc.x > 1.) uvc.x -= 1.;\n                \n                    if (uvc.y < 0.) uvc.y += 1.;\n                    if (uvc.y > 1.) uvc.y -= 1.;\n\n                    gl_FragColor = texture2D (texture, uvc);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("kaleidoscope",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.u_amount,t.amount),this.ctx.uniform1f(e.uniform.u_stretch,t.stretch),this.ctx.uniform1f(e.uniform.u_position,t.position),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}polarcoordinates(t){let e=this.compiledProgram.get("polarcoordinates");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int flip;\n                uniform float overlap;\n                uniform float rotate;\n                uniform vec2 resolution;\n                uniform int symmetry;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // Aspect Ratio\n                    float ar = resolution.x / resolution.y;\n\n                    // Square the image at the center if rectangular\n                    if (symmetry == 1) {\n                        if (resolution.x > resolution.y) {\n                            float leftEdge = (1.0-1.0/ar) * 0.5;\n                            float rightEdge = 1.0 - leftEdge;\n\n                            if (uv.x < leftEdge) {\n                                uv = vec2(0, uv.y); // Fill in the left edge\n                            } else if (uv.x > rightEdge) {\n                                uv = vec2(1, uv.y); // Fill in the right edge\n                            }\n                            else {\n                                uv.x -= leftEdge; // Square the image on X\n                                uv.x *= ar;\n                            }\n                        } else if (resolution.y > resolution.x) {\n                            float bottomEdge = (1.0-ar) * 0.5;\n                            float topEdge = 1.0 - bottomEdge;\n\n                            if (uv.y < bottomEdge) {\n                                uv = vec2(uv.x, 0); // Fill in the bottom edge\n                            } else if (uv.y > topEdge) {\n                                uv = vec2(uv.x, 1); // Fill in the top edge\n                            }\n                            else {\n                                uv.y -= bottomEdge; // Square the image on Y\n                                uv.y /= ar;\n                            }\n                        }\n                    }\n                    return uv;\n                }\n\n                void main(void) {           \n                    // Square the image\n                    vec2 uvc = squareImage(uv);\n\n                    // Bring uv coordinates to center 0.5\n                    uvc = uvc-0.5;\n\n                    // Rotate uv by angle\n                    uvc = rotate2d( rotate ) * uvc;\n\n                    // Cartesian to polar\n                    float r = length(uvc) * 2.0;\n                    float a = atan(uvc.x, uvc.y);\n\n                    // Move from -PI -> PI to 0 -> 1\n                    vec2 uvp = vec2(a / (PI_2 + overlap) + 0.5, r);\n\n                    // Flip the image by 180 degrees\n                    uvp = flip == 1 ? 1.0 - uvp : uvp;\n\n                    // Compute color\n                    gl_FragColor = texture2D(texture, uvp);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("polarcoordinates",e)}this.ctx.useProgram(e.program),this.ctx.uniform1i(e.uniform.flip,t.flip?1:0),this.ctx.uniform1i(e.uniform.symmetry,t.symmetry?1:0),this.ctx.uniform1f(e.uniform.overlap,t.overlap),this.ctx.uniform1f(e.uniform.rotate,t.rotate),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}fisheye(t){let e=this.compiledProgram.get("fisheye");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n\n                uniform sampler2D texture;\n                uniform vec2 center;\n                uniform float amount;\n                uniform float aperture;\n                uniform int edgeFill;\n                uniform vec2 resolution;\n\n                vec2 edgeFillReflect(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = -uvc.x;\n                    if (uvc.y < 0.) uvc.y = -uvc.y;\n                    if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                    if (uvc.y > 1.) uvc.y = 2. - uvc.y;\n\n                    return uvc;\n                }\n\n                vec2 edgeFillRepeat(vec2 uvc) {\n                    if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                    if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                    if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                    if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n\n                    return uvc;\n                }\n\n                int edgeFillNone(vec2 uvc) {\n                    if (uvc.x < 0. || uvc.y < 0. || uvc.x > 1. || uvc.y > 1.) {\n                        return 1;\n                    }\n                    return 0;\n                }\n\n                void main(void) {\n\n                    // Normalized device space i.e. range of [-1, 1]\n                    vec2 ndcPos = uv * 2. - center * 2.;\n\n                    // Aspect ratio of the viewport\n                    float aspect = resolution.x / resolution.y;\n\n                    // Relationship between the radius of the perimeter circle (r or half_dist) and\n                    // the angle (eye_angle): \n                    // Bisect the isosceles triangle\n                    float eye_angle = abs(aperture);\n                    float half_angle = eye_angle / 2.;\n                    float half_dist = tan(half_angle);\n\n                    // With the aspect ratio of the viewport (aspect)\n                    vec2 vp_scale = vec2(aspect, 1.);\n                    vec2 P = ndcPos * vp_scale;\n\n                    // Diameter or the length of the viewport\n                    float vp_dia = length(vp_scale);\n\n                    // Relative distance to the center of the viewport\n                    float rel_dist = length(P) / vp_dia;\n\n                    // Relative position of the point P in relation to the aspect ratio\n                    vec2 rel_P = normalize(P) / normalize(vp_scale);\n\n                    vec2 pos_prj = ndcPos;\n                    if (aperture > 0.) {\n                        // Projection from spherical surface to the place\n                        float beta = rel_dist * half_angle;\n                        pos_prj = rel_P * tan(beta) / half_angle * pow(.9, amount * 5.);\n                    } else if (aperture < 0.) {\n                        // Projection from the plane to the spherical surface\n                        float beta = atan(rel_dist * half_dist);\n                        pos_prj = rel_P * beta / half_angle * pow(.9, amount * 5.);\n                    }\n\n                    vec2 uv_prj = pos_prj * .5 + center;\n\n                    // Return transparent if no edge fill\n                    if (edgeFill == 0) {\n                        if (edgeFillNone(uv_prj) == 1) {\n                            discard;\n                        }\n                    }\n                    if (edgeFill == 1) {\n                        uv_prj = edgeFillReflect(uv_prj);\n                    } \n                    if (edgeFill == 2) {\n                        uv_prj = edgeFillRepeat(uv_prj);\n                    }\n\n                    gl_FragColor = texture2D(texture, uv_prj);;\n                }";e=this.compileShader(t),this.compiledProgram.set("fisheye",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1f(e.uniform.aperture,t.aperture),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform1i(e.uniform.edgeFill,t.edgeFill),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}wave(t){let e=this.compiledProgram.get("wave");if(!e){let t="\n                precision mediump float;\n                uniform int type;\n                uniform float amplitude;\n                uniform float scale;\n                varying vec2 uv;\n                uniform int edgeApprox;\n                // uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float rotate;\n                #define PI 3.14159265359\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                float cot(float angle) {\n                    return cos(angle) / sin(angle);\n                }\n\n                float sinewave(float rad) {\n                    return amplitude * sin(scale * 2. * PI * rad);\n                }\n\n                float trianglewave(float rad) {\n                    return amplitude * 2. / PI * asin(sin(scale * 2. * PI * rad));\n                }\n\n                float squarewave(float rad) {\n                    return amplitude * sign(sin(scale * 2. * PI * rad));\n                }\n\n                void main() {\n                    vec2 uvc = uv;\n\n                    uvc -= 0.5;\n                    uvc = rotate2d(-rotate) * uvc;\n\n                    if (type == 0) {\n                        // sine wave\n                        uvc.y = sinewave(uvc.x) + uvc.y;\n                    } else if (type == 1) {\n                        // triangular wave\n                        uvc.y = trianglewave(uvc.x) + uvc.y;\n                    } else if (type == 2) {\n                        // square wave\n                        uvc.y = squarewave(uvc.x) + uvc.y;\n                    } else {\n                        // sawtooth wave\n                        // uvc.y = amplitude * 2. / PI * atan(cot(scale * 2. * PI * uvc.x));\n                    }\n                    \n                    uvc = rotate2d(rotate) * uvc;\n                    uvc += 0.5;\n                    \n                    // Clamp\n                    // uvc = clamp(uvc, 0., 1.);\n\n                    if (edgeApprox == 2) {\n                        // Repeat acros the edges with the opposite side color\n                        if (uvc.x < 0.) uvc.x = 1. + uvc.x;\n                        if (uvc.y < 0.) uvc.y = 1. + uvc.y;\n                        if (uvc.x > 1.) uvc.x = uvc.x - 1.;\n                        if (uvc.y > 1.) uvc.y = uvc.y - 1.;\n                    } else if (edgeApprox == 1) {\n                        // Approximate (natural) around the edges with the reflection color\n                        if (uvc.x < 0.) uvc.x = -uvc.x;\n                        if (uvc.y < 0.) uvc.y = -uvc.y;\n                        if (uvc.x > 1.) uvc.x = 2. - uvc.x;\n                        if (uvc.y > 1.) uvc.y = 2. - uvc.y;    \n                    } else {\n                        // Don't approximate, render transparent\n                        if (uvc.x < 0. || uvc.x > 1. || \n                            uvc.y < 0. || uvc.y > 1.) {\n                            gl_FragColor = vec4 (0.0, 0.0, 0.0, 0.0);\n                            return;\n                        }    \n                    }\n\n                    gl_FragColor = texture2D(texture, uvc);\n                    return;\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("wave",e)}this.ctx.useProgram(e.program),this.ctx.uniform1i(e.uniform.type,t.type),this.ctx.uniform1f(e.uniform.amplitude,t.amplitude),this.ctx.uniform1f(e.uniform.scale,t.scale),this.ctx.uniform1f(e.uniform.rotate,t.rotate),this.ctx.uniform1i(e.uniform.edgeApprox,t.edgeApprox),this.draw(e)}reflect(t){let e=this.compiledProgram.get("reflect");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                #define PI 3.14159265359\n                #define PI_2 6.2831\n\n                uniform sampler2D texture;\n                uniform int type;\n                uniform vec2 resolution;\n                uniform vec2 center;\n\n                // constant integers for directions\n                const int RIGHT = 1, LEFT = -1, ZERO = 0;\n\n                const float ALMOST_ZERO = 0.00001;\n\n                mat2 rotate2d(float _angle){\n                    return mat2(cos(_angle),-sin(_angle),\n                                sin(_angle),cos(_angle));\n                }\n\n                vec2 squareImage(vec2 uv) {\n                    // return uv;\n\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                    }\n                    else {\n                        uv.x *= ar;\n                    }\n                    return uv;\n                }\n\n                vec2 squareImagereverse(vec2 uv) {\n                    float ar = resolution.x / resolution.y;\n\n                    if (resolution.x > resolution.y) {\n                        uv.y /= ar;\n                        uv.y += (1. - 1./ar) * 0.5;\n                    }\n                    else {\n                        uv.x *= ar;\n                        uv.x += (1. - ar) * 0.5;\n                    }\n                    return uv;\n                }\n\n                int direction(vec2 A, vec2 B, vec2 P) {\n                    // subtracting co-ordinates of point A from\n                    // B and P, to make A as origin\n                    B.x -= A.x;\n                    B.y -= A.y;\n                    P.x -= A.x;\n                    P.y -= A.y;\n                \n                    // Determining cross Product\n                    float cross_product = B.x * P.y - B.y * P.x;\n                \n                    // return RIGHT if cross product is positive\n                    if (cross_product > ALMOST_ZERO)\n                        return LEFT;\n                \n                    // return LEFT if cross product is negative\n                    if (cross_product < -ALMOST_ZERO)\n                        return RIGHT;\n                \n                    // return ZERO if cross product is zero.\n                    return ZERO;\n                }\n                \n                vec2 reflectmagic(vec2 uvc, int reflectfrom, mat2 transf, vec2 A, vec2 B, vec2 center) {\n\n                    vec2 cent = center - 0.5;\n                    uvc -= center;\n\n                    int dircent = direction(A, B, cent);\n                    int diruv = direction(A, B, uvc);\n\n                    uvc = dircent >= ZERO && diruv >= ZERO || dircent == LEFT && diruv == LEFT ? transf * uvc : uvc;\n\n                    uvc += center;\n\n                    uvc -= 0.5;\n\n                    if (reflectfrom == LEFT) {\n                        uvc = dircent >= ZERO ? uvc : transf * uvc;\n                    } else {\n                        uvc = dircent == LEFT ? uvc : transf * uvc;\n                    }\n\n                    uvc += 0.5;\n\n                    return uvc;\n                }\n\n                vec2 reflectx(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(-1., 0., 0., 1.);     \n\n                    vec2 A = vec2 (0., -1.);\n                    vec2 B = vec2 (0., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflecty(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(1., 0., 0., -1.);    \n\n                    vec2 A = vec2 (-1., 0.);\n                    vec2 B = vec2 (1., 0.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, center);\n                }\n\n                vec2 reflectxequalminusy(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., 1., 1., 0.);\n\n                    vec2 A = vec2 (-1., -1.);\n                    vec2 B = vec2 (1., 1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, 1.-center.x));\n                }\n\n                vec2 reflectxequaly(vec2 uvc, int reflectfrom) {\n                    mat2 transf = mat2(0., -1., -1., 0.);\n\n                    vec2 A = vec2 (-1., 1.);\n                    vec2 B = vec2 (1., -1.);\n\n                    return reflectmagic(uvc, reflectfrom, transf, A, B, vec2(center.x, center.x));\n                }\n\n                vec2 reflect(vec2 uvc) {\n                    //reflect-type-minus-x\n                    if (type == 1) {\n                        uvc = reflectx(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-y\n                    else if (type == 2) {\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-plus-x\n                    if (type == 3) {\n                        uvc = reflectx(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-y\n                    else if (type == 4) {\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-minus-x-minus-y\n                    else if (type == 5) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-minus-x-plus-y\n                    else if (type == 6) {\n                        uvc = reflectx(uvc, LEFT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-plus-y\n                    else if (type == 7) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, RIGHT);\n                    }\n\n                    //reflect-type-plus-x-minus-y\n                    else if (type == 8) {\n                        uvc = reflectx(uvc, RIGHT);\n                        uvc = reflecty(uvc, LEFT);\n                    }\n\n                    //reflect-type-above-x-equalto-y\n                    else if (type == 9) {\n                        uvc = reflectxequalminusy(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-minus-y\n                    else if (type == 10) {\n                        uvc = reflectxequaly(uvc, RIGHT);\n                    }\n\n                    // reflect-type-above-x-equalto-minus-y\n                    else if (type == 11) {\n                        uvc = reflectxequaly(uvc, LEFT);\n                    }\n\n                    // reflect-type-below-x-equalto-y\n                    else if (type == 12) {\n                        uvc = reflectxequalminusy(uvc, RIGHT);\n                    }\n\n                    return uvc;\n                }\n\n                void main(void) {\n                    vec2 uvc = reflect(uv);\n                    gl_FragColor = texture2D(texture, uvc);\n                }\n            ";e=this.compileShader(t),this.compiledProgram.set("reflect",e)}this.ctx.useProgram(e.program),this.ctx.uniform1i(e.uniform.type,t.type),this.ctx.uniform2f(e.uniform.center,t.x,t.y),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}bloom(t){let e=this.compiledProgram.get("bloom");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 px;\n                float thresh = .5;\n                \n                void main() {\n                    vec4 sum = vec4(0);\n                \n                    // mess of for loops due to gpu compiler/hardware limitations\n                    int j=-2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=-1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=0;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=1;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    j=2;\n                    for( int i=-2; i<=2; i++) sum+=texture2D(texture,uv+vec2(i,j)*px);\n                    sum/=25.0;\n                \n                    gl_FragColor= texture2D(texture, uv);\n                \n                    // use the blurred colour if it's bright enough\n                    if (length(sum) > thresh) {\n                        gl_FragColor += sum*amount;\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("bloom",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}posterize(t){let e=this.compiledProgram.get("posterize");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                float areas = 256.0 / amount;\n                float values = 255.0 / (amount - 1.0);\n                \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n\n                    px.r = floor(values * floor((px.r*255.0) / areas))/255.0;\n                    px.g = floor(values * floor((px.g*255.0) / areas))/255.0;\n                    px.b = floor(values * floor((px.b*255.0) / areas))/255.0;\n\n                    gl_FragColor = px;\n                }";e=this.compileShader(t),this.compiledProgram.set("posterize",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,100*t+1),this.draw(e)}fringe(t){let e=this.compiledProgram.get("fringe");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform vec2 amount;\n\n                void main() {\n                    vec2 dir = uv - vec2( .5 );\n                    float d = .7 * length( dir );\n                    normalize( dir );\n                    vec2 value = d * dir * amount;\n                \n                    vec4 c1 = texture2D( texture, uv - value);\n                    vec4 c2 = texture2D( texture, uv );\n                    vec4 c3 = texture2D( texture, uv + value);\n                    \n                    gl_FragColor = vec4( c1.r, c2.g, c3.b, c1.a + c2.a + c3.b);\n                }";e=this.compileShader(t),this.compiledProgram.set("fringe",e)}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.amount,t,t),this.draw(e)}rgbSplit(t){let e=0,i=0,s=0;const n=t.distance;switch(t.type){case"red-blue":e=n,s=-n;break;case"green-red":e=-n,i=n;break;case"blue-green":i=-n,s=n;break;case"red":e=n;break;case"green":i=n;break;case"blue":s=n}let a=this.compiledProgram.get("rgb-split");if(!a){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                uniform vec2 r;\n                uniform vec2 g;\n                uniform vec2 b;\n\n                void main() {\n                \n                    vec4 px = texture2D(texture, uv);\n\n                    vec4 c1 = texture2D( texture, uv - r);\n                    vec4 c2 = texture2D( texture, uv - g);\n                    vec4 c3 = texture2D( texture, uv - b);\n                    \n                    gl_FragColor = mix(px, vec4( c1.r, c2.g, c3.b, (c1.a + c2.a + c3.a)/3.0), amount);\n                }";a=this.compileShader(t),this.compiledProgram.set("rgb-split",a)}this.ctx.useProgram(a.program),this.ctx.uniform1f(a.uniform.amount,t.amount);var r=t.direction*Math.PI/180,o=Math.cos(r),c=Math.sin(r);this.ctx.uniform2f(a.uniform.r,o*e,c*e),this.ctx.uniform2f(a.uniform.g,o*i,c*i),this.ctx.uniform2f(a.uniform.b,o*s,c*s),this.draw(a)}interference(t){let e=this.compiledProgram.get("interference");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform int direction;\n\n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy, vec2(12.9898,78.233)*3.141)) * 43758.5453);\n                }\n\n                void main() {\n\n                    float rand1 = rand(vec2(seed,seed));\n                    float rand2 = rand(vec2(seed,rand1));\n                \n                    float rand1xy = rand(vec2(rand1*uv.x,rand2*uv.y));\n                    float rand2xy = rand(vec2(rand1*uv.y,rand2*uv.x));\n                  \n                    float rand1x = rand(vec2(rand1*uv.x,rand2));\n                    float rand2x = rand(vec2(rand1x,rand1x));     \n\n                    float rand1y = rand(vec2(rand1*uv.y,rand2));\n                    float rand2y = rand(vec2(rand1y,rand1y));                       \n                    \n                    if(direction == 0) {\n                        if(rand2y/100.0 > rand1y) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x + rand1y * amount, uv.y));\n                        }\n                    } else {\n                        if(rand2x/100.0 > rand1x) {\n                            if(rand2xy < 0.3) gl_FragColor = vec4(rand1xy, rand1xy, rand1xy, 0.0);\n                            else gl_FragColor = texture2D(texture, uv);\n                        }\n                        else {\n                            gl_FragColor = texture2D(texture, vec2(uv.x, uv.y + rand1x * amount));\n                        }\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("interference",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.seed,t.seed),this.ctx.uniform1f(e.uniform.amount,t.amount/15),this.ctx.uniform1i(e.uniform.direction,t.direction?1:0),this.draw(e)}bleed(t){let e=this.compiledProgram.get("bleed");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float block;\n                uniform float amplitude;\n              \n                float rand(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + rand(sd) * (max - min);\n                }\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n\n                float noise(vec2 uv, float blockiness){   \n                    vec2 lv = fract(uv);\n                    vec2 id = floor(uv);\n                    \n                    float n1 = rand(id);\n                    float n2 = rand(id+vec2(1,0));\n                    float n3 = rand(id+vec2(0,1));\n                    float n4 = rand(id+vec2(1,1));\n                    \n                    vec2 u = smoothstep(0.0, 1.0 + blockiness, lv);\n\n                    return mix(mix(n1, n2, u.x), mix(n3, n4, u.x), u.y);\n                }\n\n                float fbm(vec2 uv, int count, float blockiness, float complexity) {\n                    float val = 0.0;\n                    float amp = 0.5;\n                    \n                    for (int i = 0; i < 1000; i++) {\n                        if(i == count) break;\n                        \n                        val += amp * noise(uv, blockiness);\n                        amp *= 0.5;\n                        uv *= complexity;    \n                    }  \n                    return val;\n                }\n\n                const float shift = 2.0; //2\n\n                void main()\n                {\n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 20.0; i += 1.0) {\n\n                        float sliceY = rand(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = rand(vec2(seed, 3234.0 + float(i)));\n\n                        float sliceH = rand(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = rand(vec2(seed, 3234.0 + float(i))) * 1.5;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0){\n                           \n                            vec2 id = floor(uv * 5.0);\n        \n                            // Generate shift amplitude\n                            float shift = amplitude * fbm(uv, int(id * 6.), shift, block);\n                            //float shift = randomRange(vec2(seed, 5234.0 + float(i)), -amplitude, amplitude);\n        \n                            float r = texture2D(texture, vec2(uv.x + shift, uv.y)).r * (1. - shift) ;\n                            float g = texture2D(texture, vec2(uv.x - shift, uv.y)).g * (1. - shift) + rand(id) * shift;\n                            float b = texture2D(texture, vec2(uv.x - shift, uv.y)).b * (1. - shift);\n        \n                            px = mix(vec4(r, g, b, px.a), px, 0.5);\n                        }\n                        gl_FragColor = px;\n                    }\n                }";e=this.compileShader(t),this.compiledProgram.set("bleed",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.seed,t.seed),this.ctx.uniform1f(e.uniform.amplitude,t.amplitude),this.ctx.uniform1f(e.uniform.block,t.block),this.draw(e)}slice(t){let e=this.compiledProgram.get("slice");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float seed;\n                uniform float amount;\n                uniform float distance;\n                uniform int line;\n\n                //2D (returns 0 - 1)\n                float random2d(vec2 n) { \n                    return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);\n                }\n                float randomRange (in vec2 sd, in float min, in float max) {\n                    return min + random2d(sd) * (max - min);\n                }\n                \n                // return 1 if v inside 1d range\n                float insideRange(float v, float bottom, float top) {\n                   return step(bottom, v) - step(top, v);\n                }\n                  \n                void main() {\n                  \n                    vec4 px = texture2D(texture, uv);\n\n                    for (float i = 0.0; i < 100.0; i += 1.0) {\n\n                        if(i == amount) break;\n\n                        float sliceY = random2d(vec2(seed, 2035.0 + float(i)));\n                        float sliceX = random2d(vec2(seed, 5234.0 + float(i)));\n\n                        float sliceH = random2d(vec2(seed, 2035.0 - float(i))) * 0.1;\n                        float sliceW = random2d(vec2(seed, 5234.0 + float(i))) * 1.5;\n\n                        float hOffset = randomRange(vec2(seed, 2035.0 + float(i)), -distance*.5, distance*.5);\n                        float wOffset = randomRange(vec2(seed, 5234.0 + float(i)), -distance, distance);\n\n                        vec2 uvOff = uv;\n                        uvOff.x += wOffset;\n                        uvOff.y += hOffset;\n\n                        if(insideRange(uv.y, sliceY, fract(sliceY+sliceH)) == 1.0 && (line == 1 || insideRange(uv.x, sliceX, fract(sliceX+sliceW)) == 1.0)){\n                            px = texture2D(texture, uvOff);\n                        }\n                    }\n                    gl_FragColor = px;\n                }";e=this.compileShader(t),this.compiledProgram.set("slice",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.seed,t.seed),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1f(e.uniform.distance,t.distance/3),this.ctx.uniform1i(e.uniform.line,t.line?1:0),this.draw(e)}mimicHDR(t){let e=this.compiledProgram.get("mimicHDR");if(!e){const t="\n                precision highp float;\n\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform sampler2D blurMap;\n\n                uniform float amount;\n                uniform float contra;\n                \n                float blendSoftLight(float base, float blend) {\n                    return (blend<0.5)?(2.0*base*blend+base*base*(1.0-2.0*blend)):(sqrt(base)*(2.0*blend-1.0)+2.0*base*(1.0-blend));\n                }\n                vec4 blendSoftLight(vec4 base, vec4 blend) {\n                    return vec4(blendSoftLight(base.r,blend.r),blendSoftLight(base.g,blend.g),blendSoftLight(base.b,blend.b), base.a);\n                }\n\n                float blendOverlay(float base, float blend) {\n                    return base<0.5?(2.0*base*blend):(1.0-2.0*(1.0-base)*(1.0-blend));\n                }\n                vec4 blendOverlay(vec4 base, vec4 blend) {\n                    return vec4(blendOverlay(base.r,blend.r),blendOverlay(base.g,blend.g),blendOverlay(base.b,blend.b), base.a);\n                }\n               \n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    vec4 blur = texture2D(blurMap, uv);\n\n                    vec4 blend = blendOverlay(px, blur);\n                    blend = mix(blend, blendSoftLight(px, blend), contra);\n\n                    gl_FragColor = mix(px, blend, amount);\n                }";e=this.compileShader(t),this.compiledProgram.set("mimicHDR",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1f(e.uniform.contra,t.contra);let i=e.getTextureById("blurMap");i.createTexture(this.ctx,t.blurMap.width,t.blurMap.height),i.uploadData(this.ctx,t.blurMap),this.draw(e)}pixelate(t){let e=this.compiledProgram.get("pixelate");if(!e){const t="\n                precision highp float;\n                varying vec2 uv;\n                uniform vec2 resolution;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    float d = 1.0 / amount;\n                    float ar = resolution.x / resolution.y;\n                    float u = floor( uv.x / d ) * d + d*0.5;\n                    d = ar / amount;\n                    float v = floor( uv.y / d ) * d + d*0.5;\n                    gl_FragColor = texture2D(texture, vec2( u, v ) );\n                }";e=this.compileShader(t),this.compiledProgram.set("pixelate",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,4*(100-100*t)),this.ctx.uniform2f(e.uniform.resolution,this.width,this.height),this.draw(e)}scanlines(t){let e=this.compiledProgram.get("scanlines");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float size;\n\n                uniform int colorize;\n                uniform int direction;\n\n                void main() {\n                    \n                    vec2 sl;\n                    vec4 scanlines;\n                    vec4 color = texture2D(texture, uv);\n\n                    if(direction == 0) {\n                        sl = vec2(sin(uv.y * size), cos(uv.y * size)) * amount;\n                    }\n                    else {\n                        sl = vec2(sin(uv.x * size), cos(uv.x * size)) * amount;\n                    }\n\n                    if(colorize == 1) {\n                        scanlines = vec4(sl.x, sl.y, sl.x, 1.0);\n                    } \n                    else {\n                        scanlines = vec4(sl.x, sl.x, sl.x, 1.0);\n                    }\n\n                    gl_FragColor = vec4(color.r + scanlines.r, color.g + scanlines.g, color.b + scanlines.b, color.a);\n                }";e=this.compileShader(t),this.compiledProgram.set("scanlines",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,t.direction?Math.round(this.height/t.size):Math.round(this.width/t.size)),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform1i(e.uniform.colorize,t.colorize?1:0),this.ctx.uniform1i(e.uniform.direction,t.direction?1:0),this.draw(e)}mosaic(t){let e=this.compiledProgram.get("mosaic");if(!e){const t="\n                precision highp float;\n                varying vec2 uv;\n                \n                uniform sampler2D texture;\n                uniform vec2 num;\n                \n                void main()\n                {\n                    vec2 uv = uv;\n                    vec2 uv2 = floor(uv*num)/num;\n                    uv -= uv2;\n                    uv *= num;\n                    gl_FragColor = texture2D(texture, \n                                    uv2 + vec2(step(1.0-uv.y,uv.x)/(2.0*num.x),\n                                    step(uv.x,uv.y)/(2.0*num.y)));\n                }";e=this.compileShader(t),this.compiledProgram.set("mosaic",e)}let i=Math.round(100*(1-t)),s=Math.round(this.height/this.width*i);this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.num,i,s),this.draw(e)}bokeh(t){let e=this.compiledProgram.get("bokeh-"+t.type);if(!e){let i="";switch(t.type){case"circle":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);                          \n                            float rc = 0.0;\n\n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    float l = length(vec2(x-spread,y-spread));\n                                    if(l <= spread)\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"square":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg = vec3(0.0);\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                    mcol = max(mcol, col);\n                                    avg += col;\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / (myx * myx), mcol, amount), 1.0);\n                        }";break;case"hexagon":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define PI 3.1415926538\n                        #define PI2 6.283185308\n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n                            float myx = spread*2.0;\n\n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    vec2 pt = vec2(x-spread, y-spread);\n        \n                                    float an = 0.33 + atan(pt.x, pt.y); //0.33 Angle\n                                    float ngon = cos(an - (PI2 * floor((PI + 6.0 * an) / PI2)) / 6.0) / cos(PI / 6.0); //6 corners\n                                    float ngonSdf = ngon * length(pt) - spread;\n                            \n                                    if(ngonSdf <= 0.0) {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread, y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }";break;case"cross":i="\n                        precision highp float;\n                        varying vec2 uv;\n                        uniform sampler2D texture;\n                        uniform float amount;\n                        uniform float size;\n                        uniform vec2 px;\n                        \n                        #define KNL 100.0\n\n                        void main() {\n\n                            float spread = floor(size*30.0 + 0.5) + 1.0;\n        \n                            vec3 mcol = vec3(0.0);\n                            vec3 avg  = vec3(0.0);\n                            float rc = 0.0;\n        \n                            float myx = spread*2.0;\n                            float low = spread*.7;\n                            float high = spread*1.3;\n        \n                            for(float x = 0.0; x < KNL; x += 1.0)\n                            {\n                                if(x == myx) break;\n        \n                                for(float y = 0.0; y < KNL; y += 1.0)\n                                {\n                                    if(y == myx) break;\n        \n                                    if((y > low && y < high) || (x > low && x < high))\n                                    {\n                                        vec3 col = texture2D(texture, uv + px * vec2(x-spread,y-spread) * 2.0).rgb;\n                                        mcol = max(mcol, col);\n                                        avg += col;\n                                        rc += 1.0;\n                                    }\n                                }\n                            }\n                            gl_FragColor = vec4(mix(avg / rc, mcol, amount), 1.0);\n                        }"}e=this.compileShader(i),this.compiledProgram.set("bokeh-"+t.type,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.size,t.size),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform2f(e.uniform.px,1/this.width,1/this.height),this.draw(e)}art(t){let e=this.compiledProgram.get("art");if(!e){let t=["precision highp float;","uniform sampler2D texture;","varying vec2 uv;","void main() {","vec4 color, tmp, add;","vec2 uv = uv + vec2( sin( uv.y * 100.0 ), sin( uv.x * 100.0 )) * 0.0005;","color = texture2D( texture, uv );","add = tmp = texture2D( texture, uv + vec2( 0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, 0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.0015, -0.0015 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( -0.002, 0.0 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, 0.002 ));","if( tmp.r < color.r ) color = tmp;","add += tmp = texture2D( texture, uv + vec2( 0, -0.002 ));","if( tmp.r < color.r ) color = tmp;","uv = (uv - vec2(0.5)) * vec2(0.7);","gl_FragColor = vec4(mix(color.rgb * color.rgb * vec3(1.8), color.ggg * color.ggg - vec3(0.4), vec3(dot(uv, uv))), 1.0);","}"].join("\n");e=this.compileShader(t),this.compiledProgram.set("art",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.screenWidth,this.canvas.width),this.ctx.uniform1f(e.uniform.screenHeight,this.canvas.height),this.ctx.uniform1f(e.uniform.sampleDistance,t),this.ctx.uniform1f(e.uniform.waveFactor,.01),this.draw(e)}melt(t){let e=this.compiledProgram.get("melt");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 center;\n              \n                float rand(vec2 co){\n                    return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n                }\n                vec3 mod289(vec3 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec2 mod289(vec2 x) {\n                    return x - floor(x * (1.0 / 289.0)) * 289.0;\n                }\n                  \n                vec3 permute(vec3 x) {\n                    return mod289(((x*34.0)+1.0)*x);\n                }\n                  \n                float snoise(vec2 v) {\n\n                    const vec4 C = vec4(0.211324865405187,  // (3.0-sqrt(3.0))/6.0\n                                        0.366025403784439,  // 0.5*(sqrt(3.0)-1.0)\n                                       -0.577350269189626,  // -1.0 + 2.0 * C.x\n                                        0.024390243902439); // 1.0 / 41.0\n                  // First corner\n                    vec2 i  = floor(v + dot(v, C.yy) );\n                    vec2 x0 = v -   i + dot(i, C.xx);\n                  \n                  // Other corners\n                    vec2 i1;\n                    i1 = (x0.x > x0.y) ? vec2(1.0, 0.0) : vec2(0.0, 1.0);\n                    vec4 x12 = x0.xyxy + C.xxzz;\n                    x12.xy -= i1;\n                  \n                  // Permutations\n                    i = mod289(i); // Avoid truncation effects in permutation\n                    vec3 p = permute( permute( i.y + vec3(0.0, i1.y, 1.0 ))\n                          + i.x + vec3(0.0, i1.x, 1.0 ));\n                  \n                    vec3 m = max(0.5 - vec3(dot(x0,x0), dot(x12.xy,x12.xy), dot(x12.zw,x12.zw)), 0.0);\n                    m = m*m ;\n                    m = m*m ;\n                                   \n                    vec3 x = 2.0 * fract(p * C.www) - 1.0;\n                    vec3 h = abs(x) - 0.5;\n                    vec3 ox = floor(x + 0.5);\n                    vec3 a0 = x - ox;\n                  \n                    m *= 1.79284291400159 - 0.85373472095314 * ( a0*a0 + h*h );\n                  \n                  // Compute final noise value at P\n                    vec3 g;\n                    g.x  = a0.x  * x0.x  + h.x  * x0.y;\n                    g.yz = a0.yz * x12.xz + h.yz * x12.yw;\n                    return 130.0 * dot(m, g);\n                }\n\n                void main() {\n                    vec4 px = texture2D(texture, uv);\n                    \n                    float opacity = 0.0;\n\n                    if(amount == 0.0 || amount == 1.0) {\n                        opacity = amount;\n                    } \n                    else {\n                        if(center.x == 0.5) {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(uv.x, 0.0)));\n                            float r = amount - rand(vec2(uv.x, 0.1));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }\n                        else {\n                            float dist = distance(center, uv)- amount*exp(snoise(vec2(0.0, uv.y)));\n                            float r = amount - rand(vec2(0.1, uv.y));\n                            opacity = dist <= r ? 1.0 : (amount*amount*amount);\n                        }   \n                    }\n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";e=this.compileShader(t),this.compiledProgram.set("melt",e)}this.ctx.useProgram(e.program);let i=new s.Z(.5,.5);switch(t.direction){case"down":i.y=0;break;case"right":i.x=1;break;case"left":i.x=0;break;case"up":i.y=1}this.ctx.uniform2f(e.uniform.center,i.x,i.y),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}gooey(t){let e=this.compiledProgram.get("gooey");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                // http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\n                float random(vec2 co) {\n\n                    highp float a = 12.9898; //seed;\n                    highp float b = 78.233;\n                    highp float c = 43758.5453;\n                    highp float dt= dot(co.xy ,vec2(a,b));\n                    highp float sn= mod(dt,3.14);\n                    return fract(sin(sn) * c);\n                }\n\n                // 2D Noise based on Morgan McGuire @morgan3d\n                // https://www.shadertoy.com/view/4dS3Wd\n                float noise (in vec2 st) {\n\n                    vec2 i = floor(st);\n                    vec2 f = fract(st);\n\n                    // Four corners in 2D of a tile\n                    float a = random(i);\n                    float b = random(i + vec2(1.0, 0.0));\n                    float c = random(i + vec2(0.0, 1.0));\n                    float d = random(i + vec2(1.0, 1.0));\n\n                    // Cubic Hermine Curve.  Same as SmoothStep()\n                    vec2 u = f*f*(3.0-2.0*f);\n\n                    // Mix 4 coorners porcentages\n                    return mix(a, b, u.x) +\n                            (c - a)* u.y * (1.0 - u.x) +\n                            (d - b) * u.x * u.y;\n                }\n\n                void main() {\n\n                    vec4 col = texture2D(texture, uv);\n                    float n = noise(uv * 10.0); //scale\n                    \n                    float p = mix(-0.01, 1.0 + 0.01, amount);\n                    float lower = p - 0.01;\n                    float higher = p + 0.01;\n                    \n                    float opacity = smoothstep(lower, higher, n);\n                    \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";e=this.compileShader(t),this.compiledProgram.set("gooey",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}block(t){let e=this.compiledProgram.get("block");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                float rand (vec2 co) {\n                    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n                }\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                    \n                    float r = rand(floor(vec2(10.0) * uv)); //size\n                    float opacity = smoothstep(0.0, -0.5, r - (amount * (1.0 + 0.5)));\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }";e=this.compileShader(t),this.compiledProgram.set("block",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}curtain(t){let e=this.compiledProgram.get("curtain-"+t.direction);if(!e){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec2 p = uv;\n                    vec4 col = vec4(0);\n                ";"horizontal"===t.direction?i+="                    \n                        if(2.0 * abs(p.x-0.5) - amount > 0.0) {\n                            p = p + (p.x > 0.5 ? -1.0 : 1.0) * vec2(0.5*amount, 0.0);\n                            col = texture2D(texture, p);\n                        }\n                    ":i+="\n                        if(2.0 * abs(p.y-0.5) - amount > 0.0) {\n                            p = p + (p.y > 0.5 ? -1.0 : 1.0) * vec2(0.0, 0.5*amount);\n                            col = texture2D(texture, p);\n                        }\n                    ",i+="\n                    gl_FragColor = col;\n                }",e=this.compileShader(i),this.compiledProgram.set("curtain-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}blinds(t){let e=this.compiledProgram.get("blinds-"+t.direction);if(!e){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(t.direction){case"up":i+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.y) - amount * (1.0 + 0.5)), fract(12.0 * uv.y));";break;case"right":i+="float opacity = step(smoothstep(-0.5, 0.0, (1.0 - uv.x) - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"left":i+="float opacity = step(smoothstep(-0.5, 0.0, uv.x - amount * (1.0 + 0.5)), fract(12.0 * uv.x));";break;case"down":i+="float opacity = step(smoothstep(-0.5, 0.0, uv.y - amount * (1.0 + 0.5)), fract(12.0 * uv.y));"}i+="\n                    gl_FragColor = vec4(col.rgb, col.a * (1.0 - opacity));\n                }",e=this.compileShader(i),this.compiledProgram.set("blinds-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}wipe(t){let e=this.compiledProgram.get("wipe-"+t.direction);if(!e){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n              \n                void main() {\n                    vec4 col = texture2D(texture, uv);\n                ";switch(t.direction){case"down":i+="float opacity = 1.0 - step(uv.y, amount);";break;case"right":i+="float opacity = step(uv.x, 1.0 - amount);";break;case"left":i+="float opacity = 1.0 - step(uv.x, amount);";break;case"up":i+="float opacity = step(uv.y, 1.0 - amount);"}i+="\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",e=this.compileShader(i),this.compiledProgram.set("wipe-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}swipe(t){let e=this.compiledProgram.get("swipe-"+t.direction);if(!e){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec4 color; \n              \n                void main() {\n\n                ";switch(t.direction){case"down":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(1.0 + uv.y, amount*2.0));\n                        else gl_FragColor = step(uv.y, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"right":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(2.0 - uv.x, amount*2.0));\n                        else gl_FragColor = step(1.0 - uv.x, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"left":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(1.0 + uv.x, amount*2.0));\n                        else gl_FragColor = step(uv.x, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }";break;case"up":i+="\n                        if(amount > 0.5) gl_FragColor = vec4(color.rgb, 1.0 - step(2.0 - uv.y, amount*2.0));\n                        else gl_FragColor = step(1.0 - uv.y, amount*2.0) == 1.0 ? color : texture2D(texture, uv);\n                    }"}e=this.compileShader(i),this.compiledProgram.set("swipe-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.ctx.uniform4f(e.uniform.color,t.color.r/255,t.color.g/255,t.color.b/255,1),this.draw(e)}slot(t){let e=this.compiledProgram.get("slot");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                    vec2 f = fract(p);\n                    float opacity = step(0.0, p.y) * step(p.y, 1.0) * step(0.0, p.x) * step(p.x, 1.0);\n                   \n                    vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";e=this.compileShader(t),this.compiledProgram.set("slot",e)}let i=new s.Z(0,0);switch(t.direction){case"down":i.y=-1;break;case"right":i.x=1;break;case"left":i.x=-1;break;case"up":i.y=1}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.dir,i.x,i.y),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}marquee(t){let e=this.compiledProgram.get("marquee");if(!e){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform vec2 dir;\n\n                void main() {\n                   \n                    vec2 p = uv + amount * sign(dir);\n                ";switch(t.direction){case"up":i+="if(p.y < 0.0) p.y += 1.0;";break;case"down":i+="if(p.y > 1.0) p.y -= 1.0;";break;case"right":i+="if(p.x < 0.0) p.x += 1.0;";break;case"left":i+="if(p.x > 1.0) p.x -= 1.0;"}i+="\n         \n                    gl_FragColor = texture2D(texture, p);\n                }",e=this.compileShader(i),this.compiledProgram.set("marquee",e)}let i=new s.Z(0,0);switch(t.direction){case"up":i.y+=-1;break;case"down":i.y+=1;break;case"right":i.x+=-1;break;case"left":i.x+=1}this.ctx.useProgram(e.program),this.ctx.uniform2f(e.uniform.dir,i.x,i.y),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}split(t){let e=this.compiledProgram.get("split-"+t.direction);if(!e){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n                uniform float sections;\n\n                void main() {\n                    vec2 p = uv;\n                ";"horizontal"===t.direction?i+="float num = floor(uv.y*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.x = uv.x + amount*sign(odd-0.5);\n             \n                    float opacity = (p.x * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ":i+="float num = floor(uv.x*sections);\n                    float odd = num - (2.0 * floor(num/2.0));\n                    p.y = uv.y + amount*sign(odd-0.5);\n             \n                    float opacity = (p.y * (1.0-step(odd,0.5)*2.0) - sign(odd) > 0.0) ? 0.0 : 1.0;\n                    ",i+="vec4 col = texture2D(texture, p);\n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }",e=this.compileShader(i),this.compiledProgram.set("split-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.sections,t.sections),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}circular(t){let e=this.compiledProgram.get("circular");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                const float PI = 3.141592653589;\n\n                void main() {\n                    vec4 col = texture2D(texture, uv);\n\n                    vec2 p = uv*2.-1.;\n                    float opacity = smoothstep(0.0, 0.5, atan(p.y,p.x) - (amount-.5) * PI * 2.5);\n                   \n                    gl_FragColor = vec4(col.rgb, col.a * opacity);\n                }";e=this.compileShader(t),this.compiledProgram.set("circular",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}ripple(t){let e=this.compiledProgram.get("ripple");if(!e){let t="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n                    \n                    vec2 dir = uv - vec2(.5);\n                    float dist = length(dir);\n                    vec2 offset = dir * (sin(amount * dist * 100.0 - amount * 40.0) + 0.5) / 30.0; //100 amp 40 speed\n\n                    float opacity = smoothstep(0.2, 1.0, amount);\n\n                    vec4 px = texture2D(texture, uv + offset);                   \n                    gl_FragColor = vec4(px.rgb, px.a * (1.0 - opacity));\n                }";e=this.compileShader(t),this.compiledProgram.set("ripple",e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t),this.draw(e)}warp(t){let e=this.compiledProgram.get("warp-"+t.direction);if(!e){let i="\n                precision highp float;\n                varying vec2 uv;\n                uniform sampler2D texture;\n                uniform float amount;\n\n                void main() {\n            ";switch(t.direction){case"up":i+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"right":i+="float x = smoothstep(0.0, 1.0, (amount*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(1.0-x)+0.5);";break;case"left":i+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.x-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);";break;case"down":i+="float x = smoothstep(0.0, 1.0, ((1.0-amount)*2.0 + uv.y-1.0)); vec4 col = texture2D(texture, (uv-0.5)*(x)+0.5);"}i+="\n                gl_FragColor = vec4(col.rgb, col.a * (1.0 - amount));\n            }",e=this.compileShader(i),this.compiledProgram.set("warp-"+t.direction,e)}this.ctx.useProgram(e.program),this.ctx.uniform1f(e.uniform.amount,t.amount),this.draw(e)}cloneChain(){var t,e,i;const s=[];for(let n=0;n<this.chain.length;n++){const a=this.chain[n];let r;switch(a.type){case"curves":{const t=a.value,e=t.rgb.map((t=>t.clone())),i=t.red.map((t=>t.clone())),s=t.green.map((t=>t.clone())),n=t.blue.map((t=>t.clone()));r=new m.Z(t.scale,e,i,s,n);break}case"levels":{const t=a.value;r=new u.Z(t.minin,t.maxin,t.minout,t.maxout,t.midin,t.mid);break}case"toning":{const s=a.value;r=new l.Z(null===(t=s.highlight)||void 0===t?void 0:t.clone(),null===(e=s.midtone)||void 0===e?void 0:e.clone(),null===(i=s.shadow)||void 0===i?void 0:i.clone(),s.amount);break}case"fill":{const t=a.value;r=new c.Z(t.color.clone(),t.blend,t.amount);break}default:r=a.value}s.push(new g(a.type,r))}return s}}class g{constructor(t,e,i=!1){this.type=t,this.value=e,this.sidekick=i}}},82381:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t){this.id=t,this.texture=null}createTexture(t,e,i){this.texture=t.createTexture(),this.width=e,this.height=i}uploadData(t,e,i=t.NEAREST){t.bindTexture(t.TEXTURE_2D,this.texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,4),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)}setTexture(t){this.texture=t}destroy(t){t.deleteTexture(this.texture)}}},41721:(t,e,i)=>{i.d(e,{G:()=>d});var s=i(33655),n=i(99872),a=i(36817),r=i(43673),o=i(89679),c=i(78685),h=i(82282),l=i(51294);function d(t,e){var i,d,u,m;const p=new Date;switch(e.type){case"bitmapChange":{const t=e.layer,i=s.$E(e.layer.canvas,e.patchRect),n=t.rect?t.rect.clone():void 0;let r=s.dN(t.mask);if(e.patch){const i=e.rect,a=!!t.canvas;t.extendCanvas(i),a&&(e.patchRect.x+=n.x-t.rect.x,e.patchRect.y+=n.y-t.rect.y);if(t.canvas.getContext("2d").putImageData(e.patch,e.patchRect.x,e.patchRect.y),e.rect.width<t.rect.width||e.rect.height<t.rect.height){const n=s.vL(e.rect.width,e.rect.height);n.getContext("2d").drawImage(t.canvas,t.rect.x-e.rect.x,t.rect.y-e.rect.y),e.patchRect.x+=t.rect.x-i.x,e.patchRect.y+=t.rect.y-i.y,t.canvas=n,t.rect=i}}else t.canvas=null,t.rect=new a.Z(0,0,0,0);return e.mask&&(t.mask=e.mask),t.render(),e.layer.syncRequested=p,{type:"bitmapChange",layer:t,rect:n,kind:e.kind,patch:i,patchRect:e.patchRect.clone(),mask:r}}case"bitmapSwitch":{const t=e.layer,i=s.dN(e.layer.canvas),n=e.layer.trim?e.layer.trim.clone():e.layer.rect.clone();return t.switchCanvas(e.canvas,e.rect),t.render(),e.layer.syncRequested=p,{type:"bitmapSwitch",kind:e.kind,layer:t,rect:n,canvas:i}}case"selectionAndBitmapSwitch":{const n=e.layer,a=s.dN(e.layer.canvas),r=n.rect.clone();n.switchCanvas(e.canvas,e.rect),n.render(),e.layer.syncRequested=p;const o=s.dN(null===(i=null==t?void 0:t.selection)||void 0===i?void 0:i.mask);return e.selection?(t.addSelection(),t.selection.setMask(e.selection),{type:"selectionAndBitmapSwitch",kind:e.kind,selection:o,layer:n,rect:r,canvas:a}):(t.removeSelection(),{type:"selectionAndBitmapSwitch",kind:e.kind,selection:o,layer:n,rect:r,canvas:a})}case"addLayer":return t.layers.splice(e.order,0,e.layer),{type:"addLayer",kind:e.kind,layer:e.layer};case"deleteLayer":return t.deleteLayerById(e.layer.id),e;case"order":return t.changeLayerOrder(e.to,e.from),e;case"layerSettings":{const t=Object.assign({},e.layer.settings);return e.layer.settings=e.settings,e.layer.syncRequested=p,{type:"layerSettings",kind:e.kind,layer:e.layer,settings:t}}case"textChange":{const t=e.layer.text;return e.layer.setText(e.text),e.layer.syncRequested=p,{type:"textChange",layer:e.layer,text:t}}case"textSettings":{const t=e.layer.textSettings.clone();return e.layer.textSettings=e.settings,e.layer.textSettings.measureText(),e.layer.prepare(!0),e.layer.syncRequested=p,{type:"textSettings",kind:e.kind,layer:e.layer,settings:t}}case"background":{const i=t.color;return t.color=e.color,{type:"background",color:i}}case"mask":{let t;const i=e.layer.hasMask();if(!i&&e.patch&&e.layer.addMask(),e.patch){const n=e.layer.mask.getContext("2d");i&&(t=s.$E(e.layer.mask,new a.Z(e.rect.x,e.rect.y,e.patch.width,e.patch.height))),n.putImageData(e.patch,e.rect.x,e.rect.y)}else e.layer.removeMask();return e.layer.render(),e.layer.syncRequested=p,{type:"mask",layer:e.layer,rect:e.rect,patch:t}}case"maskInvert":return e.layer.invertMask(),e.layer.render(),e.layer.syncRequested=p,{type:"maskInvert",layer:e.layer};case"adjust":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"adjust",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"glitch":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"glitch",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"effect":{let t,i;return e.tool.marked&&(t=e.tool.marked.name,i=e.tool.marked.value),e.tool.shaders.reset(),e.name?(e.tool.shaders.addPreset(e.name,e.value),e.tool.marked=new o.Z(e.name,e.value)):e.tool.marked=void 0,{type:"effect",layer:e.layer,kind:e.kind,tool:e.tool,name:t,value:i}}case"arrange":switch(e.layer.syncRequested=p,e.action.type){case"rect":{const t=e.layer.rect.clone();return e.layer.rect=e.action.rect,e.layer instanceof c.Z&&(t.height=e.layer.textSettings.size,e.layer.rect.height!==e.layer.textSettings.size&&e.layer.setTextSize(e.layer.rect.height)),e.layer instanceof l.Z&&e.layer.trimOnResize(t),e.layer instanceof h.Z||e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"rect",rect:t}}}case"trim":{const t=e.layer.trim.clone();return e.layer.trim=e.action.rect,e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"trim",rect:t}}}case"trans":{const t=s.dN(e.layer.canvas),i=s.dN(e.layer.mask),n=e.layer.rect.clone();return e.layer.canvas=e.action.data,e.layer.mask=e.action.mask,e.layer.rect=e.action.rect,e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"trans",data:t,mask:i,rect:n}}}}case"arrangeStack":{let t=e.stack,i=e.rects,s=new Array;for(let e=0;e<t.length;e++){let n=t[e],a=n.rect?n.rect.clone():void 0;n.rect=i[e],n instanceof c.Z&&(a.height=n.textSettings.size,n.rect.height!==n.textSettings.size&&n.setTextSize(n.rect.height)),n instanceof l.Z&&n.trimOnResize(a),s.push(a),n.syncRequested=p,n.render()}return{type:"arrangeStack",id:e.id,kind:"arrange",stack:e.stack,rects:s}}case"link":{let t=e.stack,i=new Array;for(let e=0;e<t.length;e++)i.push({layer:t[e].layer,link:null!==(d=t[e].layer.settings.link)&&void 0!==d?d:""}),t[e].layer.settings.link=t[e].link,t[e].layer.syncRequested=p;return{type:"link",kind:e.kind,stack:i}}case"flipLayer":return e.layer.flip(e.vertical),e.layer.render(),e.layer.syncRequested=p,{type:"flipLayer",layer:e.layer,vertical:e.vertical};case"rotateLayer":return e.layer.rotate(!e.counterClock),e.layer.render(),e.layer.syncRequested=p,{type:"rotateLayer",layer:e.layer,counterClock:!e.counterClock};case"crop":{const i=new r.Z(-e.offset.x,-e.offset.y),o=new n.Z(t.width,t.height);let c;if(t.crop(new a.Z(e.offset.x,e.offset.y,e.size.width,e.size.height)),e.straighten){const i=t.layers[0];c=s.dN(i.canvas),i.syncRequested=p,i.canvas=e.straighten,i.rect=new a.Z(0,0,i.canvas.width,i.canvas.height),t.width=i.rect.width,t.height=i.rect.height}return t.layers.forEach((t=>t.syncRequested=p)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:i,size:o,straighten:c}}case"pageSize":{const i=new n.Z(t.width,t.height);return t.size(e.size.width,e.size.height,!1,e.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:e.anchor,size:i}}case"pageResize":{const i=new n.Z(t.width,t.height),s=t.layers.map((t=>t.clone(!0)));t.width=e.size.width,t.height=e.size.height;for(let n=0;n<e.layers.length;n++){const i=e.layers[n];i.syncRequested=p,t.replaceLayer(i),i.render()}return t.selection&&t.selection.resize(t.width,t.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:i,layers:s}}case"flip":return t.flip(e.vertical),t.layers.forEach((t=>t.syncRequested=p)),{type:"flip",vertical:e.vertical};case"rotate":return t.rotate(e.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),t.layers.forEach((t=>t.syncRequested=p)),{type:"rotate",counterClock:e.counterClock};case"selectionChange":{const i=t.selection?s.dN(t.selection.mask):void 0;return e.selection?(t.addSelection(),t.selection.setMask(e.selection),Object.assign(Object.assign({},e),{selection:i})):(t.removeSelection(),Object.assign(Object.assign({},e),{selection:i}))}case"merge":{const i=e.from.map((e=>t.layers.find((t=>t.id===e.id)))),s=e.from,n=t.layers.map((t=>t.id));return t.layers=t.layers.filter((t=>!s.includes(t))),t.layers.splice(e.order,0,e.target),t.getSelected()&&!t.hasLayer(t.getSelected())&&t.selectLayerById(e.target.id),{type:"merge",kind:e.kind,target:e.target,order:n,layers:i}}case"rasterize":{const i=t.layers.findIndex((t=>t.id===e.newId));if(i<0)return;const[s]=t.layers.splice(i,1,e.layer);return(null===(u=null==t?void 0:t.getSelected())||void 0===u?void 0:u.id)===s.id&&t.selectLayerById(e.layer.id),{type:"rasterize",layer:s,kind:e.kind,newId:e.layer.id}}case"convertSelectionToMask":{const i=t.selection.mask;return e.layer.addMask(),e.layer.mask.getContext("2d").drawImage(t.selection.mask,-e.layer.rect.x,-e.layer.rect.y),e.layer.render(),t.removeSelection(),e.layer.syncRequested=p,{type:"convertSelectionToMask",layer:e.layer,selection:i}}case"convertMaskToSelection":{const i=e.layer.mask;return e.layer.removeMask(),t.addSelection(),t.selection.setMask(e.selection),e.layer.syncRequested=p,{type:"convertMaskToSelection",layer:e.layer,mask:i}}case"applyMask":{const t=e.layer.canvas,i=e.layer.mask;let s=e.layer.rect.clone();return e.layer.render(),e.layer.canvas=e.layer.baked,e.layer.removeMask(),e.layer.shrinkWrap(),e.layer.syncRequested=p,{type:"applyMask",layer:e.layer,canvas:t,mask:i,rect:s}}case"frameContent":{let t,i;return e.layer.canvas&&(t=s.dN(e.layer.canvas),i=null===(m=e.layer.trim)||void 0===m?void 0:m.clone()),e.layer.canvas=e.canvas,e.layer.trim=e.trim,e.layer instanceof l.Z&&e.layer.render(),{type:"frameContent",kind:e.kind,layer:e.layer,canvas:t,trim:i}}case"frameSettings":{const t=e.layer.frameSettings.clone();return e.layer.frameSettings=e.settings,e.layer.prepare(),e.layer.syncRequested=p,{type:"frameSettings",kind:e.kind,layer:e.layer,settings:t}}case"shapeSettings":{const t=e.layer.shapeSettings.clone();return e.layer.shapeSettings=e.settings,e.layer.prepare(),e.layer.syncRequested=p,{type:"shapeSettings",kind:e.kind,layer:e.layer,settings:t}}case"groupSettings":{const t=e.layer.groupSettings.clone();return e.layer.groupSettings=e.settings,e.layer.syncRequested=p,{type:"groupSettings",kind:e.kind,layer:e.layer,settings:t}}case"pageAnimation":{const i=t.animation?t.animation:void 0;return t.animation=e.animation,{type:"pageAnimation",kind:e.kind,animation:i}}case"layerAnimation":{const t=e.layer.animation?e.layer.animation:void 0;return e.layer.animation=e.animation,e.layer.syncRequested=p,{type:"layerAnimation",kind:e.kind,layer:e.layer,animation:t}}default:throw new Error("No handler for this redo type")}}},45453:(t,e,i)=>{i.d(e,{N:()=>d});var s=i(96548),n=i(33655),a=i(71030),r=i(74820),o=i(93402),c=i(41721),h=i(72209),l=i(82282);class d{constructor(t,e,i=!1){this.fresco=t,this.undoStack=[],this.redoStack=[],this.ignore=!1,this.disable=()=>{this.ignore=!0},this.enable=()=>{this.ignore=!1},this.dispatchHistoryStatus=()=>{document.dispatchEvent(new CustomEvent("history-update",{detail:{atStart:this.undoStack.length<=1,atEnd:0===this.redoStack.length}}))},this.undo=()=>{if(!this.ignore&&0!==this.undoStack.length&&"open"!==this.undoStack[this.undoStack.length-1].data.type)try{this.ignore=!0;const{local:t,data:e}=this.undoStack.pop(),i=(0,o.c)(this.fresco,e);i&&(this.redoStack.push({local:t,data:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,a.Z)("undo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleUndo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),this.dispatchHistoryStatus()}finally{this.ignore=!1}},this.redo=()=>{if(!this.ignore&&0!==this.redoStack.length)try{this.ignore=!0;const{local:t,data:e}=this.redoStack.pop(),i=(0,c.G)(this.fresco,e);i&&(this.undoStack.push({local:t,data:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),(0,a.Z)("redo")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleRedo")})),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,this.dispatchHistoryStatus()}},this.hasChanges=()=>this.undoStack.length>1||this.redoStack.length>0,this.getActiveTransaction=()=>this.transaction,this.redos=t=>this.redoStack.filter((e=>e.local===t)).reverse().map((t=>t.data)),this.undos=t=>this.undoStack.filter((e=>e.local===t)).map((t=>t.data)),this.add=t=>{if(this.ignore)return;if(!(0,h.g)(this.fresco,t))return;this.validateTransaction(t);const e=r.ZP.maxHistoryUndos;!this.transaction&&this.undoStack.length>=e&&(this.undoStack=this.undoStack.slice(this.undoStack.length+1-e)),this.undoStack.push({local:!!this.transaction,data:t}),this.redoStack=[],this.dispatchHistoryStatus(),"open"!==t.type&&document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),(this.undoStack.length<1||!this.undoStack[this.undoStack.length-1].local)&&document.dispatchEvent(new CustomEvent("layer-list-render"))},this.validateTransaction=t=>{if("arrange"===t.type||"arrangeStack"===t.type||"adjust"===t.type||"glitch"===t.type||"effect"===t.type||"textSettings"===t.type||"frameSettings"===t.type||"shapeSettings"===t.type||"pageAnimation"===t.type||"layerAnimation"===t.type){const e="pageAnimation"===t.type?"page":"arrangeStack"===t.type?t.id:t.layer.id;this.transaction&&this.transaction.id!==t.type+"-"+e&&this.commitTransaction(!0),this.transaction||(this.transaction={id:t.type+"-"+e,type:t.type})}else this.commitTransaction(!0)},this.abortTransaction=()=>{this.transaction&&(this.transaction=void 0,this.redoStack=this.redoStack.filter((t=>!t.local)),this.undoStack=this.undoStack.filter((t=>!t.local)),this.dispatchHistoryStatus())},this.commitTransaction=(t=!1)=>{if(!this.transaction)return;const e=new Date;this.transaction=void 0;const i=this.undoStack.filter((t=>t.local));if(0===i.length)return;this.undoStack=this.undoStack.filter((t=>!t.local)),this.redoStack=[];let s=i[0].data,a=!1;switch(s.type){case"arrange":{const t=s.layer,i=s.action.rect;if(t instanceof l.Z&&t.wouldApplyTransform()){const e=n.dN(t.canvas),s=n.dN(t.mask);t.applyTransform(r.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:t,action:{type:"trans",data:e,mask:s,rect:i}}})}else this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:t,action:{type:"rect",rect:i}}});t.syncRequested=e,a=!0;break}case"arrangeStack":{let t=s.stack,i=s.rects,o=Array(),c=Array();for(let s=0;s<t.length;s++){let a=t[s],h=i[s];if(a instanceof l.Z&&a.wouldApplyTransform()){const t=n.dN(a.canvas),e=n.dN(a.mask);a.applyTransform(r.ZP.smoothScaling),this.undoStack.push({local:!1,data:{type:"arrange",kind:"transform",layer:a,action:{type:"trans",data:t,mask:e,rect:h}}})}else o.push(a),c.push(h);a.syncRequested=e}o.length>1?this.undoStack.push({local:!1,data:{type:"arrangeStack",id:s.id,kind:"arrange",stack:o,rects:c}}):1===o.length&&this.undoStack.push({local:!1,data:{type:"arrange",kind:"arrange",layer:o[0],action:{type:"rect",rect:c[0]}}}),a=!0;break}case"glitch":case"effect":case"adjust":break;case"textSettings":{const t=s.layer,i=s.settings;this.undoStack.push({local:!1,data:{type:"textSettings",kind:"settings",layer:t,settings:i}}),t.syncRequested=e,a=!0;break}case"frameSettings":{const t=s.layer,i=s.settings;this.undoStack.push({local:!1,data:{type:"frameSettings",kind:"settings",layer:t,settings:i}}),t.syncRequested=e,a=!0;break}case"shapeSettings":{const t=s.layer,i=s.settings;this.undoStack.push({local:!1,data:{type:"shapeSettings",kind:"settings",layer:t,settings:i}}),t.syncRequested=e,a=!0;break}case"pageAnimation":{const t=s.animation;this.undoStack.push({local:!1,data:{type:"pageAnimation",kind:"",animation:t}}),a=!0;break}case"layerAnimation":{const t=s.layer,i=s.animation;this.undoStack.push({local:!1,data:{type:"layerAnimation",kind:"",layer:t,animation:i}}),t.syncRequested=e,a=!0;break}}a&&!t&&(document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("layer-list-render"))),this.dispatchHistoryStatus()},i?this.ignore=!0:(this.add({type:"open",kind:e}),this.dispatchHistoryStatus())}jump(t){if(!this.ignore&&0!==t)try{if(this.ignore=!0,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!1})),t<0){const e=Math.min(this.undoStack.length,Math.abs(t));for(let t=0;t<e;t++){const{local:t,data:e}=this.undoStack.pop(),i=(0,o.c)(this.fresco,e);i&&this.redoStack.push({local:t,data:i})}e>0&&((0,a.Z)("undo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleUndo")})))}else{const e=Math.min(this.redoStack.length,t);for(let t=0;t<e;t++){const{local:t,data:e}=this.redoStack.pop(),i=(0,c.G)(this.fresco,e);i&&this.undoStack.push({local:t,data:i})}e>0&&((0,a.Z)("redo"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("titleRedo")})))}document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco}))}finally{this.ignore=!1,document.dispatchEvent(new CustomEvent("render-enabled",{detail:!0})),this.dispatchHistoryStatus()}}}},93402:(t,e,i)=>{i.d(e,{c:()=>d});var s=i(33655),n=i(99872),a=i(36817),r=i(43673),o=i(89679),c=i(78685),h=i(82282),l=i(51294);function d(t,e){var i,d,u,m,p;const g=new Date;switch(e.type){case"bitmapChange":{if(!t.hasLayer(e.layer))return;const i=e.layer,n=i.rect?i.rect.clone():void 0;let r,o=s.dN(i.mask);if(i.canvas){r=i.canvas.getContext("2d").getImageData(e.patchRect.x,e.patchRect.y,e.patchRect.width,e.patchRect.height)}if(e.patch){const t=e.rect,a=!!i.canvas;i.extendCanvas(t);const r=i.canvas.getContext("2d");if(a&&(e.patchRect.x+=n.x-i.rect.x,e.patchRect.y+=n.y-i.rect.y),r.putImageData(e.patch,e.patchRect.x,e.patchRect.y),e.rect.width<i.rect.width||e.rect.height<i.rect.height){const n=s.vL(e.rect.width,e.rect.height);n.getContext("2d").drawImage(i.canvas,i.rect.x-e.rect.x,i.rect.y-e.rect.y),e.patchRect.x+=i.rect.x-t.x,e.patchRect.y+=i.rect.y-t.y,i.canvas=n,i.rect=t}}else i.canvas=null,i.rect=new a.Z(0,0,0,0);return e.mask&&(i.mask=e.mask),i.render(),e.layer.syncRequested=g,{type:"bitmapChange",kind:e.kind,layer:i,rect:n,patch:r,patchRect:e.patchRect.clone(),mask:o}}case"bitmapSwitch":{const t=s.dN(e.layer.canvas),i=e.layer.trim?e.layer.trim.clone():e.layer.rect.clone();return e.layer.switchCanvas(e.canvas,e.rect),e.layer.render(),e.layer.syncRequested=g,{type:"bitmapSwitch",kind:e.kind,layer:e.layer,rect:i,canvas:t}}case"selectionAndBitmapSwitch":{const n=s.dN(e.layer.canvas),a=e.layer.rect.clone();e.layer.switchCanvas(e.canvas,e.rect),e.layer.render(),e.layer.syncRequested=g;const r=s.dN(null===(i=null==t?void 0:t.selection)||void 0===i?void 0:i.mask);return t.addSelection(),t.selection.setMask(e.selection),{type:"selectionAndBitmapSwitch",kind:e.kind,selection:r,layer:e.layer,rect:a,canvas:n}}case"addLayer":{const i=t.layerNr(e.layer.id),s=t.deleteLayerById(e.layer.id);return{type:"addLayer",kind:e.kind,layer:s,order:i}}case"deleteLayer":return t.layers.splice(e.index,0,e.layer),e;case"order":return t.changeLayerOrder(e.to,e.from),e;case"layerSettings":{const t=Object.assign({},e.layer.settings);return e.layer.settings=e.settings,e.layer.syncRequested=g,{type:"layerSettings",kind:e.kind,layer:e.layer,settings:t}}case"textChange":{const t=e.layer.text;return e.layer.setText(e.text),e.layer.syncRequested=g,{type:"textChange",layer:e.layer,text:t}}case"textSettings":{const t=e.layer.textSettings.clone();return e.layer.textSettings=e.settings,e.layer.textSettings.measureText(),e.layer.prepare(!0),e.layer.syncRequested=g,{type:"textSettings",kind:e.kind,layer:e.layer,settings:t}}case"background":{const i=t.color;return t.color=e.color,{type:"background",color:i}}case"mask":{const t=e.layer;let i;const s=t.hasMask();if(!s&&e.patch&&e.layer.addMask(),e.patch){const n=e.patch,a=t.mask.getContext("2d");s&&(i=a.getImageData(e.rect.x,e.rect.y,e.rect.width,e.rect.height)),a.putImageData(n,e.rect.x,e.rect.y)}else{if(s){i=t.mask.getContext("2d").getImageData(0,0,t.mask.width,t.mask.height)}e.layer.removeMask()}return t.render(),e.layer.syncRequested=g,{type:"mask",layer:t,rect:e.patch&&e.rect?e.rect:new a.Z(0,0,t.canvas.width,t.canvas.height),patch:i}}case"maskInvert":return e.layer.invertMask(),e.layer.render(),e.layer.syncRequested=g,{type:"maskInvert",layer:e.layer};case"adjust":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"adjust",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"glitch":{const t=e.shaders.cloneChain();return e.shaders.chain=e.chain,{type:"glitch",layer:e.layer,kind:e.kind,chain:t,shaders:e.shaders}}case"effect":{let t,i;return e.tool.marked&&(t=e.tool.marked.name,i=e.tool.marked.value),e.tool.shaders.reset(),e.name?(e.tool.shaders.addPreset(e.name,e.value),e.tool.marked=new o.Z(e.name,e.value)):e.tool.marked=void 0,{type:"effect",layer:e.layer,kind:e.kind,tool:e.tool,name:t,value:i}}case"arrange":switch(e.layer.syncRequested=g,e.action.type){case"rect":{const t=e.layer.rect.clone();return e.layer.rect=e.action.rect,e.layer instanceof c.Z&&(t.height=e.layer.textSettings.size,e.layer.rect.height!==e.layer.textSettings.size&&e.layer.setTextSize(e.layer.rect.height)),e.layer instanceof l.Z&&e.layer.trimOnResize(t),e.layer instanceof h.Z||e.layer.render(),{type:"arrange",kind:e.kind,action:{type:"rect",rect:t},layer:e.layer}}case"trim":{const t=e.layer.trim.clone();return e.layer.trim=e.action.rect,e.layer.render(),{type:"arrange",kind:e.kind,action:{type:"trim",rect:t},layer:e.layer}}case"trans":{const t=s.dN(e.layer.canvas),i=s.dN(e.layer.mask),n=e.layer.rect.clone();return e.layer.canvas=e.action.data,e.layer.mask=e.action.mask,e.layer.rect=e.action.rect,e.layer.render(),{type:"arrange",layer:e.layer,kind:e.kind,action:{type:"trans",data:t,mask:i,rect:n}}}}case"arrangeStack":{let t=e.stack,i=e.rects,s=new Array;for(let e=0;e<t.length;e++){let n=t[e],a=n.rect?n.rect.clone():void 0;n.rect=i[e],n instanceof c.Z&&(a.height=n.textSettings.size,n.rect.height!==n.textSettings.size&&n.setTextSize(n.rect.height)),n instanceof l.Z&&n.trimOnResize(a),s.push(a),n.syncRequested=g,n.render()}return{type:"arrangeStack",id:e.id,kind:"arrange",stack:e.stack,rects:s}}case"link":{let t=e.stack,i=new Array;for(let e=0;e<t.length;e++)i.push({layer:t[e].layer,link:null!==(d=t[e].layer.settings.link)&&void 0!==d?d:""}),t[e].layer.settings.link=t[e].link,t[e].layer.syncRequested=g;return{type:"link",kind:e.kind,stack:i}}case"flipLayer":return e.layer.flip(e.vertical),e.layer.render(),e.layer.syncRequested=g,{type:"flipLayer",layer:e.layer,vertical:e.vertical};case"rotateLayer":return e.layer.rotate(!e.counterClock),e.layer.render(),e.layer.syncRequested=g,{type:"rotateLayer",layer:e.layer,counterClock:!e.counterClock};case"crop":{const i=new r.Z(-e.offset.x,-e.offset.y),o=new n.Z(t.width,t.height);let c;if(t.crop(new a.Z(e.offset.x,e.offset.y,e.size.width,e.size.height)),e.straighten){const i=t.layers[0];c=s.dN(i.canvas),i.syncRequested=g,i.canvas=e.straighten,i.rect=new a.Z(0,0,i.canvas.width,i.canvas.height),t.width=i.rect.width,t.height=i.rect.height}return t.layers.forEach((t=>t.syncRequested=g)),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"crop",offset:i,size:o,straighten:c}}case"pageSize":{const i=new n.Z(t.width,t.height);return t.size(e.size.width,e.size.height,!1,e.anchor),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageSize",anchor:e.anchor,size:i}}case"pageResize":{const i=new n.Z(t.width,t.height),s=t.layers.map((t=>t.clone(!0)));t.width=e.size.width,t.height=e.size.height;for(let n=0;n<e.layers.length;n++){const i=e.layers[n];i.syncRequested=g,t.replaceLayer(i),i.render()}return t.selection&&t.selection.resize(t.width,t.height),document.dispatchEvent(new CustomEvent("reset-viewport")),{type:"pageResize",size:i,layers:s}}case"flip":return t.flip(e.vertical),t.layers.forEach((t=>t.syncRequested=g)),{type:"flip",vertical:e.vertical};case"rotate":return t.rotate(!e.counterClock),document.dispatchEvent(new CustomEvent("reset-viewport")),t.layers.forEach((t=>t.syncRequested=g)),{type:"rotate",counterClock:e.counterClock};case"selectionChange":{const i=t.selection?s.dN(t.selection.mask):void 0;return e.selection?(t.addSelection(),t.selection.setMask(e.selection),Object.assign(Object.assign({},e),{selection:i})):(t.removeSelection(),Object.assign(Object.assign({},e),{selection:i}))}case"merge":{const i=t.layers.findIndex((t=>t===e.target));if(i<0)return;const[s]=t.layers.splice(i,1);return e.layers.forEach((i=>{const s=e.order.findIndex((t=>t===i.id));s<0?t.layers.push(i):t.layers.splice(s,0,i)})),t.getSelected()&&!t.hasLayer(t.getSelected())&&t.selectLayerById(e.layers[0].id),{type:"merge",kind:e.kind,target:s,from:e.layers,order:i}}case"rasterize":{const i=t.layers.findIndex((t=>t.id===e.newId));if(i<0)return;const[s]=t.layers.splice(i,1,e.layer);return(null===(u=null==t?void 0:t.getSelected())||void 0===u?void 0:u.id)===s.id&&t.selectLayerById(e.layer.id),{type:"rasterize",layer:s,kind:e.kind,newId:e.layer.id}}case"convertSelectionToMask":{const i=e.layer.mask;return e.layer.removeMask(),e.layer.syncRequested=g,t.addSelection(),t.selection.mask=e.selection,t.selection.ctx=e.selection.getContext("2d"),t.selection.createOutline(),{type:"convertSelectionToMask",layer:e.layer,mask:i}}case"convertMaskToSelection":{const i=t.selection.mask;return t.removeSelection(),e.layer.mask=e.mask,e.layer.render(),e.layer.syncRequested=g,{type:"convertMaskToSelection",layer:e.layer,selection:i}}case"applyMask":return e.layer.canvas=e.canvas,e.layer.mask=e.mask,e.layer.rect=null===(m=e.rect)||void 0===m?void 0:m.clone(),e.layer.render(),e.layer.syncRequested=g,{type:"applyMask",layer:e.layer};case"frameContent":{let t,i;return e.layer.canvas&&(t=s.dN(e.layer.canvas),i=null===(p=e.layer.trim)||void 0===p?void 0:p.clone()),e.layer.canvas=e.canvas,e.layer.trim=e.trim,e.layer.render(),{type:"frameContent",kind:e.kind,layer:e.layer,canvas:t,trim:i}}case"frameSettings":{const t=e.layer.frameSettings.clone();return e.layer.frameSettings=e.settings,e.layer.prepare(),e.layer.syncRequested=g,{type:"frameSettings",kind:e.kind,layer:e.layer,settings:t}}case"shapeSettings":{const t=e.layer.shapeSettings.clone();return e.layer.shapeSettings=e.settings,e.layer.prepare(),e.layer.syncRequested=g,{type:"shapeSettings",kind:e.kind,layer:e.layer,settings:t}}case"groupSettings":{const t=e.layer.groupSettings.clone();return e.layer.groupSettings=e.settings,e.layer.syncRequested=g,{type:"groupSettings",kind:e.kind,layer:e.layer,settings:t}}case"pageAnimation":{const i=t.animation?t.animation:void 0;return t.animation=e.animation,{type:"pageAnimation",kind:e.kind,animation:i}}case"layerAnimation":{const t=e.layer.animation?e.layer.animation:void 0;return e.layer.animation=e.animation,e.layer.syncRequested=g,{type:"layerAnimation",kind:e.kind,layer:e.layer,animation:t}}default:throw new Error("No handler for this undo type")}}},72209:(t,e,i)=>{i.d(e,{g:()=>c});var s=i(71030),n=i(78685),a=i(51294),r=i(87108),o=i(77664);function c(t,e){const i=new Date;switch(e.type){case"open":return(0,s.Z)("open",e.kind),!0;case"addLayer":return(0,s.Z)("layer-add",e.layer.type),!0;case"bitmapSwitch":case"bitmapChange":return(0,s.Z)(e.kind),e.layer.syncRequested=i,!0;case"flipLayer":return(0,s.Z)("layer-flip"),e.layer.syncRequested=i,!0;case"rotateLayer":return(0,s.Z)("layer-rotate"),e.layer.syncRequested=i,!0;case"frameContent":return(0,s.Z)("frame-content"),e.layer.syncRequested=i,!0;case"frameSettings":return!e.layer.frameSettings.equalTo(e.settings)&&((0,s.Z)("frame-settings"),e.layer.syncRequested=i,!0);case"order":return(0,s.Z)("layer-order"),!0;case"layerSettings":return(0,s.Z)("layer-settings",e.kind),e.layer.syncRequested=i,!0;case"deleteLayer":return(0,s.Z)(e.layer.type+"-delete"),!0;case"textChange":return e.layer.text!==e.text&&((0,s.Z)("text-change"),e.layer.syncRequested=i,!0);case"textSettings":return!e.layer.textSettings.equalTo(e.settings)&&((0,s.Z)("text-settings"),e.layer.syncRequested=i,!0);case"shapeSettings":return!e.layer.shapeSettings.equalTo(e.settings)&&((0,s.Z)("shape-settings"),e.layer.syncRequested=i,!0);case"groupSettings":return!e.layer.groupSettings.equalTo(e.settings)&&((0,s.Z)("group-settings"),e.layer.syncRequested=i,!0);case"pageAnimation":return t.animation!==e.animation;case"layerAnimation":return e.layer.animation!==e.animation&&(e.layer.syncRequested=i,!0);case"mask":return(0,s.Z)("mask"),e.layer.syncRequested=i,!0;case"crop":return(0,s.Z)("crop"),t.layers.forEach((t=>t.syncRequested=i)),!0;case"background":return(0,s.Z)("background"),!0;case"maskInvert":return(0,s.Z)("mask-invert"),e.layer.syncRequested=i,!0;case"arrange":switch(e.action.type){case"rect":if(e.layer.rect.equalTo(e.action.rect))return!1;break;case"trim":if(e.layer.trim.equalTo(e.action.rect))return!1}return(0,s.Z)("arrange"),!0;case"arrangeStack":{let t=!1;for(let i=0;i<e.stack.length;i++)e.stack[i].rect&&!e.stack[i].rect.equalTo(e.rects[i])&&(t=!0);return(0,s.Z)("arrangeStack"),t}case"link":(0,s.Z)("link");for(let t=0;t<e.stack.length;t++)e.stack[t].layer.syncRequested=i;return!0;case"pageSize":return(0,s.Z)("page-size"),t.layers.forEach((t=>t.syncRequested=i)),!0;case"pageResize":return(0,s.Z)("page-resize"),e.layers.forEach((t=>t.syncRequested=i)),!0;case"flip":return(0,s.Z)("flip",e.vertical?"vertical":"horizontal"),t.layers.forEach((t=>t.syncRequested=i)),!0;case"rotate":return(0,s.Z)("rotate",e.counterClock?"left":"right"),t.layers.forEach((t=>t.syncRequested=i)),!0;case"merge":return(0,s.Z)("merge-layers",e.kind),!0;case"adjust":return(0,s.Z)("adjust",e.kind),!0;case"effect":return(0,s.Z)("effect",e.name),!0;case"glitch":return(0,s.Z)("glitch",e.kind),!0;case"selectionChange":case"selectionAndBitmapSwitch":return(0,s.Z)("selection",e.kind),!0;case"rasterize":return(0,s.Z)("rasterize",e.layer.type),e.layer instanceof o.Z||(e.layer instanceof n.Z||(e.layer instanceof a.Z||(e.layer instanceof r.Z||(console.warn("Tried to rasterize an unknown layer type"),!1))));case"convertSelectionToMask":return(0,s.Z)("selection-to-mask"),e.layer.syncRequested=i,!0;case"convertMaskToSelection":return(0,s.Z)("mask-to-selection"),e.layer.syncRequested=i,!0;case"applyMask":return(0,s.Z)("apply-mask"),e.layer.syncRequested=i,!0;default:return!1}}},96548:(t,e,i)=>{function s(t,...e){if(!I18N_STRINGS)return t;let i=I18N_STRINGS[t];if(i||(console.log("No translation for key",t),i=t),!e||0===e.length)return i;let s=0;return i.replace(/%(\d+\$)?(s|d|f){1}/gm,((t,...i)=>{const[n,a]=i,r=n?parseInt(n.slice(0,-1),10):s++;switch(a){case"d":const i=e[r];return"number"!=typeof i?"NaN":i.toFixed(0);case"s":const s=e[r];return s?s.toString():t;default:return t}}))}i.d(e,{Z:()=>s})},92672:(t,e,i)=>{i.d(e,{Z:()=>h});var s=i(98776),n=i(89679),a=i(94084),r=i(9389),o=i(71662),c=i(60134);class h{static init(){h.presets||(h.grouping={"black-white":["agnes","conny","gordon","harrison","henry","logan","olay","porter","sampi","tom","vinny"],friends:["aladin","alex","amber","anne","antonio","bob","greg","hagrid","harry","ivan","jean","josh","karen","lucas","melissa","peter","salomon","sara","sophia","tony"],instage:["borg","carl","coco","doris","doug","earl","sun","blues","country","lemonpell","tiny dc","minker"],retro:["vib","ranguit","rangeen","creamlow","sven","yenely","ragwarm","greered","danligter","garage"],tuning:["punch","bright","contrast","vivid","clairify"],portrait:["matte","deep","film","sunny","gritty"],food:["berry","ensalat","morning","corn","sharp"],urban:["cement","style","mold","shimmer","stalker","sham"],nature:["beach","flower","forest"],colors:["strawberry","clementine","pear","apple","blueberry","grapes","dragon","superone","tonola","reddish","fellowing","grassland","springs","justblues","bluesteel","flowerpot","stinker","violiin","blupur","beyllo","wifortress"],artzy:["poster","glitch","mozak","frank","pinvet","night vision","darkstreet","blomberg","lolita","atonic"]},h.presets={flower:[new n.Z("vibrance",.2),new n.Z("saturation",.1),new n.Z("temperature",.1)],forest:[new n.Z("saturation",-.2),new n.Z("vibrance",1),new n.Z("clarity",.2),new n.Z("temperature",.16),new n.Z("tint",.2),new n.Z("curves",new c.z([[0,0,65,52,173,190,236,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],beach:[new n.Z("saturation",.2),new n.Z("vibrance",.2),new n.Z("curves",new c.z([[0,0,68,56,199,208,255,255],[0,0,255,255],[0,0,98,97,196,201,255,255],[0,0,87,85,201,182,255,255]])),new n.Z("temperature",.1)],sham:[new n.Z("saturation",-.3),new n.Z("fill",new a.Z(new s.Z(153,221,255),"overlay",.3)),new n.Z("curves",new c.z([[60,31,191,217],[0,0,120,134,255,255],[0,0,255,255],[0,0,120,144,255,255]]))],stalker:[new n.Z("curves",new c.z([[62,64,190,191],[0,0,133,125,255,255],[0,0,54,65,209,208,255,255],[60,62,96,99,240,230,255,255]])),new n.Z("contrast",.1),new n.Z("saturation",-.2)],shimmer:[new n.Z("temperature",-.2),new n.Z("tint",-.12),new n.Z("fill",new a.Z(new s.Z(190,11,255),"screen",.12)),new n.Z("curves",new c.z([[8,23,244,227],[0,0,255,255],[0,0,131,124,255,255],[0,0,149,112,255,255]]))],mold:[new n.Z("curves",new c.z([[65,64,233,233],[0,0,138,121,255,255],[0,0,60,75,184,184,255,255],[0,0,64,75,181,176,255,255]])),new n.Z("contrast",.1),new n.Z("saturation",-.12)],style:[new n.Z("curves",new c.z([[0,0,73,74,191,177,235,221,255,255],[0,26,89,64,121,126,180,213,255,255],[0,0,71,50,190,210,255,255],[61,64,112,97,199,198,255,255]])),new n.Z("vibrance",-.1),new n.Z("saturation",-.4),new n.Z("temperature",.1)],cement:[new n.Z("curves",new c.z([[0,0,73,74,191,177,235,221,255,255],[0,0,255,255],[0,0,60,54,198,210,255,255],[0,0,73,37,150,149,199,198,255,255]])),new n.Z("vibrance",-.1),new n.Z("saturation",-.1)],sharp:[new n.Z("curves",new c.z([[0,0,42,20,199,218,224,246,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("vibrance",.1),new n.Z("sharpen",.1),new n.Z("clarity",.1)],corn:[new n.Z("temperature",.1),new n.Z("vibrance",.3),new n.Z("contrast",.1),new n.Z("curves",new c.z([[0,0,66,78,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]]))],morning:[new n.Z("tint",.18),new n.Z("temperature",.1),new n.Z("highlights",.08),new n.Z("levels",new o.Z(0,245,0,255)),new n.Z("curves",new c.z([[64,64,150,181,254,255],[0,0,122,138,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("fill",new a.Z(new s.Z(194,120,41),"overlay",.2))],ensalat:[new n.Z("highlights",.2),new n.Z("shadows",-.2),new n.Z("brightness",.1),new n.Z("levels",new o.Z(10,245,0,255)),new n.Z("curves",new c.z([[0,0,135,119,191,193,255,255],[0,0,255,255],[0,0,129,121,255,255],[0,0,255,255]])),new n.Z("clarity",.2),new n.Z("sharpen",.15)],berry:[new n.Z("vibrance",.44),new n.Z("curves",new c.z([[0,0,62,66,121,135,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("contrast",.2),new n.Z("highlights",.4),new n.Z("shadows",-.2),new n.Z("levels",new o.Z(20,255,0,255))],gritty:[new n.Z("saturation",-.4),new n.Z("levels",new o.Z(20,255,0,255)),new n.Z("curves",new c.z([[0,0,50,33,128,112,190,215,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("clarity",1),new n.Z("grain",.3)],sunny:[new n.Z("fill",new a.Z(new s.Z(255,194,96),"overlay",.2)),new n.Z("temperature",.1),new n.Z("glamour",.4),new n.Z("clarity",.3)],film:[new n.Z("sharpen",.2),new n.Z("glamour",.5),new n.Z("grain",.5),new n.Z("highlights",-.2),new n.Z("shadows",-.2),new n.Z("saturation",-.2)],matte:[new n.Z("curves",new c.z([[0,50,38,56,79,82,152,153,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("contrast",.12),new n.Z("saturation",-.1)],deep:[new n.Z("curves",new c.z([[0,0,117,99,191,198,255,255],[0,0,71,38,177,209,255,255],[0,0,236,255],[0,28,75,101,190,171,254,233]])),new n.Z("saturation",-.3)],aladin:[new n.Z("curves",new c.z([[0,0,255,255],[0,52,87,99,255,255],[0,0,106,107,194,190,254,212],[0,0,166,129,254,142]]))],amber:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,98,150,255,255],[0,0,138,117,255,255],[0,128,254,129]])),new n.Z("saturation",-.3),new n.Z("levels",new o.Z(20,235,0,255))],anne:[new n.Z("contrast",.25),new n.Z("curves",new c.z([[0,0,255,255],[0,0,78,66,135,171,255,255],[0,0,99,87,180,208,255,255],[0,0,94,93,171,161,255,255]]))],antonio:[new n.Z("glamour",.8)],alex:[new n.Z("glamour",.6)],bob:[new n.Z("saturation",-.6),new n.Z("highlights",.5)],greg:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,74,50,181,198,255,255],[0,0,61,41,108,170,158,207,254,208],[0,0,83,56,168,204,255,255]]))],hagrid:[new n.Z("vibrance",.9),new n.Z("saturation",.1),new n.Z("clarity",.5),new n.Z("shadows",-.3)],harry:[new n.Z("fill",new a.Z(new s.Z(214,178,119),"overlay",.7)),new n.Z("grain",.5)],ivan:[new n.Z("fill",new a.Z(new s.Z(255,0,68),"overlay",.4)),new n.Z("shadows",.15),new n.Z("levels",new o.Z(6,255,0,255))],jean:[new n.Z("levels",new o.Z(56,233,0,255)),new n.Z("saturation",-1),new n.Z("tint",.1),new n.Z("exposure",.78),new n.Z("bloom",.1)],josh:[new n.Z("curves",new c.z([[0,0,78,52,175,207,255,255],[0,0,255,255],[0,0,255,255],[0,64,87,129,254,193]]))],karen:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,89,144,255,255],[0,0,138,112,255,255],[0,0,162,88,255,255]]))],lucas:[new n.Z("tint",1),new n.Z("saturation",-.85),new n.Z("contrast",.4),new n.Z("shadows",1),new n.Z("temperature",.1)],melissa:[new n.Z("curves",new c.z([[0,0,255,255],[0,62,255,255],[0,0,255,255],[0,61,254,193]]))],peter:[new n.Z("curves",new c.z([[0,0,255,255],[0,6,31,20,65,26,87,51,195,190,254,230],[0,11,24,27,102,131,189,195,255,255],[0,40,126,148,254,177]]))],salomon:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,83,50,177,213,255,255],[0,0,69,55,186,205,255,255],[11,56,254,212]])),new n.Z("contrast",-.2)],sara:[new n.Z("vibrance",1),new n.Z("contrast",.1),new n.Z("highlights",.3)],sophia:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,140,116,222,254],[0,0,70,59,182,201,255,255],[0,29,252,227]])),new n.Z("saturation",.3)],tony:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,92,42,218,252],[0,0,73,75,157,194,255,255],[0,27,254,227]]))],agnes:[new n.Z("desaturate",1),new n.Z("contrast",.4)],conny:[new n.Z("saturation",-.55),new n.Z("temperature",.25),new n.Z("brightness",-.25),new n.Z("levels",new o.Z(14,233,0,255)),new n.Z("exposure",.35),new n.Z("highlights",-.9)],gordon:[new n.Z("desaturate",1),new n.Z("temperature",.7),new n.Z("tint",.3),new n.Z("saturation",-.2)],harrison:[new n.Z("toning",new r.Z(new s.Z(255,240,215),void 0,new s.Z(48,26,24),1)),new n.Z("grain",.2)],henry:[new n.Z("toning",new r.Z(new s.Z(255,240,215),void 0,new s.Z(48,26,24),1)),new n.Z("saturation",-.5)],logan:[new n.Z("glamour",.5),new n.Z("tint",.4),new n.Z("saturation",-.35),new n.Z("toning",new r.Z(new s.Z(255,240,215),void 0,new s.Z(48,26,24),.8))],olay:[new n.Z("saturation",-1),new n.Z("grain",.5),new n.Z("vignette",.5)],porter:[new n.Z("saturation",-1),new n.Z("vignette",.4),new n.Z("levels",new o.Z(50,205))],tom:[new n.Z("desaturate",1)],sampi:[new n.Z("toning",new r.Z(new s.Z(255,228,196),void 0,new s.Z(0,0,0),1)),new n.Z("levels",new o.Z(0,217,0,255)),new n.Z("temperature",.3)],vinny:[new n.Z("curves",new c.z([[0,0,133,111,255,255],[0,0,255,255],[0,0,255,255],[0,0,133,138,255,255]])),new n.Z("vibrance",-1),new n.Z("saturation",1),new n.Z("temperature",.8),new n.Z("contrast",-.1),new n.Z("highlights",.1)],borg:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,94,66,227,255],[0,0,93,94,179,198,255,255],[0,19,254,228]])),new n.Z("fill",new a.Z(new s.Z(204,255,0),"",.1))],carl:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,93,64,227,255],[0,0,93,94,181,189,255,255],[0,19,254,228]])),new n.Z("vignette",.3),new n.Z("contrast",.15),new n.Z("saturation",-.3)],coco:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,64,97,255,255],[0,0,142,122,255,255],[0,0,144,112,255,255]]))],doris:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,78,48,177,209,255,255],[0,0,92,94,179,208,255,255],[0,52,254,215]])),new n.Z("saturation",-.2)],doug:[new n.Z("curves",new c.z([[0,0,255,255],[0,64,255,255],[0,0,255,255],[1,64,252,193]])),new n.Z("highlights",.5),new n.Z("shadows",-.3)],earl:[new n.Z("vignette",.4),new n.Z("curves",new c.z([[0,0,255,255],[0,0,222,254],[0,47,223,254],[0,129,222,255]])),new n.Z("fill",new a.Z(new s.Z(247,218,174),"multiply",.8))],sun:[new n.Z("fill",new a.Z(new s.Z(251,242,163),"multiply",.8)),new n.Z("vignette",-.25)],blues:[new n.Z("curves",new c.z([[0,0,255,255],[0,0,77,54,181,207,255,255],[0,0,73,51,180,209,255,255],[0,0,54,75,201,185,255,255]]))],country:[new n.Z("curves",new c.z([[0,0,84,74,115,105,255,255],[0,0,73,80,93,124,255,255],[0,0,50,34,93,105,119,142,255,255],[0,0,85,85,125,112,255,255]]))],lemonpell:[new n.Z("curves",new c.z([[0,36,80,84,156,190,255,255],[0,0,255,255],[0,0,103,105,158,176,255,255],[0,19,107,83,198,196,255,255]]))],"tiny dc":[new n.Z("curves",new c.z([[0,0,255,255],[0,0,79,46,199,217,255,255],[9,1,110,126,254,232],[0,46,92,103,191,158,254,205]])),new n.Z("grain",.3)],minker:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,247,8,255)),new n.Z("brightness",.14),new n.Z("contrast",.4),new n.Z("vibrance",.5)],superone:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(77,0,51),.8)),new n.Z("levels",new o.Z(50,175,0,255))],tonola:[new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(77,0,51),.8)),new n.Z("levels",new o.Z(26,213,0,255)),new n.Z("saturation",.36),new n.Z("temperature",.22)],reddish:[new n.Z("toning",new r.Z(new s.Z(255,214,147),void 0,new s.Z(110,37,0),.8)),new n.Z("contrast",.3),new n.Z("highlights",1)],fellowing:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(77,47,0),.8)),new n.Z("levels",new o.Z(24,203,0,255)),new n.Z("contrast",.14),new n.Z("saturation",.3),new n.Z("temperature",.18)],grassland:[new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(0,77,25),.7)),new n.Z("levels",new o.Z(18,227,0,255)),new n.Z("contrast",.16)],springs:[new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(0,26,38),1)),new n.Z("highlights",1),new n.Z("levels",new o.Z(40,155,0,255)),new n.Z("shadows",1)],justblues:[new n.Z("toning",new r.Z(new s.Z(198,236,255),void 0,new s.Z(26,0,77),.79)),new n.Z("levels",new o.Z(16,189,0,255)),new n.Z("saturation",.2),new n.Z("contrast",.2)],bluesteel:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,215,12,255))],flowerpot:[new n.Z("toning",new r.Z(new s.Z(255,153,221),void 0,new s.Z(51,77,0),.8)),new n.Z("levels",new o.Z(22,215,0,255)),new n.Z("vignette",-.2)],stinker:[new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(26,0,77),.8)),new n.Z("levels",new o.Z(0,247,8,255)),new n.Z("brightness",.14),new n.Z("contrast",.4)],violiin:[new n.Z("contrast",.32),new n.Z("toning",new r.Z(new s.Z(195,166,255),void 0,new s.Z(33,0,0),1)),new n.Z("levels",new o.Z(22,223,0,255)),new n.Z("exposure",.22),new n.Z("brightness",.12)],blupur:[new n.Z("toning",new r.Z(new s.Z(255,153,221),void 0,new s.Z(7,68,97),.8)),new n.Z("vibrance",.7),new n.Z("contrast",.3)],beyllo:[new n.Z("vibrance",1),new n.Z("saturation",1),new n.Z("temperature",-.55),new n.Z("tint",.1),new n.Z("levels",new o.Z(0,255,24,249)),new n.Z("toning",new r.Z(new s.Z(255,213,0),void 0,new s.Z(125,3,84),.76)),new n.Z("curves",new c.z([[0,0,255,255],[0,0,131,115,255,255],[0,0,136,128,255,255],[0,0,122,145,255,255]])),new n.Z("vignette",.28)],wifortress:[new n.Z("toning",new r.Z(new s.Z(108,206,255),void 0,new s.Z(0,26,38),1)),new n.Z("highlights",1),new n.Z("levels",new o.Z(40,155,0,255)),new n.Z("shadows",1)],vib:[new n.Z("vibrance",.1),new n.Z("saturation",.5),new n.Z("brightness",.1),new n.Z("temperature",.5),new n.Z("levels",new o.Z(12,253,0,255)),new n.Z("highlights",.2),new n.Z("curves",new c.z([[0,0,255,255],[0,0,70,80,198,181,255,255],[0,0,140,135,255,255],[0,0,74,96,200,172,255,255]])),new n.Z("toning",new r.Z(new s.Z(255,238,210),void 0,new s.Z(54,6,6),.07)),new n.Z("contrast",-.1)],ranguit:[new n.Z("saturation",.22),new n.Z("temperature",.96),new n.Z("tint",-.28),new n.Z("contrast",.14),new n.Z("brightness",-.2),new n.Z("levels",new o.Z(0,237,56,255)),new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(41,35,33),.26))],rangeen:[new n.Z("vibrance",1),new n.Z("saturation",.46),new n.Z("temperature",.36),new n.Z("levels",new o.Z(0,251,14,255)),new n.Z("shadows",.34),new n.Z("highlights",.12),new n.Z("toning",new r.Z(new s.Z(121,255,224),void 0,new s.Z(245,22,107),.12)),new n.Z("contrast",-.1),new n.Z("curves",new c.z([[0,0,144,152,255,255],[0,0,136,107,255,255],[0,0,115,102,255,255],[0,0,106,91,255,255]]))],creamlow:[new n.Z("vibrance",.82),new n.Z("saturation",-.24),new n.Z("temperature",1),new n.Z("tint",.78),new n.Z("contrast",-.3),new n.Z("levels",new o.Z(40,247,0,255)),new n.Z("highlights",.64),new n.Z("toning",new r.Z(new s.Z(221,255,153),void 0,new s.Z(145,39,9),.29)),new n.Z("curves",new c.z([[0,0,5,13,78,83,172,162,255,255],[0,0,255,255],[0,0,131,120,255,255],[0,0,68,61,175,184,255,255]]))],sven:[new n.Z("vibrance",.7),new n.Z("temperature",.5),new n.Z("tint",.3),new n.Z("exposure",.2),new n.Z("contrast",-.2),new n.Z("levels",new o.Z(4,255,0,235)),new n.Z("highlights",-.3),new n.Z("shadows",.3),new n.Z("grain",.3),new n.Z("vignette",.45)],yenely:[new n.Z("tint",.5),new n.Z("levels",new o.Z(0,235,20,255)),new n.Z("saturation",-.62),new n.Z("contrast",-.3),new n.Z("shadows",-.6),new n.Z("curves",new c.z([[0,0,148,105,255,255],[0,0,92,79,128,227,255,255],[0,0,74,103,119,172,255,255],[0,0,111,148,255,255]])),new n.Z("highlights",1),new n.Z("brightness",.14),new n.Z("temperature",.3),new n.Z("vibrance",1),new n.Z("exposure",-.1)],ragwarm:[new n.Z("temperature",.62),new n.Z("levels",new o.Z(32,255,0,243)),new n.Z("highlights",-.14),new n.Z("vignette",.28),new n.Z("toning",new r.Z(new s.Z(153,255,187),void 0,new s.Z(21,55,143),.07)),new n.Z("curves",new c.z([[0,0,126,125,255,255],[0,0,255,255],[0,0,130,121,255,255],[0,0,138,124,255,255]]))],greered:[new n.Z("vibrance",.32),new n.Z("temperature",.4),new n.Z("tint",-.5),new n.Z("brightness",.24),new n.Z("contrast",-.1),new n.Z("vignette",.31),new n.Z("shadows",.38)],danligter:[new n.Z("saturation",.86),new n.Z("temperature",-1),new n.Z("tint",-.92),new n.Z("brightness",.22),new n.Z("exposure",.22),new n.Z("contrast",.1),new n.Z("levels",new o.Z(0,239,0,255)),new n.Z("highlights",-.12),new n.Z("dehaze",-.12),new n.Z("toning",new r.Z(new s.Z(255,216,153),void 0,new s.Z(0,52,77),.14)),new n.Z("curves",new c.z([[0,0,255,255],[0,0,96,115,162,194,255,255],[0,0,101,97,185,189,255,255],[0,0,144,130,222,228,255,255]]))],garage:[new n.Z("tint",.6),new n.Z("saturation",-.04),new n.Z("shadows",-1),new n.Z("grain",.42),new n.Z("glamour",.3)],strawberry:[new n.Z("fill",new a.Z(new s.Z(255,0,0),"soft-light",.5))],clementine:[new n.Z("fill",new a.Z(new s.Z(255,158,0),"soft-light",.5))],pear:[new n.Z("fill",new a.Z(new s.Z(170,255,0),"soft-light",.5))],apple:[new n.Z("fill",new a.Z(new s.Z(0,255,85),"soft-light",.5))],blueberry:[new n.Z("fill",new a.Z(new s.Z(0,170,255),"soft-light",.5))],grapes:[new n.Z("fill",new a.Z(new s.Z(85,0,255),"soft-light",.5))],dragon:[new n.Z("fill",new a.Z(new s.Z(255,0,170),"soft-light",.5))],punch:[new n.Z("curves",new c.z([[0,0,80,64,173,193,255,255],[0,0,255,255],[0,0,255,255],[0,0,255,255]])),new n.Z("vibrance",.5)],bright:[new n.Z("highlights",-.3),new n.Z("shadows",.5),new n.Z("levels",new o.Z(0,215,10,255))],contrast:[new n.Z("contrast",.2),new n.Z("highlights",.2),new n.Z("levels",new o.Z(20,215,0,255)),new n.Z("shadows",.4)],vivid:[new n.Z("vibrance",.4),new n.Z("shadows",.25)],clairify:[new n.Z("clarity",.6),new n.Z("sharpen",.1),new n.Z("glamour",.2)],poster:[new n.Z("posterize",.08)],glitch:[new n.Z("scanlines",{size:.03,amount:.05,colorize:!1,direction:!1}),new n.Z("slice",{seed:86,amount:4,distance:.12,line:!0}),new n.Z("bleed",{seed:58,amplitude:.05,block:1.2})],mozak:[new n.Z("mosaic",.5),new n.Z("fringe",.2)],frank:[new n.Z("fringe",.4)],pinvet:[new n.Z("bloom",.33),new n.Z("invert",1),new n.Z("pixelate",.7)],blomberg:[new n.Z("bloom",.33),new n.Z("invert",1),new n.Z("tint",1),new n.Z("temperature",-.8),new n.Z("saturation",-.5)],lolita:[new n.Z("fill",new a.Z(new s.Z(255,153,153),"vivid-light",1))],atonic:[new n.Z("curves",new c.z([[0,0,255,255],[6,235,246,4],[131,3,138,255],[1,42,251,213]]))],"night vision":[new n.Z("fill",new a.Z(new s.Z(30,255,0),"multiply",1)),new n.Z("levels",new o.Z(0,183,0,255)),new n.Z("vignette",.85),new n.Z("grain",.6)],darkstreet:[new n.Z("temperature",-1),new n.Z("highlights",.58),new n.Z("shadows",-1),new n.Z("levels",new o.Z(100,249,0,255)),new n.Z("grain",1),new n.Z("exposure",-1)]})}static named(t){return h.init(),this.presets[t]}static firstInGroup(t){return h.init(),h.grouping[t][0]}static groupLength(t){return h.grouping[t].length}static groups(){h.init();const t=[];for(const e in h.grouping)t.push(e);return t}static names(t){h.init();const e=[];for(const i in h.grouping[t])e.push(h.grouping[t][i]);return e}}},56222:(t,e,i)=>{i.d(e,{J:()=>a});var s=i(33655),n=(i(4256),i(95574));async function a(t){const e=await fetch("/api/auth/ai/remove-background/"),i=await e.json();if(!1===i.status)throw new Error(i.message);const a=new AbortController,{signal:r}=a,o=await new Promise(((e,i)=>{s.eY(t,640,640).toBlob(e,"image/jpeg",.8)})),c=new FormData;c.set("image_file",new File([o],"file.jpg"));const h=await fetch("https://api.phosus.com/bgremove/v1",{method:"POST",headers:{authorizationtoken:i.data,Accept:"application/json"},body:c,signal:r}),l=await h.json();if(!l.ok)throw new Error(l.error);return await(0,n.OA)("data:image/jpeg;base64,"+l.results.mask)}},12257:(t,e,i)=>{i.d(e,{Z:()=>c});var s=i(93947),n=i(33655),a=i(98776),r=i(43673),o=i(50972);class c{constructor(t){this.getSettingsString=()=>JSON.stringify(this.settings),this.setSettingsString=t=>{this.settings=n.mS(o.Z,JSON.parse(t)),this.generate()},this.getStep=()=>Math.round(this.settings.distance*this.settings.size),this.getCursorImage=(t,e=new a.Z(255,255,255,255))=>{if(!(this.canvas.width*t>512||this.canvas.height*t>512))return this.generatetOutline(t,e)},this.generateBasic=(t,e)=>{let i=this.settings.softness;if(this.settings.size<3){if(1===this.settings.size||i<.25)return this.canvas.width=this.settings.size,this.canvas.height=this.settings.size,this.context.fillStyle=t.toRGBA(),void this.context.fillRect(0,0,this.canvas.width,this.canvas.height);i-=.25}const s=this.settings.size,n=(s%2?s:s+1)/2;let a,o,c,h,l,d,u,m,p,g=0,v=0,f=new r.Z(0,0),y=new r.Z(0,0);switch(d=Math.sin(this.settings.angle*Math.PI/180),l=Math.cos(this.settings.angle*Math.PI/180),p=n*this.settings.aspect,f.x=l*n,f.y=d*n*-1,y.x=d*p,y.y=l*p,this.settings.type){case"circle":g=Math.ceil(Math.sqrt(f.x*f.x+y.x*y.x)),v=Math.ceil(Math.sqrt(f.y*f.y+y.y*y.y));break;case"square":g=Math.ceil(Math.abs(f.x)+Math.abs(y.x)),v=Math.ceil(Math.abs(f.y)+Math.abs(y.y));break;case"diamond":g=Math.ceil(Math.max(Math.abs(f.x),Math.abs(y.x))),v=Math.ceil(Math.max(Math.abs(f.y),Math.abs(y.y)))}this.settings.spikes>2&&(g=v=Math.ceil(Math.sqrt(n*n+p*p)),y.x=d*n,y.y=l*n),this.canvas.width=2*g+1,this.canvas.height=2*v+1;const w=this.lookupTable(n,i);u=Math.cos(-2*Math.PI/this.settings.spikes),m=Math.sin(-2*Math.PI/this.settings.spikes);const x=this.context.canvas.width,b=this.context.getImageData(0,0,x,this.context.canvas.height);for(c=-v;c<=v;++c)for(o=-g;o<=g;++o){let i=0,s=l*o-d*c,r=Math.abs(d*o+l*c);if(this.settings.spikes>2){let t,e,i=Math.atan2(r,s);for(;i>Math.PI/this.settings.spikes;)e=s,t=r,s=u*e-m*t,r=m*e+u*t,i-=2*Math.PI/this.settings.spikes}switch(r/=this.settings.aspect,this.settings.type){case"circle":i=Math.sqrt(s*s+r*r);break;case"square":i=Math.max(Math.abs(s),Math.abs(r));break;case"diamond":i=Math.abs(s)+Math.abs(r)}a=i<n+1?w[Math.floor(4*i)]:0,e&&(a=a<64?0:255),h=4*((c+v)*x+(o+g)),b.data[h]=t.r,b.data[h+1]=t.g,b.data[h+2]=t.b,b.data[h+3]=a}this.context.putImageData(b,0,0)},this.generateCustom=(t,e)=>{},this.canvas=(0,s.T)("canvas"),this.settings=t,this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this.generate()}generate(t=new a.Z,e=!1){"custom"===this.settings.type?this.generateCustom(t,e):this.generateBasic(t,e)}generatetOutline(t=1,e=new a.Z(255,255,255,255)){const i=Math.round(this.canvas.width*t)||1,s=Math.round(this.canvas.height*t)||1;let r=n.vL(i+2,s+2);const o=r.getContext("2d");o.fillStyle=e.toRGBA(),o.shadowColor=new a.Z(0,0,0).toRGBA(),o.shadowBlur=1,i>20&&s>20&&(o.fillRect(~~(i/2)-3,~~(s/2),8,2),o.fillRect(~~(i/2),~~(s/2)-3,2,8));let c,h,l,d,u,m=1!=t?n.eY(this.canvas,i,s,!1).getContext("2d").getImageData(0,0,i,s):this.context.getImageData(0,0,i,s);for(let n=0;n<s;++n){h=!0,l=Boolean(m.data[n*i*4+3]<64);for(let t=0;t<i;++t)c=h,h=l,l=t+1===i||m.data[4*(n*i+t+1)+3]<64,h||(d=n-1<0||m.data[4*((n-1)*i+t)+3]<64,u=n+1===s||m.data[4*((n+1)*i+t)+3]<64,(c||d||l||u)&&o.fillRect(t+1,n+1,1,1))}if(i<=20&&s<=20){const t=n.vL(33,33),i=t.getContext("2d");i.drawImage(r,Math.floor((33-r.width)/2),Math.floor((33-r.height)/2)),i.fillStyle=e.toRGBA(),i.shadowColor=new a.Z(0,0,0).toRGBA(),i.shadowBlur=1,i.fillRect(2,15,4,2),i.fillRect(26,15,4,2),i.fillRect(15,2,2,4),i.fillRect(15,26,2,4),r=t}return r}lookupTable(t,e){const i=new Array;let s,n,a=0;const r=new Array(4),o=Math.round(t+1),c=4*Math.ceil(1+Math.sqrt(o*o*2));let h;for(n=e<4e-7?1e6:.4/e,h=0;h<4;h++)s=Math.abs((h+.5)/4-.5),r[h]=s>t?0:this.gaussian(Math.pow(s/t,n)),a+=r[h];for(h=0;s<t||a>1e-5;s+=1/4){a-=r[h%4],r[h%4]=s>t?0:this.gaussian(Math.pow(s/t,n)),a+=r[h%4];let e=Math.floor(63.75*a);i[h++]=Math.max(0,e)}for(;h<c;)i[h++]=0;return i}gaussian(t){return t<-.5?2*(t=-1-t)*t:t<.5?1-2*t*t:2*(t=1-t)*t}}},50972:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t="circle",e=40,i=.2,s=1,n=0,a=1,r=2,o=.2,c){this.type=t,this.size=e,this.softness=i,this.opacity=s,this.angle=n,this.aspect=a,this.spikes=r,this.distance=o,this.source=c}}s.isEqual=(t,e)=>!(!t||!e)&&(t.type===e.type&&t.size===e.size&&t.softness===e.softness&&t.angle===e.angle&&t.aspect===e.aspect&&t.spikes===e.spikes&&t.source===e.source)},71662:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t=0,e=255,i=0,s=255,n=1,a=.5){this.minin=t,this.maxin=e,this.minout=i,this.maxout=s,this.midin=n,this.mid=a,this.map=t=>(t=(t-this.minin)/(this.maxin-this.minin),t=Math.pow(t,this.midin),(t=this.minout+t*(this.maxout-this.minout))>this.maxout?t=this.maxout:t<this.minout&&(t=this.minout),Math.round(t))}reset(){this.minout=0,this.maxout=255,this.midin=1,this.minin=0,this.maxin=255,this.mid=.5}isFlat(){return Boolean(0==this.minout&&255==this.maxout&&.5==this.mid&&0==this.minin&&255==this.maxin)}setMid(t){this.mid=(t-this.minin)/(this.maxin-this.minin),this.midin=this.midToIn(this.mid)}midToIn(t){return Math.min(Math.max(Math.pow(9.99,2*t-1),.1),9.99)}static fillPaletteMap(t,e){for(let i=0;i<256;++i){let s=t.map(i);e.data[4*i]=s,e.data[4*i+1]=s,e.data[4*i+2]=s}}static fillRGBPaletteMap(t,e,i,s){for(let n=0;n<256;++n)s.data[4*n]=t?t.map(n):n,s.data[4*n+1]=e?e.map(n):n,s.data[4*n+2]=i?i.map(n):n}}},82468:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e){var i,s,n,a,r,o,c,h,l,d,u,m,p;if(null!=t&&null!=e){for(h=t.length-1,a=[],u=[],c=[],d=[],m=[],s=[],i=[],n=[],o=[],l=[],r=0;0<=h?r<h:r>h;0<=h?r+=1:r-=1)a[r]=t[r+1]-t[r],o[r]=e[r+1]-e[r],l[r]=o[r]/a[r];for(r=1;1<=h?r<h:r>h;1<=h?r+=1:r-=1)u[r]=3/a[r]*(e[r+1]-e[r])-3/a[r-1]*(e[r]-e[r-1]);for(c[0]=1,d[0]=0,m[0]=0,r=1;1<=h?r<h:r>h;1<=h?r+=1:r-=1)c[r]=2*(t[r+1]-t[r-1])-a[r-1]*d[r-1],d[r]=a[r]/c[r],m[r]=(u[r]-a[r-1]*m[r-1])/c[r];for(c[h]=1,m[h]=0,s[h]=0,r=p=h-1;p<=0?r<=0:r>=0;p<=0?r+=1:r-=1)s[r]=m[r]-d[r]*s[r+1],i[r]=(e[r+1]-e[r])/a[r]-a[r]*(s[r+1]+2*s[r])/3,n[r]=(s[r+1]-s[r])/(3*a[r]);this.x=t.slice(0,h+1),this.a=e.slice(0,h),this.b=i,this.c=s.slice(0,h),this.d=n}}interpolate(t){var e,i,s;for(i=s=this.x.length-1;(s<=0?i<=0:i>=0)&&!(this.x[i]<=t);s<=0?i+=1:i-=1);return e=t-this.x[i],this.a[i]+this.b[i]*e+this.c[i]*Math.pow(e,2)+this.d[i]*Math.pow(e,3)}}},60134:(t,e,i)=>{i.d(e,{Z:()=>r,z:()=>a});var s=i(43673),n=i(82468);class a{constructor(t){this.preset=t}static createCurveSet(t){const e=new Array,i=new Array,n=new Array,a=new Array;for(let r=0;r<t.preset[0].length;r+=2)e.push(new s.Z(t.preset[0][r],t.preset[0][r+1]));for(let r=0;r<t.preset[1].length;r+=2)i.push(new s.Z(t.preset[1][r],t.preset[1][r+1]));for(let r=0;r<t.preset[2].length;r+=2)n.push(new s.Z(t.preset[2][r],t.preset[2][r+1]));for(let r=0;r<t.preset[3].length;r+=2)a.push(new s.Z(t.preset[3][r],t.preset[3][r+1]));return new r(1,e,i,n,a)}}class r{constructor(t=255,e=[],i=[],s=[],n=[]){this.scale=t,this.rgb=e,this.red=i,this.green=s,this.blue=n,this.percent=1}static getInterpolation(t,e){let i=[],s=[],a=new Float32Array(256);for(var r=0;r<e.length;r++)i.push(e[r].x*t),s.push(e[r].y*t);let o=new n.Z(i,s);for(var c=0;c<Math.ceil(i[0]);c++)a[c]=s[0];for(c=Math.ceil(i[0]);c<Math.ceil(i[i.length-1]);c++)a[c]=o.interpolate(c);for(c=Math.ceil(i[i.length-1]);c<256;c++)a[c]=s[s.length-1];return a}static fillPaletteMap(t,e){let i=r.getInterpolation(t.scale,t.rgb),s=r.getInterpolation(t.scale,t.red),n=r.getInterpolation(t.scale,t.green),a=r.getInterpolation(t.scale,t.blue);for(let r=0;r<256;++r){let o=r-i[r];e.data[4*r]=r-Math.round((r-(s[r]-o))*t.percent),e.data[4*r+1]=r-Math.round((r-(n[r]-o))*t.percent),e.data[4*r+2]=r-Math.round((r-(a[r]-o))*t.percent)}}}},94084:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e,i){this.color=t,this.blend=e,this.amount=i}}},22758:(t,e,i)=>{i.d(e,{Z:()=>c});var s=i(33655),n=i(36817),a=i(4256),r=i(43673),o=i(67175);class c{constructor(t,e){this.setMask=t=>{this.mask=t,this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.isSelected=t=>{var e;return!!(null===(e=this.bounds)||void 0===e?void 0:e.isInside(t))&&this.ctx.getImageData(t.x,t.y,1,1).data[3]>=64},this.applyOffset=()=>{let t=s.dN(this.mask);this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.ctx.drawImage(t,this.offset.x,this.offset.y),this.offset.x=this.offset.y=0,this.createOutline()},this.editRectangle=(t,e,i)=>{let n=s.vL(this.mask.width,this.mask.height),a=n.getContext("2d");o.Z.fill(a,"rectangle",t.topLeft(),t.bottomRight()),a=void 0,this.drawOnMask(n,e,!1,i)},this.editEllipse=(t,e,i,n)=>{let a=s.vL(this.mask.width,this.mask.height),r=a.getContext("2d");o.Z.fill(r,"ellipse",t.topLeft(),t.bottomRight()),r=void 0,this.drawOnMask(a,e,i,n)},this.editBezier=(t,e,i,n)=>{let a=s.vL(this.mask.width,this.mask.height),r=a.getContext("2d");r.beginPath(),r.moveTo(t[0].x,t[0].y);for(let s=1;s<t.length;s+=2)s+1===t.length?r.lineTo(t[s].x,t[s].y):r.quadraticCurveTo(t[s+1].x,t[s+1].y,t[s].x,t[s].y);r.fill(),r=void 0,this.drawOnMask(a,e,i,n)},this.editPolygon=(t,e,i,n)=>{let a=s.vL(this.mask.width,this.mask.height),r=a.getContext("2d");r.beginPath(),r.moveTo(t[0].x,t[0].y),t.forEach((t=>r.lineTo(t.x,t.y))),r.fill(),r=void 0,this.drawOnMask(a,e,i,n)},this.drawOnMask=(t,e=0,i=!1,s=!1,n=new r.Z(0,0))=>{if(e>0){let i=new a.Z;i.addShader("blur",e),t=i.apply(t)}else if(i){let e=new a.Z;e.addShader("dealiasing",!0),t=e.apply(t)}this.ctx.save(),s&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.drawImage(t,n.x,n.y),this.ctx.restore(),this.createOutline()},this.selectAll=()=>{this.ctx.fillRect(0,0,this.mask.width,this.mask.height),this.createOutline()},this.invert=()=>{const t=new a.Z([]);t.addShader("alpha-invert",1),this.mask=s.dN(t.apply(this.mask)),this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.size=(t,e)=>{const i=s.vL(t,e);this.ctx=i.getContext("2d",{willReadFrequently:!0});const n=Math.round(.5*(i.width-this.mask.width)),a=Math.round(.5*(i.height-this.mask.height));this.ctx.drawImage(this.mask,n,a),this.mask=i,this.createOutline()},this.resize=(t,e)=>{this.mask=s.eY(this.mask,t,e),this.ctx=this.mask.getContext("2d",{willReadFrequently:!0}),this.createOutline()},this.createOutline=()=>{let t=this.ctx.getImageData(0,0,this.mask.width,this.mask.height);if(this.bounds=s.vO(t),!this.bounds)return;let e=this.bounds.top(),i=this.bounds.left(),n=this.bounds.right(),a=this.bounds.bottom(),r=this.mask.width,o=this.mask.height;this.outline=new Array;let c,h,l,d,u,m=-1;for(let s=e;s<a;++s){h=0===i||t.data[4*(s*r+i-1)+3]<64,l=t.data[4*(s*r+i)+3]<64;for(let e=i;e<n;++e)c=h,h=l,l=e+1===r||t.data[4*(s*r+e+1)+3]<64,h||(m=-1,d=s-1<0||t.data[4*((s-1)*r+e)+3]<64,u=s+1===o||t.data[4*((s+1)*r+e)+3]<64,c&&d&&l&&u?m=8:c&&d&&u?m=9:l&&d&&u?m=10:l&&d&&c?m=11:l&&u&&c?m=12:c&&l?m=13:u&&d?m=14:c&&d?m=0:d&&l?m=2:c&&u?m=5:u&&l?m=7:d?m=1:c?m=3:l?m=4:u&&(m=6),-1!==m&&this.outline.push(e,s,m))}},this.clear=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array},this.reset=()=>{this.ctx.clearRect(0,0,this.mask.width,this.mask.height),this.outline=new Array,this.offset=new r.Z,this.bounds=new n.Z},this.cleanUp=()=>{this.outline=void 0,this.offset=void 0,this.bounds=void 0,this.mask=void 0,this.ctx=void 0},this.mask=s.vL(t,e),this.offset=new r.Z,this.bounds=new n.Z,this.ctx=this.mask.getContext("2d",{willReadFrequently:!0})}}},9389:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e,i,s=1){this.highlight=t,this.midtone=e,this.shadow=i,this.amount=s}static fillPaletteMap(t,e){if(t.midtone){for(let i=0;i<128;i++){let s=i/127;e.data[4*i]=Math.round(t.midtone.r*s+t.shadow.r*(1-s)),e.data[4*i+1]=Math.round(t.midtone.g*s+t.shadow.g*(1-s)),e.data[4*i+2]=Math.round(t.midtone.b*s+t.shadow.b*(1-s))}for(let i=128;i<256;i++){let s=(i-127)/128;e.data[4*i]=Math.round(t.highlight.r*s+t.midtone.r*(1-s)),e.data[4*i+1]=Math.round(t.highlight.g*s+t.midtone.g*(1-s)),e.data[4*i+2]=Math.round(t.highlight.b*s+t.midtone.b*(1-s))}}else for(let i=0;i<256;++i){let s=i/255;e.data[4*i]=Math.round(t.highlight.r*s+t.shadow.r*(1-s)),e.data[4*i+1]=Math.round(t.highlight.g*s+t.shadow.g*(1-s)),e.data[4*i+2]=Math.round(t.highlight.b*s+t.shadow.b*(1-s))}}}},18203:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(43673);class n{constructor(t,e){this.addPointer=t=>{this.pointers.push(t),this.stage.raster.setPointerCapture(t)},this.removePointer=t=>{for(let e=0;e<this.pointers.length;e++)if(this.pointers[e]===t.pointerId){this.pointers.splice(e,1);break}this.stage.raster.releasePointerCapture(t.pointerId)},this.pointerDown=t=>{t.stopPropagation(),this.stage.coating.override||t.button>0||(this.isDown=!0,this.addPointer(t.pointerId),1===this.pointers.length&&this.down(new s.Z(t.clientX-this.stage.rasterRect.x,t.clientY-this.stage.rasterRect.y),t.pointerType,t.pressure))},this.pointerMove=t=>{t.stopPropagation(),this.pointers.length<2&&this.move(new s.Z(t.clientX-this.stage.rasterRect.x,t.clientY-this.stage.rasterRect.y),t.pointerType,t.pressure)},this.pointerUp=t=>{t.stopPropagation(),this.isDown=!1,this.up(new s.Z(t.clientX-this.stage.rasterRect.x,t.clientY-this.stage.rasterRect.y))},this.dblClick=t=>{t.stopPropagation(),this.dbl(new s.Z(t.clientX-this.stage.rasterRect.x,t.clientY-this.stage.rasterRect.y))},this.addDownListeners=()=>{this.stage.raster.addEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.addEventListener("pointerup",this.removePointer,!1)},this.removeDownListeners=()=>{this.stage.raster.removeEventListener("pointerdown",this.pointerDown,!1),this.stage.raster.removeEventListener("pointerup",this.removePointer,!1)},this.addMoveListeners=()=>{this.stage.raster.addEventListener("pointermove",this.pointerMove,!1),this.stage.raster.addEventListener("pointerup",this.pointerUp,!1)},this.removeMoveListeners=()=>{this.stage.raster.removeEventListener("pointermove",this.pointerMove,!1),this.stage.raster.removeEventListener("pointerup",this.pointerUp,!1)},this.down=(t,e,i)=>{},this.move=(t,e,i)=>{},this.dbl=t=>{},this.up=t=>{},this.apply=()=>{},this.cancel=()=>{},this.cleanUp=()=>{},this.name=t,this.stage=e,this.pointers=new Array}}},98776:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(33655);class n{constructor(t,e,i){this.h=t,this.s=e,this.b=i}toColor(){let t,e,i,s,n,r,o,c;if(0==this.b)t=0,e=0,i=0;else if(0==this.s)t=e=i=this.b;else switch(s=this.h/60,n=s-Math.floor(s),r=this.b*(1-this.s),c=this.b*(1-this.s*n),o=this.b*(1-this.s*(1-n)),Math.floor(s)){case 0:case 6:t=this.b,e=o,i=r;break;case 1:t=c,e=this.b,i=r;break;case 2:t=r,e=this.b,i=o;break;case 3:t=r,e=c,i=this.b;break;case 4:t=o,e=r,i=this.b;break;case 5:t=this.b,e=r,i=c}return new a(Math.round(255*t),Math.round(255*e),Math.round(255*i))}toHEX(){const t=this.toColor(),e=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${e(t.r)}${e(t.g)}${e(t.b)}`}}class a{constructor(t=255,e=255,i=255,a=255){this.isEqual=t=>!!t&&(this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a),this.toHEX=()=>{const t=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${t(this.r)}${t(this.g)}${t(this.b)}`},this.toHEXA=()=>{const t=t=>{const e=t.toString(16);return 1===e.length?"0"+e:e};return`#${t(this.r)}${t(this.g)}${t(this.b)}${t(this.a)}`},this.toRGBA=(t=this.a)=>`rgba(${this.r},${this.g},${this.b},${t/255})`,this.toHSB=()=>{let t,e,i,s=Math.min(this.r,this.g,this.b),a=Math.max(this.r,this.g,this.b);i=a/255;let r=a-s;return r?(e=r/a,t=this.r==a?(this.g-this.b)/r*60:this.g==a?60*(2+(this.b-this.r)/r):60*(4+(this.r-this.g)/r),t>360?t-=360:t<0&&(t+=360)):t=e=0,new n(t,e,i)},this.r=s.uZ(t,0,255),this.g=s.uZ(e,0,255),this.b=s.uZ(i,0,255),this.a=s.uZ(a,0,255)}rotateHue(t){let e,i,s,n=Math.min(this.r,this.g,this.b),r=Math.max(this.r,this.g,this.b);e=r/255;var o=r-n;return o?(i=o/r,s=this.r==r?(this.g-this.b)/o*60:this.g==r?60*(2+(this.b-this.r)/o):60*(4+(this.r-this.g)/o)):s=i=0,s+=t,s>360?s-=360:s<0&&(s+=360),360===s&&(s=0),a.fromHSB(s,i,e)}static fromRGB(t){if(/^#[0-9A-F]{6}$/i.test(t))return a.fromHEX(t);let e=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return!e||e.length<4?new a:new a(Number(e[1]),Number(e[2]),Number(e[3]))}static fromHEXA(t){let e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return!e||e.length<4?new a:new a(parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),parseInt(e[4],16))}static fromHEX(t,e=255){let i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return!i||i.length<3?new a:new a(parseInt(i[1],16),parseInt(i[2],16),parseInt(i[3],16),e)}static fromHSB(t,e,i){let s,n,r,o,c,h,l,d;if(0==i)s=0,n=0,r=0;else if(0==e)s=n=r=i;else switch(o=t/60,c=o-Math.floor(o),h=i*(1-e),d=i*(1-e*c),l=i*(1-e*(1-c)),Math.floor(o)){case 0:case 6:s=i,n=l,r=h;break;case 1:s=d,n=i,r=h;break;case 2:s=h,n=i,r=l;break;case 3:s=h,n=d,r=i;break;case 4:s=l,n=h,r=i;break;case 5:s=i,n=h,r=d}return new a(Math.round(255*s),Math.round(255*n),Math.round(255*r))}clone(){return new a(this.r,this.g,this.b,this.a)}}},82542:(t,e,i)=>{i.d(e,{Z:()=>s});class s{static rotation(t){return new Promise(((e,i)=>{const s=new FileReader;s.onload=t=>{t.target||e(0);const i=t.target,s=new DataView(i.result);65496!==s.getUint16(0,!1)&&e(0);const n=s.byteLength;let a=2;for(;a<n;){s.getUint16(a+2,!1)<=8&&e(0);const t=s.getUint16(a,!1);if(a+=2,65505===t){1165519206!==s.getUint32(a+=2,!1)&&e(0);const t=18761===s.getUint16(a+=6,!1);a+=s.getUint32(a+4,t);const i=s.getUint16(a,t);a+=2;for(let n=0;n<i;n++)if(274===s.getUint16(a+12*n,t)){switch(s.getUint16(a+12*n+8,t)){case 8:e(-90);break;case 6:e(90);break;case 3:e(180);break;default:e(0)}return}}else{if(65280!=(65280&t))break;a+=s.getUint16(a,!1)}}e(0)},s.readAsArrayBuffer(t)}))}}},9591:(t,e,i)=>{i.d(e,{Z:()=>r});var s=i(98776),n=i(77359),a=i(9067);class r{constructor(t){this.value=t,this.getType=()=>this.value instanceof s.Z?"color":this.value instanceof n.ZP?"gradient":this.value instanceof a.Z?"pattern":void 0,this.getStringValue=()=>this.value instanceof s.Z?this.value.toHEX():this.value instanceof n.ZP||this.value instanceof a.Z?this.value.toJSON():void 0,this.getCssValue=()=>this.value instanceof s.Z?this.value.toHEX():this.value instanceof n.ZP||this.value instanceof a.Z?this.value.toCSS():void 0,this.addToCanvasFillStyle=(t,e=0,i=0)=>{this.value instanceof s.Z?t.fillStyle=this.value.toHEX():this.value instanceof n.ZP?t.fillStyle=this.value.createCanvasGradient(t,e,i):this.value instanceof a.Z&&(t.fillStyle=this.value.createCanvasPattern(t))},this.addToCanvasStrokeStyle=(t,e=0,i=0)=>{this.value instanceof s.Z?t.strokeStyle=this.value.toHEX():this.value instanceof n.ZP?t.strokeStyle=this.value.createCanvasGradient(t,e,i):this.value instanceof a.Z&&(t.strokeStyle=this.value.createCanvasPattern(t))}}}r.fromString=async(t,e)=>{let i;return"color"===t&&/^#[0-9A-F]{6}$/i.test(e)?i=new r(s.Z.fromHEX(e)):"gradient"===t?i=new r(n.ZP.fromJSON(e)):"pattern"===t&&(i=new r(await a.Z.fromJSON(e))),i}},77359:(t,e,i)=>{i.d(e,{ZP:()=>r});var s=i(33655),n=i(98776);class a{constructor(t,e,i){this.id=t,this.color=e,this.position=i}}class r{constructor(){this.direction=0,this.type="linear",this.addStop=(t,e)=>{e=s.uZ(e,0,1);const i=new a(s.Zd(),t,e);return this.stops.push(i),this.sort(),i},this.removeStop=t=>{const e=this.stops.findIndex((e=>e.id===t));return-1!==e&&this.stops.splice(e,1),this.sort(),this.stops[0].id},this.getStop=t=>{let e;return this.stops.forEach((i=>{i.id===t&&(e=i)})),e},this.sort=()=>{this.stops.sort(((t,e)=>t.position-e.position))},this.toCSS=()=>{let t="linear-gradient(to right";for(let e=0;e<this.stops.length;++e)t+=", "+this.stops[e].color.toRGBA()+" "+(100*this.stops[e].position).toFixed(0)+"%";return t+=")",t},this.toJSON=()=>JSON.stringify(this.toIGradient()),this.toIGradient=()=>{let t=new Array;return this.stops.forEach((e=>{t.push({id:e.id,color:e.color.toHEXA(),position:e.position})})),{type:this.type,direction:this.direction,stops:t}},this.createCanvasGradient=(t,e=0,i=0)=>{let s;if("linear"===this.type){const n=(this.direction-90)*Math.PI/180,a=t.canvas.width,r=t.canvas.height;if(a<1||r<1)return;const o=Math.sqrt(a*a+r*r)/2,c=Math.asin(r/2/o);let h=(n%(2*Math.PI)+4*Math.PI)%(2*Math.PI);h>Math.PI&&(h-=Math.PI),h>Math.PI/2&&h<=Math.PI&&(h=Math.PI/2-(h-Math.PI/2));let l=Math.PI/2-c-Math.abs(h),d=Math.abs(c-Math.abs(h)),u=Math.max(Math.cos(d)*a,Math.cos(l)*r)/2,m=Math.cos(n)*u,p=Math.sin(n)*u;s=t.createLinearGradient(a/2+m+e,r/2+p+i,a/2-m+e,r/2-p+i)}else{let n=t.canvas.width/2,a=t.canvas.height/2,r=Math.max(t.canvas.width,t.canvas.height)/2;s=t.createRadialGradient(n+e,a+i,0,n+e,a+i,r)}return this.addStopToCanvasGradient(s),s},this.addStopToCanvasGradient=(t,e=!1)=>{for(let i=0;i<this.stops.length;++i)t.addColorStop(this.stops[i].position,this.stops[i].color.toRGBA(e?255-this.stops[i].color.a:this.stops[i].color.a))},this.stops=new Array}static fromJSON(t){let e=JSON.parse(t);return r.fromIGradient(e)}static fromIGradient(t){const e=new r;if(e.type=t.type&&"radial"===t.type?"radial":"linear",e.direction=t.direction,t.stops)for(let i=0;i<t.stops.length;++i){let s="string"==typeof t.stops[i].color?n.Z.fromHEXA(t.stops[i].color):new n.Z(t.stops[i].color.r,t.stops[i].color.g,t.stops[i].color.b,t.stops[i].color.a);e.addStop(s,t.stops[i].position)}return e}static fromPreset(t){const e=new r;for(let i=0;i<t.colors.length;++i)e.addStop(n.Z.fromHEXA(t.colors[i]),t.positions[i]);return e.direction=t.direction+180,e.type=t.type,e}static fromColors(t,e){const i=new r;return i.addStop(t,0),i.addStop(e,1),i}}},11726:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(43673);class n{constructor(t=1,e=0,i=0,s=1,a=0,r=0){this.a=t,this.b=e,this.c=i,this.d=s,this.e=a,this.f=r,this.reset=()=>{this.a=this.d=1,this.b=this.c=this.e=this.f=0},this.translate=t=>{this.transform(1,0,0,1,t.x,t.y)},this.rotate=t=>{let e=Math.cos(t),i=Math.sin(t);this.transform(e,i,-i,e,0,0)},this.rotateDegree=function(t){this.rotate(.017453292519943295*t)},this.transform=(t,e,i,s,n,a)=>{const r=this.a,o=this.b,c=this.c,h=this.d,l=this.e,d=this.f;this.a=r*t+c*e,this.b=o*t+h*e,this.c=r*i+c*s,this.d=o*i+h*s,this.e=r*n+c*a+l,this.f=o*n+h*a+d},this.invert=()=>{let t=this.a,e=this.b,i=this.c,s=this.d,a=this.e,r=this.f,o=(new n,t*s-e*i);this.a=s/o,this.b=-e/o,this.c=-i/o,this.d=t/o,this.e=(i*r-s*a)/o,this.f=-(t*r-e*a)/o}}transformPoint(t){return new s.Z(t.x*this.a+t.y*this.c+this.e,t.x*this.b+t.y*this.d+this.f)}}},9067:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(33655),n=i(95574);class a{constructor(t,e=1,i=0){this.svg=t,this.scale=e,this.direction=i,this.createCanvasPattern=t=>{let e;if(1!=this.scale){let i=s.vL(Math.round(this.image.width*this.scale),Math.round(this.image.height*this.scale));i.getContext("2d").drawImage(this.image,0,0,i.width,i.height),e=t.createPattern(i,"repeat")}else e=t.createPattern(this.image,"repeat");return 0!==this.direction&&e.setTransform((new DOMMatrix).rotate(this.direction)),e},this.toCSS=()=>"url(data:image/svg+xml;base64,"+btoa(this.svg)+")",this.toJSON=()=>JSON.stringify(this.toIPattern())}toIPattern(t=this.svg){return{svg:t,scale:this.scale,direction:this.direction}}}a.fromIPattern=async t=>{let e=new a(t.svg,t.scale,t.direction),i=new Blob([e.svg],{type:"image/svg+xml"});return e.image=await(0,n.s4)(i),e},a.fromJSON=async t=>{let e=JSON.parse(t);return a.fromIPattern(e)}},43673:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t=0,e=0){this.x=t,this.y=e}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}angleTo(t){let e=-(this.x-t.x),i=this.y-t.y,s=360-Math.atan2(i,e)*(180/Math.PI);return s<0&&(s+=360),s>360&&(s-=360),s}dot(t){return this.x*t.x+this.y*t.y}lengthSQ(){return this.dot(this)}length(){return Math.sqrt(this.lengthSQ())}hypot2(){return this.dot(this)}hypot(){return Math.hypot(this.x,this.y)}add(t){return t?t instanceof s?new s(this.x+t.x,this.y+t.y):new s(this.x+t,this.y+t):this}neg(t){return t instanceof s?new s(this.x-t.x,this.y-t.y):new s(this.x-t,this.y-t)}mul(t){return t instanceof s?new s(this.x*t.x,this.y*t.y):new s(this.x*t,this.y*t)}rotateAround(t,e){let i=Math.sin(e),n=Math.cos(e),a=this.x-t.x,r=this.y-t.y,o=a*i+r*n;return new s(a*n-r*i+t.x,o+t.y)}equalTo(t){return this.x===t.x&&this.y===t.y}clone(){return new s(this.x,this.y)}}},36817:(t,e,i)=>{i.d(e,{Z:()=>r});var s=i(11726),n=i(43673),a=i(99872);class r{constructor(t=0,e=0,i=0,s=0,n=0){this.x=t,this.y=e,this.width=i,this.height=s,this.rotation=n}left(){return this.x}right(){return this.x+this.width}top(){return this.y}bottom(){return this.y+this.height}size(){return new a.Z(this.width,this.height)}center(){return new n.Z(this.x+this.width/2,this.y+this.height/2)}topLeft(){return new n.Z(this.x,this.y)}topRight(){return new n.Z(this.right(),this.y)}bottomLeft(){return new n.Z(this.x,this.bottom())}bottomRight(){return new n.Z(this.right(),this.bottom())}setTop(t){this.height=this.y+this.height-t,this.y=t}setLeft(t){this.width=this.x+this.width-t,this.x=t}setRight(t){this.width=Math.round(t-this.x)}setBottom(t){this.height=Math.round(t-this.y)}setCenter(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}setCenterX(t){this.x=t-.5*this.width}setCenterY(t){this.y=t-.5*this.height}moveRight(t){this.x=Math.round(t-this.width)}moveBottom(t){this.y=Math.round(t-this.height)}isSet(){return this.x>0||this.y>0||this.width>0||this.height>0||this.rotation>0}isInside(t){return t.x>=this.x&&t.x<this.x+this.width&&t.y>=this.y&&t.y<this.y+this.height}contains(t){return t.x>=this.x&&t.y>=this.y&&t.bottom()<=this.bottom()&&t.right()<=this.right()}equalTo(t){return!!t&&(this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height&&this.rotation===t.rotation)}clone(){return new r(this.x,this.y,this.width,this.height,this.rotation)}scale(t){return new r(Math.round(this.x*t),Math.round(this.y*t),Math.round(this.width*t),Math.round(this.height*t),this.rotation)}flipWidthAndHeight(){return new r(this.y,this.x,this.height,this.width)}union(t){if(!t)return this;const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x+this.width,t.x+t.width),n=Math.max(this.y+this.height,t.y+t.height);return new r(e,i,s-e,n-i)}intersect(t){let e=Math.max(this.x,t.x),i=Math.min(this.x+this.width,t.x+t.width);if(i<=e)return;let s=Math.max(this.y,t.y),n=Math.min(this.y+this.height,t.y+t.height);return n<=s?void 0:new r(e,s,i-e,n-s)}rebase(t,e){return new r(Math.round(this.x-t),Math.round(this.y-e),Math.round(this.width),Math.round(this.height))}gridAlign(){return new r(Math.floor(this.x),Math.floor(this.y),Math.ceil(this.width),Math.ceil(this.height))}getRotatedBounds(){if(0===this.rotation)return this;let t=new s.Z,e=this.center();t.translate(e),t.rotate(this.rotation*Math.PI/180),t.invert();const i=t.transformPoint(this.topLeft()),n=t.transformPoint(this.topRight()),a=t.transformPoint(this.bottomLeft()),o=t.transformPoint(this.bottomRight());let c=r.fromPoints([i,n,a,o]);return c.x=Math.round(c.x+e.x),c.y=Math.round(c.y+e.y),c.rotation=this.rotation,c}rotatedSize(t){const e=this.width,i=this.height,s=(t,e)=>{var i=t[0].x,s=t[0].y,a=t[1].x,r=t[1].y,o=e[0].x,c=e[0].y,h=e[1].x,l=e[1].y;return new n.Z(((i*r-s*a)*(o-h)-(i-a)*(o*l-c*h))/((i-a)*(c-l)-(s-r)*(o-h)),((i*r-s*a)*(c-l)-(s-r)*(o*l-c*h))/((i-a)*(c-l)-(s-r)*(o-h)))};let r,o,c,h,l,d,u;var m=t*(Math.PI/180),p=[new n.Z(0,0),new n.Z(e,0),new n.Z(e,i),new n.Z(0,i)],g=((t,e)=>{for(var i=new Array,s=0;s<t.length;++s)i.push(new n.Z(t[s].x*Math.cos(e)-t[s].y*Math.sin(e),t[s].x*Math.sin(e)+t[s].y*Math.cos(e)));return i})(p=((t,e,i)=>{for(var s=new Array,a=0;a<t.length;++a)s.push(new n.Z(t[a].x+e,t[a].y+i));return s})(p,-e/2,-i/2),m);return t>=0?(r=[new n.Z(0,0),new n.Z(-e/2,-i/2)],c=[g[0],g[3]],d=s(r,c),o=[new n.Z(0,0),new n.Z(e/2,-i/2)],h=[g[0],g[1]],u=s(o,h)):(r=[new n.Z(0,0),new n.Z(e/2,-i/2)],c=[g[1],g[2]],u=s(r,c),o=[new n.Z(0,0),new n.Z(-e/2,-i/2)],h=[g[0],g[1]],d=s(o,h)),l=new n.Z(Math.max(d.x,-u.x),Math.max(d.y,u.y)),new a.Z(Math.round(-l.x-l.x),Math.round(-l.y-l.y))}pad(t){return new r(this.x-t,this.y-t,this.width+2*t,this.height+2*t)}getAspect(){return this.width/this.height}getComparedScale(t){if(t)return new a.Z(this.width/t.width,this.height/t.height)}static calculate(t,e,i=0){if(!t||!e)return;let s=new r;return s.x=Math.round(t.x<e.x?t.x:e.x),s.y=Math.round(t.y<e.y?t.y:e.y),s.width=Math.round(t.x<e.x?e.x-s.x:t.x-s.x),s.height=0!==i?Math.round(s.width/i):Math.round(t.y<e.y?e.y-s.y:t.y-s.y),s}static merge(t,e){if(!t&&!e)return;if(t&&!e)return t;if(!t&&e)return e;const i=Math.round(Math.min(t.x,e.x)),s=Math.round(Math.min(t.y,e.y)),n=Math.round(Math.max(t.x+t.width,e.x+e.width)),a=Math.round(Math.max(t.y+t.height,e.y+e.height));return new r(i,s,n-i,a-s)}static fillFit(t,e,i,s,n=!1){let a=1;return a=t/e<i/s?i/t:s/e,n&&a>1&&(a=1),new r(Math.round((i-t*a)/2),Math.round((s-e*a)/2),Math.round(t*a),Math.round(e*a))}static bestFit(t,e,i,s,n=!1){let a=1;return a=t/e>i/s?i/t:s/e,a>1&&!n&&(a=1),new r(Math.round((i-t*a)/2),Math.round((s-e*a)/2),Math.round(t*a),Math.round(e*a))}static fromPoints(t){let e=t[0].x,i=t[0].x,s=t[0].y,n=t[0].y;return t.forEach((t=>{e=Math.min(t.x,e),i=Math.max(t.x,i),s=Math.min(t.y,s),n=Math.max(t.y,n)})),new r(Math.round(e),Math.round(s),Math.round(i-e),Math.round(n-s))}static fromPointRects(t,e,i){let s=t[0].x,n=t[0].x+e,a=t[0].y,o=t[0].y+i;return t.forEach((t=>{s=Math.min(t.x,s),n=Math.max(t.x+e,n),a=Math.min(t.y,a),o=Math.max(t.y+i,o)})),new r(s,a,n-s,o-a)}}},33347:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e,i){this.start=t,this.stop=e,this.row=i}}},89679:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t,e){this.name=t,this.value=e}}},67175:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(36817);class n{static roundRect(t,e,i,s,n,a=0){const r=Math.min(s/2,n/2,a);t.beginPath(),t.moveTo(e+r,i),t.lineTo(e+s-r,i),t.quadraticCurveTo(e+s,i,e+s,i+r),t.lineTo(e+s,i+n-r),t.quadraticCurveTo(e+s,i+n,e+s-r,i+n),t.lineTo(e+r,i+n),t.quadraticCurveTo(e,i+n,e,i+n-r),t.lineTo(e,i+r),t.quadraticCurveTo(e,i,e+r,i),t.closePath()}}n.ellipse=(t,e,i)=>{let s=.5*(i.x-e.x),n=.5*(i.y-e.y),a=e.x+s,r=e.y+n,o=.01,c=o,h=2*Math.PI-o;for(t.beginPath(),t.moveTo(a+s*Math.cos(0),r+n*Math.sin(0));c<h;c+=o)t.lineTo(a+s*Math.cos(c),r+n*Math.sin(c));t.closePath()},n.triangle=(t,e,i)=>{t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y),t.lineTo(e.x-(i.x-e.x),i.y),t.lineTo(e.x,e.y),t.closePath()},n.star=(t,e,i)=>{let s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2));t.beginPath(),t.translate(e.x,e.y),t.moveTo(0,0-s);for(var n=0;n<5;n++)t.rotate(Math.PI/5),t.lineTo(0,0-.5*s),t.rotate(Math.PI/5),t.lineTo(0,0-s);t.translate(-e.x,-e.y)},n.heart=(t,e,i)=>{let s=Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2)),n=.8*s;t.save(),t.translate(e.x,e.y-s/2),t.rotate(45*Math.PI/180),t.beginPath(),t.moveTo(0,0),t.bezierCurveTo(-n,0,-n,s,0,s),t.lineTo(s,s),t.lineTo(s,0),t.bezierCurveTo(s,-n,0,-n,0,0),t.closePath(),t.restore()},n.rectangle=(t,e,i,s,n)=>{t.beginPath(),t.moveTo(e,i),t.lineTo(e+s,i),t.lineTo(e+s,i+n),t.lineTo(e,i+n),t.lineTo(e,i),t.closePath()},n.line=(t,e,i)=>{t.beginPath(),t.moveTo(e.x,e.y),t.lineTo(i.x,i.y)},n.bezier=(t,e,i,s)=>{t.beginPath(),t.moveTo(e.x,e.y),t.quadraticCurveTo(s.x,s.y,i.x,i.y)},n.arc=(t,e,i)=>{t.beginPath(),t.arc(e.x,e.y,i,0,2*Math.PI)},n.fill=(t,e,i,a,r)=>{switch(e){case"rectangle":t.fillRect(i.x,i.y,a.x-i.x,a.y-i.y);break;case"rounded":const e=s.Z.fromPoints([i,a]);n.roundRect(t,e.x,e.y,e.width,e.height,r),t.fill();break;case"ellipse":n.ellipse(t,i,a),t.fill();break;case"triangle":n.triangle(t,i,a),t.fill();break;case"star":n.star(t,i,a),t.fill();break;case"heart":n.heart(t,i,a),t.fill();break;case"line":n.line(t,i,a),t.stroke()}},n.stroke=(t,e,i,a,r)=>{switch(e){case"rectangle":t.strokeRect(i.x,i.y,a.x-i.x,a.y-i.y);break;case"rounded":const e=s.Z.fromPoints([i,a]);n.roundRect(t,e.x,e.y,e.width,e.height,r),t.stroke();break;case"ellipse":n.ellipse(t,i,a),t.stroke();break;case"triangle":n.triangle(t,i,a),t.stroke();break;case"star":n.star(t,i,a),t.stroke();break;case"heart":n.heart(t,i,a),t.stroke();break;case"line":n.line(t,i,a),t.stroke()}}},99872:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(t=0,e=0){this.width=t,this.height=e}}},59064:(t,e,i)=>{i.d(e,{Z:()=>h});var s=i(33655),n=i(93947),a=i(43673),r=i(98776),o=i(11726),c=i(74820);class h{constructor(t){this.zoomor=!1,this.hypo=void 0,this.cursorPos=new a.Z(-999,-999),this.lastPos=new a.Z(-999,-999),this.ants=Array(!0,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!1,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1,!0,!0,!0,!0,!1,!1,!1),this.hide=()=>{this.raster.style.display="none"},this.show=()=>{this.raster.style.display="block"},this.drawDropPreviewRect=(t,e)=>{this.ctx.save(),this.ctx.strokeStyle=s.TA,this.clear();const i=this.stage.rasterRect,n=this.stage.zoom,a=e.rect.width*n,r=e.rect.height*n;this.ctx.strokeRect(t.x-i.x-a/2,t.y-i.y-r/2,a,r),this.dirty=!0,this.ctx.restore()},this.setPan=(t=this.raster,e=!1)=>{this.override||(this.byMouse=e,this.override=!0,t.addEventListener("mousedown",this.panDown,!1),t.classList.add("grab"),this.stage.resetAnchor(),this.cursorImage&&(0,n.ZP)("cursor-image")&&this.cursorImage.remove())},this.removePan=(t=this.raster)=>{(0,n.ZP)("color-picker-quick")||(this.override=!1,t.classList.remove("grab"),t.removeEventListener("mousedown",this.panDown,!1),this.cursorImage&&((0,n.ZP)("workspace").appendChild(this.cursorImage),this.positionCursorImage()))},this.panDown=t=>{t.stopPropagation(),this.stage.resetAnchor(),this.downPoint=new a.Z(t.clientX,t.clientY),this.downAnchor=this.stage.anchor.clone(),document.addEventListener("mousemove",this.panMove,!0),document.addEventListener("mouseup",this.panUp,!0)},this.panMove=t=>{let e=~~((t.clientX-this.downPoint.x)/this.stage.zoom),i=~~((t.clientY-this.downPoint.y)/this.stage.zoom);this.stage.setAnchor(new a.Z(this.downAnchor.x-e,this.downAnchor.y-i)),this.stage.updateViewport()},this.panUp=t=>{document.removeEventListener("mousemove",this.panMove,!0),document.removeEventListener("mouseup",this.panUp,!0),this.byMouse&&this.removePan()},this.setPicker=(t=this.raster)=>{var e;if(this.override)return;this.override=!0,t.addEventListener("mousedown",this.pickerDown,!1),t.addEventListener("mousemove",this.pickerMove,!1),t.classList.add("crosshair");const i=this.lastPos.clone(),h=new o.Z;let l=null!==(e=(0,n.ZP)("color-picker-quick"))&&void 0!==e?e:(0,n.T)("div",{id:"color-picker-quick"});for(let s=0;s<c.ZP.oldColor.length;s++){h.reset(),h.rotateDegree(14*-s);let t=h.transformPoint(new a.Z(-100,0));t.x+=i.x+20,t.y+=i.y-46;let e=(0,n.T)("div",{className:"color-pod small floater"});e.style.backgroundColor=c.ZP.oldColor[s],e.style.left=t.x+"px",e.style.top=t.y+"px",e.addEventListener("mousemove",(t=>{this.lastPos.x=t.clientX,this.lastPos.y=t.clientY,this.pickerPreview(this.lastPos.clone()),this.preview.style.backgroundColor=t.currentTarget.style.backgroundColor})),e.addEventListener("click",(t=>{let e=r.Z.fromRGB(t.currentTarget.style.backgroundColor);this.preview.style.backgroundColor=e.toHEX(),document.dispatchEvent(new CustomEvent("set-color",{detail:e}))})),l.append(e)}(0,n.ZP)("workspace").appendChild(l),this.pickerCanvas=s.dN(document.getElementsByClassName("canvas")[0]),this.pickerCanvasCTX=this.pickerCanvas.getContext("2d",{willReadFrequently:!0}),this.preview=document.createElement("div"),this.preview.id="color-picker-preview",this.preview.style.display="none",(0,n.ZP)("workspace").appendChild(this.preview),this.cursorImage&&(0,n.ZP)("cursor-image")&&this.cursorImage.remove(),this.pickerPreview(i)},this.updateHistoryPods=()=>{var t=(0,n.ZP)("color-picker-quick").children;for(let e=0;e<t.length;e++)t[e].style.backgroundColor=c.ZP.oldColor[e]},this.pickerMove=t=>{this.lastPos.x=t.clientX,this.lastPos.y=t.clientY,this.pickerPreview(this.lastPos.clone())},this.pickerPreview=t=>{if(this.preview.style.top=t.y-50+"px",this.preview.style.left=t.x+10+"px",this.preview.style.display="block",t.x-=this.stage.canvas.offsetLeft,t.y-=this.stage.canvas.offsetTop,t.x<0||t.y<0||t.x>this.stage.canvas.width||t.y>this.stage.canvas.height)return void(this.preview.style.display="none");let e=this.pickerCanvasCTX.getImageData(t.x,t.y,1,1).data;this.preview.style.backgroundColor=new r.Z(e[0],e[1],e[2]).toHEX()},this.pickerDown=t=>{let e=new a.Z(t.clientX-this.stage.canvas.offsetLeft,t.clientY-this.stage.canvas.offsetTop);if(e.x<0||e.y<0||e.x>this.stage.canvas.width||e.y>this.stage.canvas.height)return;let i=this.pickerCanvasCTX.getImageData(e.x,e.y,1,1).data;const s=new r.Z(i[0],i[1],i[2]);this.updateColorHistory(s),this.updateHistoryPods(),document.dispatchEvent(new CustomEvent("set-color",{detail:s}))},this.updateColorHistory=t=>{let e=t.toHEX(),i=c.ZP.oldColor.findIndex((t=>t===e));i>-1?c.ZP.oldColor.splice(0,0,c.ZP.oldColor.splice(i,1)[0]):(c.ZP.oldColor.pop(),c.ZP.oldColor.unshift(e)),(0,c.Lt)("oldColor",c.ZP.oldColor)},this.removePicker=(t=this.raster)=>{var e;this.override&&(this.override=!1,t.classList.remove("crosshair"),t.removeEventListener("mousedown",this.pickerDown,!1),t.removeEventListener("mousemove",this.pickerMove,!1),this.preview.remove(),null===(e=(0,n.ZP)("color-picker-quick"))||void 0===e||e.remove(),this.cursorImage&&(this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage()),this.pickerCanvasCTX=void 0,this.pickerCanvas=void 0)},this.setCursorImage=t=>{this.cursorImage&&(0,n.ZP)("cursor-image")&&(this.cursorImage.remove(),this.cursorImage=void 0),this.raster.style.cursor=t?"none":"crosshair",t&&(this.cursorImage=t,this.cursorImage.id="cursor-image",this.stage.workspace.appendChild(this.cursorImage),this.positionCursorImage())},this.animateCursorTap=()=>{const t=(0,n.T)("div",{className:"clickEffect"});t.style.top=this.cursorPos.y+this.stage.rasterRect.y+"px",t.style.left=this.cursorPos.x+this.stage.rasterRect.x+"px",t.addEventListener("animationend",(()=>t.remove())),this.stage.workspace.appendChild(t)},this.positionCursorImage=()=>{this.cursorImage&&(this.cursorImage.style.left=this.cursorPos.x-~~(this.cursorImage.width/2)+this.raster.offsetLeft+"px",this.cursorImage.style.top=this.cursorPos.y-~~(this.cursorImage.height/2)+this.raster.offsetTop+"px")},this.removeCursorImage=()=>{this.raster.style.cursor="unset",this.cursorImage&&(this.cursorImage.remove(),this.cursorImage=void 0,this.cursorPos.x=this.cursorPos.y=-999)},this.throttle=0,this.mouseWheel=t=>{if("none"!==c.ZP.scrollMode&&(t.preventDefault(),t.stopPropagation(),this.throttle+20<Date.now())){if(this.throttle=Date.now(),this.stage.supressRender=!0,"zoom"===c.ZP.scrollMode&&!t.shiftKey||"move"===c.ZP.scrollMode&&t.shiftKey){const e=this.stage.getViewPortCenter(),i=new a.Z(t.clientX-this.stage.rasterRect.x,t.clientY-this.stage.rasterRect.y),s=this.stage.translateRasterToFresco(i);this.stage.setFluidZoom(t.deltaY<0);const n=this.stage.translateRasterToFresco(i);this.stage.setAnchor(new a.Z(e.x+(s.x-n.x),e.y+(s.y-n.y)))}else{const e=this.stage.anchor.add(new a.Z(t.deltaX,t.deltaY));this.stage.setAnchor(e)}this.stage.supressRender=!1,this.stage.updateViewport()}},this.mouseMove=t=>{this.lastPos.x=t.clientX,this.lastPos.y=t.clientY,this.cursorPos.x=t.clientX-this.stage.rasterRect.x,this.cursorPos.y=t.clientY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.mouseLeave=t=>{this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.touchMove=t=>{if(t.targetTouches.length>1){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation();let e=Math.hypot(t.targetTouches[0].pageX-t.targetTouches[1].pageX,t.targetTouches[0].pageY-t.targetTouches[1].pageY);if(void 0===this.hypo)return this.hypo=e,this.downPoint=new a.Z((t.targetTouches[0].pageX+t.targetTouches[1].pageX)/2,(t.targetTouches[0].pageY+t.targetTouches[1].pageY)/2),this.stage.resetAnchor(),void(this.downAnchor=this.stage.anchor.clone());if(this.hypo-e<-20||this.hypo-e>20)this.stage.setFluidZoom(Boolean(e>this.hypo)),this.hypo=e;else{const e=new a.Z((t.targetTouches[0].pageX+t.targetTouches[1].pageX)/2,(t.targetTouches[0].pageY+t.targetTouches[1].pageY)/2),i=this.stage.isHDPI?.5*this.stage.zoom:this.stage.zoom,s=Math.round(e.x-this.downPoint.x)/i,n=Math.round(e.y-this.downPoint.y)/i;this.stage.setAnchor(new a.Z(this.downAnchor.x-s,this.downAnchor.y-n)),this.stage.updateViewport()}}else this.lastPos.x=t.targetTouches[0].pageX,this.lastPos.y=t.targetTouches[0].pageY,this.cursorPos.x=t.targetTouches[0].pageX-this.stage.rasterRect.x,this.cursorPos.y=t.targetTouches[0].pageY-this.stage.rasterRect.y,this.cursorImage&&this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:this.stage.translateRasterToFresco(this.cursorPos)}))},this.touchEnd=t=>{t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.hypo=void 0,this.downPoint=void 0,this.downAnchor=void 0,this.cursorPos.x=this.cursorPos.y=-999,this.positionCursorImage(),document.dispatchEvent(new CustomEvent("mouse-cord",{detail:void 0}))},this.freeze=(t=!0)=>{this.frozen=t,t||this.render()},this.sleep=()=>{this.sleeping=!0,this.clear(!0)},this.wake=()=>{this.sleeping=!1,this.render()},this.so=7,this.render=(t,e=!0)=>{if(e&&this.clear(),this.sleeping)return;if(window.clearTimeout(this.timer),!this.stage||!this.stage.fresco||this.stage.supressRender)return;if(!this.stage.fresco.hasSelection())return void(t&&this.ctx.putImageData(t,0,0));let i,s,n,a,r,o=this.stage.zoom,c=this.stage.fresco.selection,h=this.stage.getViewPort(),l=this.stage.offset.x>0?this.stage.offset.x:0,d=this.stage.offset.y>0?this.stage.offset.y:0;if(t||(t=this.getImageData()),o>1){var u=Math.ceil(o)-1;for(let e=0,o=0,l=c.outline.length;e<l;e+=3)if(n=c.outline[e],a=c.outline[e+1],r=c.outline[e+2],n+c.offset.x>=h.x&&n+c.offset.x<h.x+h.width&&a+c.offset.y>=h.y&&a+c.offset.y<h.y+h.height)switch(i=Math.round((n+c.offset.x)*this.stage.zoom)+this.stage.offset.x,s=Math.round((a+c.offset.y)*this.stage.zoom)+this.stage.offset.y,r){case 0:for(this.drawAnt(i,s,t),o=1;o<=u;++o)this.drawAnt(i+o,s,t),this.drawAnt(i,s+o,t);break;case 1:for(o=0;o<=u;++o)this.drawAnt(i+o,s,t);break;case 2:for(i+=u,this.drawAnt(i,s,t),o=1;o<=u;++o)this.drawAnt(i-o,s,t),this.drawAnt(i,s+o,t);break;case 3:for(o=0;o<=u;++o)this.drawAnt(i,s+o,t);break;case 4:for(i+=u,o=0;o<=u;++o)this.drawAnt(i,s+o,t);break;case 5:for(s+=u,this.drawAnt(i,s,t),o=1;o<=u;++o)this.drawAnt(i,s-o,t),this.drawAnt(i+o,s,t);break;case 6:for(s+=u,o=0;o<=u;++o)this.drawAnt(i+o,s,t);break;case 7:for(i+=u,s+=u,this.drawAnt(i,s,t),o=1;o<=u;++o)this.drawAnt(i,s-o,t),this.drawAnt(i-o,s,t);break;case 8:for(this.drawAnt(i,s,t),this.drawAnt(i+u,s+u,t),o=1;o<=u;++o)this.drawAnt(i+o,s,t),this.drawAnt(i,s+o,t),this.drawAnt(i+u,s-o+u,t),this.drawAnt(i-o+u,s+u,t);break;case 9:for(this.drawAnt(i,s,t),o=1;o<=u;++o)this.drawAnt(i+o,s,t),this.drawAnt(i,s+o,t),this.drawAnt(i+o,s+u,t);break;case 10:for(i+=u,s+=u,this.drawAnt(i,s,t),o=1;o<=u;++o)this.drawAnt(i+o-u,s-u,t),this.drawAnt(i,s-o,t),this.drawAnt(i-o,s,t);break;case 11:for(o=0;o<=u;++o)this.drawAnt(i+o,s,t),this.drawAnt(i,s+o,t),this.drawAnt(i+u,s+o,t);break;case 12:for(o=0;o<=u;++o)this.drawAnt(i+o,s+u,t),this.drawAnt(i,s+o,t),this.drawAnt(i+u,s+o,t);break;case 13:for(o=0;o<=u;++o)this.drawAnt(i,s+o,t),this.drawAnt(i+u,s+o,t);break;case 14:for(o=0;o<=u;++o)this.drawAnt(i+o,s,t),this.drawAnt(i+o,s+u,t)}}else for(let m=0,p=c.outline.length;m<p;m+=3)n=c.outline[m],a=c.outline[m+1],r=c.outline[m+2],i=Math.round((n+c.offset.x-h.x)*o)+l,s=Math.round((a+c.offset.y-h.y)*o)+d,this.drawAnt(i,s,t);this.ctx.putImageData(t,0,0),this.dirty=!0,this.frozen||(this.timer=window.setTimeout((()=>{--this.so<0&&(this.so=7),this.frozen||this.render()}),400))},this.drawAnt=(t,e,i)=>{if(e=~~e,(t=~~t)>=0&&e>=0&&t<this.raster.width&&e<this.raster.height){let s=4*(e*this.raster.width+t);this.ants[(t+this.so)%8*8+e%8]?(i.data[s]=0,i.data[s+1]=0,i.data[s+2]=0,i.data[s+3]=255):(i.data[s]=255,i.data[s+1]=255,i.data[s+2]=255,i.data[s+3]=255)}},this.clear=(t=!1)=>{(t||this.dirty)&&(this.ctx&&this.ctx.clearRect(0,0,this.raster.width,this.raster.height),this.dirty=!1)},this.stage=t,this.raster=t.raster,this.ctx=this.raster.getContext("2d",{willReadFrequently:!0}),this.ctx.imageSmoothingEnabled=!1,this.raster.addEventListener("mousemove",this.mouseMove,!0),this.raster.addEventListener("mouseout",this.mouseLeave,!0),this.raster.addEventListener("touchmove",this.touchMove,{passive:!1}),this.raster.addEventListener("touchend",this.touchEnd,{passive:!1}),this.raster.addEventListener("wheel",this.mouseWheel,{passive:!1}),this.raster.addEventListener("contextmenu",(t=>{t.preventDefault()}),!1),"e"===c.ZP.product&&document.addEventListener("viewport-render",(()=>this.render()),!1)}getImageData(){return this.ctx.getImageData(0,0,this.raster.width,this.raster.height)}drawAntPolygon(t){this.clear(),t.length>0&&(this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),t.forEach((t=>{this.ctx.lineTo(t.x,t.y)})),this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y),t.forEach((t=>{this.ctx.lineTo(t.x,t.y)})),this.ctx.stroke(),this.ctx.restore(),this.dirty=!0),this.render(void 0,!1)}drawAntBezier(t){if(this.clear(),t.length>0){this.ctx.save(),this.ctx.translate(.5,.5),this.ctx.strokeStyle="#ffffff",this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e+=2)e+1===t.length?this.ctx.lineTo(t[e].x,t[e].y):this.ctx.quadraticCurveTo(t[e+1].x,t[e+1].y,t[e].x,t[e].y);this.ctx.stroke(),this.ctx.strokeStyle="#000000",this.ctx.setLineDash([5,5]),this.ctx.beginPath(),this.ctx.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e+=2)e+1===t.length?this.ctx.lineTo(t[e].x,t[e].y):this.ctx.quadraticCurveTo(t[e+1].x,t[e+1].y,t[e].x,t[e].y);this.ctx.stroke(),this.ctx.restore(),this.dirty=!0}this.render(void 0,!1)}drawAntRectangle(t){this.clear();let e=this.getImageData();for(var i=0;i<t.height;++i)this.drawAnt(t.x,t.y+i,e),this.drawAnt(t.right()-1,t.y+i,e);for(var s=0;s<t.width;++s)this.drawAnt(t.x+s,t.y,e),this.drawAnt(t.x+s,t.bottom()-1,e);this.dirty=!0,this.render(e,!1)}drawAntEllipse(t){this.clear();let e=this.getImageData();var i,s,n,a,r,o,c,h,l,d,u,m,p,g,v,f,y=t.width%2==0?1:0,w=t.height%2==0?1:0;i=.5*t.width,c=0,h=s=.5*t.height,u=(l=i*i)*(1-(s<<1))+(g=(d=s*s)<<1),m=d-(p=l<<1)*((s<<1)-1),n=3*g,a=f=d<<2,r=(v=l<<2)*(s-1),o=p*((s<<1)-3),this.drawAnt(t.x+c+i-y,t.y+h+s-w,e),this.drawAnt(t.x-c+i,t.y+h+s-w,e),this.drawAnt(t.x-c+i,t.y-h+s,e),this.drawAnt(t.x+c+i-y,t.y-h+s,e);do{u<0?(u+=n,m+=a,n+=f,a+=f,c++):m<0?(u+=n-r,n+=f,r-=v,m+=a-o,a+=f,o-=v,c++,h--):(u-=r,r-=v,m-=o,o-=v,h--),this.drawAnt(t.x+c+i-y,t.y+h+s-w,e),this.drawAnt(t.x-c+i,t.y+h+s-w,e),this.drawAnt(t.x-c+i,t.y-h+s,e),this.drawAnt(t.x+c+i-y,t.y-h+s,e)}while(h>0);this.dirty=!0,this.render(e,!1)}cleanUp(){window.clearTimeout(this.timer)}}},94699:(t,e,i)=>{i.d(e,{F:()=>b,q:()=>x});var s=i(33655),n=i(23770),a=i(95574),r=i(36817),o=i(78685),c=i(82282),h=i(51294),l=i(87108),d=i(77664),u=i(44170),m=i(77758),p=i(50694),g=i(44686),v=i(47163),f=i(92396),y=i(68934),w=i(84253);class x{constructor(t,e,i,s,n,a,r){this.name=e,this.width=i,this.height=s,this.color=n,this.animation=r,this.templateMeta=a,this.id=t,this.lastModified=new Date,this.pinned=!1,this.timeoutId=null}async restore(t){const e=await(0,n.X3)();try{const[i,n]=e.transaction("readonly","layer-meta","document-selection"),[a,o]=await Promise.all([i.index("document").getAll(this.id),n.get(this.id)]);this.order||(this.order=a.sort(((t,e)=>t.order-e.order)).map((t=>t.id)));let c=[];if(this.order.forEach((t=>{const e=a.find((e=>e.id===t));e&&("bitmap"===e.type&&(e.type=u.Z.TYPE_IMAGE),e.settings.rotation&&e.rect&&void 0===e.rect.rotation&&(e.rect.rotation=e.settings.rotation),e.rect&&void 0===e.rect.rotation&&(e.rect=new r.Z(e.rect.x,e.rect.y,e.rect.width,e.rect.height,0)),c.push(e))})),c.length!==a.length){console.warn("Had layers that could not be sorted, this is a problem");const t=a.filter((t=>!this.order.includes(t.id)));c=c.concat(t)}if(o){t.fresco.addSelection();const e=t.fresco.selection;e.mask=await s.Td(o),e.ctx=e.mask.getContext("2d"),e.createOutline()}const h=await Promise.all(c.map((async t=>{const i=s.mS(b,t),[n,a]=e.transaction("readonly","layer-bitmap","layer-mask"),[r,o]=await Promise.all([n.get(i.id),a.get(i.id)]);return i.toLayer(r,o)})));h.forEach((e=>t.fresco.layers.push(e))),t.fresco.layers.length>0&&t.selectLayer(t.fresco.layers[0])}catch(i){throw console.error("Restore",i),i}}async save(){const t=await(0,n.X3)(),[e]=t.transaction("readwrite","document-meta");await e.put(this)}async remove(){const t=await(0,n.X3)(),[e,i,s,a,r,o]=t.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),c=[e.delete(this.id),i.delete(this.id),s.delete(this.id)],h=await a.index("document").getAll(this.id);for(let n=0;n<h.length;n++){const t=h[n];c.push(a.delete(t.id)),c.push(o.delete(t.id)),c.push(r.delete(t.id))}await Promise.all(c)}async pendingRemove(t){const e=setTimeout((async()=>{await this.remove(),t(null,this)}),5e3);this.timeoutId=e}async undoRemove(){clearTimeout(this.timeoutId)}static async saveOrder(t){const e=t.layers.map((t=>t.id)),i=await(0,n.X3)(),[s]=i.transaction("readwrite","document-meta"),a=await s.get(t.id);a.order=e,await s.put(a)}static async duplicate(t){const e=await(0,n.X3)(),[i,a,r,o,c,h]=e.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta","layer-mask","layer-bitmap"),l=s.M8(),d=[(async()=>{const e=await a.get(t);e&&await a.add(e,l)})(),(async()=>{const e=await r.get(t);e&&await r.add(e,l)})()],u=await o.index("document").getAll(t),m={};for(let n=0;n<u.length;n++){const t=u[n],e=t.id,i=s.M8();m[e]=i,d.push((async()=>{t.id=i,t.document=l,await o.add(t)})(),(async()=>{const t=await h.get(e);t&&await h.add(t,i)})(),(async()=>{const t=await c.get(e);t&&await c.add(t,i)})())}d.push((async()=>{const e=await i.get(t);e.id=l,e.pinned=!1,e.order=e.order.map((t=>m[t])),e.lastModified=new Date,await i.add(e)})()),await Promise.all(d)}static async deleteAll(){const t=await(0,n.X3)(),[e]=t.transaction("readwrite","document-meta"),i=await e.getAll();for(let n=0;n<i.length;n++){const t=s.mS(x,i[n]);t.pinned||await t.remove()}}async getThumbnail(){const t=await(0,n.X3)(),[e]=t.transaction("readonly","document-thumbnail"),i=await e.get(this.id);return i?"string"==typeof i?(0,a.OA)(i):(0,a.s4)(i):Promise.resolve(void 0)}static async getAll(){const t=await(0,n.X3)(),[e]=t.transaction("readonly","document-meta");return(await e.getAll()).map((t=>s.mS(x,t)))}static async history(){return x.getAll().then((t=>t.sort(((t,e)=>t.lastModified===e.lastModified?0:t.lastModified<e.lastModified?1:-1))))}static async getByID(t){const e=await(0,n.X3)(),[i]=e.transaction("readonly","document-meta"),a=await i.get(t);return s.mS(x,a)}async pin(){this.pinned=!0,await this.save()}async unpin(){this.pinned=!1,await this.save()}}class b{constructor(t,e){this.order=0,this.id=t.id,this.type=t.type,this.document=e,this.settings=t.settings,this.animation=t.animation,this.rect=t.rect,this.trim=t.trim,t instanceof o.Z&&(this.textSettings=t.textSettings,this.text=t.text),t instanceof d.Z&&(this.url=t.url,this.variant=t.variant,this.scalemethod=t.scalemethod),t instanceof l.Z&&(this.shapeSettings=t.shapeSettings),t instanceof h.Z&&(this.frameSettings=t.frameSettings),t instanceof w.Z&&(this.groupSettings=t.groupSettings)}async toLayer(t,e){const i="string"==typeof t?await s.lU(t):await s.Td(t),n="string"==typeof e?await s.lU(e):await s.Td(e);switch(this.type){case u.Z.TYPE_IMAGE:{const t=new c.Z(this.id,this.settings.name,i,s.mS(r.Z,this.rect),this.settings.locked);return n&&(t.mask=n,t.render()),t.settings=this.settings,t.animation=s.mS(f.Z,this.animation),t}case u.Z.TYPE_ELEMENT:{const t=new d.Z(this.id,this.settings.name,i,this.url,this.variant,this.settings.blendmode,this.scalemethod);return t.settings=this.settings,t.rect=s.mS(r.Z,this.rect),t.animation=s.mS(f.Z,this.animation),t}case u.Z.TYPE_TEXT:{const t=new o.Z(this.id,this.text,s.mS(r.Z,this.rect),s.mS(m.Z,this.textSettings));return t.settings=this.settings,t.animation=s.mS(f.Z,this.animation),await v.Z.loadFont(this.textSettings.font),await t.prepare(),t}case u.Z.TYPE_SHAPE:{const t=new l.Z(this.id,this.settings.name,s.mS(r.Z,this.rect),s.mS(g.Z,this.shapeSettings));return t.settings=this.settings,t.animation=s.mS(f.Z,this.animation),await t.prepare(),t}case u.Z.TYPE_FRAME:{const t=new h.Z(this.id,this.settings.name,s.mS(r.Z,this.rect),s.mS(p.Z,this.frameSettings));return t.canvas=i,t.settings=this.settings,t.trim=s.mS(r.Z,this.trim),t.animation=s.mS(f.Z,this.animation),t.canvas&&t.render(),t}case u.Z.TYPE_GROUP:{const t=new w.Z(this.id,this.settings.name,s.mS(y.Z,this.groupSettings));return t.settings=this.settings,t.animation=s.mS(f.Z,this.animation),t}}}static async delete(t){const e=await(0,n.X3)();let[i,s,a]=e.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([i.delete(t),s.delete(t),a.delete(t)])}static async sync(t,e){if(!e.hasLayer(t))throw new Error("This is probably a bug, cant create layermeta from layer not in the fresco");const i=new b(t,e.id);let a=!1;if(t.type===u.Z.TYPE_IMAGE||t.type===u.Z.TYPE_ELEMENT?a=t.rect&&t.rect.isSet()&&!!t.canvas||!t.rect&&!t.canvas:t.type===u.Z.TYPE_FRAME&&(a=t.trim&&t.trim.isSet()&&!!t.canvas||!t.trim&&!t.canvas),a){const[e,a]=await Promise.all([s._c(t.canvas),s._c(t.mask)]),r=await(0,n.X3)();let[o,c,h]=r.transaction("readwrite","layer-bitmap","layer-meta","layer-mask");await Promise.all([c.put(i),e?o.put(e,i.id):o.delete(i.id),a?h.put(a,i.id):h.delete(i.id)])}else{const t=await(0,n.X3)();let[e]=t.transaction("readwrite","layer-meta");await e.put(i)}t.syncLatest=new Date}}},77664:(t,e,i)=>{i.d(e,{Z:()=>h});var s=i(44170),n=i(33655),a=i(36817),r=i(43673),o=i(82282),c=i(92396);class h extends s.Z{constructor(t=n.M8(),e,i,l,d,u="",m=h.SCALE_METHOD_NONE){super(s.Z.TYPE_ELEMENT),this.id=t,this.rotateAndFit=(t,e)=>{this.settings.locked&&this.variant===h.VARIANT_OVERLAY?(this.rotate(t),this.calculate(new r.Z(0,0),new r.Z(e.width,e.height),0)):this.rect.rotation+=t?-90:90},this.calculate=(t,e,i)=>{this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<10&&(this.rect.width=10),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(e.y-t.y),this.rect.height<10&&(this.rect.height=10))},this.rasterize=()=>{const t=new o.Z(n.M8(),this.settings.name,n.dN(this.canvas),this.rect.clone(),this.settings.locked);return t.settings=Object.assign({},this.settings),t.applyTransform(),t},this.clone=(t=!1)=>{let e=new h(t?this.id:n.M8(),this.settings.name,n.dN(this.canvas),this.url,this.variant,this.settings.blendmode,this.scalemethod);return e.settings=Object.assign({},this.settings),e.rect=this.rect.clone(),e.animation=c.Z.clone(this.animation),t&&(e.id=this.id,e.settings.name=this.settings.name),e},this.url=l,this.canvas=i,this.variant=d,this.scalemethod=m,this.settings.name=e,this.settings.blendmode=u,this.rect=new a.Z(0,0,i.width,i.height)}}h.VARIANT_OVERLAY="overlay",h.VARIANT_STICKER="sticker",h.SCALE_METHOD_STRETCH="stretch",h.SCALE_METHOD_FILL="fill",h.SCALE_METHOD_NONE="none"},51294:(t,e,i)=>{i.d(e,{Z:()=>d});var s=i(44170),n=i(33655),a=i(36817),r=i(98776),o=i(43673),c=i(82282),h=i(50694),l=i(92396);class d extends s.Z{constructor(t=n.M8(),e,i,u=new h.Z){super(s.Z.TYPE_FRAME),this.id=t,this.prepare=()=>{this.setPath()},this.calculate=(t,e,i)=>{this.editMode&&this.trim?(this.trim.x=Math.round(t.x),this.trim.y=Math.round(t.y),this.trim.width=Math.round(e.x-t.x),this.trim.height=0===i?Math.round(e.y-t.y):Math.round(this.trim.width/(this.canvas.width/this.canvas.height)),this.trim.width<10&&(this.trim.width=10),this.trim.height<10&&(this.trim.height=10)):(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.height=0!==i?Math.round(this.rect.width/i):Math.round(e.y-t.y),this.rect.width<10&&(this.rect.width=10),this.rect.height<10&&(this.rect.height=10))},this.setWidth=(t,e)=>{this.rect&&(t<1&&(t=1),this.editMode&&this.trim?(this.trim.width=t,0!==e&&(this.trim.height=Math.round(this.trim.width/(this.canvas.width/this.canvas.height)))):(this.rect.width=t,0!==e&&(this.rect.height=this.rect.width*e)),this.render())},this.setHeight=(t,e)=>{this.rect&&(t<1&&(t=1),this.editMode&&this.trim?(this.trim.height=t,0!==e&&(this.trim.height=Math.round(this.trim.height/(this.canvas.height/this.canvas.width)))):(this.rect.height=t,0!==e&&(this.rect.width=this.rect.height/e)),this.render())},this.position=(t,e)=>{this.rect&&(this.editMode?(this.trim&&(void 0!==t&&(this.trim.x=t),void 0!==e&&(this.trim.y=e)),this.render()):(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e),this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(t,e)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.trim&&(this.trim.x=Math.round(this.trim.x*t),this.trim.y=Math.round(this.trim.y*e),this.trim.width=Math.round(this.trim.width*t),this.trim.height=Math.round(this.trim.height*e)),this.frameSettings.outlineSize>0&&(this.frameSettings.outlineSize=Math.round(this.frameSettings.outlineSize*t)),this.frameSettings.shadow&&(this.frameSettings.shadowDistance=Math.round(100*this.frameSettings.shadowDistance*t)/100,this.frameSettings.shadowBlur=Math.round(100*this.frameSettings.shadowBlur*t)/100),this.render())},this.rotate=t=>{this.rect.rotation+=t?-90:90},this.flip=t=>{this.canvas&&(this.canvas=n.x2(this.canvas,t),this.render())},this.setPath=(t=this.frameSettings.clip,e=!1)=>{t&&(e||(this.frameSettings.clip=t),this.path2D=new Path2D(t)),this.render()},this.setOutline=(t,e,i)=>{this.frameSettings.outline=t,this.frameSettings.outlineSize=e,this.frameSettings.outlineColor=i,this.render()},this.setShadow=(t,e,i,s,n,a)=>{this.frameSettings.shadow=t,this.frameSettings.shadowBlur=e,this.frameSettings.shadowOpacity=i,this.frameSettings.shadowColor=s,this.frameSettings.shadowDistance=n,this.frameSettings.shadowDirection=a,this.render()},this.setFrameSettings=t=>{this.frameSettings=t,this.render()},this.setContent=t=>{this.canvas=t,this.fitContent()},this.trimOnResize=t=>{if(!this.trim)return;let e=this.rect.getComparedScale(t);this.trim.x=Math.round(this.trim.x*e.width),this.trim.y=Math.round(this.trim.y*e.height),this.trim.width=Math.round(this.trim.width*e.width),this.trim.height=Math.round(this.trim.height*e.height)},this.fitContent=()=>{this.canvas?this.trim=a.Z.fillFit(this.canvas.width,this.canvas.height,this.rect.width,this.rect.height):this.trim=void 0,this.render()},this.getGlobalTrim=()=>{if(this.trim)return new a.Z(this.rect.x+this.trim.x,this.rect.y+this.trim.y,this.trim.width,this.trim.height,this.rect.rotation)},this.scaleTrim=(t,e)=>{let i=this.trim.clone();this.trim.x=Math.round(this.trim.x*t),this.trim.y=Math.round(this.trim.y*e),this.trim.width=Math.round(this.trim.width*t),this.trim.height=Math.round(this.trim.height*e),this.trim.width<1&&(this.trim.width=1),this.trim.height<1&&(this.trim.height=1),this.render(),this.trim=i},this.render=()=>{if(this.bect=this.rect.clone(),this.frameSettings.shadow){let t=100*this.frameSettings.shadowBlur;t+=Math.abs(100*this.frameSettings.shadowDistance),this.bect.width+=2*t,this.bect.height+=2*t,this.bect.x-=t,this.bect.y-=t}const t=this.baked.getContext("2d");if(this.baked.width!==this.bect.width||this.baked.height!==this.bect.height?(this.baked.height=this.bect.height,this.baked.width=this.bect.width):t.clearRect(0,0,this.baked.width,this.baked.height),this.canvas){const e=new Path2D;let i=t.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):0;e.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-i)/100,(this.rect.height-i)/100)),t.save(),t.translate(this.rect.x-this.bect.x+i/2,this.rect.y-this.bect.y+i/2),this.frameSettings.outline?(t.strokeStyle=this.frameSettings.outlineColor,t.lineWidth=i,this.frameSettings.shadow&&this.shadowContext(t),t.fill(e),t.stroke(e)):this.frameSettings.shadow&&(this.shadowContext(t),t.fill(e)),t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0,t.clip(e),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high",t.drawImage(this.canvas,this.trim.x-i/2,this.trim.y-i/2,this.trim.width,this.trim.height),t.restore()}else{const e=new Path2D;let i=t.lineWidth=this.frameSettings.outline?Math.round(100*this.frameSettings.outlineSize):2;e.addPath(this.path2D,(new DOMMatrix).scale((this.rect.width-i)/100,(this.rect.height-i)/100)),t.save(),t.translate(this.rect.x-this.bect.x+i/2,this.rect.y-this.bect.y+i/2),this.frameSettings.outline?t.strokeStyle=this.frameSettings.outlineColor:t.strokeStyle="#ccc",t.fillStyle="rgba(0, 0, 0, 0.3)",this.frameSettings.shadow&&this.shadowContext(t),t.fill(e),t.stroke(e),t.restore();const s=new o.Z(Math.round(this.bect.width/2),Math.round(this.bect.height/2));let n=20;t.lineWidth=8,this.rect.width>500&&this.rect.height>500&&(t.lineWidth=16,n=40),t.save(),t.strokeStyle="rgba(255, 255, 255, 0.5)",t.beginPath(),t.moveTo(s.x-n,s.y),t.lineTo(s.x+n,s.y),t.moveTo(s.x,s.y-n),t.lineTo(s.x,s.y+n),t.closePath(),t.stroke(),t.restore()}},this.shadowContext=t=>{const e=r.Z.fromHEX(this.frameSettings.shadowColor,Math.round(255*this.frameSettings.shadowOpacity)).toRGBA();var i=(this.frameSettings.shadowDirection-90)*Math.PI/180,s=Math.cos(i)*this.frameSettings.shadowDistance,n=Math.sin(i)*this.frameSettings.shadowDistance;t.fillStyle=e,t.shadowColor=e,t.shadowBlur=100*this.frameSettings.shadowBlur,t.shadowOffsetX=100*s,t.shadowOffsetY=100*n},this.replaceCanvas=t=>{const e=this.canvas.getContext("2d");e.save(),e.globalCompositeOperation="copy",e.drawImage(t,0,0),e.restore()},this.switchCanvas=(t,e)=>{this.canvas=t,this.trim=e.clone(),this.render()},this.rasterize=()=>{let t=this.baked?this.baked:this.canvas,e=this.bect?this.bect.clone():this.rect.clone();const i=new c.Z(n.M8(),this.settings.name,t,e,this.settings.locked);return i.settings=Object.assign({},this.settings),i.applyTransform(),i},this.clone=(t=!1)=>{var e;let i=new d(t?this.id:n.M8(),this.settings.name,this.rect.clone(),this.frameSettings.clone());return i.settings=Object.assign({},this.settings),i.animation=l.Z.clone(this.animation),i.trim=null===(e=this.trim)||void 0===e?void 0:e.clone(),i.canvas=n.dN(this.canvas),i.render(),t&&(i.id=this.id,i.settings.name=this.settings.name),i},this.rect=i,this.settings.name=e,this.frameSettings=u,this.baked=n.vL(i.width,i.height),this.prepare()}}},50694:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(){this.clip="M 0,0 H 100 V 100 H 0 Z",this.outline=!1,this.outlineColor="#555555",this.outlineSize=.3,this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const t=Object.create(s.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.clip===t.clip&&this.outline===t.outline&&this.outlineSize===t.outlineSize&&this.outlineColor===t.outlineColor&&this.shadow===t.shadow&&this.shadowBlur===t.shadowBlur&&this.shadowColor===t.shadowColor&&this.shadowOpacity===t.shadowOpacity&&this.shadowDistance===t.shadowDistance&&this.shadowDirection===t.shadowDirection)}}},58027:(t,e,i)=>{i.d(e,{Z:()=>c});var s=i(44170),n=i(36817),a=i(51294),r=i(49198),o=i(22758);class c{constructor(t,e,i,r,o,c,h,l){this.block=!1,this.layerAddedCounterForUserEase=0,this.savedTimesCounterForUserEase=0,this.setBlock=(t=!1)=>{this.block=t||Boolean(!!this.templateMeta&&this.templateMeta.locked)},this.unblock=()=>{this.block=!1,this.templateMeta&&(this.templateMeta.locked=!1)},this.getSelected=()=>1!==this.selected.length?void 0:this.selected[0],this.getSelectedStack=()=>this.selected,this.getSelectedLinkedStack=()=>this.selectedLinked,this.updateSelectedLinkedStack=()=>{let t=new Set;for(let i of this.selected)i.hasLink()&&t.add(i.settings.link);let e=this.layers.filter((e=>t.has(e.settings.link)));this.selectedLinked=[...new Set([...this.selected,...e])]},this.getNotSelectedStack=(t=this.selected)=>this.layers.filter((e=>!t.includes(e))),this.getStackRect=(t=this.selected)=>{let e=new Array;for(let i of t)e.push(i.rect?i.rect.clone():void 0);return e},this.getStackBounds=(t=this.selected)=>{let e;if(1===t.length)e=t[0].editMode&&t[0]instanceof a.Z?t[0].trim.clone():t[0].rect?t[0].rect.clone():void 0;else for(let i of t)i.rect&&(e=n.Z.merge(e,i.rect.getRotatedBounds()));return e},this.getStackId=(t=this.selected)=>{let e=new Array;return t.forEach((t=>{e.push(t.id)})),e},this.getStackHashId=(t=this.selected)=>{if(0===t.length)return;if(1===t.length)return t[0].id;let e=this.getStackId(t).join(),i=0;for(let s=0;s<e.length;s++)i=(i<<5)-i+e.charCodeAt(s),i&=i;return i.toString()},this.getLayerById=t=>{let e;return this.layers.forEach((i=>{i.id===t&&(e=i)})),e},this.hasSelected=()=>this.selected.length>0,this.isSelectedStack=()=>this.selected.length>1,this.isSelectedLinkedStack=()=>this.selectedLinked.length>1,this.isSelectedType=t=>1===this.selected.length&&this.selected[0].type===t,this.isSelectedImageWithCanvas=()=>(!this.selected||1===this.selected.length)&&(this.selected[0].type===s.Z.TYPE_IMAGE&&!!this.selected[0].canvas),this.isSelectedShaderbleWithCanvas=()=>(!this.selected||1===this.selected.length)&&((this.selected[0].type===s.Z.TYPE_IMAGE||this.selected[0].type===s.Z.TYPE_FRAME||this.selected[0].type===s.Z.TYPE_ELEMENT)&&!!this.selected[0].canvas),this.isSelectedById=t=>{if(t)return-1!==this.selected.findIndex((e=>e.id===t))},this.isSelectedLinkedById=t=>{if(t)return-1!==this.selectedLinked.findIndex((e=>e.id===t))},this.selectLayerById=(t,e=!1,i=!1)=>{this.selected[0]&&(this.selected[0].editMode=!1);let n=!1;return t?e?this.isSelectedById(t)?i&&(this.unselectLayerById(t),n=!0):(this.selected.push(this.getLayerById(t)),n=!0):this.isSelectedById(t)&&1===this.selected.length||(this.selected=[this.getLayerById(t)],n=!0):0!==this.layers.length&&this.layers[0].settings.locked&&this.layers[0].type===s.Z.TYPE_IMAGE?0===this.selected.length||1===this.selected.length&&this.selected[0]===this.layers[0]||(this.selected=[this.layers[0]],n=!0):0!==this.selected.length&&(this.selected=[],n=!0),this.selected.length>1&&this.selected.sort(((t,e)=>this.layers.indexOf(t)-this.layers.indexOf(e))),this.updateSelectedLinkedStack(),n},this.unselectLayerById=t=>{const e=this.selected.findIndex((e=>e.id===t));return-1!==e?(this.selected.splice(e,1),!0):(this.updateSelectedLinkedStack(),!1)},this.unselectLayers=()=>{this.selected=[],this.selectedLinked=[]},this.selectLayerStack=(t,e=!1)=>{this.selected=t,this.updateSelectedLinkedStack()},this.deleteLayerById=t=>{const e=this.layers.findIndex((e=>e.id===t));let i;return-1!==e&&(i=this.layers[e],this.layers.splice(e,1),this.unselectLayerById(t)),!this.hasSelected()&&this.layers.length>0&&(this.selected=[this.layers[e>0?e-1:0]]),this.updateSelectedLinkedStack(),i},this.id=t,this.name=e,this.width=i,this.height=r,this.color=o,this.animation=c,this.templateMeta=h,this.source=l,this.layers=[],this.selected=[],this.selectedLinked=[],this.setBlock()}addScratch(){return this.scratch||(this.scratch=new r.Z),this.scratch}removeScratch(){this.scratch=void 0}hasScratch(){return!!this.scratch&&"none"!==this.scratch.renderMode}addSelection(){this.selection||(this.selection=new o.Z(this.width,this.height))}clearSelection(){this.selection&&this.selection.clear()}removeSelection(){this.selection&&(this.selection.cleanUp(),this.selection=void 0)}hasSelection(){return this.selection&&this.selection.bounds&&this.selection.outline&&this.selection.outline.length>0}hasAnimation(){if(this.animation)return!0;for(const t of this.layers)if(t.animation&&!t.animation.block)return!0;return!1}hasLayers(){return this.layers.length>0}hasLayer(t){return this.layerNr(t.id)>=0}numLayers(){return this.layers.length}numSelected(){return this.selected.length}isSelectedLinked(){return this.selected.filter((t=>t.hasLink())).length===this.selected.length}nextAddedLayerNumber(){return this.numLayers()>this.layerAddedCounterForUserEase&&(this.layerAddedCounterForUserEase=this.numLayers()),(this.layerAddedCounterForUserEase+1).toString()}lockedBackground(){return this.layers.length>0&&this.layers[0].settings.locked&&this.layers[0].type===s.Z.TYPE_IMAGE}selectedLayerNr(){if(0===this.selected.length)return-1;if(1===this.selected.length)return this.layerNr(this.selected[0].id);let t=0;return this.selected.forEach((e=>{t=Math.max(t,this.layerNr(e.id))})),t}layerNr(t){return this.layers.findIndex((e=>e.id===t))}changeLayerOrder(t,e){this.layers.splice(e,0,this.layers.splice(t,1)[0])}rotate(t){let e=this.width;this.width=this.height,this.height=e;for(let i=0;i<this.layers.length;i++)this.layers[i].rotate(t),this.layers[i].render()}flip(t){for(let e=0;e<this.layers.length;e++)this.layers[e].type===s.Z.TYPE_IMAGE&&(this.layers[e].flip(t),this.layers[e].render())}straighten(t,e,i){if(this.lockedBackground()){let s=this.layers[0];s.rect.rotation=t,s.rect.x=-(s.rect.width-e)/2,s.rect.y=-(s.rect.height-i)/2}this.width=e,this.height=i}crop(t){this.width=t.width,this.height=t.height;for(let e=0;e<this.layers.length;e++)this.layers[e].rect&&(this.layers[e].rect.x-=t.x,this.layers[e].rect.y-=t.y,this.layers[e].render());this.selection&&this.selection.size(this.width,this.height)}setSize(t,e){this.width=t,this.height=e}resize(t,e,i){let s=t/this.width,n=e/this.height;this.width=t,this.height=e;for(let a=0;a<this.layers.length;a++)this.layers[a].scale(s,n,i);this.selection&&this.selection.resize(this.width,this.height)}size(t,e,i,s){let n=i?t:t-this.width,a=i?e:e-this.height;if(this.width=i?this.width+t:t,this.height=i?this.height+e:e,"TL"!=s){"CL"!=s&&"BL"!=s||(n=0),"TC"!=s&&"CC"!=s&&"BC"!=s||(n=Math.round(n/2)),"TC"!=s&&"TR"!=s||(a=0),"CL"!=s&&"CC"!=s&&"CR"!=s||(a=Math.round(a/2));for(let t=0;t<this.layers.length;t++)this.layers[t].rect&&(this.layers[t].rect.x+=n,this.layers[t].rect.y+=a,this.layers[t].render())}this.selection&&this.selection.size(this.width,this.height)}addLayer(t){this.layerAddedCounterForUserEase++;let e=this.selectedLayerNr();return e>-1?this.layers.splice(e+1,0,t):this.layers.push(t),this.selected=[t],this.updateSelectedLinkedStack(),t}replaceLayer(t){const e=this.layers.findIndex((e=>e.id===t.id));this.layers[e]=t;const i=this.selected.findIndex((e=>e.id===t.id));-1!==i&&(this.selected[i]=t),this.updateSelectedLinkedStack()}}},84253:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(44170),n=i(33655);class a extends s.Z{constructor(t=n.M8(),e,i){super(s.Z.TYPE_GROUP),this.id=t,this.settings.name=e,this.groupSettings=i}}},68934:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(){this.color="",this.collapsed=!1,this.numberOfMembers=0}clone(){const t=Object.create(s.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.collapsed===t.collapsed&&this.numberOfMembers===t.numberOfMembers)}}},82282:(t,e,i)=>{i.d(e,{Z:()=>o});var s=i(44170),n=i(33655),a=i(36817),r=i(92396);class o extends s.Z{constructor(t=n.M8(),e,i,c,h=!1){super(s.Z.TYPE_IMAGE),this.id=t,this.calculate=(t,e,i)=>{this.canvas&&(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<10&&(this.rect.width=10),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(e.y-t.y),this.rect.height<10&&(this.rect.height=10)))},this.scale=(t,e,i)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.applyTransform(i))},this.wouldApplyTransform=()=>!(!this.canvas||!this.rect)&&(0!==this.rect.rotation||this.rect.width!==this.canvas.width||this.rect.height!==this.canvas.height),this.applyStraighten=t=>{this.canvas=n.zs(this.canvas,this.rect.rotation,t),this.mask&&(this.mask=n.zs(this.mask,this.rect.rotation,t)),this.rect=t,this.render()},this.applyTransform=(t=!0)=>{if(!this.wouldApplyTransform())return!1;if(this.rect.width===this.canvas.width&&this.rect.height===this.canvas.height||(this.canvas=t?n.Ai(this.canvas,this.rect.width,this.rect.height):n.ZE(this.canvas,this.rect.width,this.rect.height),this.mask&&(this.mask=n.Ai(this.mask,this.rect.width,this.rect.height))),0!==this.rect.rotation){this.rect=this.rect.getRotatedBounds(),this.canvas=n.zs(this.canvas,this.rect.rotation,this.rect),this.mask&&(this.mask=n.zs(this.mask,this.rect.rotation,this.rect));let t=n.l(this.canvas);t.equalTo(new a.Z(0,0,this.canvas.width,this.canvas.height))||(this.canvas=n.fg(this.canvas,t),this.mask&&(this.mask=n.fg(this.mask,t)),this.rect.width=t.width,this.rect.height=t.height,this.rect.x+=t.x,this.rect.y+=t.y),this.rect.rotation=0}return this.render(),!0},this.switchCanvas=(t,e)=>{this.mask&&!this.rect.equalTo(e)&&(this.mask=n.ST(this.mask,this.rect,e)),this.canvas=t,this.rect=e.clone()},this.extendCanvas=t=>{if(!this.canvas)return this.rect=t,void(this.canvas=n.vL(t.width,t.height));let e=this.rect.union(t);this.rect.equalTo(e)||(this.canvas=n.ST(this.canvas,this.rect,e),this.mask&&(this.mask=n.ST(this.mask,this.rect,e)),this.rect=e)},this.hasMask=()=>!!this.mask,this.addMask=(t="clear")=>{if(this.mask=n.vL(this.canvas.width,this.canvas.height),"fill"===t){this.mask.getContext("2d").fillRect(0,0,this.mask.width,this.mask.height)}},this.invertMask=()=>{if(this.mask){let t=n.vL(this.mask.width,this.mask.height),e=t.getContext("2d");e.save(),e.fillRect(0,0,t.width,t.height),e.globalCompositeOperation="xor",e.drawImage(this.mask,0,0),e.restore(),this.mask=t}},this.removeMask=()=>{this.mask=void 0,this.baked=void 0},this.render=()=>{if(this.mask){if(!this.canvas)return;this.baked&&this.baked.width===this.canvas.width&&this.baked.height===this.canvas.height||(this.baked=n.vL(this.canvas.width,this.canvas.height));var t=this.baked.getContext("2d");t.save(),t.globalCompositeOperation="copy",t.drawImage(this.canvas,0,0),t.globalCompositeOperation="destination-in",t.drawImage(this.mask,0,0),t.restore(),t=void 0}},this.shrinkWrap=()=>{const t=n.l(this.canvas);if(!t)return this.canvas=void 0,this.mask=void 0,this.baked=void 0,this.rect=void 0,!0;if(!t.equalTo(this.rect)){const e=n.vL(t.width,t.height);return e.getContext("2d").drawImage(this.canvas,-t.x,-t.y),this.canvas=e,this.rect=t.rebase(-this.rect.x,-this.rect.y),this.mask&&(this.mask=n.WL(this.mask,t)),!0}return!1},this.rasterize=()=>this.clone(),this.clone=(t=!1)=>{var e;let i=new o(t?this.id:n.M8(),this.settings.name,n.dN(this.canvas),null===(e=this.rect)||void 0===e?void 0:e.clone(),!1);return i.settings=Object.assign({},this.settings),t||(i.settings.locked=!1),i.animation=r.Z.clone(this.animation),this.baked&&(i.baked=n.dN(this.baked)),this.hasMask()&&(i.mask=n.dN(this.mask)),i},this.canvas=i,this.rect=c,this.settings.name=e,this.settings.locked=h}}},44170:(t,e,i)=>{i.d(e,{Z:()=>n});var s=i(33655);class n{constructor(t){this.settings={opacity:1,blendmode:"",locked:!1,visible:!0,name:"",link:""},this.hasLink=()=>this.settings.link&&""!==this.settings.link,this.rotate=t=>{this.canvas&&(this.canvas=s.Xj(this.canvas,t?-90:90),this.mask&&(this.mask=s.Xj(this.mask,t?-90:90)),this.rect=this.rect.flipWidthAndHeight())},this.flip=t=>{this.canvas&&(this.canvas=s.x2(this.canvas,t),this.mask&&(this.mask=s.x2(this.mask,t)))},this.setWidth=(t,e)=>{this.rect&&(t<1&&(t=1),this.rect.width=t,0!==e&&(this.rect.height=Math.round(this.rect.width/e),this.rect.height<1&&(this.rect.height=1)))},this.setHeight=(t,e)=>{this.rect&&(t<1&&(t=1),this.rect.height=t,0!==e&&(this.rect.width=Math.round(this.rect.height*e),this.rect.width<1&&(this.rect.width=1)))},this.position=(t,e)=>{this.rect&&(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e))},this.scale=(t,e,i)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1))},this.setRect=t=>{this.bect?this.bect=t:this.rect=t},this.getRect=()=>this.bect?this.bect:this.rect,this.getCanvas=()=>this.transient?this.transient:this.baked?this.baked:this.canvas,this.setAltCanvas=()=>{this.transient=s.dN(this.canvas)},this.replaceCanvas=t=>{this.canvas?this.canvas.width===t.width&&this.canvas.height===t.height||(this.canvas.width=t.width,this.canvas.height=t.height):this.canvas=s.vL(this.rect.width,this.rect.height);const e=this.canvas.getContext("2d");e.save(),e.imageSmoothingEnabled=!1,e.globalCompositeOperation="copy",e.drawImage(t,0,0),e.restore()},this.extendCanvas=t=>{},this.switchCanvas=(t,e)=>{},this.render=(t=!1)=>{},this.calculate=(t,e,i)=>{},this.rasterize=()=>{},this.clone=(t=!1)=>{},this.id=s.M8(),this.type=t}}n.TYPE_GROUP="group",n.TYPE_SCRATCH="scratch",n.TYPE_ELEMENT="element",n.TYPE_IMAGE="image",n.TYPE_SHAPE="shape",n.TYPE_FRAME="frame",n.TYPE_TEXT="text"},49198:(t,e,i)=>{i.d(e,{Z:()=>r});var s=i(33655),n=i(44170),a=i(43673);class r extends n.Z{constructor(){super(n.Z.TYPE_SCRATCH),this.renderMode="none",this.setRenderMode=t=>{this.renderMode=t},this.calculate=(t,e,i)=>{this.canvas&&(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<10&&(this.rect.width=10),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(e.y-t.y),this.rect.height<10&&(this.rect.height=10)))},this.clear=t=>{t?s.lI(this.canvas,t,new a.Z(0,0)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.baked&&this.btx.clearRect(0,0,this.baked.width,this.baked.height)},this.addBake=()=>{this.baked=s.dN(this.canvas),this.btx=this.baked.getContext("2d"),this.btx.imageSmoothingEnabled=!1},this.getCanvas=()=>this.baked?this.baked:this.canvas,this.applySelection=t=>{if(t.fresco.hasSelection()){let e=this.baked?this.btx:this.ctx;e.save(),this.baked&&(e.globalCompositeOperation="copy",e.drawImage(this.canvas,0,0)),e.globalCompositeOperation="destination-in",e.drawImage(t.fresco.selection.mask,-this.rect.x,-this.rect.y),e.restore()}},this.drawCanvas=(t,e="source-over",i=1)=>{t&&(this.ctx.save(),this.ctx.save(),this.ctx.globalAlpha=i,this.ctx.globalCompositeOperation=e,this.ctx.drawImage(t,0,0,t.width,t.height),this.ctx.restore())},this.drawToLayer=(t,e="source-over",i=1)=>{if(t&&t.canvas&&t.rect)if(t.type===n.Z.TYPE_FRAME){this.canvas.width===t.canvas.width&&this.canvas.height===t.canvas.height||(t.canvas.width=this.canvas.width,t.canvas.height=this.canvas.height);const e=t.canvas.getContext("2d");e.imageSmoothingEnabled=!1,e.clearRect(0,0,t.canvas.width,t.canvas.height),e.drawImage(this.canvas,0,0)}else{const s=t.canvas.getContext("2d");s.save(),s.globalAlpha=i,s.imageSmoothingEnabled=!1,s.globalCompositeOperation=e,s.drawImage(this.baked?this.baked:this.canvas,Math.round(this.rect.x-t.rect.x),Math.round(this.rect.y-t.rect.y),this.rect.width,this.rect.height),s.restore()}}}setTarget(t,e,i,n){this.id=t,this.rect=e.clone(),this.renderMode=i,this.canvas=n?s.dN(n):s.vL(e.width,e.height),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.baked=void 0,this.btx=void 0}}},87108:(t,e,i)=>{i.d(e,{Z:()=>m});var s=i(33655),n=i(44170),a=i(9591),r=i(36817),o=i(98776),c=i(43673),h=i(67175),l=i(82282),d=i(95574),u=i(92396);class m extends n.Z{constructor(t=s.M8(),e,i,p){super(n.Z.TYPE_SHAPE),this.id=t,this.prepare=async()=>{if("svg"===this.shapeSettings.variant&&!this.image){let t=new Blob([this.shapeSettings.content],{type:"image/svg+xml"});this.image=await(0,d.s4)(t),this.rect||(this.rect=new r.Z(0,0,this.image.width,this.image.height))}"path"===this.shapeSettings.variant&&(this.path2D=new Path2D(this.shapeSettings.content)),this.shapeSettings.fillType&&(this.fill=await a.Z.fromString(this.shapeSettings.fillType,this.shapeSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),"line"===this.shapeSettings.variant&&this.shapeSettings.outlineSize!==this.rect.height&&(this.rect.height=this.shapeSettings.outlineSize),this.canvas||(this.canvas=s.vL(this.rect.width,this.rect.height)),this.render()},this.setVariant=t=>{switch(t){case"rounded":this.shapeSettings.variant="rounded";break;case"rectangle":this.shapeSettings.variant="rectangle";break;case"ellipse":this.shapeSettings.variant="ellipse";break;case"line":this.shapeSettings.variant="line"}this.render()},this.setPath=(t,e=!1)=>{e||(this.shapeSettings.content=t),this.shapeSettings.variant="path",this.path2D=new Path2D(t),this.render()},this.setFill=(t,e=!1)=>{this.fill=t,e||(this.shapeSettings.fillType=this.fill?t.getType():void 0,this.shapeSettings.fillValue=this.fill?t.getStringValue():void 0),this.render()},this.setOutline=(t,e)=>{this.shapeSettings.outlineSize=t,this.shapeSettings.outlineColor=e,"line"===this.shapeSettings.variant&&(this.rect.height=0===t?1:t),this.render()},this.setShadow=(t,e,i,s,n,a)=>{this.shapeSettings.shadow=t,this.shapeSettings.shadowBlur=e,this.shapeSettings.shadowOpacity=i,this.shapeSettings.shadowColor=s,this.shapeSettings.shadowDistance=n,this.shapeSettings.shadowDirection=a,this.render()},this.setRadii=t=>{this.shapeSettings.radii=t,this.render()},this.render=(t=!1)=>{if(!this.canvas)return;const e=this.canvas.getContext("2d");if(this.canvas.width!==this.rect.width||this.canvas.height!==this.rect.height?(this.canvas.height=this.rect.height,this.canvas.width=this.rect.width):e.clearRect(0,0,this.canvas.width,this.canvas.height),"svg"===this.shapeSettings.variant)return e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",void e.drawImage(this.image,0,0,this.rect.width,this.rect.height);if("line"===this.shapeSettings.variant)e.fillStyle=this.shapeSettings.outlineColor,e.fillRect(0,0,this.rect.width,this.rect.height);else{e.save();let t,i=2*this.shapeSettings.outlineSize,s=this.shapeSettings.outlineSize,n=this.rect.width-i,a=this.rect.height-i,r=s>0,o=!(!this.fill||!this.fill.value);switch(e.lineWidth=i,e.strokeStyle=this.shapeSettings.outlineColor,this.shapeSettings.variant){case"path":t=new Path2D,t.addPath(this.path2D,(new DOMMatrix).scale(n/100,a/100)),e.translate(s,s);break;case"rounded":h.Z.roundRect(e,s,s,n,a,this.shapeSettings.radii);break;case"rectangle":h.Z.rectangle(e,s,s,n,a);break;case"ellipse":h.Z.ellipse(e,new c.Z(s,s),new c.Z(s+n,s+a))}r&&t?e.stroke(t):r&&e.stroke(),o?this.fill.addToCanvasFillStyle(e):(e.fillStyle="#ffffff",e.globalCompositeOperation="destination-out"),t?e.fill(t):e.fill(),e.restore()}if(this.shapeSettings.shadow){this.baked||(this.baked=document.createElement("canvas"));var i=100*this.shapeSettings.shadowBlur;i+=Math.abs(100*this.shapeSettings.shadowDistance),this.bect=new r.Z(this.rect.x-i,this.rect.y-i,this.rect.width+2*i,this.rect.height+2*i,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height;let t=this.baked.getContext("2d");var s=(this.shapeSettings.shadowDirection-90)*Math.PI/180,n=Math.cos(s)*this.shapeSettings.shadowDistance,a=Math.sin(s)*this.shapeSettings.shadowDistance;t.save(),t.shadowColor=o.Z.fromHEX(this.shapeSettings.shadowColor,Math.round(255*this.shapeSettings.shadowOpacity)).toRGBA(),t.shadowBlur=100*this.shapeSettings.shadowBlur,t.shadowOffsetX=100*n,t.shadowOffsetY=100*a,t.drawImage(this.canvas,i,i),t.restore()}else this.baked=void 0,this.bect=void 0},this.calculate=(t,e,i)=>{"line"===this.shapeSettings.variant?(this.rect.x=Math.round(t.x),this.rect.width=Math.round(e.x-t.x)):(this.rect.x=Math.round(t.x),this.rect.y=Math.round(t.y),this.rect.width=Math.round(e.x-t.x),this.rect.width<2&&(this.rect.width=2),0!==i?this.rect.height=Math.round(this.rect.width/i):(this.rect.height=Math.round(e.y-t.y),this.rect.height<2&&(this.rect.height=2)))},this.position=(t,e)=>{this.rect&&(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e),this.bect&&(this.bect.x=this.rect.x-(this.bect.width-this.rect.width)/2,this.bect.y=this.rect.y-(this.bect.height-this.rect.height)/2))},this.scale=(t,e)=>{this.rect&&(this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.rect.height=Math.round(this.rect.height*e),this.rect.width<0&&(this.rect.width=1),this.rect.height<0&&(this.rect.height=1),this.shapeSettings.outlineSize>0&&(this.shapeSettings.outlineSize=Math.round(this.shapeSettings.outlineSize*t)),this.shapeSettings.shadow&&(this.shapeSettings.shadowDistance=Math.round(100*this.shapeSettings.shadowDistance*t)/100,this.shapeSettings.shadowBlur=Math.round(100*this.shapeSettings.shadowBlur*t)/100),this.render())},this.rotate=t=>{this.rect.rotation+=t?-90:90},this.rasterize=()=>{let t=this.baked?this.baked:this.canvas,e=this.bect?this.bect.clone():this.rect.clone();const i=new l.Z(s.M8(),this.settings.name,t,e,this.settings.locked);return i.settings=Object.assign({},this.settings),i.applyTransform(),i},this.clone=(t=!1)=>{let e=new m(t?this.id:s.M8(),this.settings.name,this.rect.clone(),this.shapeSettings.clone());return e.settings=Object.assign({},this.settings),e.animation=u.Z.clone(this.animation),e.prepare(),e},this.rect=i,this.settings.name=e,this.shapeSettings=p}}},44686:(t,e,i)=>{i.d(e,{Z:()=>s});class s{constructor(){this.radii=0,this.outlineSize=0,this.outlineColor="#555555",this.shadow=!1,this.shadowBlur=.3,this.shadowOpacity=.8,this.shadowColor="#000000",this.shadowDistance=.3,this.shadowDirection=180}clone(){const t=Object.create(s.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.variant===t.variant&&this.radii===t.radii&&this.content===t.content&&this.fillType===t.fillType&&this.fillValue===t.fillValue&&this.outlineSize===t.outlineSize&&this.outlineColor===t.outlineColor&&this.shadow===t.shadow&&this.shadowBlur===t.shadowBlur&&this.shadowColor===t.shadowColor&&this.shadowOpacity===t.shadowOpacity&&this.shadowDistance===t.shadowDistance&&this.shadowDirection===t.shadowDirection)}}},66792:(t,e,i)=>{i.d(e,{Z:()=>D});var s=i(96548),n=i(93947),a=i(23770),r=i(71030),o=i(74820),c=i(75934),h=i(58027),l=i(59064),d=i(47339),u=i(56222),m=i(33655),p=i(99872),g=i(36817),v=i(43673),f=i(44170),y=i(4256),w=i(78685),x=i(51294),b=i(82282),k=i(87108),S=i(77664),Z=i(77758),P=i(44686),E=i(33506),C=i(45453),M=i(94699),_=i(84253),T=i(68934),L=i(70840);class A{constructor(t,e){this.zoom=1,this.zoomMode="fit",this.anchor=new v.Z(0,0),this.fresco=t,this.history=new C.N(t,e)}}class D{constructor(t){this.tabLimit=10,this.showTabs=!1,this.bounds=20,this.isHDPI=!1,this.canTouch=!1,this.syncDisabled=!1,this.supressRender=!1,this.zoom=1,this.zoomMode="fit",this.doSync=t=>{t instanceof CustomEvent&&this.syncDocument(t.detail)},this.doRender=t=>{t instanceof CustomEvent&&(this.supressRender=!1===t.detail)},this.touch=()=>{document.documentElement.classList.add("touch"),document.removeEventListener("touchstart",this.touch,!1),this.canTouch=!0},this.notify=t=>{document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)(t)}))},this.syncQueue=0,this.browseFrameImage=async()=>{await c.Q0(!1,!0).then((async t=>{document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));for(let e=0;e<t.length;e++)await c.ZB(this,t[e],!1,"frame");document.dispatchEvent(new CustomEvent("loading",{detail:"stop"}))}))},this.setFrameContent=t=>{var e;const i=this.fresco.getSelected();let s,n;i.canvas&&(s=m.dN(i.canvas),n=null===(e=i.trim)||void 0===e?void 0:e.clone()),i.setContent(t),i.editMode=!1;const a=s?t?"replace":"delete":"add";this.history.add({type:"frameContent",kind:a,layer:i,canvas:s,trim:n}),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.fitFrameContent=()=>{var t;const e=this.fresco.getSelected();if(e instanceof x.Z){let i=null===(t=e.trim)||void 0===t?void 0:t.clone();e.fitContent(),this.history.add({type:"arrange",layer:e,kind:"fitContent",action:{type:"trim",rect:i}})}document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.addLayer=t=>{for(let e=0;e<t.length;e++)this.fresco.addLayer(t[e]),this.history.add({type:"addLayer",kind:"add"+t[e].type,layer:t[e]});this.fresco.selectLayerStack(t)},this.addCopiedLayer=async t=>{let e,i=new Array,n=new g.Z(0,0,this.fresco.width,this.fresco.height),a=this.fresco.getStackBounds(t);n.contains(a)||(e=new v.Z(Math.round((n.width-a.width)/2),Math.round((n.height-a.height)/2)));for(let r=0;r<t.length;r++){let n=t[r].clone();-1===n.settings.name.indexOf((0,s.Z)("copy"))&&(n.settings.name+=" "+(0,s.Z)("copy")),n.settings.link="",e&&(n.rect.x=n.rect.x-a.x+e.x,n.rect.y=n.rect.y-a.y+e.y),n instanceof k.Z||n instanceof w.Z||n instanceof x.Z?await n.prepare():n.render(),this.fresco.addLayer(n),this.history.add({type:"addLayer",kind:"paste"+n.type,layer:n}),i.push(n)}this.fresco.selectLayerStack(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.duplicateLayer=async(t=!0)=>{let e=this.fresco.getSelectedStack();if(0===e.length)return;let i=new Array;for(let n=0;n<e.length;n++){let t=e[n].clone();-1===t.settings.name.indexOf((0,s.Z)("copy"))&&(t.settings.name+=" "+(0,s.Z)("copy")),t.settings.link="",t instanceof k.Z||t instanceof w.Z||t instanceof x.Z?await t.prepare():t.render(),this.fresco.addLayer(t),this.history.add({type:"addLayer",kind:"duplicate"+t.type,layer:t}),i.push(t)}this.fresco.selectLayerStack(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),t&&this.notify("duplicated")},this.deleteLayer=(t=!1)=>{let e=this.fresco.getSelectedStack();if(0!==e.length){if(1===e.length&&e[0]instanceof x.Z&&(t||e[0].editMode))this.setFrameContent(void 0);else{this.fresco.getStackId().forEach((t=>{const e=this.fresco.layerNr(t),i=this.fresco.deleteLayerById(t);this.history.add({type:"deleteLayer",layer:i,index:e})})),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))}this.notify("deleted")}},this.linkLayer=()=>{let t=this.fresco.getSelectedStack();if(0===t.length||1===t.length&&!t[0].hasLink())return;let e="add";const i=new Array,s=m.Zd(),n=t.filter((t=>!t.hasLink()));if(n.length===t.length)t.forEach((t=>{var e;i.push({layer:t,link:null!==(e=t.settings.link)&&void 0!==e?e:""}),t.settings.link=s}));else if(0===n.length){e="remove";const s=new Set;t.forEach((t=>{var e;s.add(t.settings.link),i.push({layer:t,link:null!==(e=t.settings.link)&&void 0!==e?e:""}),t.settings.link=""})),s.forEach((t=>{var e;const s=this.fresco.layers.filter((e=>e.settings.link===t));1===s.length&&(i.push({layer:s[0],link:null!==(e=s[0].settings.link)&&void 0!==e?e:""}),s[0].settings.link="")}))}else{const e=new Set;if(t.forEach((t=>{e.add(t.settings.link)})),1===e.entries.length){let t=[...e][0];n.forEach((e=>{var s;i.push({layer:e,link:null!==(s=e.settings.link)&&void 0!==s?s:""}),e.settings.link=t}))}else t.forEach((t=>{var e;i.push({layer:t,link:null!==(e=t.settings.link)&&void 0!==e?e:""}),t.settings.link=s})),e.forEach((t=>{var e;const s=this.fresco.layers.filter((e=>e.settings.link===t));1===s.length&&(i.push({layer:s[0],link:null!==(e=s[0].settings.link)&&void 0!==e?e:""}),s[0].settings.link="")}))}i.length>0&&this.history.add({type:"link",kind:e,stack:i}),this.fresco.updateSelectedLinkedStack(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayer=(t,e=!1,i=!1,s=!1)=>{this.selectLayerById(t?t.id:void 0,e,i,s)},this.selectLayerStack=(t,e=!1,i=!1)=>{this.fresco.selectLayerStack(t,e),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.selectLayerById=(t,e=!1,i=!1,s=!1)=>{this.fresco.selectLayerById(t,e,i)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),s&&document.dispatchEvent(new CustomEvent("layer-marked")))},this.unselectLayerById=t=>{this.fresco.unselectLayerById(t)&&(document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")))},this.isSelectedLayerShaderble=()=>{var t;const e=null===(t=this.fresco)||void 0===t?void 0:t.getSelected();return e&&(e.type===f.Z.TYPE_IMAGE||e.type===f.Z.TYPE_FRAME||e.type===f.Z.TYPE_ELEMENT)&&!!e.canvas},this.mergeDown=()=>{if(!this.fresco.getSelected())return;const t=this.fresco.getSelected(),e=this.fresco.layers.findIndex((e=>t.id===e.id)),i=this.fresco.layers.map((t=>t.id));if(e<1)return void this.notify("noMerger");const s=this.fresco.layers[e-1],n=t.rect?t.rect.getRotatedBounds():void 0,a=s.rect?s.rect.getRotatedBounds():void 0,r=n?n.union(a):a;let o;if(r){o=m.vL(r.width,r.height);const e=o.getContext("2d");this.renderLayer(e,s,!1,r.topLeft()),this.renderLayer(e,t,!1,r.topLeft())}const c=new b.Z(m.M8(),t.settings.name,o,r,s.settings.locked),h=this.fresco.layers.splice(e-1,2,c);this.fresco.selectLayerById(c.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"down",layers:h,order:i,target:c}),this.notify("layersMerged")},this.mergeVisible=()=>{const t=this.fresco.layers.findIndex((t=>t.settings.visible)),e=this.fresco.layers.map((t=>t.id));if(t<0)return void this.notify("noMerge");const i=this.fresco.layers[t];let s=this.getOutputCanvas();const n=new b.Z(m.M8(),i.settings.name,s,new g.Z(0,0,s.width,s.height),!0),a=this.fresco.layers.filter((t=>t.settings.visible));this.fresco.layers=this.fresco.layers.filter((t=>!t.settings.visible)),this.fresco.layers.splice(t,0,n),this.fresco.selectLayerById(n.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"visible",order:e,layers:a,target:n}),this.notify("layersMerged")},this.mergeFlatten=()=>{let t=this.getOutputCanvas();const e=new b.Z(m.M8(),(0,s.Z)("background"),t,new g.Z(0,0,t.width,t.height),!0),i=this.fresco.layers.slice(),n=this.fresco.layers.map((t=>t.id));this.fresco.layers=[e],this.fresco.selectLayerById(e.id),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"merge",kind:"flatten",layers:i,order:n,target:e}),this.notify("imageFlattend")},this.moveUp=()=>{if(this.fresco.getSelected()){let t=this.fresco.selectedLayerNr(),e=t+1;(0!=t||!this.fresco.lockedBackground())&&e<this.fresco.numLayers()&&this.changeOrder(t,e)}},this.moveDown=()=>{if(this.fresco.getSelected()){let t=this.fresco.selectedLayerNr(),e=t-1;(e>0||!this.fresco.lockedBackground()&&1==t)&&this.changeOrder(t,e)}},this.changeOrder=(t,e)=>{this.fresco.changeLayerOrder(t,e),this.render(),this.history.add({type:"order",from:t,to:e})},this.changeVisible=(t,e)=>{if(!t)return;const i=Object.assign({},t.settings);t.settings.visible=e,this.history.add({type:"layerSettings",kind:"visible",layer:t,settings:i}),document.dispatchEvent(new CustomEvent("viewport-render"))},this.changeLocked=(t,e)=>{if(t||(t=this.fresco.getSelected()),!t)return;const i=Object.assign({},t.settings);t.settings.locked=e,this.history.add({type:"layerSettings",kind:"locked",layer:t,settings:i}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.changeCollapsed=t=>{const e=t.groupSettings.clone();t.groupSettings.collapsed=!t.groupSettings.collapsed,this.history.add({type:"groupSettings",kind:"collapse",layer:t,settings:e}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.unblock=()=>{var t;this.fresco.unblock(),null===(t=(0,n.ZP)("premium-unlock-message"))||void 0===t||t.remove(),document.dispatchEvent(new CustomEvent("sync-document",{detail:this.fresco})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.rasterize=()=>{let t=this.fresco.getSelectedStack();if(0===t.length)return;let e=new Array;for(let i=0;i<t.length;i++){let s=t[i];if(s instanceof b.Z||s instanceof x.Z&&!s.canvas){e.push(s);continue}const n=this.fresco.layers.findIndex((t=>t.id===s.id)),a=s.rasterize();this.fresco.layers.splice(n,1,a),this.history.add({type:"rasterize",kind:s.type,newId:a.id,layer:s}),e.push(a)}e.length>0?(this.fresco.selectLayerStack(e),this.notify("layerRasterized")):this.notify("noRasterization"),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render"))},this.cutLayer=()=>{let t=this.fresco.getSelectedStack();if(t.length>0){let e=new Array;t.forEach((t=>{e.push(t.clone())})),this.clipboard=e,this.clipboardSize=this.fresco.getStackBounds(e).size(),this.deleteLayer(),this.notify("cut")}},this.copyLayer=()=>{let t=this.fresco.getSelectedStack();if(t.length>0){let e=new Array;t.forEach((t=>{e.push(t.clone())})),this.clipboard=e,this.clipboardSize=this.fresco.getStackBounds(e).size(),this.notify("copy")}},this.pasteLayer=()=>{Array.isArray(this.clipboard)?(this.addCopiedLayer(this.clipboard),this.notify("paste")):document.dispatchEvent(new CustomEvent("viewport-render"))},this.pasteFromSelection=()=>{if(this.fresco.hasSelection()){let t=this.copy();t instanceof HTMLCanvasElement?(this.addImage(m.dN(t),(this.fresco,this.fresco.nextAddedLayerNumber()),"paste"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("paste")})),this.selectionDeselect()):this.notify("selectionEmpty")}else this.notify("selectionEmpty")},this.cut=()=>{if(!this.fresco.hasSelection())return void this.cutLayer();let t=this.copy();return t?(this.clear("cut"),this.selectionDeselect(),t):void 0},this.copy=()=>{if(!this.fresco)return;if(!this.fresco.hasSelection()&&this.fresco.hasSelected())return void this.copyLayer();const t=this.fresco.getSelected();if(!t||!t.rect||!t.rect.isSet())return void this.notify("selectionEmpty");let e=this.fresco.selection.bounds.intersect(t.rect);if(e){let i=m.vL(e.width,e.height),s=i.getContext("2d");s.drawImage(t.baked?t.baked:t.canvas,t.rect.x-e.x,t.rect.y-e.y);const n=new v.Z(-e.x,-e.y);return s.save(),s.globalCompositeOperation="destination-in",s.drawImage(this.fresco.selection.mask,n.x,n.y),s.restore(),s=void 0,i}this.notify("selectionEmpty")},this.clear=(t="clear")=>{if(!this.fresco||!this.fresco.hasSelection())return!1;if(!this.fresco.isSelectedImageWithCanvas())return this.notify("notAImageLayer"),!1;const e=this.fresco.getSelected();let i=this.fresco.selection.bounds.intersect(e.rect);if(!i)return void this.notify("selectionEmpty");i=i.rebase(e.rect.x,e.rect.y);const s=m.$E(e.canvas,i),n=e.rect.clone();let a=e.canvas.getContext("2d");return a.save(),a.globalCompositeOperation="destination-out",a.drawImage(this.fresco.selection.mask,-e.rect.x,-e.rect.y),a.restore(),a=void 0,e.shrinkWrap(),e.render(),e.rect&&(i=i.rebase(e.rect.x-n.x,e.rect.y-n.y)),this.history.add({type:"bitmapChange",kind:t,layer:e,patchRect:i,rect:n,patch:s}),this.render(),!0},this.primeCut=(t=!0)=>{if(!this.fresco||!this.fresco.hasSelection())return[void 0,void 0];const e=this.fresco.getSelected();if(!e||!e.rect)return this.notify("noLayerSelected"),[void 0,void 0];const i=this.fresco.selection.bounds.intersect(e.rect);if(i){let s=m.vL(i.width,i.height),n=s.getContext("2d");return n.drawImage(e.canvas,e.rect.x-i.x,e.rect.y-i.y),n.save(),n.globalCompositeOperation="destination-in",n.drawImage(this.fresco.selection.mask,-i.x,-i.y),n.restore(),n=void 0,t&&(n=e.canvas.getContext("2d"),n.save(),n.globalCompositeOperation="destination-out",n.drawImage(this.fresco.selection.mask,-e.rect.x,-e.rect.y),n.restore(),n=void 0,e.render()),[s,i]}return this.notify("selectionEmpty"),[void 0,void 0]},this.selectionSave=()=>{this.fresco&&this.fresco.selection&&((0,n.ZP)("selection-restore").classList.remove("disabled"),this.selection=m.dN(this.fresco.selection.mask),this.notify("selectionSaved"))},this.selectionRestore=()=>{var t,e;this.selection&&(this.history.add({type:"selectionChange",kind:"restore",selection:m.dN(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.selection.drawOnMask(this.selection,0,!1,!1),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionAll=()=>{var t,e;this.fresco&&(this.history.add({type:"selectionChange",kind:"all",selection:m.dN(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.selection.selectAll(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionDeselect=()=>{var t,e;this.fresco&&this.fresco.selection&&(this.history.add({type:"selectionChange",kind:"deselect",selection:m.dN(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.removeSelection(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionInvert=()=>{var t,e;this.fresco&&this.fresco.hasSelection()&&(this.history.add({type:"selectionChange",kind:"invert",selection:m.dN(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.selection.invert(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")))},this.selectionPixels=()=>{var t,e;const i=this.fresco.getSelected();if(!i||!i.canvas)return;this.history.add({type:"selectionChange",kind:"pixels",selection:m.dN(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.clearSelection();let s=new y.Z;s.addShader("alpha-mask",1),this.fresco.selection.drawOnMask(s.apply(i.canvas),0,!1,!1,i.rect.topLeft()),s.cleanUp(),s=void 0,document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionSubject=async()=>{var t,e;const i=this.fresco.getSelected();if(!i||!i.canvas)return;document.dispatchEvent(new CustomEvent("loading",{detail:"start"})),this.history.add({type:"selectionChange",kind:"subject",selection:m.dN(null===(e=null===(t=this.fresco)||void 0===t?void 0:t.selection)||void 0===e?void 0:e.mask)}),this.fresco.addSelection(),this.fresco.clearSelection();const s=await(0,u.J)(i.canvas),n=new y.Z;n.addShader("alpha-shift-mask",!0);const a=n.apply(m.qT(s,1080)),r=m.vL(i.canvas.width,i.canvas.height);r.getContext("2d").drawImage(a,0,0,r.width,r.height),this.fresco.selection.drawOnMask(r,0,!1,!1,i.rect.topLeft()),n.cleanUp(),document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.selectionConvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;if(!this.fresco.hasSelection())return;const t=this.fresco.getSelected(),e=m.dN(this.fresco.selection.mask);t.addMask(),t.mask.getContext("2d").drawImage(this.fresco.selection.mask,-t.rect.x,-t.rect.y),this.fresco.removeSelection(),this.history.add({type:"convertSelectionToMask",layer:t,selection:e}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskAdd=()=>{if(!this.fresco.isSelectedImageWithCanvas())return;const t=this.fresco.getSelected();this.history.add({type:"mask",layer:t,rect:t.rect.clone()}),t.addMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.maskApply=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}));const t=this.fresco.getSelected(),e=t.mask,i=t.canvas,n=t.rect.clone();t.render(),t.canvas=t.baked,t.removeMask(),t.shrinkWrap(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("maskApplied")})),this.history.add({type:"applyMask",layer:t,canvas:i,mask:e,rect:n})},this.maskInvert=()=>{if(!this.fresco.isSelectedImageWithCanvas())return void document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}));const t=this.fresco.getSelected();t.hasMask()?(t.invertMask(),t.render(),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("invert")})),document.dispatchEvent(new CustomEvent("layer-select")),this.history.add({type:"maskInvert",layer:t})):document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}))},this.maskDelete=()=>{if(!this.fresco.getSelected())return;const t=this.fresco.getSelected();if(!t.hasMask())return;const e=m.$E(t.mask);t.removeMask(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("reset")})),this.history.add({type:"mask",layer:t,rect:new g.Z(0,0,e.width,e.height),patch:e})},this.maskExtract=()=>{const t=this.fresco.getSelected();if(t&&t.mask){let e=m.dN(t.canvas),i=e.getContext("2d");i.save(),i.globalCompositeOperation="destination-in",i.drawImage(t.mask,0,0),i.restore(),i=void 0;let n=m.l(t.mask),a=m.vL(n.width,n.height);i=a.getContext("2d"),i.drawImage(e,-n.x,-n.y),this.addImage(a,"Cutout","extract"),document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("layerCreated")}))}else document.dispatchEvent(new CustomEvent("notification",{detail:(0,s.Z)("noCutout")}))},this.maskConvert=()=>{const t=this.fresco.getSelected();if(!t||!t.hasMask())return;const e=t.mask;this.fresco.addSelection(),this.fresco.selection.drawOnMask(t.mask,0,!1,!1,t.rect.topLeft()),t.removeMask(),this.history.add({type:"convertMaskToSelection",layer:t,mask:e}),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-select"))},this.setZoomStep=(t,e=1)=>{this.fresco&&(1===e&&(this.zoom=Math.round(10*this.zoom)/10),this.zoom+=t?this.zoom>=5?1*e:.1*e:this.zoom>=6?-1*e:-.1*e,this.zoom=m.uZ(this.zoom,.1,50),this.zoomMode="free",this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setFluidZoom=t=>{if(!this.fresco)return;const e=this.isHDPI?.1:.12;this.zoomMode="free",this.zoom+=t?this.zoom*e:-this.zoom*e,this.zoom=m.uZ(this.zoom,.1,50),this.zoom>.95&&this.zoom<1.05&&(this.zoom=1),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change"))},this.resetZoom=()=>{this.setZoom(this.zoomMode)},this.setZoom=t=>{this.fresco&&("fit"===t?(this.zoomMode="fit",this.zoom=m.q7(this.fresco.width,this.fresco.height,this.raster.width-2*this.bounds,this.raster.height-2*this.bounds),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"fill"===t?(this.zoomMode="fill",this.zoom=m.UF(this.fresco.width,this.fresco.height,this.raster.width,this.raster.height),this.anchor.x=Math.round(this.fresco.width/2),this.anchor.y=Math.round(this.fresco.height/2)):"free"!==t&&(this.zoomMode="free",this.zoom=Number.parseFloat(t),this.zoom=m.uZ(this.zoom,.1,50)),this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")))},this.setAnchor=t=>{t.equalTo(this.anchor)||(this.anchor.x=m.uZ(t.x,0,this.fresco.width),this.anchor.y=m.uZ(t.y,0,this.fresco.height))},this.resetAnchor=()=>{this.setAnchor(this.getViewPortCenter())},this.resize=(t,e,i,s)=>{this.raster.height=this.isHDPI?2*s:s,this.raster.width=this.isHDPI?2*i:i,this.raster.style.left=t+"px",this.raster.style.top=e+"px",this.raster.style.width=i+"px",this.raster.style.height=s+"px";let n=this.raster.getBoundingClientRect();this.rasterRect=new g.Z(n.x,n.y,n.width,n.height),this.setZoom(this.zoomMode)},this.updateViewport=()=>{if(this.fresco){if(this.fresco.width*this.zoom<this.raster.width)this.canvas.width!==~~(this.fresco.width*this.zoom)&&(this.canvas.width=~~(this.fresco.width*this.zoom)),this.isHDPI?(this.canvas.style.left=~~(.25*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=2*(this.canvas.offsetLeft-this.raster.offsetLeft)):(this.canvas.style.left=~~(.5*(this.raster.width-this.canvas.width)+this.raster.offsetLeft)+"px",this.offset.x=this.canvas.offsetLeft-this.raster.offsetLeft);else{this.canvas.style.left=this.raster.style.left,this.canvas.width=this.raster.width;let t=this.anchor.x*this.zoom-this.canvas.width/2,e=this.fresco.width*this.zoom-this.canvas.width;if(this.offset.x=-m.uZ(~~t,0,~~e),t<0){let e=m.uZ(-1*t,0,250);this.offset.x+=e,this.canvas.style.left=this.raster.offsetLeft+e+"px",this.canvas.width=this.raster.width-e}if(t>e){let i=m.uZ(t-e,0,250);this.canvas.width=this.raster.width-i,this.offset.x-=i}}if(this.fresco.height*this.zoom<this.raster.height)this.canvas.height!==~~(this.fresco.height*this.zoom)&&(this.canvas.height=~~(this.fresco.height*this.zoom)),this.isHDPI?(this.canvas.style.top=~~(.25*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=2*(this.canvas.offsetTop-this.raster.offsetTop)):(this.canvas.style.top=~~(.5*(this.raster.height-this.canvas.height)+this.raster.offsetTop)+"px",this.offset.y=this.canvas.offsetTop-this.raster.offsetTop);else{this.canvas.style.top=this.raster.style.top,this.canvas.height=this.raster.height;let t=this.anchor.y*this.zoom-this.canvas.height/2,e=this.fresco.height*this.zoom-this.canvas.height;if(this.offset.y=-m.uZ(~~t,0,~~e),t<0){let e=m.uZ(-1*t,0,250);this.offset.y+=e,this.canvas.style.top=this.raster.offsetTop+e+"px",this.canvas.height=this.raster.height-e}if(t>e){let i=m.uZ(t-e,0,250);this.canvas.height=this.raster.height-i,this.offset.y-=i}}this.isHDPI&&(this.canvas.style.width=~~(.5*this.canvas.width)+"px",this.canvas.style.height=~~(.5*this.canvas.height)+"px"),this.supressRender||document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("viewport-update"))}},this.getViewPort=()=>new g.Z(this.offset.x>0?0:-1*~~(this.offset.x/this.zoom),this.offset.y>0?0:-1*~~(this.offset.y/this.zoom),Math.ceil(this.canvas.width/this.zoom),Math.ceil(this.canvas.height/this.zoom)),this.getViewPortCenter=()=>{let t=new v.Z;return t.x=(this.offset.x>0?-this.offset.x/this.zoom:this.offset.x/this.zoom*-1)+this.raster.width/this.zoom/2,t.y=(this.offset.y>0?-this.offset.y/this.zoom:this.offset.y/this.zoom*-1)+this.raster.height/this.zoom/2,t},this.getLayerLocationRect=t=>{if(!t.rect)return;const e=this.isHDPI?.5*this.zoom:this.zoom;return new g.Z(Math.round(t.rect.x*e+this.offset.x),Math.round(t.rect.y*e+this.offset.y),Math.round(t.rect.width*e),Math.round(t.rect.height*e),t.rect.rotation)},this.getLayerLocationTrim=t=>{if(!t.trim)return;const e=this.isHDPI?.5*this.zoom:this.zoom;let i=t.getGlobalTrim();return new g.Z(Math.round(i.x*e+this.offset.x),Math.round(i.y*e+this.offset.y),Math.round(i.width*e),Math.round(i.height*e),i.rotation)},this.isAnimating=!1,this.animationId=0,this.playAnimation=(t=24,e=new Array)=>{if(this.isAnimating)return;this.animators=e,0===this.animators.length&&(this.animators=d.Z.bakeAnimators(this.fresco));let i=0;for(const s of this.animators)i=Math.max(i,s.getDuration()),s.prepare(new p.Z(this.fresco.width,this.fresco.height));if(i>0){this.coating.hide(),this.isAnimating=!0,document.dispatchEvent(new CustomEvent("animation-play",{detail:i}));let e=0,s=performance.now(),n=performance.now();const a=1e3/t,r=Math.ceil((i+50)/1e3)*t,o=()=>{const t=performance.now(),i=t-s;i>a&&(e++,s=t-i%a,this.stepAnimation(s-n)),e>r?this.finnishAnimation():this.animationId=window.requestAnimationFrame(o)};o()}},this.stepAnimation=t=>{if(!this.animators)return;const e=new p.Z(this.fresco.width,this.fresco.height);for(const i of this.animators)i.step(t,e);document.dispatchEvent(new CustomEvent("animation-step",{detail:t})),this.render()},this.stopAnimation=()=>{window.cancelAnimationFrame(this.animationId),this.finnishAnimation()},this.finnishAnimation=()=>{if(this.isAnimating){if(this.animators)for(const t of this.animators)t.finish();this.isAnimating=!1,this.coating.show(),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("animation-stop"))}},this.render=()=>{if(!this.supressRender&&this.ctx&&this.fresco){if(this.fresco.color?(this.ctx.fillStyle=this.fresco.color,this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)):this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.translate(this.offset.x<0?this.offset.x:0,this.offset.y<0?this.offset.y:0),this.ctx.scale(this.zoom,this.zoom),this.isAnimating)for(var t=0;t<this.fresco.layers.length;t++){const e=this.fresco.layers[t];e.settings.visible&&(e.transform?this.renderTransformedLayer(this.ctx,e):this.renderLayer(this.ctx,e,!1))}else for(let t=0;t<this.fresco.layers.length;t++){const e=this.fresco.layers[t];e.settings.visible&&(this.fresco.hasScratch()&&this.fresco.scratch.id===e.id?("over"===this.fresco.scratch.renderMode&&this.renderLayer(this.ctx,e,this.zoom<1),this.renderLayer(this.ctx,this.fresco.scratch,this.zoom<1)):this.renderLayer(this.ctx,e,this.zoom<1))}if(this.ctx.setTransform(1,0,0,1,0,0),this.fresco.block){this.ctx.globalAlpha=1,this.ctx.globalCompositeOperation="source-over";let t=this.canvas.width<this.canvas.height?this.canvas.height:this.canvas.width;this.ctx.drawImage(this.premiumGrid,0,this.canvas.height-t,t,t)}}},this.renderOutputFrame=(t,e,i=!1)=>{t.clearRect(0,0,t.canvas.width,t.canvas.height),i||(t.fillStyle=this.fresco.color?this.fresco.color:"#000000",t.fillRect(0,0,t.canvas.width,t.canvas.height)),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high";for(var s=0;s<this.fresco.layers.length;s++){const i=this.fresco.layers[s];(e||i.settings.visible)&&(i.transform?this.renderTransformedLayer(t,i):this.renderLayer(t,i,!1))}t.setTransform(1,0,0,1,0,0)},this.renderTransformedLayer=(t,e)=>{var i,s,n,a,r;if((e.canvas||e.baked)&&e.rect){t.globalAlpha=e.settings.opacity*(null!==(i=e.transform.opacity)&&void 0!==i?i:1),t.globalCompositeOperation=""===e.settings.blendmode?"source-over":e.settings.blendmode;try{const i=e.bect?e.bect:e.rect,o=e.transient?e.transient:e.baked?e.baked:e.canvas;t.save(),t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high";let c=i.x+.5*i.width+(null!==(n=null===(s=e.transform.offset)||void 0===s?void 0:s.x)&&void 0!==n?n:0),h=i.y+.5*i.height+(null!==(r=null===(a=e.transform.offset)||void 0===a?void 0:a.y)&&void 0!==r?r:0);t.translate(c,h),c=-.5*i.width,h=-.5*i.height,e.rect.rotation&&t.rotate(e.rect.rotation*Math.PI/180),e.transform.rotation&&(t.translate(i.width*(e.transform.rAnchor.x-.5),i.height*(e.transform.rAnchor.y-.5)),t.rotate(e.transform.rotation*Math.PI/180),c=-i.width*e.transform.rAnchor.x,h=-i.height*e.transform.rAnchor.y),!e.transform.scale||1===e.transform.scale.x&&1===e.transform.scale.y||(t.translate(i.width*(e.transform.sAnchor.x-.5),i.height*(e.transform.sAnchor.y-.5)),t.scale(e.transform.scale.x,e.transform.scale.y),c=-i.width*e.transform.sAnchor.x,h=-i.height*e.transform.sAnchor.y),t.drawImage(o,c,h,i.width,i.height),t.restore()}catch(o){console.log(o)}}},this.renderLayer=(t,e,i,s)=>{if((e.canvas||e.baked)&&e.rect){t.imageSmoothingQuality="high",t.globalAlpha=e.settings.opacity,t.imageSmoothingEnabled=i||0!==e.rect.rotation,t.globalCompositeOperation=""===e.settings.blendmode?"source-over":e.settings.blendmode;try{const i=e.bect?e.bect:e.rect,n=e.transient?e.transient:e.baked?e.baked:e.canvas;e.rect.rotation?(this.ix=i.x+.5*i.width,this.iy=i.y+.5*i.height,s&&(this.ix-=s.x,this.iy-=s.y),t.save(),t.translate(this.ix,this.iy),t.rotate(e.rect.rotation*Math.PI/180),t.drawImage(n,-.5*i.width,-.5*i.height,i.width,i.height),t.restore()):(this.ix=i.x,this.iy=i.y,s&&(this.ix-=s.x,this.iy-=s.y),t.drawImage(n,this.ix,this.iy,i.width,i.height))}catch(n){console.log(n)}}},this.renderPreview=t=>{this.ctx&&t&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.drawImage(t,0,0,this.canvas.width,this.canvas.height))},this.getThumbnail=()=>{if(this.canvas)return this.getOutputCanvas(m.UF(this.fresco.width,this.fresco.height,200,180))},this.getSingleLayerOutputCanvas=()=>{const t=this.fresco.getSelected();if(!t||!t.canvas)return;let e=m.vL(this.fresco.width,this.fresco.height),i=e.getContext("2d");return this.renderLayer(i,t,!1),i=null,e},this.getOutputCanvas=(t=1,e)=>{t>1&&(t=1);let i=m.vL(Math.round(this.fresco.width*t),Math.round(this.fresco.height*t)),s=i.getContext("2d");(this.fresco.color||e)&&(s.fillStyle=this.fresco.color?this.fresco.color:e,s.fillRect(0,0,i.width,i.height)),s.scale(t,t);for(var n=0;n<this.fresco.layers.length;n++){const e=this.fresco.layers[n];e.settings.visible&&this.renderLayer(s,e,t<1)}return s=null,i},this.translateToRect=(t,e,i,s)=>{if(i){const i=t.x-e.x,s=t.y-e.y;let n=Math.sqrt(i*i+s*s)/Math.sqrt(2);e.x=t.x+(i>0?-n:n),e.y=t.y+(s>0?-n:n)}let n=t.x<e.x?t.x:e.x,a=t.y<e.y?t.y:e.y,r=t.x<e.x?e.x:t.x,o=t.y<e.y?e.y:t.y;return t=this.translateRasterToFresco(new v.Z(n,a),void 0,!0),(e=this.translateRasterToFresco(new v.Z(r,o),void 0,!1)).x=Math.ceil(e.x),e.y=Math.ceil(e.y),s&&(t=this.translateFrescoToRaster(t),e=this.translateFrescoToRaster(e)),new g.Z(t.x,t.y,e.x-t.x,e.y-t.y)},this.translateRasterToFresco=(t,e,i=!0)=>{const s=this.isHDPI?.5*this.zoom:this.zoom;let n=t.x/s-this.offset.x/this.zoom,a=t.y/s-this.offset.y/this.zoom;return e&&(n-=e.x,a-=e.y),i?new v.Z(Math.floor(n),Math.floor(a)):new v.Z(n,a)},this.translateFrescoToRaster=(t,e)=>{let i=t.x,s=t.y;const n=this.isHDPI?.5*this.zoom:this.zoom;return e&&(i+=e.x,s+=e.y),i=Math.round(i*n)+this.offset.x,s=Math.round(s*n)+this.offset.y,new v.Z(i,s)},this.togglePremiumMessage=()=>{var t;null===(t=(0,n.ZP)("premium-unlock-message"))||void 0===t||t.remove(),this.fresco.block&&this.fresco.templateMeta&&(0,n.ZP)("workspace").appendChild((0,n.T)("div",{id:"premium-unlock-message",onclick:()=>new L.Z(this)},(0,s.Z)("unlockPremiumMessage"),(0,n.T)("img",{className:"close",src:"/img/icon/close.svg",width:14,height:14,onclick:t=>(t.preventDefault(),t.stopImmediatePropagation(),(0,n.ZP)("premium-unlock-message").remove(),!1)})))},this.layerDragMove=()=>{this.layerDrag.fresco!==this.fresco.id&&this.coating.drawDropPreviewRect(this.layerDrag.position,this.layerDrag.layer)},this.layerDragDrop=()=>{const t=this.layerDrag;if(t.fresco===this.fresco.id)return;const e=this.layerDrag.layer.clone(),i=new v.Z(t.position.x-this.rasterRect.x,t.position.y-this.rasterRect.y),s=this.translateRasterToFresco(i);e.rect.x=s.x-t.layer.rect.width/2,e.rect.y=s.y-t.layer.rect.height/2,e.settings.link="",this.fresco.addLayer(e),this.coating.clear(),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"duplicate"+e.type,layer:e})},this.closeAll=()=>{this.tabs=[],this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),document.dispatchEvent(new CustomEvent("layer-list-render"))},this.close=t=>{this.stopAnimation(),void 0===t&&this.fresco&&(t=this.fresco.id);const e=this.tabs.findIndex((e=>e.fresco.id===t)),i=this.fresco&&this.fresco.id===t;if(!(e<0)){if(this.tabs.splice(e,1),0===this.tabs.length)return this.history=null,this.fresco=null,this.showTabs=!1,this.coating.clear(),this.render(),document.dispatchEvent(new CustomEvent("tool-apply")),void document.dispatchEvent(new CustomEvent("layer-list-render"));if(i){const t=Math.min(e,this.tabs.length-1);this.select(this.tabs[t].fresco.id)}else document.dispatchEvent(new CustomEvent("fresco-select"))}},this.cleanUp=()=>{document.removeEventListener("viewport-render",this.render,!1),document.removeEventListener("sync-document",this.doSync,!1),document.removeEventListener("layer-drag-move",this.layerDragMove,!1),document.removeEventListener("layer-drag-drop",this.layerDragDrop,!1),document.removeEventListener("render-enabled",this.doRender,!1),document.removeEventListener("reset-viewport",this.resetZoom,!1),document.removeEventListener("unblock-viewport",this.unblock,!1),document.removeEventListener("touchstart",this.touch,!1)},this.workspace=t,this.tabs=[],document.addEventListener("touchstart",this.touch,!1);this.isHDPI="m"===o.ZP.product&&matchMedia("(-webkit-min-device-pixel-ratio: 2), (min-device-pixel-ratio: 2), (min-resolution: 192dpi)").matches,this.canvas=this.workspace.querySelector(".canvas"),this.canvas||(this.canvas=(0,n.T)("canvas",{className:"canvas"}),t.appendChild(this.canvas)),this.canvas.width=this.canvas.height=0,this.ctx=this.canvas.getContext("2d"),this.raster=this.workspace.querySelector(".raster"),this.raster||(this.raster=(0,n.T)("canvas",{className:"raster"}),t.appendChild(this.raster)),this.anchor=new v.Z(0,0),this.offset=new v.Z(0,0),this.coating=new l.Z(this),document.addEventListener("viewport-render",this.render,!1),document.addEventListener("sync-document",this.doSync,!1),document.addEventListener("layer-drag-move",this.layerDragMove,!1),document.addEventListener("layer-drag-drop",this.layerDragDrop,!1),document.addEventListener("render-enabled",this.doRender,!1),document.addEventListener("reset-viewport",this.resetZoom,!1),document.addEventListener("unblock-viewport",this.unblock,!1),"premium"!==(null===E.a||void 0===E.a?void 0:E.a.subscriptionAccess)&&(this.premiumGrid=(0,n.T)("img",{src:"/img/misc/premium-grid.svg"}))}async syncDocument(t){var e,i,s;if(!(!t||this.syncQueue>0||this.syncDisabled)&&(!t.templateMeta||this.history.hasChanges()))try{this.syncQueue++;let n,r=new Date;t.id===(null===(e=this.fresco)||void 0===e?void 0:e.id)&&(n=await m._c(this.getThumbnail()));const o=t.layers.map((t=>t.id)),c=await m._c(null===(i=null==t?void 0:t.selection)||void 0===i?void 0:i.mask),h=await(0,a.X3)(),[l,d,u,p]=h.transaction("readwrite","document-meta","document-thumbnail","document-selection","layer-meta");let g=m.mS(M.q,await l.get(t.id));g||(g=new M.q(t.id,t.name,t.width,t.height,t.color,t.templateMeta,t.animation)),g.lastModified=r,g.width=t.width,g.color=t.color,g.height=t.height,g.selected=null===(s=null==t?void 0:t.getSelected())||void 0===s?void 0:s.id,g.templateMeta=t.templateMeta,g.animation=t.animation,g.order=o;const[v]=await Promise.all([p.index("document").getAllKeys(t.id),n?d.put(n,t.id):void 0,c?u.put(c,t.id):u.delete(t.id),l.put(g)]),f=v.filter((e=>!t.layers.some((t=>t.id===e)))),y=t.layers.filter((t=>!v.includes(t.id)));await Promise.all(y.map((e=>M.F.sync(e,t)))),await Promise.all(f.map((async t=>M.F.delete(t))));const w=t.layers.filter((t=>t.syncRequested&&(!t.syncLatest||t.syncRequested>t.syncLatest)));await Promise.all(w.map((e=>M.F.sync(e,t)))),document.cookie="has-history=true; path=/; SameSite=Strict; expires=Fri, 31 Dec 9999 23:59:59 GMT"}finally{this.syncQueue--}}createNew(t,e,i,s){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.addTab(new h.Z(m.M8(),t,e,i,s),"create"),this.addEmpty(),this.setZoom("fit"),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}async openFromHistory(t,e){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),t.templateMeta&&t.templateMeta.premium&&"premium"===(null===E.a||void 0===E.a?void 0:E.a.subscriptionAccess)&&(t.templateMeta.locked=!1),this.addTab(new h.Z(t.id,t.name,t.width,t.height,t.transparent?void 0:t.color,t.animation,t.templateMeta),"document"),this.setZoom("fit"),this.renderPreview(e),this.supressRender=!0,document.dispatchEvent(new CustomEvent("loading",{detail:"start"}));try{await t.restore(this)}catch(i){console.log(i)}document.dispatchEvent(new CustomEvent("loading",{detail:"stop"})),this.supressRender=!1,document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("selection-update")),document.dispatchEvent(new CustomEvent("resize")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}))}addGroup(){let t="Group "+this.fresco.nextAddedLayerNumber();const e=new T.Z;this.fresco.numSelected()>1&&(e.numberOfMembers=this.fresco.numSelected());let i=new _.Z(m.M8(),t,e);return this.fresco.addLayer(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"group",layer:i}),i}addEmpty(){let t="Layer "+this.fresco.nextAddedLayerNumber(),e=new b.Z(m.M8(),t);return this.fresco.addLayer(e),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addemptyimage",layer:e}),e}addImage(t,e,i){if(document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),this.fresco||this.addTab(new h.Z(m.M8(),e,t.width,t.height,void 0,void 0,void 0,i),"image"),"frame"===i&&this.fresco.getSelected()instanceof x.Z)return void this.setFrameContent(t);const n=0===this.fresco.layers.length;let a=this.fresco.addLayer(new b.Z(m.M8(),n?(0,s.Z)("background"):e,t,new g.Z(0,0,t.width,t.height),n));if(n)this.setZoom("fit"),this.syncDocument(this.fresco);else{let t=this.getViewPort().center();a.rect.x=Math.round(t.x-a.rect.width/2),a.rect.y=Math.round(t.y-a.rect.height/2),this.history.add({type:"addLayer",kind:i+"image",layer:a})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),o.ZP.tool&&(document.dispatchEvent(new CustomEvent("select-tool",{detail:o.ZP.tool})),o.ZP.tool=void 0),a}async addSVGShape(t,e,i){document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));let s=new P.Z;s.variant="svg",s.content=t;let n=new k.Z(m.M8(),e,void 0,s);if(await n.prepare(),this.fresco||this.addTab(new h.Z(m.M8(),n.settings.name,n.rect.width,n.rect.height,void 0,void 0,void 0,i),"shape"),this.fresco.addLayer(n),1===this.fresco.layers.length)this.setZoom("fit"),this.syncDocument(this.fresco);else{let t=this.getViewPort().center();n.rect.x=Math.round(t.x-n.rect.width/2),n.rect.y=Math.round(t.y-n.rect.height/2),this.history.add({type:"addLayer",kind:i+"shape",layer:n})}return document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"})),o.ZP.tool&&(document.dispatchEvent(new CustomEvent("select-tool",{detail:o.ZP.tool})),o.ZP.tool=void 0),n}async addShape(t,e,i="add"){t||(t=new g.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2))),e||((e=new P.Z).variant="rectangle",e.fillType="color",e.fillValue="#444444");let n=(0,s.Z)("shape")+" "+this.fresco.nextAddedLayerNumber(),a=new k.Z(m.M8(),n,t,e);return await a.prepare(),this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:i+"shape",layer:a}),a}addElement(t,e,i,s,n){let a;if((0,r.Z)("add-element",i),n!==S.Z.SCALE_METHOD_NONE)if((this.fresco.height>this.fresco.width&&t.height<t.width||this.fresco.width>this.fresco.height&&t.width<t.height)&&(t=m.Xj(t,90)),a=new S.Z(m.M8(),e,t,i,"overlay",s,n),n==S.Z.SCALE_METHOD_FILL){let e=g.Z.fillFit(t.width,t.height,this.fresco.width,this.fresco.height);a.calculate(new v.Z(e.x,e.y),new v.Z(e.right(),e.bottom()),0)}else a.calculate(new v.Z(0,0),new v.Z(this.fresco.width,this.fresco.height),0);else{let r=g.Z.bestFit(t.width,t.height,this.fresco.width,this.fresco.height);(t.height>this.fresco.height||t.width>this.fresco.width)&&(t=m.Ai(t,r.width,r.height)),a=new S.Z(m.M8(),e,t,i,"sticker",s,n),a.rect.x=r.x,a.rect.y=r.y}return this.fresco.addLayer(a),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.add({type:"addLayer",kind:"addelement",layer:a}),a}async addText(t,e,i,s="add"){if(!t||!e||!i){t="Lorem ipsum ..",(i=new Z.Z("Verdana",40)).fillType="color",i.fillValue="#ffffff";let s=this.getViewPort();e=new g.Z(Math.round(s.x+(s.width-Math.round(s.width/1.2))/2),Math.round(s.y+s.height/2.5),Math.round(s.width/1.2),40)}const n=new w.Z(m.M8(),t,e,i);return await n.prepare(),this.fresco.addLayer(n),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:s+"text",layer:n}),n}addFrame(t){t||(t=new g.Z(Math.round(this.fresco.width/4),Math.round(this.fresco.height/4),Math.round(this.fresco.width/2),Math.round(this.fresco.height/2)));let e=(0,s.Z)("frame")+" "+this.fresco.nextAddedLayerNumber();const i=new x.Z(m.M8(),e,t);return this.fresco.addLayer(i),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("viewport-render")),this.history.add({type:"addLayer",kind:"addframe",layer:i}),i}crop(t){const e=new p.Z(this.fresco.width,this.fresco.height),i=new v.Z(-t.x,-t.y);this.fresco.crop(t),this.updateViewport(),this.history.add({type:"crop",offset:i,size:e})}flip(t){this.fresco.flip(t),this.render(),this.history.add({type:"flip",vertical:t})}rotate(t){this.fresco.rotate(t),this.updateViewport(),this.history.add({type:"rotate",counterClock:t})}rotateSelected(t){const e=this.fresco.getSelected();e?e.settings.locked?this.notify("layer locked"):(this.history.add({type:"rotateLayer",layer:e,counterClock:t}),e.rotate(t),document.dispatchEvent(new CustomEvent("viewport-render"))):this.notify("no layer selected")}flipSelected(t){if(!this.isSelectedLayerShaderble())return void this.notify("onlyImageLayer");const e=this.fresco.getSelected();e.settings.locked?this.notify("layerLocked"):(this.history.add({type:"flipLayer",layer:e,vertical:t}),e.flip(t),e.render(),this.render())}straighten(t){if(!this.fresco.lockedBackground())return;const e=this.fresco.layers[0].rect.rotatedSize(t);this.fresco.straighten(t,e.width,e.height),this.updateViewport()}addTab(t,e,i=!0,s=!1){s||document.dispatchEvent(new CustomEvent("navigate",{detail:"editor"}));const n=new A(t,e);this.tabs.push(n),i&&(this.fresco=n.fresco,this.history=n.history,this.setZoom("fit"),n.zoom=this.zoom,n.zoomMode=this.zoomMode,n.anchor=this.anchor,document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()),this.tabs.length>this.tabLimit&&this.close(this.tabs[0].fresco.id),this.tabs.length>1&&(this.showTabs=!0),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize"))}select(t){this.stopAnimation();const e=this.tabs.find((e=>e.fresco.id===t));if(!e)return;const i=this.tabs.find((t=>{var e;return t.fresco.id===(null===(e=this.fresco)||void 0===e?void 0:e.id)}));i&&(i.zoom=this.zoom,i.zoomMode=this.zoomMode,i.anchor=this.anchor.clone()),this.fresco=e.fresco,this.history=e.history,this.zoom=e.zoom,this.zoomMode=e.zoomMode,this.anchor=e.anchor,this.updateViewport(),document.dispatchEvent(new CustomEvent("zoom-change")),document.dispatchEvent(new CustomEvent("layer-list-render")),document.dispatchEvent(new CustomEvent("layer-select")),document.dispatchEvent(new CustomEvent("fresco-select")),document.dispatchEvent(new CustomEvent("resize")),this.history.dispatchHistoryStatus(),this.togglePremiumMessage()}}},78685:(t,e,i)=>{i.d(e,{Z:()=>u});var s=i(33655),n=i(44170),a=i(9591),r=i(36817),o=i(98776),c=i(43673),h=i(82282),l=i(77758),d=i(92396);class u extends n.Z{constructor(t=s.M8(),e,i,m){super(n.Z.TYPE_TEXT),this.id=t,this.prepare=async(t=!1)=>{this.fill&&!t||(this.fill=await a.Z.fromString(this.textSettings.fillType,this.textSettings.fillValue),document.dispatchEvent(new CustomEvent("layer-select"))),this.setText()},this.setText=(t=this.text)=>{this.text=t,this.settings.name=t.substring(0,25)+"..",this.textSettings.uppercase?this.words=this.text.replace(/[\n]/g," §§§ ").toUpperCase().split(" "):this.words=this.text.replace(/[\n]/g," §§§ ").split(" "),this.render()},this.setTextSize=t=>{this.textSettings.setSize(t),this.render()},this.setLineSpace=t=>{this.textSettings.lineSpace=t,this.render()},this.setLetterSpace=t=>{this.textSettings.letterSpace=t,this.render()},this.setTextFill=(t,e=!1)=>{this.fill=t,e||(this.textSettings.fillType=t.getType(),this.textSettings.fillValue=t.getStringValue()),this.render()},this.setTextFont=(t,e=!1)=>{this.textSettings.setFont(t),this.render(e)},this.setTextUpperCase=t=>{this.textSettings.uppercase=t,this.setText(this.text)},this.setTextItalic=t=>{this.textSettings.italic=t,this.setText(this.text)},this.setTextBold=t=>{this.textSettings.bold=t,this.setText(this.text)},this.setTextUnderline=t=>{this.textSettings.underline=t,this.setText(this.text)},this.setTextAlign=t=>{this.textSettings.align=t,this.render()},this.setCurve=(t,e,i,s,n)=>{this.textSettings.curve=t,this.textSettings.curveType=e,this.textSettings.curveAmount=i,this.textSettings.curveSpread=s,this.textSettings.curveFlip=n,this.render()},this.setWarp=(t,e,i,s,n,a,r)=>{this.textSettings.warp=t,this.textSettings.warpType=e,this.textSettings.warpMode=i,this.textSettings.warpEdgeSize=s,this.textSettings.warpCenterSize=n,this.textSettings.warpHorizontalOffset=a,this.textSettings.warpVerticalOffset=r,this.render()},this.setBackground=(t,e,i,s,n)=>{this.textSettings.background=t,this.textSettings.backgroundType=e,this.textSettings.backgroundColor=i,this.textSettings.backgroundPunch=s,this.textSettings.backgroundOffset=n,this.render()},this.setOutline=(t,e,i,s,n,a)=>{this.textSettings.outline=t,this.textSettings.outlineSize=e,this.textSettings.outlineColor=i,this.textSettings.outlinePunch=s,this.textSettings.outlineDistance=n,this.textSettings.outlineDirection=a,this.render()},this.setShadow=(t,e,i,s,n,a)=>{this.textSettings.shadow=t,this.textSettings.shadowBlur=e,this.textSettings.shadowAlpha=i,this.textSettings.shadowColor=s,this.textSettings.shadowDistance=n,this.textSettings.shadowDirection=a,this.render()},this.setTextSettings=t=>{this.textSettings=t,this.render()},this.setCanvasStyle=()=>{var t;this.ctx.textBaseline="top",this.ctx.font=this.textSettings.getCssFont(),this.ctx.strokeStyle=this.textSettings.outlineColor,this.ctx.lineWidth=Math.round(this.textSettings.outlineSize*this.textSettings.padding),this.ctx.lineJoin="miter",this.ctx.miterLimit=2,null===(t=this.fill)||void 0===t||t.addToCanvasFillStyle(this.ctx)},this.isPunchOut=!1,this.isWordBackground=!1,this.render=(t=!1)=>{this.isPunchOut=void 0===this.fill||this.textSettings.background&&this.textSettings.backgroundPunch||this.textSettings.outline&&this.textSettings.outlinePunch,this.isWordBackground=this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_WORD;let e=this.textSettings.padding;this.canvas||(this.canvas=document.createElement("canvas")),this.ctx||(this.ctx=this.canvas.getContext("2d")),this.setCanvasStyle();const i=new c.Z;if(this.textSettings.outline&&this.textSettings.outlineDistance>0){const t=(this.textSettings.outlineDirection-90)*Math.PI/180;i.x=Math.cos(t)*this.textSettings.outlineDistance*e,i.y=Math.sin(t)*this.textSettings.outlineDistance*e}const n=this.textSettings.getLineSpacing();let a=this.textSettings.height+e+n,h=this.textSettings.background?Math.round(this.textSettings.backgroundOffset*e):0;this.textSettings.background&&this.textSettings.backgroundType!==l.Z.BACKGROUND_FULL&&(a+=2*e);let d=this.splitTextIntoLines(a);this.setCanvasSize(d.length,n),this.setCanvasStyle();let u=!1;if(this.textSettings.curve&&"arc"===this.textSettings.curveType){if(u=!0,0!==this.textSettings.curveAmount){const t=this.textSettings.getLetterSpacing();let[e,i]=this.calculateArcRadius(),s=(e-this.textSettings.height/2)*Math.PI*2;u=(this.ctx.measureText(" ").width+t)/s*Math.PI*2<5e-4}this.textSettings.curveAmount<=0&&!u&&(d=d.reverse())}for(let s=0;s<d.length;s++){if(""===d[s])continue;const t=this.lineWidth(d[s]);this.textSettings.curve&&!u?this.drawCurveLine(d[s],e+s*a,t,h,i):this.drawLine(d[s],e+s*a,t,h,i,u)}if(this.textSettings.warp){this.transient=s.dN(this.canvas),this.ctx.imageSmoothingEnabled=!0,this.ctx.imageSmoothingQuality="high";let t=this.textSettings.warpMode,i="angular"===this.textSettings.warpType,n=this.textSettings.background||this.textSettings.outline?0:e,a=this.transient.width,r=this.transient.height-2*n,o=r+r*this.textSettings.warpEdgeSize,c=r+r*this.textSettings.warpCenterSize,h=a*(.5+.5*this.textSettings.warpHorizontalOffset),l=a*(1-(.5+.5*this.textSettings.warpHorizontalOffset)),d=180/(2*h),u=180/(2*l),m=0,p=r*this.textSettings.warpVerticalOffset;if("upper"===t)p<0?(this.rect.height=Math.max(Math.abs(p)+o,c),m-=p):this.rect.height=Math.max(p+c,o);else if("lower"===t)p*=-1,m=Math.max(o,c-p)-r,this.rect.height=p<=0?Math.max(Math.abs(p)+c,o):Math.max(p+o,c);else if("middle"===t){p*=.75,m=.5*(Math.max(o,c)-r);let t=.5*(o-c),e=Math.max(c,o);if(p<0){let t=.5*(o-c),e=Math.max(c,o);t+c+Math.abs(p)>e?(this.rect.height=t+c+Math.abs(p),m-=t+p,t<0&&(m+=t)):(this.rect.height=e,c>o&&(m-=p))}else t+c+p>e?(this.rect.height=t+c+p,t<0&&(m+=t)):(this.rect.height=e,c>o&&(m-=p))}for(this.rect.height+=2*n,this.canvas.width=this.rect.width,this.canvas.height=this.rect.height;a--;){let e=0;e=a>h?i?1-(a-h)/l:Math.sin((l-(a-h))*u*Math.PI/180):i?1-(h-a)/h:Math.sin(a*d*Math.PI/180);let s=(1-e)*o+c*e,g=e*p,v="upper"===t?0:"lower"===t?r-s:.5*(r-s);this.ctx.drawImage(this.transient,a,n,1,r,a,n+g+v+m,1,s)}this.transient=void 0}if(this.textSettings.shadow&&!t){this.baked||(this.baked=document.createElement("canvas"));let t=this.baked.getContext("2d");if(this.bect=new r.Z(this.rect.x-4*e,this.rect.y-4*e,this.rect.width+8*e,this.rect.height+8*e,this.rect.rotation),this.baked.width=this.bect.width,this.baked.height=this.bect.height,this.textSettings.shadow){t.save();var m=(this.textSettings.shadowDirection-90)*Math.PI/180,p=Math.cos(m)*this.textSettings.shadowDistance,g=Math.sin(m)*this.textSettings.shadowDistance;t.shadowBlur=this.textSettings.shadowBlur*this.textSettings.padding*2,t.shadowOffsetX=p*this.textSettings.padding*2,t.shadowOffsetY=g*this.textSettings.padding*2,t.shadowColor=o.Z.fromHEX(this.textSettings.shadowColor,Math.round(255*this.textSettings.shadowAlpha)).toRGBA(),t.drawImage(this.canvas,4*e,4*e),t.restore()}}else this.baked=void 0,this.bect=void 0},this.scaleBect=t=>{if(this.bect){const e=4*this.textSettings.padding*t;this.bect=new r.Z(this.rect.x-e,this.rect.y-e,this.rect.width+2*e,this.rect.height+2*e,this.rect.rotation),this.bect.width<1&&(this.bect.width=1),this.bect.height<1&&(this.bect.height=1)}},this.setCanvasSize=(t,e)=>{if(this.textSettings.background&&this.textSettings.backgroundType!==l.Z.BACKGROUND_FULL?this.rect.height=(this.textSettings.height+3*this.textSettings.padding)*t+e*(t-1)-this.textSettings.padding:this.rect.height=(this.textSettings.height+this.textSettings.padding)*t+e*(t-1)+this.textSettings.padding,this.textSettings.curve)switch(this.textSettings.curveType){case"arc":let t=this.calculateArcHeight();this.rect.height+=t;break;case"circle":this.rect.height=this.rect.width;break;case"half":this.rect.height=Math.round(this.rect.width/2)}this.canvas.width=this.rect.width,this.canvas.height=this.rect.height,this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_FULL&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height))},this.splitTextIntoLines=t=>{let e="",i=new Array,s=this.textSettings.curve?this.curveMaxWidth(0,t):this.rect.width;for(var n=0;n<this.words.length;n++){let a=""!==e?e+" "+this.words[n]:this.words[n];if("§§§"===this.words[n]||this.lineWidth(a)>s&&a!==this.words[n]){if(i.push(e),e="§§§"===this.words[n]?"":this.words[n],this.textSettings.curve&&(s=this.curveMaxWidth(i.length,t),s<0))return i}else e=a}return i.push(e),i},this.lineWidth=t=>{let e=0,i=this.textSettings.getLineSpacing(),s=this.textSettings.getLetterSpacing();if(this.isWordBackground){let n=t.split(" ").filter((t=>t));for(let t=0;t<n.length;t++)e+=this.measureTextWidth(n[t],s,!0)+2*this.textSettings.padding,e+=this.textSettings.padding+i;this.textSettings.curve&&"circle"===this.textSettings.curveType||(e-=this.textSettings.padding+i)}else this.textSettings.curve&&"circle"===this.textSettings.curveType?(e=this.measureTextWidth(t,s,!1),e+=this.measureTextWidth(" ",s,!1)):(e=this.measureTextWidth(t,s,!0),e+=2*this.textSettings.padding);return e},this.curveMaxWidth=(t,e)=>{if("arc"===this.textSettings.curveType){if(0===this.textSettings.curveAmount)return this.rect.width;let[t,i]=this.calculateArcRadius();return this.textSettings.curveAmount<0&&(i+=-e/4),i}if("circle"===this.textSettings.curveType){let i=this.rect.width/2-this.textSettings.padding-t*e;return i<e?-1:i*Math.PI*2}{let i=this.rect.width/2-t*e-(this.textSettings.background?this.textSettings.padding:0);return i<e?-1:i*Math.PI}},this.calculateArcHeight=()=>Math.round(this.rect.width/5*Math.abs(this.textSettings.curveAmount)),this.calculateArcRadius=()=>{let t=this.calculateArcHeight(),e=new c.Z(0,t),i=new c.Z(this.rect.width/2,0),s=new c.Z(this.rect.width,t),n=(i.y-e.y)/(i.x-e.x),a=(s.y-i.y)/(s.x-i.x),r=-1*((n*a*(e.y-s.y)+a*(e.x+i.x)-n*(i.x+s.x))/(2*(a-n))-(e.x+i.x)/2)/n+(e.y+i.y)/2;return[r,Math.atan2(this.rect.width/2,r-t)*r*2]},this.drawHalfLine=(t,e,i,s,n)=>{var a;const r=this.textSettings.curveFlip,o=this.textSettings.curveSpread,c=this.textSettings.getLineSpacing(),h=this.textSettings.getLetterSpacing();let d=!1,u=this.rect.width/2-e,m=u*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let t=u-this.textSettings.height/2;t>0&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,r?0:this.rect.width/2,t,t,0,Math.PI,0,r),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let e=o?-m/4:-i/2,n=(m/2-i)/t.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let a=t.split(" ").filter((t=>t));for(var p=0;p<a.length;p++){let t=this.measureTextWidth(a[p],h,!0);o&&(t+=n*a[p].length);let i=u-this.textSettings.height/2;if(i<this.textSettings.height)continue;let l=(t+2*this.textSettings.padding)/m*360*(Math.PI/180),d=e/m*360*(Math.PI/180),g=r?90:270,v=g*(Math.PI/180)+(r?-d:d),f=g*(Math.PI/180)+(r?-(l+d):l+d);if(this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,r?0:this.rect.width/2,i,v,f,r),this.ctx.stroke(),this.textSettings.underline){const n=Math.ceil(.06*this.textSettings.height),a=Math.round(this.textSettings.padding+h);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=n,d=(e+a)/m*360*(Math.PI/180),l=(t-2*h)/m*360*(Math.PI/180),v=g*(Math.PI/180)+(r?-d:d),f=g*(Math.PI/180)+(r?-(l+d):l+d);const o=Math.round(.5*(this.textSettings.baseline+n)+s);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,r?0:this.rect.width/2,i+(r?o:-o),v,f,r),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}e+=Math.round(t+3*this.textSettings.padding+c)}this.ctx.restore(),d=!0}let g=0;if(o){g=(m/2-i)/(d?t.replace(/\s/g,"").length:t.length+1)/2,i=d?m/2:m/2-2*g}if(this.textSettings.underline&&!this.isWordBackground){let t=u-this.textSettings.height/2;if(t<this.textSettings.height){const e=Math.ceil(.06*this.textSettings.height);let n=(i-2*Math.round(this.textSettings.padding+h))/(u*Math.PI*2)*360*(Math.PI/180/2),a=r?90:270,o=a*(Math.PI/180)-n,c=a*(Math.PI/180)+n;const l=Math.round(.5*(this.textSettings.baseline+e)+s);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=e,this.ctx.beginPath(),r?this.ctx.arc(this.rect.width/2,0,t+l,o,c):this.ctx.arc(this.rect.width/2,this.rect.width/2,t-l,o,c),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),t.length>0){const e=.5*this.rect.width,o=r?0:.5*this.rect.width;null===(a=this.fill)||void 0===a||a.addToCanvasFillStyle(this.ctx,-e,-o),this.ctx.translate(e,o);let l=r?u-this.textSettings.height-this.textSettings.ascent:-u-this.textSettings.ascent;this.ctx.textAlign="center";let p=r?-1:1,f=d?2*h+2*this.textSettings.padding:2*this.textSettings.padding+2*h;this.ctx.rotate((i-f)/m*Math.PI*-p),this.ctx.textAlign="center";for(var v=0;v<t.length;v++){if(d&&" "===t[v]){if(v>0&&" "===t[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+c+h)/m*(2*Math.PI)*p);continue}let e=this.ctx.measureText(t[v]).width/2;this.ctx.rotate((e+g)/m*Math.PI*2*p),this.drawChar(t[v],0,l+s,n),this.ctx.rotate((e+h+g)/m*Math.PI*2*p)}}this.ctx.restore()},this.drawCircleLine=(t,e,i,s,n)=>{var a;const r=this.textSettings.curveFlip,o=this.textSettings.curveSpread,c=this.textSettings.getLineSpacing(),h=this.textSettings.getLetterSpacing();let d=!1,u=this.rect.width/2-e,m=u*Math.PI*2;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let t=u-this.textSettings.height/2;t>this.textSettings.height&&(this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.ellipse(this.rect.width/2,this.rect.width/2,t,t,0,0,2*Math.PI),this.ctx.stroke(),this.ctx.restore())}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let e=o?this.textSettings.padding/2+c/2-m/2:this.textSettings.padding/2+c/2-i/2,n=(m-i)/t.replace(/\s/g,"").length;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let a=t.split(" ").filter((t=>t));for(var p=0;p<a.length;p++){let t=this.measureTextWidth(a[p],h,!0);o&&(t+=n*a[p].length);let i=u-this.textSettings.height/2;if(i<this.textSettings.height)continue;let l=(t+2*this.textSettings.padding)/m*360*(Math.PI/180),d=e/m*360*(Math.PI/180),g=r?90:270,v=g*(Math.PI/180)+(r?-d:d),f=g*(Math.PI/180)+(r?-(l+d):l+d);if(this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,i,v,f,r),this.ctx.stroke(),this.textSettings.underline){const n=Math.ceil(.06*this.textSettings.height),a=Math.round(this.textSettings.padding+h);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=n,d=(e+a)/m*360*(Math.PI/180),l=(t-2*h)/m*360*(Math.PI/180),v=g*(Math.PI/180)+(r?-d:d),f=g*(Math.PI/180)+(r?-(l+d):l+d);const o=Math.round(.5*(this.textSettings.baseline+n)+s);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,this.rect.width/2,i+(r?o:-o),v,f,r),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}e+=Math.round(t+3*this.textSettings.padding+c)}this.ctx.restore(),d=!0}let g=0;if(o){g=(m-i)/(d?t.replace(/\s/g,"").length:t.length+1)/2,i=d?m:m-2*g}if(this.textSettings.underline&&!this.isWordBackground){let t=u-this.textSettings.height/2;if(t>this.textSettings.height){const e=Math.ceil(.06*this.textSettings.height);let n=(i-2*Math.round(this.textSettings.padding+h))/(u*Math.PI*2)*360*(Math.PI/180/2),a=r?90:270,o=a*(Math.PI/180)-n,c=a*(Math.PI/180)+n;const l=Math.round(.5*(this.textSettings.baseline+e)+s);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=e,this.ctx.beginPath(),r?this.ctx.arc(this.rect.width/2,this.rect.width/2,t+l,o,c):this.ctx.arc(this.rect.width/2,this.rect.width/2,t-l,o,c),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),t.length>0){const e=.5*this.rect.width,o=.5*this.rect.height;null===(a=this.fill)||void 0===a||a.addToCanvasFillStyle(this.ctx,-e,-o),this.ctx.translate(e,o);let l=r?u-this.textSettings.height-this.textSettings.ascent:-u-this.textSettings.ascent,p=r?-1:1,f=d?2*h+3*this.textSettings.padding+c:this.measureTextWidth(" ",h,!0);this.ctx.rotate((i-f)/m*Math.PI*-p),this.ctx.textAlign="center";for(var v=0;v<t.length;v++){if(d&&" "===t[v]){if(v>0&&" "===t[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+c+h)/m*(2*Math.PI)*p);continue}let e=this.ctx.measureText(t[v]).width/2;this.ctx.rotate((e+g)/m*Math.PI*2*p),this.drawChar(t[v],0,l+s,n),this.ctx.rotate((e+h+g)/m*Math.PI*2*p)}}this.ctx.restore()},this.drawArcLine=(t,e,i,s,n)=>{var a;const r=this.textSettings.getLineSpacing(),o=this.textSettings.getLetterSpacing();let[c,h]=this.calculateArcRadius(),d=c-e,u=d*Math.PI*2,m=this.textSettings.curveAmount<0,p=!1;if(this.textSettings.background)if(this.textSettings.backgroundType===l.Z.BACKGROUND_WORD){let e=-i/2;this.ctx.save(),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding;let n=t.split(" ").filter((t=>t));for(var g=0;g<n.length;g++){let t=this.measureTextWidth(n[g],o,!0),i=d-this.textSettings.height/2;if(i<this.textSettings.height)continue;let a=(t+2*this.textSettings.padding)/u*360*(Math.PI/180),h=e/u*360*(Math.PI/180),l=m?this.canvas.height-c:c,p=m?90:270,v=p*(Math.PI/180)+(m?-h:h),f=p*(Math.PI/180)+(m?-(a+h):a+h);if(this.ctx.beginPath(),m?this.ctx.arc(this.rect.width/2,l,i,f,v):this.ctx.arc(this.rect.width/2,l,i,v,f),this.ctx.stroke(),this.textSettings.underline){const n=Math.ceil(.06*this.textSettings.height),r=Math.round(this.textSettings.padding+o);this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=n,h=(e+r)/u*360*(Math.PI/180),a=(t-2*o)/u*360*(Math.PI/180),v=p*(Math.PI/180)+(m?-h:h),f=p*(Math.PI/180)+(m?-(a+h):a+h);const c=Math.round(.5*(this.textSettings.baseline+n)+s);this.ctx.beginPath(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),m?this.ctx.arc(this.rect.width/2,l,i+c,f,v):this.ctx.arc(this.rect.width/2,l,i-c,v,f),this.ctx.stroke(),this.ctx.globalCompositeOperation="source-over",this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding}e+=Math.round(t+3*this.textSettings.padding+r)}this.ctx.restore(),p=!0}else if(this.textSettings.backgroundType===l.Z.BACKGROUND_LINE){let t=d-this.textSettings.height/2;if(t>this.textSettings.height){let e=i/(d*Math.PI*2)*360*(Math.PI/180/2),s=m?this.canvas.height-c:c,n=m?90:270,a=n*(Math.PI/180)-e,r=n*(Math.PI/180)+e;this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.strokeStyle=this.textSettings.backgroundColor,this.ctx.lineWidth=this.textSettings.height+2*this.textSettings.padding,this.ctx.beginPath(),this.ctx.arc(this.rect.width/2,s,t,a,r),this.ctx.stroke(),this.ctx.restore()}}if(this.textSettings.underline&&!this.isWordBackground){let t=d-this.textSettings.height/2;if(t>this.textSettings.height){const e=Math.ceil(.06*this.textSettings.height);let n=(i-2*Math.round(this.textSettings.padding+o))/(d*Math.PI*2)*360*(Math.PI/180/2),a=m?this.canvas.height-c:c,r=m?90:270,h=r*(Math.PI/180)-n,l=r*(Math.PI/180)+n;const u=Math.round(.5*(this.textSettings.baseline+e)+s);this.ctx.save(),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.fill.addToCanvasStrokeStyle(this.ctx),this.ctx.lineWidth=e,this.ctx.beginPath(),m?this.ctx.arc(this.rect.width/2,a,t+u,h,l):this.ctx.arc(this.rect.width/2,a,t-u,h,l),this.ctx.stroke(),this.ctx.restore()}}if(this.ctx.save(),t.length>0){let e=m?-1:1,h=m?d-this.textSettings.height-this.textSettings.ascent:-d-this.textSettings.ascent;this.ctx.textAlign="center";const l=.5*this.ctx.canvas.width,g=m?this.canvas.height-c:c;this.ctx.translate(l,g),null===(a=this.fill)||void 0===a||a.addToCanvasFillStyle(this.ctx,-l,-g),this.ctx.rotate((i-2*o-2*this.textSettings.padding)/u*Math.PI*-e);for(var v=0;v<t.length;v++){if(p&&" "===t[v]){if(v>0&&" "===t[v-1])continue;this.ctx.rotate((3*this.textSettings.padding+r+o)/u*(2*Math.PI)*e);continue}let i=this.ctx.measureText(t[v]).width;i/u*Math.PI*2>5e-4?(this.ctx.rotate(i/2/u*Math.PI*2*e),this.drawChar(t[v],0,h+s,n),this.ctx.rotate((i/2+o)/u*Math.PI*2*e)):(this.drawChar(t[v],i/2,h+s,n),this.ctx.rotate((i+o)/u*Math.PI*2*e))}}this.ctx.restore()},this.drawLine=(t,e,i,s,n,a=!1)=>{var r,o;let c=0,h=0;const d=this.textSettings.getLineSpacing(),u=this.textSettings.getLetterSpacing(),m=Math.ceil(.06*this.textSettings.height),p=Math.round(this.textSettings.padding+u),g=t.split(" ");if("center"==this.textSettings.align?c=Math.round((this.rect.width-i)/2):"right"==this.textSettings.align?c=Math.round(this.rect.width-i):"justify"==this.textSettings.align&&g.length>1&&i/this.rect.width>.7&&(h=this.isWordBackground?(this.rect.width-i)/(t.split(" ").filter((t=>t)).length-1):(this.rect.width-i)/(g.length-1),i=this.rect.width),this.textSettings.background&&this.textSettings.backgroundType===l.Z.BACKGROUND_LINE&&(this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(c,e-this.textSettings.padding,Math.round(i),this.textSettings.height+2*this.textSettings.padding),null===(r=this.fill)||void 0===r||r.addToCanvasFillStyle(this.ctx)),this.textSettings.underline&&!this.isWordBackground){const t=Math.ceil(.06*this.textSettings.height),n=Math.round(this.textSettings.padding+u);this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillRect(c+n,e+this.textSettings.baseline+t+s,i-2*n,t),this.ctx.globalCompositeOperation="source-over"}if(0!==h||this.isWordBackground){let t=this.ctx.measureText(" ").width;for(let i=0;i<g.length;i++){const a=this.measureTextWidth(g[i],u,!0);if(this.isWordBackground){if(!g[i])continue;this.ctx.fillStyle=this.textSettings.backgroundColor,this.ctx.fillRect(c,e-this.textSettings.padding,Math.round(a+2*this.textSettings.padding),this.textSettings.height+2*this.textSettings.padding),null===(o=this.fill)||void 0===o||o.addToCanvasFillStyle(this.ctx),t=3*this.textSettings.padding+d,this.textSettings.underline&&(this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillRect(c+p,e+this.textSettings.baseline+m+s,Math.round(a+2*this.textSettings.padding)-2*p,m),this.ctx.globalCompositeOperation="source-over")}0===u?this.drawText(g[i],c+this.textSettings.padding+u,e-this.textSettings.ascent+s,n):this.drawSpacedText(g[i],c+this.textSettings.padding+u,e-this.textSettings.ascent+s,u,n),c+=Math.round(a+t+h)}}else 0!==u||a?this.drawSpacedText(t,c+this.textSettings.padding+u,e-this.textSettings.ascent+s,u,n):this.drawText(t,c+this.textSettings.padding+u,e-this.textSettings.ascent+s,n)},this.drawSpacedText=(t,e,i,s,n)=>{let a=0,r="";for(;a<t.length;)r=t[a++],this.drawChar(r,e,i,n),e+=this.ctx.measureText(r).width+s},this.drawText=(t,e,i,s)=>{this.textSettings.outline&&0===s.x&&0===s.y&&this.ctx.strokeText(t,e,i),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(t,e,i),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===s.x&&0===s.y||this.ctx.strokeText(t,e+s.x,i+s.y)},this.drawChar=(t,e,i,s)=>{this.textSettings.outline&&0===s.x&&0===s.y&&this.ctx.strokeText(t,e,i),this.isPunchOut&&(this.ctx.globalCompositeOperation="destination-out"),this.ctx.fillText(t,e,i),this.ctx.globalCompositeOperation="source-over",!this.textSettings.outline||0===s.x&&0===s.y||this.ctx.strokeText(t,e+s.x,i+s.y)},this.measureTextWidth=(t,e,i)=>{if(!t)return 0;let s=0;if(0!==e){for(let e=0;e<t.length;e++)s+=this.ctx.measureText(t[e]).width;s+=t.length*e}else s=this.ctx.measureText(t).width;return i&&(s+=e),s},this.position=(t,e)=>{this.rect&&(void 0!==t&&(this.rect.x=t),void 0!==e&&(this.rect.y=e),this.bect&&(this.bect.x=this.rect.x-4*this.textSettings.padding,this.bect.y=this.rect.y-4*this.textSettings.padding))},this.scale=(t,e)=>{this.textSettings.setSize(Math.round(this.textSettings.size*e)),this.rect.x=Math.round(this.rect.x*t),this.rect.y=Math.round(this.rect.y*e),this.rect.width=Math.round(this.rect.width*t),this.render()},this.calculate=(t,e)=>{this.rect.x=Math.round(t.x),this.rect.width=Math.round(e.x-t.x),this.rect.width<20&&(this.rect.width=20),this.render()},this.setWidth=t=>{this.rect.width=Math.round(t),this.rect.width<20&&(this.rect.width=20),this.render()},this.getHeight=()=>this.textSettings.height,this.setHeightScale=t=>{let e=Math.round(this.textSettings.size*t);this.setTextSize(e>1e3?1e3:e)},this.rotate=t=>{this.rect.rotation+=t?-90:90},this.rasterize=()=>{let t=this.baked?this.baked:this.canvas,e=this.bect?this.bect.clone():this.rect.clone();const i=new h.Z(s.M8(),this.settings.name,t,e,this.settings.locked);return i.settings=Object.assign({},this.settings),i.applyTransform(),i},this.clone=(t=!1)=>{let e=new u(t?this.id:s.M8(),this.text,this.rect.clone(),this.textSettings.clone());return e.settings=Object.assign({},this.settings),e.animation=d.Z.clone(this.animation),e.rect=this.rect.clone(),e.canvas=s.dN(this.canvas),e.prepare(),e},this.textSettings=m,this.text=e,this.rect=i}drawCurveLine(t,e,i,s,n){switch(this.textSettings.curveType){case"arc":this.drawArcLine(t,e,i,s,n);break;case"circle":this.drawCircleLine(t,e,i,s,n);break;case"half":this.drawHalfLine(t,e,i,s,n)}}}},77758:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(93947),n=i(33655);class a{constructor(t,e,i=!0){this.lineSpace=0,this.letterSpace=0,this.bold=!1,this.italic=!1,this.uppercase=!1,this.underline=!1,this.align="center",this.curve=!1,this.curveAmount=0,this.curveType="arc",this.curveFlip=!1,this.curveSpread=!1,this.warp=!1,this.warpEdgeSize=0,this.warpCenterSize=0,this.warpHorizontalOffset=0,this.warpVerticalOffset=0,this.warpType=a.WARP_CIRCULAR,this.warpMode=a.WARP_UPPER,this.background=!1,this.backgroundOffset=0,this.backgroundPunch=!1,this.backgroundColor="#555555",this.backgroundType=a.BACKGROUND_FULL,this.outline=!1,this.outlinePunch=!1,this.outlineColor="#555555",this.outlineSize=.3,this.outlineDistance=0,this.outlineDirection=305,this.shadow=!1,this.shadowBlur=.3,this.shadowColor="#444444",this.shadowAlpha=.3,this.shadowDistance=.3,this.shadowDirection=160,this.font=t,this.size=e,i&&this.measureText()}setSize(t){this.size=t,this.measureText()}setFont(t){this.font=t,this.measureText()}measureText(){if(this.size<1)return;var t=document.createElement("canvas");t.width=20*this.size,t.height=Math.round(2*this.size);const e=t.getContext("2d",{willReadFrequently:!0});e.textBaseline="top",e.fillStyle="white",e.font=this.getCssFont(),e.fillText("SfTgMjkHpqLRnliIFIABCDEFGIJKNOPQSUVXYZabcdeghmnorstuvxyz",0,Math.round(.5*this.size));const i=n.vO(e.getImageData(0,0,t.width,t.height));if(i){this.ascent=i.y-Math.round(.5*this.size),this.height=i.height,e.clearRect(0,0,t.width,t.height),e.fillText("SMOP",0,Math.round(.5*this.size));const s=n.vO(e.getImageData(0,0,t.width,t.height));this.baseline=s.height}this.height<=0&&this.measureTextFallback(),this.padding=Math.round(.2*this.height)}measureTextFallback(){var t=document.createElement("span");t.innerHTML="ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz",t.style.fontFamily=this.font,t.style.fontSize=this.size+"px";var e=document.createElement("div");e.style.display="inline-block",e.style.width="1px",e.style.height="0px";var i=document.createElement("div");i.appendChild(t),i.appendChild(e),(0,s.ZP)("workspace").appendChild(i);try{e.style.verticalAlign="baseline",this.ascent=e.offsetTop-t.offsetTop+1,e.style.verticalAlign="bottom",this.height=e.offsetTop-t.offsetTop+1,this.baseline=this.height}finally{i.remove()}}getLineSpacing(){var t;return Math.ceil(this.height*Number(null!==(t=this.lineSpace)&&void 0!==t?t:0))}getLetterSpacing(){var t;return Math.ceil(this.height/2*Number(null!==(t=this.letterSpace)&&void 0!==t?t:0))}getCssFont(t=this.size){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+t+"px "+this.font}clone(){const t=Object.create(a.prototype);return Object.assign(t,this)}equalTo(t){return!!t&&(this.font===t.font&&this.size===t.size&&this.lineSpace===t.lineSpace&&this.letterSpace===t.letterSpace&&this.bold===t.bold&&this.italic===t.italic&&this.underline===t.underline&&this.uppercase===t.uppercase&&this.fillType===t.fillType&&this.fillValue===t.fillValue&&this.align===t.align&&this.curve===t.curve&&this.curveAmount===t.curveAmount&&this.curveType===t.curveType&&this.curveSpread===t.curveSpread&&this.curveFlip===t.curveFlip&&this.warp===t.curve&&this.warpMode===t.warpMode&&this.warpType===t.warpType&&this.warpEdgeSize===t.warpEdgeSize&&this.warpCenterSize==this.warpCenterSize&&this.warpHorizontalOffset==this.warpHorizontalOffset&&this.warpVerticalOffset==this.warpVerticalOffset&&this.background===t.background&&this.backgroundPunch===t.backgroundPunch&&this.backgroundColor===t.backgroundColor&&this.backgroundType===t.backgroundType&&this.outline===t.outline&&this.outlinePunch===t.outlinePunch&&this.outlineSize===t.outlineSize&&this.outlineColor===t.outlineColor&&this.outlineDistance===t.outlineDistance&&this.outlineDirection===t.outlineDirection&&this.shadow===t.shadow&&this.shadowBlur===t.shadowBlur&&this.shadowColor===t.shadowColor&&this.shadowAlpha===t.shadowAlpha&&this.shadowDistance===t.shadowDistance&&this.shadowDirection===t.shadowDirection)}}a.BACKGROUND_FULL="full",a.BACKGROUND_LINE="line",a.BACKGROUND_WORD="word",a.WARP_CIRCULAR="circular",a.WARP_ANGULAR="angular",a.WARP_UPPER="upper",a.WARP_MIDDLE="middle",a.WARP_LOWER="lower"},74820:(t,e,i)=>{i.d(e,{Lt:()=>r,X6:()=>c,ZP:()=>d,ru:()=>o});var s=i(93947),n=i(71030),a=i(43673);function r(t,e){(0,n.Z)("setting-"+t,e.toString());const i=window.localStorage.getItem("user-settings"),s=JSON.parse(i||"{}");l[t]=s[t]=e,window.localStorage.setItem("user-settings",JSON.stringify(s)),document.dispatchEvent(new CustomEvent("user-setting-updated",{detail:t}))}function o(){let t=1,e=h();l.ddid&&""!==l.ddid&&-1!==l.ddid.indexOf(":")&&Number(l.ddid.split(":")[0])===e&&(t=Number(l.ddid.split(":")[1])+1),r("ddid",e+":"+t),(0,n.Z)("daily-saves",t.toString())}function c(){return function(){if(l.ddid&&""!==l.ddid&&-1!==l.ddid.indexOf(":")&&Number(l.ddid.split(":")[0])===h()){let t=Number(l.ddid.split(":")[1]);return t<=0&&(t=666),t}return 0}()>=3}function h(){let t=new Date;return(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate())-Date.UTC(t.getFullYear(),0,0))/24/60/60/1e3}const l=function(){const t={product:"web",api:!1,debug:"",cdnUrl:"",accent:"default",workspace:"default",allTooltip:!1,autoSelect:!0,showGuides:!0,snapToGuides:!0,smoothScaling:!0,askToPreResize:!0,useLegacySave:!1,scrollMode:"zoom",maxHistoryUndos:25,boxBarXState:"maximized",panelFloating:!1,panelNavigator:!0,panelLayer:!0,panelHistory:!0,barQuicklink:!0,mainColor:"#ffffff",altColor:"#000000",oldColor:["#A8534B","#EC9D75","#F9D697","#DCE6A7","#9ADFB0","#57CBAB","#38A793","#5A5E5A"],gradients:[],dialogPos:new a.Z(0,0),adyenClientKey:"",lastNewsCheck:"1970-01-01T00:00:00Z",ddid:""};return Object.assign(t,(()=>{const t=window.localStorage.getItem("user-settings");return JSON.parse(t||"{}")})()),Object.assign(t,(()=>{const t=new URL(window.location.href),e={};return t.searchParams.forEach(((t,i)=>{e[i]=t})),e})()),Object.assign(t,(()=>{const t=(0,s.ZP)("config_data");if(t&&t.innerText){let t=JSON.parse((0,s.ZP)("config_data").innerText);return(0,s.ZP)("config_data").remove(),t}return{}})()),t.api=!!t.referrer&&!!t.file,t}(),d=l},57909:(t,e,i)=>{i.d(e,{Z:()=>a});var s=i(93947),n=i(33655);class a{constructor(t=!0){this.setContent=(...t)=>{t[0]instanceof HTMLElement?this.content.append(...t):this.content.innerHTML+=t[0]},this.keyDown=t=>{"Escape"!==t.key&&"Esc"!==t.key||this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.classList.remove("ani"),this.modal.classList.remove("dim"),setTimeout((()=>{this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null}),200)},this.mid=n.Zd(),this.modal=(0,s.T)("div",{id:"modal-"+this.mid,className:"modal"}),document.body.appendChild(this.modal),this.dialog=(0,s.T)("div",{className:"announce"}),this.modal.appendChild(this.dialog),this.content=(0,s.T)("div",{className:"content"}),this.dialog.append((0,s.T)("img",{id:"announce-close"+this.mid,className:"close",src:"/img/icon/close.svg",onclick:()=>this.cleanUp()}),this.content),document.addEventListener("keydown",this.keyDown,!1),setTimeout((()=>this.dialog.classList.add("ani")),5),t&&setTimeout((()=>this.modal.classList.add("dim")),5)}}},57246:(t,e,i)=>{i.d(e,{Z:()=>l});var s=i(93947),n=i(96548),a=i(57909),r=i(71030),o=i(27969),c=i(33506),h=i(16577);class l extends a.Z{constructor(){super(!0),(0,r.Z)("paywall"),this.dialog.style.maxWidth="920px",this.content.style.flexDirection="column",this.content.style.padding="40px 40px 20px 40px",this.content.style.background="linear-gradient(180deg, #00000000 0%, #00000000 10%, #00000010 100%)",this.setContent(`\n            <h1 class="heavy bold">${(0,n.Z)("snapYouHaveUseAllDailySaves")}</h1>\n            <p style="font-size:16px;" class="pad-5">${(0,n.Z)("forAsLow075GetUnlimitedSavesAdFree")}</p>\n\n            <p id="do-login" style="display:none">${(0,n.Z)("common-alreadyMember")} <a id="login-link" class="anchor">${(0,n.Z)("common-loginHere")}</a></p>\n\n            <section class="paywal-plan pad-40">\n\n                <div id="subscribe-plus" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/plus-icon.svg" alt="plus icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("plus")}</h1>\n                        </span>\n\n                        <p class="pad-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("addFreeUnlimitedSaves")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$0.75</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big white w-100 pad-30 text-default">${(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n\n                <div id="subscribe-premium" class="plan popular">\n                    <div class="plan-header">\n                        ${(0,n.Z)("mostPopular")}\n                    </div>\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/premium-icon.svg" alt="premium icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("premium")}</h1>\n                        </span>\n\n                        <p class="pad-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("fullAccessToPixlrSuiteAssetTemplates")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$4.90</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big w-100 pad-30" style="background: #019ECF;">${!c.a||c.a.eligibleForTrail?(0,n.Z)("try30DaysFree"):(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n\n                <div id="subscribe-team" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/team-icon.svg" alt="team icon">\n                            <h1 class="text-capitalize">${(0,n.Z)("team")}</h1>\n                        </span>\n\n                        <p class="pad-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("manageYourTeamAndCollaborate")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$9.91</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big white w-100 pad-30 text-default">${(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n            </section>\n\n            <p class="pad-30 center">${(0,n.Z)("unsureWhichSubscriptionToGet",`<a href="/pricing" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("pricingPage")}</a>`)} ${(0,n.Z)("freeForEducation",`<a href="/learn/education/" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("education")}</a>`)}</p>\n        `),c.a||((0,s.ZP)("do-login").style.display="block",(0,s.ZP)("login-link").addEventListener("click",(()=>{this.cleanUp(),new o.ZP}))),(0,s.ZP)("subscribe-plus").addEventListener("click",(()=>{this.cleanUp(),c.a?new h.Z("subscription",{plan:"plus-monthly",bounceSource:"paywall"}):new o.ZP})),(0,s.ZP)("subscribe-premium").addEventListener("click",(()=>{this.cleanUp(),c.a?new h.Z("subscription",{plan:"premium-monthly",bounceSource:"paywall"}):new o.ZP})),(0,s.ZP)("subscribe-team").addEventListener("click",(()=>{this.cleanUp(),c.a?new h.Z("subscription",{plan:"team-monthly",bounceSource:"paywall"}):new o.ZP}))}}},21951:(t,e,i)=>{i.d(e,{Z:()=>l});var s=i(93947),n=i(96548),a=i(57909),r=i(71030),o=i(27969),c=i(33506),h=i(16577);class l extends a.Z{constructor(t,e){super(!0),(0,r.Z)("premium-bounce",t),this.dialog.style.maxWidth="920px",this.content.id="bounce-content",this.content.style.flexDirection="column";const i=!(!c.a||"plus"!==c.a.subscriptionAccess);this.setContent(`\n            <div style="padding:30px 40% 20px 40px;">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div>\n                   \n                <h1 class="top-30">${(0,n.Z)("premiumBounceTitle")}</h1>\n                <p class="top-20" style="text-align:left;">${(0,n.Z)("premiumFeaturePitch")}</p>\n\n            </div>\n\n            <section class="paywal-plan" style="padding:40px;background:linear-gradient(180deg, #00000000 0%, #00000000 10%, #00000010 100%)">\n\n                <div id="subscribe-plus" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/plus-icon.svg" alt="plus icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("plus")}</h1>\n                        </span>\n\n                        <p class="top-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("addFreeUnlimitedSaves")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$0.75</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        ${i?`<div class="button big disabled w-100 top-30 text-default" style="color: #000;cursor: not-allowed !important;">${(0,n.Z)("currentPlan")}</div>`:`<div class="button big white w-100 top-30 text-default">${(0,n.Z)("subscribeNow")}</div>`}\n                    </div>\n                </div>\n\n                <div id="subscribe-premium" class="plan popular">\n                    <div class="plan-header">\n                        ${(0,n.Z)("mostPopular")}\n                    </div>\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/premium-icon.svg" alt="premium icon" style="width: 24px;">\n                            <h1 class="text-capitalize">${(0,n.Z)("premium")}</h1>\n                        </span>\n\n                        <p class="top-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("fullAccessToPixlrSuiteAssetTemplates")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$4.90</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big w-100 top-30" style="background: #019ECF;">\n                        ${i?(0,n.Z)("upgradeNow"):!c.a||c.a.eligibleForTrail?(0,n.Z)("try30DaysFree"):(0,n.Z)("subscribeNow")}\n                        </div>\n                    </div>\n                </div>\n\n                <div id="subscribe-team" class="plan">\n                    <div class="plan-details">\n                        <span style="display: flex; column-gap: 12px">\n                            <img src="/img/misc/team-icon.svg" alt="team icon">\n                            <h1 class="text-capitalize">${(0,n.Z)("team")}</h1>\n                        </span>\n\n                        <p class="top-5" style="line-height: 22px; color: #3F4246;">${(0,n.Z)("manageYourTeamAndCollaborate")}</p>\n                        <div style="font-size: 36px; line-height: normal;">$9.91</div>\n                        <div style="font-size: 16px; line-height: normal;">USD /${(0,n.Z)("month")}</div>\n\n                        <div class="button big white w-100 top-30 text-default">${i?(0,n.Z)("upgradeNow"):(0,n.Z)("subscribeNow")}</div>\n                    </div>\n                </div>\n            </section>\n\n            <p class="center" style="padding:10px;">${(0,n.Z)("unsureWhichSubscriptionToGet",`<a href="/pricing" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("pricingPage")}</a>`)} ${(0,n.Z)("freeForEducation",`<a href="/learn/education/" class="anchor" target="_blank" style="color: #019ECF;">${(0,n.Z)("education")}</a>`)}</p>\n            \n        `),(0,s.ZP)("subscribe-plus").addEventListener("click",(()=>{i||(this.cleanUp(),c.a?new h.Z("subscription",{platform:(null==e?void 0:e.platform)||"suite",plan:"plus-monthly",bounceSource:"premiumbounce"}):new o.ZP)})),(0,s.ZP)("subscribe-premium").addEventListener("click",(()=>{this.cleanUp(),c.a?i?new h.Z("subscription",{platform:(null==e?void 0:e.platform)||"suite",plan:"premium-yearly",checkoutMode:"upgrade",bounceSource:"premiumbounce"}):new h.Z("subscription",{platform:(null==e?void 0:e.platform)||"suite",plan:"premium-monthly",bounceSource:"premiumbounce"}):new o.ZP})),(0,s.ZP)("subscribe-team").addEventListener("click",(()=>{this.cleanUp(),c.a?i?new h.Z("subscription",{platform:(null==e?void 0:e.platform)||"suite",plan:"team-yearly",checkoutMode:"upgrade",bounceSource:"premiumbounce"}):new h.Z("subscription",{platform:(null==e?void 0:e.platform)||"suite",plan:"team-monthly",bounceSource:"premiumbounce"}):new o.ZP}))}}},70840:(t,e,i)=>{i.d(e,{Z:()=>d});var s=i(93947),n=i(96548),a=i(57909),r=i(71030),o=i(27969),c=i(33506),h=i(16577),l=i(92409);class d extends a.Z{constructor(t){super(!0),this.hasPlayBilling=!1,this.checkPlayBilling=async()=>{this.hasPlayBilling=await(0,l.Ev)(),this.hasPlayBilling&&((0,s.ZP)("gpay-info").style.display="block")},this.showAuth=async()=>{(0,s.ZP)("tbounce-content").style.display="none",(0,s.ZP)("tbounce-entry").style.display="flex",new o.ZP("chooser",{method:"embed",holder:(0,s.ZP)("tbounce-entry")})},this.stage=t,(0,r.Z)("premium-bounce","template"),this.setContent(`\n            <div id="tbounce-content" style="display:flex;width:420px;flex-grow:0;flex-shrink:0;padding:30px;flex-direction:column;">\n\n                <div class="premium-tag" title="premium"><img src="/img/icon/premium.svg"></div> \n\n                <h1 class="pad-40">${(0,n.Z)("premiumTemplate")}</h1>\n\n                <p class="pad-10">${(0,n.Z)("premiumTemplateSalesPitch")}</p>\n\n                <div style="display:flex;flex-direction:column;flex-grow:1;padding-bottom:10px;">\n                    <a id="premium-one-time" class="button big green w-100" style="margin-top:auto">${(0,n.Z)("premiumOneTime")} ${"USD"===(null===c.a||void 0===c.a?void 0:c.a.currency)?"$":"€"}1</a>\n                    <a id="premium-go-now" class="button big green outline pad-15 w-100" style="border-radius:50vh">${(null===c.a||void 0===c.a?void 0:c.a.eligibleForTrail)?(0,n.Z)("try30DayFreePremium"):(0,n.Z)("subscribeNow")}</a>\n                    <div id="gpay-info" class="pad-10 center" style="display:none;font-size:12px;font-style:italic">\n                        *30 day free trial is only eligible for new users and can only be claimed once per customer.\n                    </div>\n                    <p class="pad-30 center" id="one-of-us">${(0,n.Z)("common-alreadyMember")} <a id="premiumbounce-auth" class="link" style="cursor:pointer">${(0,n.Z)("common-loginHere")}</a></p>\n                </div>\n            </div>\n            <div id="tbounce-entry" style="display:none;flex-direction:column;width:420px;flex-grow:0;flex-shrink:0;"></div>\n            <div id="tbounce-template-holder" class="flair left-panel">\n\n            </div>\n        `),(0,s.ZP)("tbounce-template-holder").appendChild(this.stage.getOutputCanvas()),c.a?((0,s.ZP)("one-of-us").style.display="none",(0,s.ZP)("premium-one-time").addEventListener("click",(async()=>{var t,e,i;this.hasPlayBilling?await(0,l.V)(!0,null!==(i=null===(e=null===(t=this.stage.fresco)||void 0===t?void 0:t.templateMeta)||void 0===e?void 0:e.templateId)&&void 0!==i?i:null)&&(this.cleanUp(),document.dispatchEvent(new CustomEvent("unblock-viewport"))):(this.cleanUp(),new h.Z("template",{bounceSource:"premiumtemplatebounce",stage:this.stage}))})),(0,s.ZP)("premium-go-now").addEventListener("click",(async()=>{this.hasPlayBilling?await(0,l.V)(!1,null)&&(this.cleanUp(),document.dispatchEvent(new CustomEvent("unblock-viewport"))):(this.cleanUp(),new h.Z("subscription",{plan:"premium-monthly",bounceSource:"premiumtemplatebounce"}))}))):((0,s.ZP)("premium-one-time").addEventListener("click",this.showAuth),(0,s.ZP)("premium-go-now").addEventListener("click",this.showAuth)),(0,s.ZP)("premiumbounce-auth").addEventListener("click",this.showAuth),this.checkPlayBilling()}}},39868:(t,e,i)=>{i.d(e,{Z:()=>r});var s=i(93947),n=i(96548),a=i(23868);class r extends a.Z{constructor(){super((0,n.Z)("dialogChoiceTitle"),!0),this.init=()=>new Promise(((t,e)=>{const i=this.content.querySelector("#open-as-new"),s=this.content.querySelector("#open-in-current");this.cancel=()=>{this.cleanUp(),t("close")},i.onclick=()=>{this.cleanUp(),t("create")},s.onclick=()=>{this.cleanUp(),t("layer")}})),this.setContent(`    \n            ${(0,n.Z)("dialogChoiceHeadline")}\n            <ul class="push-buttons pad-20" style="text-align: center">\n                <li id="open-as-new">\n                    <img src="/img/icon/document-new.svg" class="ic" />\n                    <span>${(0,n.Z)("createNew")}</span>\n                </li>\n                <li id="open-in-current">\n                    <img src="/img/icon/document-add.svg" class="ic" />\n                    <span>${(0,n.Z)("addCurrent")}</span>\n                </li>\n            </ul>\n        `),(0,s.ZP)("dialog-buttons"+this.mid).style.display="none"}}},23868:(t,e,i)=>{i.d(e,{Z:()=>c});var s=i(96548),n=i(33655),a=i(43673),r=i(74820),o=i(93947);class c{constructor(t,e=!0,i=!1){this.setContent=(...t)=>{t[0]instanceof HTMLElement?this.content.append(...t):this.content.innerHTML+=t[0],this.position()},this.disableApply=()=>{const t=(0,o.ZP)("dialog-apply"+this.mid);t.classList.add("disabled"),t.onclick=void 0},this.enableApply=()=>{const t=(0,o.ZP)("dialog-apply"+this.mid);t.classList.remove("disabled"),t.onclick=()=>this.apply()},this.disableCancel=()=>{const t=(0,o.ZP)("dialog-cancel"+this.mid);t.classList.add("disabled"),t.onclick=void 0},this.enableCancel=()=>{const t=(0,o.ZP)("dialog-cancel"+this.mid);t.classList.remove("disabled"),t.onclick=()=>this.cancel()},this.position=()=>{this.dialog.style.left=Math.round((this.modal.offsetWidth-this.dialog.offsetWidth)/2+r.ZP.dialogPos.x)+"px",this.dialog.style.top=Math.round((this.modal.offsetHeight-this.dialog.offsetHeight)/2+r.ZP.dialogPos.y)+"px";let t=this.dialog.getBoundingClientRect(),e=this.modal.getBoundingClientRect();t.bottom>e.bottom&&(this.dialog.style.top=e.height-t.height<0?"0px":e.height-t.height+"px"),t.right>e.right&&(this.dialog.style.left=e.width-t.width<0?"0px":e.width-t.width+"px"),this.dialog.offsetTop<0&&(this.dialog.style.top="0px"),this.dialog.offsetLeft<0&&(this.dialog.style.left="0px")},this.dragStart=t=>{this.p=t,this.d=new a.Z(this.dialog.offsetLeft,this.dialog.offsetTop)},this.dragMove=t=>{this.dialog.style.left=Math.round(this.d.x+(t.x-this.p.x))+"px",this.dialog.style.top=Math.round(this.d.y+(t.y-this.p.y))+"px"},this.dragEnd=t=>{r.ZP.dialogPos.x=Math.round(this.dialog.offsetLeft-(this.modal.offsetWidth-this.dialog.offsetWidth)/2),r.ZP.dialogPos.y=Math.round(this.dialog.offsetTop-(this.modal.offsetHeight-this.dialog.offsetHeight)/2)},this.resizeStart=t=>{this.d=new a.Z(this.dialog.clientHeight,t.y)},this.resizeMove=t=>{const e=this.d.x+(t.y-this.d.y);this.dialog.style.height=(e<320?320:e)+"px"},this.keyDown=t=>{27!=t.keyCode||"none"===(0,o.ZP)("dialog-cancel"+this.mid).style.display?13!=t.keyCode||"none"===(0,o.ZP)("dialog-apply"+this.mid).style.display||t.shiftKey||(0,o.ZP)("dialog-apply"+this.mid).classList.contains("disabled")||this.apply():this.cancel()},this.condition=()=>{this.cleanUp()},this.cancel=()=>{this.cleanUp()},this.apply=()=>{this.cleanUp()},this.cleanUp=()=>{document.removeEventListener("keydown",this.keyDown,!1),this.dialog.remove(),this.dialog=null,this.modal.remove(),this.modal=null},this.mid=n.Zd(),this.modal=(0,o.T)("div",{id:"modal-"+this.mid,className:"modal"}),e&&this.modal.classList.add("dim"),document.body.appendChild(this.modal),this.dialog=(0,o.T)("div",{className:"dialog"}),this.modal.appendChild(this.dialog),this.content=(0,o.T)("div",{className:"content"});const c=(0,o.T)("div",{id:"dialog-title",className:"title"},t);if((0,o.Rg)(c,this.dragStart,this.dragMove,this.dragEnd),this.dialog.append(c,(0,o.T)("img",{id:"dialog-close"+this.mid,className:"close ic",src:"/img/icon/close.svg",onclick:()=>this.cancel()}),(0,o.T)("div",{id:"dialog-splitter"+this.mid,className:"splitter"}),this.content,(0,o.T)("div",{className:"buttons",id:"dialog-buttons"+this.mid},(0,o.T)("a",{id:"dialog-apply"+this.mid,className:"button positive",onclick:()=>this.apply()},(0,s.Z)("apply")),(0,o.T)("a",{id:"dialog-cancel"+this.mid,className:"button negative",onclick:()=>this.cancel()},(0,s.Z)("cancel")))),i){const t=(0,o.T)("img",{id:"resize-"+this.mid,src:"/img/icon/three-dot.svg",className:"resize ic"});(0,o.Rg)(t,this.resizeStart,this.resizeMove),this.dialog.append(t)}document.addEventListener("keydown",this.keyDown,!1)}}},4375:(t,e,i)=>{i.d(e,{Z:()=>c});var s=i(93947),n=i(96548),a=i(23868),r=i(71030),o=i(95574);class c extends a.Z{constructor(t={}){super((0,n.Z)("dialogLoadTitle")),this.load=async t=>{(0,r.Z)("load-url");const e=(0,s.ZP)("load-message");try{this.cancel=()=>{throw c.CANCEL};const i=this.settings.title||(0,n.Z)("image"),a=this.settings.referrer||(0,n.Z)("source");e.innerText=(0,n.Z)("dialogLoadLoadingFrom",i.toLowerCase(),a.toLowerCase());const r=await(0,o.c6)(t,(t=>{const e=(0,s.ZP)("load-progress");-1==t?e.removeAttribute("value"):e.value=t})),h=new File([r],this.settings.title||t.substring(t.lastIndexOf("/")+1),{type:r.type});return this.cleanUp(),h}catch(i){if(i===c.CANCEL)return void this.cleanUp();(0,s.ZP)("load-progress")&&(e.innerText=(0,n.Z)("dialogLoadError"),(0,s.ZP)("load-progress").style.display="none",this.cancel=()=>{this.cleanUp()})}},this.settings=t,this.setContent('\n            <p id="load-message"></p><br />\n\n            <progress id="load-progress" value="0" max="100" style="width: 100%;"></progress>\n            <br><br>\n        '),(0,s.ZP)("dialog-apply"+this.mid).style.display="none";(0,s.ZP)("load-message").innerText=(0,n.Z)("dialogLoadPrepare")}}c.CANCEL=new Error("CANCEL")},56584:(t,e,i)=>{i.d(e,{Z:()=>l});var s=i(93947),n=i(96548),a=i(33655),r=i(23868),o=i(99872),c=i(74820),h=i(33506);class l extends r.Z{constructor(t,e){if(super((0,n.Z)("dialogPreResizeTitle")),this.rotation=0,this.size=1920,this.init=()=>new Promise(((t,e)=>{this.apply=()=>{(0,s.ZP)("preresize-never-ask-again").checked&&(0,c.Lt)("askToPreResize",!1);const e=new o.Z(Number((0,s.ZP)("pre-resize-width").value),Number((0,s.ZP)("pre-resize-height").value)),i=(0,s.ZP)("pre-resize-auto-rotate").checked?this.rotation:0;this.cleanUp(),t([e,i])},this.cancel=()=>{this.cleanUp(),t([void 0,void 0])}})),this.presetChange=t=>{let e=t.currentTarget,i=(0,s.ZP)("pre-resize-preset").getElementsByTagName("li");for(var n=0;n<i.length;n++)i[n].classList.remove("selected");e.classList.add("selected"),this.size=Number(e.getAttribute("data")),this.setSize()},this.imageSizeInputChange=t=>{let e,i,n=t.currentTarget;"pre-resize-width"===n.id?(e=a.uZ(Number(n.value),1,this.width),i=Math.round(e/this.width*this.height)):(i=a.uZ(Number(n.value),1,this.height),e=Math.round(i/this.height*this.width)),(0,s.ZP)("pre-resize-height").value=i.toString(),(0,s.ZP)("pre-resize-width").value=e.toString()},this.setSize=()=>{let t=(0,s.ZP)("pre-resize-width"),e=(0,s.ZP)("pre-resize-height");this.width>this.height?(t.value=this.size.toString(),e.value=Math.round(this.size/this.width*this.height).toString()):(e.value=this.size.toString(),t.value=Math.round(this.size/this.height*this.width).toString())},"premium"===(null===h.a||void 0===h.a?void 0:h.a.subscriptionAccess)?this.dialog.style.width="560px":this.dialog.style.width="480px",this.image=t,90===e||-90===e?(this.height=t.width,this.width=t.height):(this.width=t.width,this.height=t.height),this.rotation=e,this.setContent(`\n            <span style="display: block;">${(0,n.Z)("dialogPreResizeInfo1")} (<span id="pre-resize-start"></span>) ${(0,n.Z)("dialogPreResizeInfo2")}</span>\n\n            <input type="checkbox" id="preresize-never-ask-again" />\n            <label class="switch pad-10" for="preresize-never-ask-again">${(0,n.Z)("neverAskMeAgain")}<span></span></label>\n\n            <span id="pre-resize-auto-rotate-setting" style="display:none;">\n                <input type="checkbox" checked id="pre-resize-auto-rotate" />\n                <label class="switch pad-20" for="pre-resize-auto-rotate">${(0,n.Z)("dialogPreResizeExif")}<span></span></label>\n            </span>\n        \n            <ul id="pre-resize-preset" class="push-buttons pad-20">\n                <li id="pre-resize-original" data="4096"><img src="/img/icon/layer-image.svg" class="ic"><span>${(0,n.Z)("original")}<br /><small id="pre-resize-uhd-size">Max 3840 px</small></span></li>\n                <li id="pre-resize-uhd" data="3840"><img src="/img/icon/size-uhd.svg" class="ic"><span>${(0,n.Z)("sizeUltraHD")}<br /><small>Max 3840 px</small></span></li>\n                <li id="pre-resize-fhd" data="1920" class="selected"><img src="/img/icon/size-fhd.svg" class="ic"><span>${(0,n.Z)("sizeFullHD")}<br /><small>Max 1920 px</small></span></li>\n                <li id="pre-resize-uhd" data="1280"><img src="/img/icon/size-web.svg" class="ic"><span>${(0,n.Z)("sizeWeb")}<br /><small>Max 1280 px</small></span></li>\n            </ul>\n\n            <div class="pad-20" style="text-align:right;line-height:32px;">${(0,n.Z)("newSize")}<input type="number" style="text-align:center;margin-left:16px" id="pre-resize-width"/> x <input type="number" style="text-align:center" id="pre-resize-height"/></div>\n        `),this.maxSize="premium"===(null===h.a||void 0===h.a?void 0:h.a.subscriptionAccess)?8192:4096,"premium"===(null===h.a||void 0===h.a?void 0:h.a.subscriptionAccess)?(this.width<3840&&this.height<3840&&((0,s.ZP)("pre-resize-uhd").style.display="none"),(0,s.ZP)("pre-resize-original").setAttribute("data",Math.min(Math.max(this.width,this.height),this.maxSize).toString()),(0,s.ZP)("pre-resize-uhd-size").innerText=(0,n.Z)("dialogPreResizeMaxSize",Math.min(Math.max(this.width,this.height),this.maxSize))):this.width<3840&&this.height<3840?((0,s.ZP)("pre-resize-uhd").style.display="none",(0,s.ZP)("pre-resize-original").setAttribute("data",Math.max(this.width,this.height).toString()),(0,s.ZP)("pre-resize-uhd-size").innerText=(0,n.Z)("dialogPreResizeMaxSize",Math.max(this.width,this.height))):(0,s.ZP)("pre-resize-original").style.display="none",0!==e){let t=(0,s.ZP)("pre-resize-auto-rotate-setting");t.style.display="block",t.addEventListener("change",(()=>{let t=(0,s.ZP)("pre-resize-width"),e=(0,s.ZP)("pre-resize-height");const i=t.value;t.value=e.value,e.value=i}),!1)}(0,s.ZP)("pre-resize-start").innerText=this.width.toString()+" x "+this.height.toString();let i=(0,s.ZP)("pre-resize-preset").getElementsByTagName("li");for(var r=0;r<i.length;r++)i[r].addEventListener("click",this.presetChange,!1);this.setSize(),(0,s.ZP)("pre-resize-width").addEventListener("change",this.imageSizeInputChange,!1),(0,s.ZP)("pre-resize-height").addEventListener("change",this.imageSizeInputChange,!1)}}},55390:(t,e,i)=>{i.d(e,{Z:()=>o});var s=i(93947),n=i(33655),a=i(36817),r=i(43673);class o{constructor(t,e){this.stage=t,this.render=()=>{if(!this.stage||!this.stage.fresco||this.stage.supressRender)return;this.viewport=a.Z.bestFit(this.stage.fresco.width,this.stage.fresco.height,180,180),this.scale=this.viewport.width/this.stage.fresco.width,this.panel.style.width=this.viewport.width+2+"px",this.panel.style.height=this.viewport.height+2+"px",this.back.width=this.viewport.width,this.back.height=this.viewport.height;var t=this.back.getContext("2d");t.imageSmoothingEnabled=!0,t.imageSmoothingQuality="high";let e=this.stage.getOutputCanvas(this.scale);e&&e.width>0&&e.height>0&&t.drawImage(e,0,0),this.position()},this.position=()=>{let t=this.stage.fresco.width*this.stage.zoom,e=this.stage.fresco.height*this.stage.zoom;if(!(this.stage.raster.width<=t||this.stage.raster.height<=e))return void(this.panel.style.display="none");this.panel.style.display="block";let i=this.viewport.width,s=this.viewport.height,n=0,a=0;i=Math.round(this.back.width*(this.stage.canvas.width/(this.stage.fresco.width*this.stage.zoom))),s=Math.round(this.back.height*(this.stage.canvas.height/(this.stage.fresco.height*this.stage.zoom))),n=-Math.round((this.stage.offset.x<0?this.stage.offset.x/this.stage.zoom:0)*this.scale),a=-Math.round((this.stage.offset.y<0?this.stage.offset.y/this.stage.zoom:0)*this.scale),this.marker.style.width=i+"px",this.marker.style.height=s+"px",this.marker.style.left=n+"px",this.marker.style.top=a+"px"},this.backDown=t=>{t.stopPropagation();let e=this.back.getBoundingClientRect(),i=this.stage.fresco.width/this.back.width;this.stage.setAnchor(new r.Z(Math.round((t.clientX-e.x)*i),Math.round((t.clientY-e.y)*i))),this.stage.updateViewport()},this.markerDown=t=>{t.stopPropagation(),this.down(t.clientX,t.clientY),document.addEventListener("pointermove",this.pointerMove,!0),document.addEventListener("pointerup",this.pointerUp,!0)},this.pointerMove=t=>{t.stopPropagation(),this.move(t.clientX,t.clientY)},this.pointerUp=t=>{t.stopPropagation(),document.removeEventListener("pointermove",this.pointerMove,!0),document.removeEventListener("pointerup",this.pointerUp,!0)},this.down=(t,e)=>{this.downPoint=new r.Z(t,e),this.downPosition=new r.Z(this.marker.offsetLeft,this.marker.offsetTop)},this.move=(t,e)=>{let i=this.downPosition.x+(t-this.downPoint.x),s=this.downPosition.y+(e-this.downPoint.y);this.stage.setAnchor(new r.Z(Math.round((i+this.marker.clientWidth/2)/this.scale),Math.round((s+this.marker.clientHeight/2)/this.scale))),this.stage.updateViewport()},this.cleanUp=()=>{this.panel.remove(),document.removeEventListener("viewport-update",this.position),document.removeEventListener("layer-list-render",this.render)},this.viewport=new a.Z,this.panel=(0,s.T)("div",{id:"navigator"}),this.marker=(0,s.T)("div",{id:"navigator-marker"}),this.back=n.vL(50,50),this.back.id="navigator-back",this.panel.append(this.back,this.marker),e.append(this.panel),this.marker.addEventListener("pointerdown",this.markerDown,!1),this.back.addEventListener("pointerdown",this.backDown,!1),document.addEventListener("viewport-update",this.position),document.addEventListener("layer-list-render",this.render)}}},4188:(t,e,i)=>{i.d(e,{Z:()=>o});var s=i(96548),n=i(33655),a=i(93947);const r={step:[.01],range:[0,1],stops:[0,1],compact:!1,force:!1,defaultValue:0,labelFormat:t=>String(t),labelParse:t=>parseInt(t,10)};class o{constructor(t,e={}){if(this.findElements=()=>{this.outlet=this.container.querySelector("input"),this.slider=this.container.querySelector(".slider"),this.knob=this.container.querySelector(".slider .knob"),this.diff=this.container.querySelector(".slider .diff"),this.bounds=this.container.querySelector(".slider .bounds"),this.label=this.container.querySelector(".info label"),this.hold=this.container.querySelector(".slider-holder")},this.buildElements=()=>{this.container.classList.add("range-box"),this.label=document.createElement("label"),this.label.innerText=(this.options.label||this.name)+" ",this.outlet=document.createElement("input"),this.outlet.type="text",this.outlet.autocomplete="off",this.outlet.value=this.options.labelFormat(this.options.defaultValue);const t=document.createElement("div");t.className="info",t.appendChild(this.label),t.appendChild(this.outlet),this.knob=document.createElement("div"),this.knob.innerHTML="<div></div>",this.knob.className="knob",this.bounds=(0,a.T)("div",{className:"bounds"},this.knob),this.diff=(0,a.T)("div",{className:"diff"},this.bounds),this.slider=(0,a.T)("div",{className:"slider"},this.diff),this.hold=(0,a.T)("div",{className:"slider-holder"},this.slider),this.container.appendChild(t),this.container.appendChild(this.hold)},this.labelOver=()=>{this.value!==this.options.defaultValue&&(this.label.innerText=(0,s.Z)("reset")+" ")},this.labelOut=()=>{this.label.innerText=(this.options.label||this.name)+" "},this.labelClick=()=>{if(this.value===this.options.defaultValue)return;const t=this.value;this.options.onStart&&this.options.onStart(this.value,this.name),this.reset(),this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,t,this.name)},this.sliderMouseDown=t=>{t.preventDefault(),t.stopPropagation(),this.knobDown(t),this.move(t.clientX)},this.knobDown=t=>{document.addEventListener("mousemove",this.knobMouseMove,!1),document.addEventListener("touchmove",this.knobTouchMove,{passive:!1}),document.addEventListener("mouseup",this.knobUp,!0),document.addEventListener("touchend",this.knobUp,{passive:!1}),this.knob.classList.add("grabbed"),t.preventDefault(),t.stopPropagation(),this.downValue=this.value,this.options.onStart&&setTimeout((()=>this.options.onStart(this.downValue,this.name)),0)},this.move=t=>{const e=this.bounds.getBoundingClientRect();if(t<=e.left)return void this.setAmount(0);if(t>=e.right)return void this.setAmount(1);const i=(t-e.left)/e.width;this.setAmount(i)},this.knobMouseMove=t=>{t.preventDefault(),t.stopPropagation(),this.move(t.clientX)},this.knobTouchMove=t=>{t.preventDefault(),t.stopPropagation(),this.move(t.touches[0].clientX)},this.knobUp=()=>{if(document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.classList.remove("grabbed"),this.options.onEnd&&(this.options.force||this.downValue!==this.value)){const t=this.downValue;this.downValue=this.value,setTimeout((()=>this.options.onEnd(this.value,t,this.name)),0)}},this.outletKeyUp=t=>{const e=this.options.labelParse(this.outlet.value);if(isNaN(e))return;const i=this.options.range[0],s=this.options.range[this.options.range.length-1],n=Math.max(Math.min(e,s),i);this.value=n,this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.diff.style.backgroundImage=this.generateDiff(this.options.defaultValue,this.value);const a=this.calculateAmount(this.value);this.setKnob(100*a),this.options.onChange&&void 0!==t&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.outletFocus=t=>{if(this.options.onStart&&(this.downValue=this.value,this.options.onStart(this.value,this.name)),this.options.compact){this.hold.style.display="block";const t=n.HS(this.container);this.hold.style.left=t.x+this.container.offsetWidth-this.hold.offsetWidth+10+"px",this.hold.style.top=t.y+34+"px"}},this.outletBlur=t=>{this.options.compact&&(this.hold.style.display="none");const e=this.options.labelParse(this.outlet.value);isNaN(e)||(this.outlet.value=this.options.labelFormat(this.value),this.options.onEnd&&(this.options.force||this.downValue!==this.value)&&void 0!==t&&this.options.onEnd(this.value,this.downValue,this.name))},this.calculateAmount=t=>{for(let e=1;e<this.options.range.length;e++){const i=this.options.range[e-1],s=this.options.range[e];if(t>=i&&t<=s){const n=this.options.stops[e-1];return n+(t-i)/(s-i)*(this.options.stops[e]-n)}}if(t==this.options.defaultValue)throw new Error("Cant recurse on default value with calculateAmount, this is a bug");return this.calculateAmount(this.options.defaultValue)},this.setKnob=t=>{const e=100*this.calculateAmount(this.options.defaultValue),i=this.generateDiff(e,t);requestAnimationFrame((()=>{this.knob.style.marginLeft=`${t}%`,this.diff.style.backgroundImage=i}))},this.roundToStep=(t,e,i,s)=>{const n=t%e;return 0===n||t===i||t===s?t:t-n},this.generateDiff=(t,e)=>{if(t===e)return"none";const i="var(--accent-color)",s=this.knob.clientWidth-3;return(e*=this.bounds.clientWidth/this.diff.clientWidth)>t?`linear-gradient(to right, transparent 0%, transparent ${t}%, ${i} ${t}%, ${i} calc(${e}%), transparent calc(${e}%), transparent 100%)`:`linear-gradient(to right, transparent 0%, transparent calc(${e}% + ${s}px), ${i} calc(${e}% + ${s}px), ${i} ${t}%, transparent ${t}%, transparent 100%)`},this.setAmount=(t,e=!1)=>{const[i,s]=this.bucket(t),n=this.options.range[i],a=this.options.range[i+1],r=this.options.step[i];this.setKnob(100*t),this.value=this.roundToStep(s*(a-n)+n,r,n,a),this.slider.classList.toggle("changed",this.value!==this.options.defaultValue),this.outlet.value=this.options.labelFormat(this.value),this.options.onChange&&!e&&setTimeout((()=>this.options.onChange(this.value,this.name)),0)},this.bucket=t=>{for(let e=1;e<this.options.stops.length;e++){const i=this.options.stops[e-1],s=this.options.stops[e];if(t>=i&&t<=s)return[e-1,(t-i)/(s-i)]}throw new Error(`Could not assign ${t} to a bucket, this is a bug`)},this.setValue=(t,e=!1)=>{const i=this.value;void 0===t&&(t=this.options.defaultValue);const s=this.options.range[0],n=this.options.range[this.options.range.length-1];this.value=Math.max(Math.min(t,n),s),this.slider.classList.toggle("changed",this.isChanged()),this.outlet.value=this.options.labelFormat(this.value);const a=this.calculateAmount(this.value);this.setKnob(100*a),(this.options.onChange||this.options.onEnd)&&e&&setTimeout((()=>{this.options.onChange&&this.options.onChange(this.value,this.name),this.options.onEnd&&this.options.onEnd(this.value,i,this.name)}),0)},this.isChanged=()=>this.value!==this.options.defaultValue,this.getValue=()=>{var t;return null!==(t=this.value)&&void 0!==t?t:0},this.reset=()=>{this.value=this.options.defaultValue,this.setKnob(100*this.calculateAmount(this.value)),this.slider.classList.remove("changed"),this.outlet.value=this.options.labelFormat(this.value),this.label.innerText=(this.options.label||this.name)+" "},this.cleanUp=()=>{document.removeEventListener("mousemove",this.knobMouseMove,!1),document.removeEventListener("touchmove",this.knobTouchMove),document.removeEventListener("mouseup",this.knobUp,!0),document.removeEventListener("touchend",this.knobUp),this.knob.removeEventListener("mousedown",this.knobDown,!1),this.knob.removeEventListener("touchstart",this.knobDown),this.slider.removeEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.removeEventListener("focus",this.outletFocus,!1),this.outlet.removeEventListener("keyup",this.outletKeyUp,!1),this.outlet.removeEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.removeEventListener("mouseover",this.labelOver,!1),this.label.removeEventListener("mouseleave",this.labelOut,!1),this.label.removeEventListener("click",this.labelClick,!1))},this.name=t,this.container=(0,a.ZP)(t),this.options=Object.assign(Object.assign({},r),e),this.value=this.options.defaultValue,Array.isArray(this.options.step)||(this.options=Object.assign(Object.assign({},this.options),{step:[this.options.step]})),this.options.stops.length<2)throw new Error("Slider need to have atleast two stops, default is [0,1]");if(this.options.range.length!=this.options.stops.length)throw new Error("Slider range option and slide stops option, needs to be the same length");if(this.options.step.length!=this.options.stops.length-1)throw new Error("Step array must be the same length as the number of ranges (slider options range - 1)");this.options.compact&&this.container.classList.add("compact");!!this.container.querySelector(".slider")?this.findElements():this.buildElements(),this.knob.addEventListener("mousedown",this.knobDown,!1),this.knob.addEventListener("touchstart",this.knobDown,{passive:!1}),this.slider.addEventListener("mousedown",this.sliderMouseDown,!1),this.outlet.addEventListener("focus",this.outletFocus,!1),this.outlet.addEventListener("keyup",this.outletKeyUp,!1),this.outlet.addEventListener("blur",this.outletBlur,!1),this.options.compact||(this.label.addEventListener("mouseover",this.labelOver,!1),this.label.addEventListener("mouseleave",this.labelOut,!1),this.label.addEventListener("click",this.labelClick,!1)),this.outlet.value!==this.options.labelFormat(this.options.defaultValue)?(this.outletKeyUp(void 0),this.outletBlur(void 0)):this.reset()}hide(){this.container.style.display="none"}show(){this.container.style.display="block"}disable(){this.container.style.pointerEvents="none",this.container.style.opacity="0.4"}enable(){this.container.style.pointerEvents="auto",this.container.style.opacity="1.0"}}},31456:(t,e,i)=>{i.d(e,{Z:()=>y});var s=i(96548),n=i(4188),a=i(33347),r=i(93947),o=i(36817),c=i(33655),h=i(18203),l=i(98776),d=i(12257),u=i(66792),m=i(4256),p=i(58027),g=i(55390),v=i(82282),f=i(50972);class y extends h.Z{constructor(t,e,i){super("fine-tune",void 0),this.mode="restore",this.type="brush",this.setUpToolBar=()=>{var t,e,i,a,o,c,h,l;let d=(0,r.T)("div",{className:"options-panel"});this.right.append(d);let u=(0,r.T)("div",{className:"tool-panel"});u.innerHTML+=`\n            <div>${(0,s.Z)("tool")}</div>\n            <ul class="tool-selector pad-10">\n                <li id="tool-brush" class="marked" tooltip="${(0,s.Z)("draw")}" flow="up"><div><img src="/img/tool/thick/draw-alternative.svg" width="28" height="28" class="ic"></div></li>\n                <li id="tool-magic" tooltip="${(0,s.Z)("magic")}" flow="up"><div><img src="/img/tool/thick/wand.svg" width="28" height="28" class="ic"></div></li>\n                <li id="tool-lasso" tooltip="${(0,s.Z)("lasso")}" flow="up"><div><img src="/img/tool/thick/lasso.svg" width="28" height="28" class="ic"></div></li>\n            </ul>\n\n            <div class="pad-40">${(0,s.Z)("mode")}</div>\n            <div class="switch-field big stretch">\n                <input type="radio" id="mode-restore" name="mode" value="restore" checked><label for="mode-restore">${(0,s.Z)("restore")} </label>\n                <input type="radio" id="mode-remove" name="mode" value="remove"><label for="mode-remove">${(0,s.Z)("remove")}</label>\n            </div>\n            \n            <div class="pad-40">${(0,s.Z)("softness")}</div>\n            <div class="switch-field big stretch">\n                <input type="radio" id="softness-none" name="softness" value="0" checked><label for="softness-none">${(0,s.Z)("none")}</label>\n                <input type="radio" id="softness-light" name="softness" value="0.1"><label for="softness-light">${(0,s.Z)("light")}</label>\n                <input type="radio" id="softness-medium" name="softness" value="0.5"><label for="softness-medium">${(0,s.Z)("medium")}</label>\n            </div>\n            <div id="size" class="pad-40"></div>\n            <div id="tolerance" class="pad-40"></div>\n        `,d.append(u,(0,r.T)("div",{className:"button positive big pad-50",onclick:this.apply,style:"display:block"},(0,s.Z)("apply")),(0,r.T)("div",{className:"button negative med pad-16",onclick:this.cleanUp,style:"display:block"},(0,s.Z)("cancel"))),null===(t=(0,r.ZP)("tool-brush"))||void 0===t||t.addEventListener("click",(()=>this.selectTool("brush")),!1),null===(e=(0,r.ZP)("tool-magic"))||void 0===e||e.addEventListener("click",(()=>this.selectTool("magic")),!1),null===(i=(0,r.ZP)("tool-lasso"))||void 0===i||i.addEventListener("click",(()=>this.selectTool("lasso")),!1),null===(a=(0,r.ZP)("mode-restore"))||void 0===a||a.addEventListener("change",(()=>this.setMode("restore")),!1),null===(o=(0,r.ZP)("mode-remove"))||void 0===o||o.addEventListener("change",(()=>this.setMode("remove")),!1),null===(c=(0,r.ZP)("softness-none"))||void 0===c||c.addEventListener("change",this.updateBrush,!1),null===(h=(0,r.ZP)("softness-light"))||void 0===h||h.addEventListener("change",this.updateBrush,!1),null===(l=(0,r.ZP)("softness-medium"))||void 0===l||l.addEventListener("change",this.updateBrush,!1),this.size=new n.Z("size",{label:(0,s.Z)("size"),range:[1,500],step:1,defaultValue:50,labelFormat:t=>t+"px",onEnd:t=>{this.updateBrush()}}),this.tolerance=new n.Z("tolerance",{defaultValue:.32,label:(0,s.Z)("tolerance")+":",labelFormat:t=>(100*t).toFixed(0),labelParse:t=>parseInt(t,10)/100})},this.selectTool=t=>{var e,i,s,n;null===(e=(0,r.ZP)("tool-brush"))||void 0===e||e.classList.remove("marked"),null===(i=(0,r.ZP)("tool-magic"))||void 0===i||i.classList.remove("marked"),null===(s=(0,r.ZP)("tool-lasso"))||void 0===s||s.classList.remove("marked"),null===(n=(0,r.ZP)("tool-"+t))||void 0===n||n.classList.add("marked"),this.type=t,"brush"===this.type?this.updateBrush():(this.stage.coating.removeCursorImage(),this.stage.raster.style.cursor="crosshair"),(0,r.ZP)("size").style.display="brush"===t?"block":"none",(0,r.ZP)("tolerance").style.display="magic"===t?"block":"none"},this.setMode=t=>{if(this.mode=t,(0,r.ZP)("mode-remove").checked="remove"===this.mode,(0,r.ZP)("mode-restore").checked="restore"===this.mode,"brush"===this.type)this.updateBrush()},this.resize=()=>{this.stage.resize(0,0,this.left.offsetWidth,this.left.offsetHeight)},this.zoomChange=()=>{if("brush"===this.type)this.updateBrush()},this.isKeyDown=!1,this.keyDown=t=>{if(!this.isKeyDown)if(this.isKeyDown=!0,"Shift"!==t.key)if("Escape"!==t.key){if("Enter"!==t.key)return" "===t.key?(this.stage.coating.cursorImage.remove(),this.stage.coating.setPan(),void t.preventDefault()):void 0;this.apply()}else this.cleanUp();else this.setMode("restore"===this.mode?"remove":"restore")},this.keyUp=t=>(this.isKeyDown=!1,"Shift"===t.key?(this.isKeyDown=!1,void this.setMode("restore"===this.mode?"remove":"restore")):" "===t.key?(this.stage.coating.removePan(),this.updateBrush(),void t.preventDefault()):void 0),this.updateBrush=()=>{"brush"===this.type&&(this.brush||(this.brush=new d.Z(new f.Z)),this.brush.settings.size=this.size.getValue(),this.brush.settings.softness=Number(document.querySelector('input[name="softness"]:checked').value),this.brush.generate("restore"===this.mode?new l.Z(0,255,0,255):new l.Z(255,0,0,255)),this.stage.coating.setCursorImage(this.brush.getCursorImage(this.stage.zoom)))},this.down=t=>{if(this.downPoint=t,"magic"!==this.type){switch(this.type){case"brush":this.downDraw(t);break;case"lasso":this.downLasso(t)}this.addMoveListeners()}else this.applyMagic(t)},this.move=t=>{switch(this.type){case"brush":this.moveDraw(t);break;case"lasso":this.moveLasso(t)}},this.up=t=>{switch(this.removeMoveListeners(),this.type){case"brush":this.applyDraw();break;case"lasso":this.applyLasso()}},this.applyMagic=t=>{if((t=this.stage.translateRasterToFresco(t)).x<0||t.y<0||t.x>this.selected.canvas.width||t.y>this.selected.canvas.height)return;let e=Number(document.querySelector('input[name="softness"]:checked').value),i=this.selected.canvas.getContext("2d").getImageData(t.x,t.y,1,1).data,s=new l.Z(i[0],i[1],i[2],i[3]);if(0===s.a&&"remove"===this.mode&&0===e)return;const n=100*this.tolerance.getValue();let a=(this.selected.baked&&"remove"===this.mode?this.selected.baked:this.selected.canvas).getContext("2d").getImageData(0,0,this.selected.canvas.width,this.selected.canvas.height);this.cpx=new Uint32Array(a.data.buffer);let r=this.scratch.ctx.getImageData(0,0,this.scratch.canvas.width,this.scratch.canvas.height);this.mpx=new Uint32Array(r.data.buffer),this.floodFill(t,s,n,0!==e),this.scratch.ctx.putImageData(r,0,0),this.cpx=null,this.mpx=null,this.drawToMask(e)},this.floodFill=(t,e,i,s)=>{let n=this.selected.canvas.width,a=this.selected.canvas.height,r=new Array,o=new Array(n*a);for(this.linearFill(t.x,t.y,e,i,s,r,o);r.length>0;)for(var c=r.shift(),h=c.start;h<=c.stop;++h)c.row>0&&!o[(c.row-1)*n+h]&&this.linearFill(h,c.row-1,e,i,s,r,o),c.row<a-1&&!o[(c.row+1)*n+h]&&this.linearFill(h,c.row+1,e,i,s,r,o)},this.linearFill=(t,e,i,s,n,r,o)=>{var c=this.selected.canvas.width;o[c*e+t]=!0;var h=t,l=t;if(this.tolerate(c*e+t,i,s)){for(this.mpx[c*e+t]=4294967295,h=t-1,l=t+1;h>=0&&!o[c*e+h];){if(o[c*e+h]=!0,!this.tolerate(c*e+h,i,s)){n&&(this.mpx[c*e+h]=4294967295);break}this.mpx[c*e+h]=4294967295,--h}for(;l<c&&!o[c*e+l];){if(o[c*e+l]=!0,!this.tolerate(c*e+l,i,s)){n&&(this.mpx[c*e+l]=4294967295);break}this.mpx[c*e+l]=4294967295,++l}r.push(new a.Z(h+1,l-1,e))}else n&&(this.mpx[c*e+h]=4294967295)},this.tolerate=(t,e,i)=>{let s,n,a,r,o,c,h;return n=0,a=this.cpx[t],r=a>>24&255,r=e.a-r,s=r<0?-r:r,s>n&&(n=s),e.a>0&&(h=a>>16&255,c=a>>8&255,o=255&a,o=e.r-o,s=o<0?-o:o,s>n&&(n=s),c=e.g-c,s=c<0?-c:c,s>n&&(n=s),h=e.b-h,s=h<0?-h:h,s>n&&(n=s)),n<i},this.downDraw=t=>{this.x=this.y=-1,this.scratch.settings.opacity=.4,this.moveDraw(t)},this.x=-1,this.y=-1,this.moveDraw=t=>{let e=this.brush.getStep(),i=!1;if(t=this.stage.translateRasterToFresco(t),-1===this.x&&(this.lx=t.x,this.ly=t.y,this.x=t.x,this.y=t.y,this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),i=!0),t.x!==this.x||t.y!==this.y){let s=t.x-this.x,n=t.y-this.y,a=s>0?1:-1,r=n>0?1:-1;if(s=s<0?-s:s,n=n<0?-n:n,s>n){let t=.5*s;for(let o=1;o<=s;o++)this.x+=a,t+=n,t>=s&&(t-=s,this.y+=r),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,i=!0)}else{let t=.5*n;for(let o=1;o<=n;o++)this.y+=r,t+=s,t>=n&&(t-=n,this.x+=a),(this.x>this.lx+e||this.x<this.lx-e||this.y>this.ly+e||this.y<this.ly-e)&&(this.scratch.ctx.drawImage(this.brush.canvas,this.x-~~(this.brush.canvas.width/2),this.y-~~(this.brush.canvas.height/2)),this.lx=this.x,this.ly=this.y,i=!0)}}i&&window.requestAnimationFrame((()=>this.stage.render()))},this.applyDraw=()=>{this.drawToMask(0)},this.downLasso=t=>{this.points=[]},this.moveLasso=t=>{this.stage.coating.ctx.save(),this.points.push(t),this.stage.raster.style.opacity="0.6",this.stage.coating.ctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.stage.coating.ctx.strokeStyle="restore"===this.mode?"#00ff00":"#ff0000",this.stage.coating.ctx.lineWidth=2,this.stage.coating.ctx.lineCap="round",this.stage.coating.ctx.setLineDash([6]),this.stage.coating.ctx.beginPath(),this.stage.coating.ctx.moveTo(this.points[0].x,this.points[0].y),this.points.forEach((t=>{this.stage.coating.ctx.lineTo(t.x,t.y)})),this.stage.coating.ctx.stroke(),this.stage.coating.ctx.restore()},this.applyLasso=()=>{if(this.stage.raster.style.opacity="1",this.stage.coating.ctx.clearRect(0,0,this.stage.raster.width,this.stage.raster.height),this.points.length<2)return;const t=this.points.map((t=>this.stage.translateRasterToFresco(t)));let e=Number(document.querySelector('input[name="softness"]:checked').value);this.scratch.ctx.beginPath(),this.scratch.ctx.moveTo(t[0].x,t[0].y),t.forEach((t=>this.scratch.ctx.lineTo(t.x,t.y))),this.scratch.ctx.fill(),this.drawToMask(e)},this.renderMask=()=>{this.selected.render(),this.stage.render()},this.apply=()=>{this.callback&&this.callback(this.selected.mask),this.cleanUp()},this.cleanUp=()=>{this.removeDownListeners(),this.left=void 0,this.right=void 0,this.layer=void 0,this.stage.cleanUp(),this.stage=void 0,this.navigator.cleanUp(),this.navigator=void 0,window.removeEventListener("resize",this.resize),document.removeEventListener("resize",this.resize),document.removeEventListener("keyup",this.keyUp),document.removeEventListener("keydown",this.keyDown),document.removeEventListener("zoom-change",this.zoomChange),this.overspace.remove()},this.overspace=(0,r.T)("div",{id:"overspace"}),document.body.appendChild(this.overspace),this.left=(0,r.T)("div",{className:"left flatbox",style:"overflow:hidden"}),this.overspace.append(this.left),this.right=(0,r.T)("div",{className:"right"}),this.overspace.append(this.right),this.callback=i,this.stage=new u.Z(this.left),this.navigator=new g.Z(this.stage,this.left),this.setUpToolBar(),this.stage.addTab(new p.Z(c.M8(),"name",t.width,t.height),"create",!0,!0),this.layer=new v.Z(c.M8(),"original",t,new o.Z(0,0,t.width,t.height)),this.layer.mask=c.dN(e),this.layer.render(),this.stage.fresco.addLayer(this.layer),this.selected=this.stage.fresco.getSelected(),this.scratch=this.stage.fresco.addScratch(),this.scratch.setTarget(this.selected.id,this.selected.rect,"over"),window.addEventListener("resize",this.resize),document.addEventListener("resize",this.resize),document.addEventListener("zoom-change",this.zoomChange),document.addEventListener("keydown",this.keyDown),document.addEventListener("keyup",this.keyUp),document.dispatchEvent(new CustomEvent("resize")),document.dispatchEvent(new CustomEvent("layer-list-render")),this.addDownListeners(),this.stage.setZoom("fit"),this.selectTool("brush")}drawToMask(t){if(t){let e=new m.Z;e.addShader("blur",t),this.scratch.replaceCanvas(e.apply(this.scratch.canvas))}if(!c.l(this.scratch.canvas))return;const e=this.selected.mask.getContext("2d");e.save(),"remove"===this.mode&&(e.globalCompositeOperation="destination-out"),e.drawImage(this.scratch.canvas,0,0),e.restore(),this.scratch.clear(),this.renderMask()}}},33506:(t,e,i)=>{i.d(e,{a:()=>n});var s=i(93947);const n=function(){let t;const e=(0,s.ZP)("current_user");if(e&&"null"!==e.innerText)try{t=JSON.parse(e.innerText)}catch(n){console.error("Could not read user data json")}const i=new URL(location.href);return t&&"pixlr.com"!==i.hostname&&"true"===i.searchParams.get("premium")&&(t.subscription=!0,t.subscriptionAccess="premium"),t}()},33655:(t,e,i)=>{i.d(e,{$E:()=>u,Ai:()=>f,Dc:()=>L,HS:()=>A,L5:()=>D,M8:()=>M,ST:()=>x,TA:()=>a,Td:()=>l,UF:()=>c,WL:()=>b,Xj:()=>S,ZE:()=>v,Zd:()=>_,_c:()=>m,dN:()=>k,eY:()=>y,fg:()=>w,l:()=>E,lI:()=>p,lU:()=>d,mS:()=>r,q7:()=>o,qT:()=>g,uZ:()=>T,vL:()=>h,vO:()=>C,x2:()=>P,zs:()=>Z});var s=i(36817),n=i(43673);const a="rgb(209,72,14)";function r(t,e){if(void 0===e)return;if(e instanceof t)return e;const i=Object.create(t.prototype);return Object.assign(i,e)}function o(t,e,i,s){let n;return n=t/e>i/s?i/t:s/e,n>1?1:n}function c(t,e,i,s){return t/e<i/s?i/t:s/e}function h(t,e){t<0&&(t=1),e<0&&(e=1);let i=document.createElement("canvas");return i.width=t,i.height=e,i}async function l(t){if(!t)return;const e=URL.createObjectURL(t),i=await d(e);return URL.revokeObjectURL(e),i}function d(t){if(void 0!==t)return new Promise(((e,i)=>{if(!t)return console.log("Invalid URL in dataURLToCanvas"),void e(void 0);const s=document.createElement("canvas"),n=s.getContext("2d"),a=new Image;a.onerror=t=>i(t),a.onload=()=>{s.width=a.width,s.height=a.height,n.drawImage(a,0,0),e(s)},a.src=t}))}function u(t,e){if(!t)return;const i=e||new s.Z(0,0,t.width,t.height);return t.getContext("2d").getImageData(i.x,i.y,i.width,i.height)}function m(t,e){if(!t)return;const i=e||new s.Z(0,0,t.width,t.height),n=h(i.width,i.height);return n.getContext("2d").drawImage(t,-i.x,-i.y),new Promise(((t,e)=>n.toBlob(t)))}function p(t,e,i){if(!t||!e)return;let s=t.getContext("2d");s.save(),s.globalCompositeOperation="copy",s.drawImage(e,i.x,i.y),s.restore(),s=void 0}function g(t,e,i=0){let n=h(t.width,t.height),a=n.getContext("2d",{colorSpace:"srgb"});if(a.drawImage(t,0,0,t.width,t.height),a=void 0,n.width>e||n.height>e){let i=s.Z.bestFit(t.width,t.height,e,e);n=f(n,i.width,i.height)}return 0!==i&&(n=S(n,i)),n}function v(t,e,i){if(!t)return;let s=h(e,i);var n=t.getContext("2d").getImageData(0,0,t.width,t.height),a=new Int32Array(n.data.buffer),r=t.width,o=t.height,c=s.width,l=s.height,d=s.getContext("2d").getImageData(0,0,s.width,s.height),u=new Int32Array(d.data.buffer);const m=c/r,p=l/o;for(let h=0;h<l;){const t=r*~~(h/p),e=c*h++;for(let i=0;i<c;)u[e+i++]=a[t+~~(i/m)]}return s.getContext("2d").putImageData(d,0,0),s}function f(t,e,i,s){var n;if(!t)return;if(e>t.width||i>t.width)return y(t,e,i);let a=null!==(n=s)&&void 0!==n?n:h(e,i);for(var r=t.getContext("2d").getImageData(0,0,t.width,t.height).data,o=t.width,c=t.height,l=a.width,d=a.height,u=a.getContext("2d").getImageData(0,0,a.width,a.height),m=u.data,p=o/l,g=c/d,v=Math.ceil(p/2),f=Math.ceil(g/2),w=0;w<d;w++)for(var x=0;x<l;x++){for(var b=4*(x+w*l),k=0,S=0,Z=0,P=0,E=0,C=0,M=(w+.5)*g,_=Math.floor(w*g);_<(w+1)*g;_++)for(var T=Math.abs(M-(_+.5))/f,L=(x+.5)*p,A=T*T,D=Math.floor(x*p);D<(x+1)*p;D++){var I=Math.abs(L-(D+.5))/v,R=Math.sqrt(A+I*I);R>=-1&&R<=1&&(k=2*R*R*R-3*R*R+1)>0&&(Z+=k*r[I=4*(D+_*o)],P+=k*r[I+1],E+=k*r[I+2],C+=k*r[I+3],S+=k)}m[b]=Z/S,m[b+1]=P/S,m[b+2]=E/S,m[b+3]=C/S}return a.getContext("2d").putImageData(u,0,0),a}function y(t,e,i,s=!0,n){if(!t)return;e<1&&(e=1),i<1&&(i=1);let a=null!=n?n:h(e,i);var r=a.getContext("2d");return r.imageSmoothingQuality="high",r.imageSmoothingEnabled=s,r.drawImage(t,0,0,a.width,a.height),r=void 0,a}function w(t,e){let i=h(e.width,e.height),s=i.getContext("2d");return s.drawImage(t,-e.x,-e.y),s=void 0,i}function x(t,e,i){let s=h(i.width,i.height),n=s.getContext("2d");return n.imageSmoothingQuality="high",n.imageSmoothingEnabled=!0,n.drawImage(t,e.x-i.x,e.y-i.y,e.width,e.height),n=void 0,s}function b(t,e){if(t){var i=document.createElement("canvas"),s=i.getContext("2d");return i.width=e.width,i.height=e.height,s.drawImage(t,-e.x,-e.y),s=void 0,i}}function k(t){if(t){var e=document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i=void 0,e}}function S(t,e){if(t){var i=h(t.width,t.height),s=i.getContext("2d");return 180!==e&&(i.width=t.height,i.height=t.width),s.translate(i.width/2,i.height/2),s.rotate(e*Math.PI/180),s.drawImage(t,-t.width/2,-t.height/2),s.setTransform(1,0,0,1,0,0),s=void 0,i}}function Z(t,e,i){let s=h(i.width,i.height),n=s.getContext("2d");return n.save(),n.translate(i.width/2,i.height/2),n.rotate(e*Math.PI/180),n.drawImage(t,-t.width/2,-t.height/2),n.restore(),n=null,s}function P(t,e){if(t){var i=h(t.width,t.height),s=i.getContext("2d");return s.save(),e?(s.scale(1,-1),s.drawImage(t,0,-t.height,t.width,t.height)):(s.scale(-1,1),s.drawImage(t,-t.width,0,t.width,t.height)),s.restore(),s=void 0,i}}function E(t){if(!t)return;const e=t.width,i=t.height;return C(t.getContext("2d",{willReadFrequently:!0}).getImageData(0,0,e,i))}function C(t){if(!t)return;const e=t.width,i=t.height;let n,a,r=new Uint32Array(t.data.buffer),o=-1,c=-1,h=-1,l=-1;for(a=0;a<i;++a){for(n=0;n<e;++n)if(r[n+a*e]>0){c=a;break}if(-1!==c)break}if(-1!==c){for(a=i-1;a>=c;--a){for(n=0;n<e;++n)if(r[n+a*e]>0){l=a+1;break}if(-1!==l)break}for(n=0;n<e;++n){for(a=c;a<=l;++a)if(r[n+a*e]>0){o=n;break}if(-1!==o)break}for(n=e-1;n>=o;--n){for(a=c;a<=l;++a)if(r[n+a*e]>0){h=n+1;break}if(-1!==h)break}return new s.Z(o,c,h-o,l-c)}}function M(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function _(){return"xxxxyxxx4xxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0;return("x"==t?e:3&e|8).toString(16)}))}function T(t,e,i){return isNaN(t)?e:Math.min(Math.max(t,e),i)}function L(t){return new Promise(((e,i)=>{setTimeout((()=>e()),t)}))}function A(t){let e=new n.Z(t.offsetLeft,t.offsetTop);for(;t.offsetParent&&(e.x=e.x+t.offsetParent.offsetLeft,e.y=e.y+t.offsetParent.offsetTop,t!=document.getElementsByTagName("body")[0]);)t=t.offsetParent;return e}class D{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}then(t,e){return this.promise.then(t,e)}catch(t){return this.promise.catch(t)}finally(t){return this.promise.finally(t)}}Symbol.toStringTag;Error},72982:(t,e,i)=>{i.a(t,(async(s,n)=>{try{var a,r=s([a=i(82646)]),[a]=r.then?(await r)():r;await i.v(e,t.id,"6e346a770e88fb798d2d",{"./pixlr_bg.js":{__wbindgen_string_new:a.h4,__wbg_x_7af334499c70ecf9:a.ut,__wbg_y_7b2e0b17f2702db7:a.qY,__wbg_width_9a7937fdc4208452:a.nx,__wbg_height_c0440005f53e9792:a.Wy,__wbindgen_memory:a.oH,__wbg_buffer_3f3d764d4747d564:a.jp,__wbg_newwithbyteoffsetandlength_b79525f5b383cdb2:a.gI,__wbindgen_object_drop_ref:a.ug,__wbg_new_4c0b35176d4e6c47:a.BY,__wbindgen_throw:a.Or}}),n()}catch(o){n(o)}}),1)}},h={};function l(t){var e=h[t];if(void 0!==e)return e.exports;var i=h[t]={id:t,loaded:!1,exports:{}};return c[t](i,i.exports,l),i.loaded=!0,i.exports}l.m=c,t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&!t.d&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},l.a=(n,a,r)=>{var o;r&&((o=[]).d=1),o&&(o.moduleId=n.id);var c,h,l,d=new Set,u=n.exports,m=new Promise(((t,e)=>{l=e,h=t}));m[e]=u,m[t]=t=>(o&&t(o),d.forEach(t),m.catch((t=>{}))),m.moduleId=n.id,n.exports=m,a((n=>{var a;c=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[t])return n;if(n.then){var a=[];a.d=0,n.then((t=>{r[e]=t,s(a)}),(t=>{r[i]=t,s(a)}));var r={};return r[t]=t=>t(a),r}}var o={};return o[t]=t=>{},o[e]=n,o})))(n);var r=()=>c.map((t=>{if(t[i])throw t[i];return t[e]})),h=new Promise((e=>{(a=()=>e(r)).r=0;var i=t=>t!==o&&!d.has(t)&&(d.add(t),t&&!t.d&&(a.r++,t.push(a)));c.map((e=>e[t](i)))}));return a.r?h:r()}),(t=>(t?l(m[i]=t):h(u),s(o)))),o&&(o.d=0)},l.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return l.d(e,{a:e}),e},a=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,l.t=function(t,e){if(1&e&&(t=this(t)),8&e)return t;if("object"==typeof t&&t){if(4&e&&t.__esModule)return t;if(16&e&&"function"==typeof t.then)return t}var i=Object.create(null);l.r(i);var s={};n=n||[null,a({}),a([]),a(a)];for(var r=2&e&&t;"object"==typeof r&&!~n.indexOf(r);r=a(r))Object.getOwnPropertyNames(r).forEach((e=>s[e]=()=>t[e]));return s.default=()=>t,l.d(i,s),i},l.d=(t,e)=>{for(var i in e)l.o(e,i)&&!l.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},l.f={},l.e=t=>Promise.all(Object.keys(l.f).reduce(((e,i)=>(l.f[i](t,e),e)),[])),l.u=t=>(({1477:"checkout.modal",2556:"tiff",4500:"pdf-lib",5215:"native",6600:"adyen"}[t]||t)+"."+{630:"4926b999c5b1aa4e682b",979:"a9d4f94d1acc1b2e035e",1477:"04d8fd7fe6fbb0a9dccb",1562:"b2f23a17be955c413f98",1633:"bca408a432aca422601b",1977:"89c716bdfd95beb917a1",2312:"2fd7b3b3429155b9194f",2501:"0e62a93348f468613965",2513:"f48dcc4df2e8f946a302",2556:"4f70bc66cc921f2e9f34",2638:"c703f43a369bc1c758fc",3997:"7b9b51d90111e121d898",4184:"ed7dd98ffe72bfc36821",4495:"ca6cc6e40224ccd33bef",4500:"6e0f0f87cf07a7bf1c45",4886:"5a88193c64749d4a6b45",4905:"decc471637174350cd4d",5126:"347d9f5aa6cd9ab95979",5215:"a63a284d32e4c2c63a9c",5289:"256498886f282b787803",6600:"0aff1048b701bce81868",7250:"bf5506039142aafaf875",7251:"abea7bec738cb6eedafb",7391:"e79e94b7e6c04e34855a",7392:"a8a921f00c0cc9c0b792",7630:"682dfb21527a726fe020",8030:"b387797e56823649a39f",8132:"ec22adaf1ead93576299",9304:"c861181918e8e885244c",9316:"7201d6229987d809759d"}[t]+".js"),l.miniCssF=t=>{},l.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),l.hmd=t=>((t=Object.create(t)).children||(t.children=[]),Object.defineProperty(t,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+t.id)}}),t),l.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r={},o="pixlr:",l.l=(t,e,i,s)=>{if(r[t])r[t].push(e);else{var n,a;if(void 0!==i)for(var c=document.getElementsByTagName("script"),h=0;h<c.length;h++){var d=c[h];if(d.getAttribute("src")==t||d.getAttribute("data-webpack")==o+i){n=d;break}}n||(a=!0,(n=document.createElement("script")).charset="utf-8",n.timeout=120,l.nc&&n.setAttribute("nonce",l.nc),n.setAttribute("data-webpack",o+i),n.src=t),r[t]=[e];var u=(e,i)=>{n.onerror=n.onload=null,clearTimeout(m);var s=r[t];if(delete r[t],n.parentNode&&n.parentNode.removeChild(n),s&&s.forEach((t=>t(i))),e)return e(i)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:n}),12e4);n.onerror=u.bind(null,n.onerror),n.onload=u.bind(null,n.onload),a&&document.head.appendChild(n)}},l.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.j=6372,l.v=(t,e,i,s)=>{var n=fetch(l.p+""+i+".module.wasm");return"function"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(n,s).then((e=>Object.assign(t,e.instance.exports))):n.then((t=>t.arrayBuffer())).then((t=>WebAssembly.instantiate(t,s))).then((e=>Object.assign(t,e.instance.exports)))},l.p="/dist/",(()=>{var t={6372:0,5215:0,8132:0};l.f.j=(e,i)=>{var s=l.o(t,e)?t[e]:void 0;if(0!==s)if(s)i.push(s[2]);else{var n=new Promise(((i,n)=>s=t[e]=[i,n]));i.push(s[2]=n);var a=l.p+l.u(e),r=new Error;l.l(a,(i=>{if(l.o(t,e)&&(0!==(s=t[e])&&(t[e]=void 0),s)){var n=i&&("load"===i.type?"missing":i.type),a=i&&i.target&&i.target.src;r.message="Loading chunk "+e+" failed.\n("+n+": "+a+")",r.name="ChunkLoadError",r.type=n,r.request=a,s[1](r)}}),"chunk-"+e,e)}};var e=(e,i)=>{var s,n,[a,r,o]=i,c=0;if(a.some((e=>0!==t[e]))){for(s in r)l.o(r,s)&&(l.m[s]=r[s]);if(o)o(l)}for(e&&e(i);c<a.length;c++)n=a[c],l.o(t,n)&&t[n]&&t[n][0](),t[n]=0},i=self.webpackChunkpixlr=self.webpackChunkpixlr||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})(),l.nc=void 0;var d=l(81188);bg=d})();